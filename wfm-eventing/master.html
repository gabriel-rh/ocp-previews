<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.16">
<title>Eventing</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;-webkit-tap-highlight-color:transparent}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos{border-right:1px solid;opacity:.35;padding-right:.5em}
pre.pygments .lineno{border-right:1px solid;opacity:.35;display:inline-block;margin-right:.75em}
pre.pygments .lineno::before{content:"";margin-right:-.125em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd),table.stripes-even tr:nth-of-type(even),table.stripes-hover tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
</head>
<body class="article">
<div id="header">
<h1>Eventing</h1>
</div>
<div id="content">
<div class="sect1">
<h2 id="knative-eventing-overview">Knative Eventing</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Knative Eventing on OpenShift Container Platform enables developers to use an <a href="https://www.redhat.com/en/topics/integration/what-is-event-driven-architecture">event-driven architecture</a> with serverless applications. An event-driven architecture is based on the concept of decoupled relationships between event producers and event consumers.</p>
</div>
<div class="paragraph">
<p>Event producers create events, and event <em>sinks</em>, or consumers, receive events. Knative Eventing uses standard HTTP POST requests to send and receive events between event producers and sinks. These events conform to the <a href="https://cloudevents.io">CloudEvents specifications</a>, which enables creating, parsing, sending, and receiving events in any programming language.</p>
</div>
<div class="sect2">
<h3 id="_knative-eventing-use-cases">Knative Eventing use cases:</h3>
<div class="paragraph">
<p>Knative Eventing supports the following use cases:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Publish an event without creating a consumer</dt>
<dd>
<p>You can send events to a broker as an HTTP POST, and use binding to decouple the destination configuration from your application that produces events.</p>
</dd>
<dt class="hdlist1">Consume an event without creating a publisher</dt>
<dd>
<p>You can use a trigger to consume events from a broker based on event attributes. The application receives events as an HTTP POST.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>To enable delivery to multiple types of sinks, Knative Eventing defines the following generic interfaces that can be implemented by multiple Kubernetes resources:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Addressable resources</dt>
<dd>
<p>Able to receive and acknowledge an event delivered over HTTP to an address defined in the <code>status.address.url</code> field of the event. The Kubernetes <code>Service</code> resource also satisfies the addressable interface.</p>
</dd>
<dt class="hdlist1">Callable resources</dt>
<dd>
<p>Able to receive an event delivered over HTTP and transform it, returning <code>0</code> or <code>1</code> new events in the HTTP response payload. These returned events may be further processed in the same way that events from an external event source are processed.</p>
</dd>
</dl>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_event-sources">Event sources</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="knative-event-sources">Event sources</h3>
<div class="paragraph">
<p>A Knative <em>event source</em> can be any Kubernetes object that generates or imports cloud events, and relays those events to another endpoint, known as a <a href="#serverless-event-sinks"><em>sink</em></a>. Sourcing events is critical to developing a distributed system that reacts to events.</p>
</div>
<div class="paragraph">
<p>You can create and manage Knative event sources by using the <strong>Developer</strong> perspective in the OpenShift Container Platform web console, the Knative (<code>kn</code>) CLI, or by applying YAML files.</p>
</div>
<div class="paragraph">
<p>Currently, OpenShift Serverless supports the following event source types:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><a href="#serverless-apiserversource">API server source</a></dt>
<dd>
<p>Brings Kubernetes API server events into Knative. The API server source sends a new event each time a Kubernetes resource is created, updated or deleted.</p>
</dd>
<dt class="hdlist1"><a href="#serverless-pingsource">Ping source</a></dt>
<dd>
<p>Produces events with a fixed payload on a specified cron schedule.</p>
</dd>
<dt class="hdlist1"><a href="#serverless-kafka-developer-source">Kafka event source</a></dt>
<dd>
<p>Connects an Apache Kafka cluster to a sink as an event source.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>You can also create a <a href="#serverless-custom-event-sources">custom event source</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="event-source-admin-perspective">Event source in the Administrator perspective</h3>
<div class="paragraph">
<p>Sourcing events is critical to developing a distributed system that reacts to events.</p>
</div>
<div class="sect3">
<h4 id="serverless-creating-event-source-admin-web-console_event-source-admin-perspective">Creating an event source by using the Administrator perspective</h4>
<div class="paragraph">
<p>A Knative <em>event source</em> can be any Kubernetes object that generates or imports cloud events, and relays those events to another endpoint, known as a <em>sink</em>.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>The OpenShift Serverless Operator and Knative Eventing are installed on your OpenShift Container Platform cluster.</p>
</li>
<li>
<p>You have logged in to the web console and are in the <strong>Administrator</strong> perspective.</p>
</li>
<li>
<p>You have cluster administrator permissions on OpenShift Container Platform, or you have cluster or dedicated administrator permissions on Red Hat OpenShift Service on AWS or OpenShift Dedicated.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the <strong>Administrator</strong> perspective of the OpenShift Container Platform web console, navigate to <strong>Serverless</strong> &#8594; <strong>Eventing</strong>.</p>
</li>
<li>
<p>In the <strong>Create</strong> list, select <strong>Event Source</strong>. You will be directed to the <strong>Event Sources</strong> page.</p>
</li>
<li>
<p>Select the event source type that you want to create.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="serverless-apiserversource">Creating an API server source</h3>
<div class="paragraph">
<p>The API server source is an event source that can be used to connect an event sink, such as a Knative service, to the Kubernetes API server. The API server source watches for Kubernetes events and forwards them to the Knative Eventing broker.</p>
</div>
<div class="sect3">
<h4 id="odc-creating-apiserversource_serverless-apiserversource">Creating an API server source by using the web console</h4>
<div class="paragraph">
<p>After Knative Eventing is installed on your cluster, you can create an API server source by using the web console. Using the OpenShift Container Platform web console provides a streamlined and intuitive user interface to create an event source.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You have logged in to the OpenShift Container Platform web console.</p>
</li>
<li>
<p>The OpenShift Serverless Operator and Knative Eventing are installed on the cluster.</p>
</li>
<li>
<p>You have created a project or have access to a project with the appropriate roles and permissions to create applications and other workloads in OpenShift Container Platform.</p>
</li>
<li>
<p>You have installed the OpenShift CLI (<code>oc</code>).</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="title">Procedure</div>
<div class="paragraph">
<p>If you want to re-use an existing service account, you can modify your existing <code>ServiceAccount</code> resource to include the required permissions instead of creating a new resource.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a service account, role, and role binding for the event source as a YAML file:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: v1
kind: ServiceAccount
metadata:
  name: events-sa
  namespace: default <b class="conum">(1)</b>

---
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: event-watcher
  namespace: default <b class="conum">(1)</b>
rules:
  - apiGroups:
      - ""
    resources:
      - events
    verbs:
      - get
      - list
      - watch

---
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: k8s-ra-event-watcher
  namespace: default <b class="conum">(1)</b>
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: Role
  name: event-watcher
subjects:
  - kind: ServiceAccount
    name: events-sa
    namespace: default <b class="conum">(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Change this namespace to the namespace that you have selected for installing the event source.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Apply the YAML file:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc apply -f &lt;filename&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>In the <strong>Developer</strong> perspective, navigate to <strong>+Add</strong> → <strong>Event Source</strong>. The  <strong>Event Sources</strong> page is displayed.</p>
</li>
<li>
<p>Optional: If you have multiple providers for your event sources, select the required provider from the <strong>Providers</strong> list to filter the available event sources from the provider.</p>
</li>
<li>
<p>Select <strong>ApiServerSource</strong> and then click <strong>Create Event Source</strong>. The  <strong>Create Event Source</strong> page is displayed.</p>
</li>
<li>
<p>Configure the <strong>ApiServerSource</strong> settings by using the <strong>Form view</strong> or <strong>YAML view</strong>:</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>You can switch between the <strong>Form view</strong> and <strong>YAML view</strong>. The data is persisted when switching between the views.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Enter <code>v1</code> as the <strong>APIVERSION</strong> and <code>Event</code> as the <strong>KIND</strong>.</p>
</li>
<li>
<p>Select the <strong>Service Account Name</strong> for the service account that you created.</p>
</li>
<li>
<p>Select the <strong>Sink</strong> for the event source. A <strong>Sink</strong> can be either a <strong>Resource</strong>, such as a channel, broker, or service, or a <strong>URI</strong>.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Click <strong>Create</strong>.</p>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Verification</div>
<ul>
<li>
<p>After you have created the API server source, you will see it connected to the service it is sinked to in the <strong>Topology</strong> view.</p>
<div class="imageblock">
<div class="content">
<img src="images/toplogy-odc-apiserver.png" alt="ApiServerSource Topology view">
</div>
</div>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>If a URI sink is used, modify the URI by right-clicking on <strong>URI sink</strong> &#8594; <strong>Edit URI</strong>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<div class="title">Deleting the API server source</div>
<ol class="arabic">
<li>
<p>Navigate to the <strong>Topology</strong> view.</p>
</li>
<li>
<p>Right-click the API server source and select <strong>Delete ApiServerSource</strong>.</p>
<div class="imageblock">
<div class="content">
<img src="images/delete-apiserversource-odc.png" alt="Delete the ApiServerSource">
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="apiserversource-kn_serverless-apiserversource">Creating an API server source by using the Knative CLI</h4>
<div class="paragraph">
<p>You can use the <code>kn source apiserver create</code> command to create an API server source by using the <code>kn</code> CLI. Using the <code>kn</code> CLI to create an API server source provides a more streamlined and intuitive user interface than modifying YAML files directly.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>The OpenShift Serverless Operator and Knative Eventing are installed on the cluster.</p>
</li>
<li>
<p>You have created a project or have access to a project with the appropriate roles and permissions to create applications and other workloads in OpenShift Container Platform.</p>
</li>
<li>
<p>You have installed the OpenShift CLI (<code>oc</code>).</p>
</li>
<li>
<p>You have installed the Knative (<code>kn</code>) CLI.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="title">Procedure</div>
<div class="paragraph">
<p>If you want to re-use an existing service account, you can modify your existing <code>ServiceAccount</code> resource to include the required permissions instead of creating a new resource.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a service account, role, and role binding for the event source as a YAML file:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: v1
kind: ServiceAccount
metadata:
  name: events-sa
  namespace: default <b class="conum">(1)</b>

---
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: event-watcher
  namespace: default <b class="conum">(1)</b>
rules:
  - apiGroups:
      - ""
    resources:
      - events
    verbs:
      - get
      - list
      - watch

---
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: k8s-ra-event-watcher
  namespace: default <b class="conum">(1)</b>
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: Role
  name: event-watcher
subjects:
  - kind: ServiceAccount
    name: events-sa
    namespace: default <b class="conum">(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Change this namespace to the namespace that you have selected for installing the event source.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Apply the YAML file:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc apply -f &lt;filename&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>Create an API server source that has an event sink. In the following example, the sink is a broker:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ kn source apiserver create &lt;event_source_name&gt; --sink broker:&lt;broker_name&gt; --resource "event:v1" --service-account &lt;service_account_name&gt; --mode Resource</code></pre>
</div>
</div>
</li>
<li>
<p>To check that the API server source is set up correctly, create a Knative service that dumps incoming messages to its log:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ kn service create &lt;service_name&gt; --image quay.io/openshift-knative/knative-eventing-sources-event-display:latest</code></pre>
</div>
</div>
</li>
<li>
<p>If you used a broker as an event sink, create a trigger to filter events from the <code>default</code> broker to the service:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ kn trigger create &lt;trigger_name&gt; --sink ksvc:&lt;service_name&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>Create events by launching a pod in the default namespace:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc create deployment hello-node --image quay.io/openshift-knative/knative-eventing-sources-event-display:latest</code></pre>
</div>
</div>
</li>
<li>
<p>Check that the controller is mapped correctly by inspecting the output generated by the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ kn source apiserver describe &lt;source_name&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">Name:                mysource
Namespace:           default
Annotations:         sources.knative.dev/creator=developer, sources.knative.dev/lastModifier=developer
Age:                 3m
ServiceAccountName:  events-sa
Mode:                Resource
Sink:
  Name:       default
  Namespace:  default
  Kind:       Broker (eventing.knative.dev/v1)
Resources:
  Kind:        event (v1)
  Controller:  false
Conditions:
  OK TYPE                     AGE REASON
  ++ Ready                     3m
  ++ Deployed                  3m
  ++ SinkProvided              3m
  ++ SufficientPermissions     3m
  ++ EventTypesProvided        3m</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">Verification</div>
<p>You can verify that the Kubernetes events were sent to Knative by looking at the message dumper function logs.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Get the pods:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc get pods</code></pre>
</div>
</div>
</li>
<li>
<p>View the message dumper function logs for the pods:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc logs $(oc get pod -o name | grep event-display) -c user-container</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">☁️  cloudevents.Event
Validation: valid
Context Attributes,
  specversion: 1.0
  type: dev.knative.apiserver.resource.update
  datacontenttype: application/json
  ...
Data,
  {
    "apiVersion": "v1",
    "involvedObject": {
      "apiVersion": "v1",
      "fieldPath": "spec.containers{hello-node}",
      "kind": "Pod",
      "name": "hello-node",
      "namespace": "default",
       .....
    },
    "kind": "Event",
    "message": "Started container",
    "metadata": {
      "name": "hello-node.159d7608e3a3572c",
      "namespace": "default",
      ....
    },
    "reason": "Started",
    ...
  }</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="olist arabic">
<div class="title">Deleting the API server source</div>
<ol class="arabic">
<li>
<p>Delete the trigger:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ kn trigger delete &lt;trigger_name&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>Delete the event source:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ kn source apiserver delete &lt;source_name&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>Delete the service account, cluster role, and cluster binding:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc delete -f authentication.yaml</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="sect4">
<h5 id="specifying-sink-flag-kn_serverless-apiserversource">Knative CLI sink flag</h5>
<div class="paragraph">
<p>When you create an event source by using the Knative (<code>kn</code>) CLI, you can specify a sink where events are sent to from that resource by using the <code>--sink</code> flag. The sink can be any addressable or callable resource that can receive incoming events from other resources.</p>
</div>
<div class="paragraph">
<p>The following example creates a sink binding that uses a service, <code>http://event-display.svc.cluster.local</code>, as the sink:</p>
</div>
<div class="listingblock">
<div class="title">Example command using the sink flag</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ kn source binding create bind-heartbeat \
  --namespace sinkbinding-example \
  --subject "Job:batch/v1:app=heartbeat-cron" \
  --sink http://event-display.svc.cluster.local \ <b class="conum">(1)</b>
  --ce-override "sink=bound"</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p><code>svc</code> in <code>http://event-display.svc.cluster.local</code> determines that the sink is a Knative service. Other default sink prefixes include <code>channel</code>, and <code>broker</code>.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="apiserversource-yaml_context">Creating an API server source by using YAML files</h4>
<div class="paragraph">
<p>Creating Knative resources by using YAML files uses a declarative API, which enables you to describe event sources declaratively and in a reproducible manner. To create an API server source by using YAML, you must create a YAML file that defines an <code>ApiServerSource</code> object, then apply it by using the <code>oc apply</code> command.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>The OpenShift Serverless Operator and Knative Eventing are installed on the cluster.</p>
</li>
<li>
<p>You have created a project or have access to a project with the appropriate roles and permissions to create applications and other workloads in OpenShift Container Platform.</p>
</li>
<li>
<p>You have created the <code>default</code> broker in the same namespace as the one defined in the API server source YAML file.</p>
</li>
<li>
<p>Install the OpenShift CLI (<code>oc</code>).</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="title">Procedure</div>
<div class="paragraph">
<p>If you want to re-use an existing service account, you can modify your existing <code>ServiceAccount</code> resource to include the required permissions instead of creating a new resource.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a service account, role, and role binding for the event source as a YAML file:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: v1
kind: ServiceAccount
metadata:
  name: events-sa
  namespace: default <b class="conum">(1)</b>

---
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: event-watcher
  namespace: default <b class="conum">(1)</b>
rules:
  - apiGroups:
      - ""
    resources:
      - events
    verbs:
      - get
      - list
      - watch

---
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: k8s-ra-event-watcher
  namespace: default <b class="conum">(1)</b>
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: Role
  name: event-watcher
subjects:
  - kind: ServiceAccount
    name: events-sa
    namespace: default <b class="conum">(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Change this namespace to the namespace that you have selected for installing the event source.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Apply the YAML file:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc apply -f &lt;filename&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>Create an API server source as a YAML file:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: sources.knative.dev/v1alpha1
kind: ApiServerSource
metadata:
  name: testevents
spec:
  serviceAccountName: events-sa
  mode: Resource
  resources:
    - apiVersion: v1
      kind: Event
  sink:
    ref:
      apiVersion: eventing.knative.dev/v1
      kind: Broker
      name: default</code></pre>
</div>
</div>
</li>
<li>
<p>Apply the <code>ApiServerSource</code> YAML file:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc apply -f &lt;filename&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>To check that the API server source is set up correctly, create a Knative service as a YAML file that dumps incoming messages to its log:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: serving.knative.dev/v1
kind: Service
metadata:
  name: event-display
  namespace: default
spec:
  template:
    spec:
      containers:
        - image: quay.io/openshift-knative/knative-eventing-sources-event-display:latest</code></pre>
</div>
</div>
</li>
<li>
<p>Apply the <code>Service</code> YAML file:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc apply -f &lt;filename&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>Create a <code>Trigger</code> object as a YAML file that filters events from the <code>default</code> broker to the service created in the previous step:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: eventing.knative.dev/v1
kind: Trigger
metadata:
  name: event-display-trigger
  namespace: default
spec:
  broker: default
  subscriber:
    ref:
      apiVersion: serving.knative.dev/v1
      kind: Service
      name: event-display</code></pre>
</div>
</div>
</li>
<li>
<p>Apply the <code>Trigger</code> YAML file:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc apply -f &lt;filename&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>Create events by launching a pod in the default namespace:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc create deployment hello-node --image=quay.io/openshift-knative/knative-eventing-sources-event-display</code></pre>
</div>
</div>
</li>
<li>
<p>Check that the controller is mapped correctly, by entering the following command and inspecting the output:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc get apiserversource.sources.knative.dev testevents -o yaml</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: sources.knative.dev/v1alpha1
kind: ApiServerSource
metadata:
  annotations:
  creationTimestamp: "2020-04-07T17:24:54Z"
  generation: 1
  name: testevents
  namespace: default
  resourceVersion: "62868"
  selfLink: /apis/sources.knative.dev/v1alpha1/namespaces/default/apiserversources/testevents2
  uid: 1603d863-bb06-4d1c-b371-f580b4db99fa
spec:
  mode: Resource
  resources:
  - apiVersion: v1
    controller: false
    controllerSelector:
      apiVersion: ""
      kind: ""
      name: ""
      uid: ""
    kind: Event
    labelSelector: {}
  serviceAccountName: events-sa
  sink:
    ref:
      apiVersion: eventing.knative.dev/v1
      kind: Broker
      name: default</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">Verification</div>
<p>To verify that the Kubernetes events were sent to Knative, you can look at the message dumper function logs.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Get the pods by entering the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc get pods</code></pre>
</div>
</div>
</li>
<li>
<p>View the message dumper function logs for the pods by entering the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc logs $(oc get pod -o name | grep event-display) -c user-container</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">☁️  cloudevents.Event
Validation: valid
Context Attributes,
  specversion: 1.0
  type: dev.knative.apiserver.resource.update
  datacontenttype: application/json
  ...
Data,
  {
    "apiVersion": "v1",
    "involvedObject": {
      "apiVersion": "v1",
      "fieldPath": "spec.containers{hello-node}",
      "kind": "Pod",
      "name": "hello-node",
      "namespace": "default",
       .....
    },
    "kind": "Event",
    "message": "Started container",
    "metadata": {
      "name": "hello-node.159d7608e3a3572c",
      "namespace": "default",
      ....
    },
    "reason": "Started",
    ...
  }</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="olist arabic">
<div class="title">Deleting the API server source</div>
<ol class="arabic">
<li>
<p>Delete the trigger:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc delete -f trigger.yaml</code></pre>
</div>
</div>
</li>
<li>
<p>Delete the event source:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc delete -f k8s-events.yaml</code></pre>
</div>
</div>
</li>
<li>
<p>Delete the service account, cluster role, and cluster binding:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc delete -f authentication.yaml</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="serverless-pingsource">Creating a ping source</h3>
<div class="paragraph">
<p>A ping source is an event source that can be used to periodically send ping events with a constant payload to an event consumer. A ping source can be used to schedule sending events, similar to a timer.</p>
</div>
<div class="sect3">
<h4 id="serverless-pingsource-odc_serverless-pingsource">Creating a ping source by using the web console</h4>
<div class="paragraph">
<p>After Knative Eventing is installed on your cluster, you can create a ping source by using the web console. Using the OpenShift Container Platform web console provides a streamlined and intuitive user interface to create an event source.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You have logged in to the OpenShift Container Platform web console.</p>
</li>
<li>
<p>The OpenShift Serverless Operator, Knative Serving and Knative Eventing are installed on the cluster.</p>
</li>
<li>
<p>You have created a project or have access to a project with the appropriate roles and permissions to create applications and other workloads in OpenShift Container Platform.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>To verify that the ping source is working, create a simple Knative
service that dumps incoming messages to the logs of the service.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>In the <strong>Developer</strong> perspective, navigate to <strong>+Add</strong> &#8594; <strong>YAML</strong>.</p>
</li>
<li>
<p>Copy the example YAML:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: serving.knative.dev/v1
kind: Service
metadata:
  name: event-display
spec:
  template:
    spec:
      containers:
        - image: quay.io/openshift-knative/knative-eventing-sources-event-display:latest</code></pre>
</div>
</div>
</li>
<li>
<p>Click <strong>Create</strong>.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Create a ping source in the same namespace as the service created in the previous step, or any other sink that you want to send events to.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>In the <strong>Developer</strong> perspective, navigate to <strong>+Add</strong> &#8594; <strong>Event Source</strong>. The  <strong>Event Sources</strong> page is displayed.</p>
</li>
<li>
<p>Optional: If you have multiple providers for your event sources, select the required provider from the <strong>Providers</strong> list to filter the available event sources from the provider.</p>
</li>
<li>
<p>Select <strong>Ping Source</strong> and then click <strong>Create Event Source</strong>. The <strong>Create Event Source</strong> page is displayed.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>You can configure the <strong>PingSource</strong> settings by using the <strong>Form view</strong> or <strong>YAML view</strong> and can switch between the views. The data is persisted when switching between the views.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Enter a value for <strong>Schedule</strong>. In this example, the value is <code>*/2 * * * *</code>, which creates a PingSource that sends a message every two minutes.</p>
</li>
<li>
<p>Optional: You can enter a value for <strong>Data</strong>, which is the message payload.</p>
</li>
<li>
<p>Select a <strong>Sink</strong>. This can be either a <strong>Resource</strong> or a <strong>URI</strong>. In this example, the <code>event-display</code> service created in the previous step is used as the <strong>Resource</strong> sink.</p>
</li>
<li>
<p>Click <strong>Create</strong>.</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">Verification</div>
<p>You can verify that the ping source was created and is connected to the sink by viewing the <strong>Topology</strong> page.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the <strong>Developer</strong> perspective, navigate to <strong>Topology</strong>.</p>
</li>
<li>
<p>View the ping source and sink.</p>
<div class="imageblock">
<div class="content">
<img src="images/verify-pingsource-ODC.png" alt="View the ping source and service in the Topology view">
</div>
</div>
</li>
</ol>
</div>
<div class="olist arabic">
<div class="title">Deleting the ping source</div>
<ol class="arabic">
<li>
<p>Navigate to the <strong>Topology</strong> view.</p>
</li>
<li>
<p>Right-click the API server source and select <strong>Delete Ping Source</strong>.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="serverless-pingsource-kn_serverless-pingsource">Creating a ping source by using the Knative CLI</h4>
<div class="paragraph">
<p>You can use the <code>kn source ping create</code> command to create a ping source by using the Knative (<code>kn</code>) CLI. Using the Knative CLI to create event sources provides a more streamlined and intuitive user interface than modifying YAML files directly.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>The OpenShift Serverless Operator, Knative Serving and Knative Eventing are installed on the cluster.</p>
</li>
<li>
<p>You have installed the Knative (<code>kn</code>) CLI.</p>
</li>
<li>
<p>You have created a project or have access to a project with the appropriate roles and permissions to create applications and other workloads in OpenShift Container Platform.</p>
</li>
<li>
<p>Optional: If you want to use the verification steps for this procedure, install the OpenShift CLI (<code>oc</code>).</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>To verify that the ping source is working, create a simple Knative
service that dumps incoming messages to the service logs:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ kn service create event-display \
    --image quay.io/openshift-knative/knative-eventing-sources-event-display:latest</code></pre>
</div>
</div>
</li>
<li>
<p>For each set of ping events that you want to request, create a ping source in the same namespace as the event consumer:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ kn source ping create test-ping-source \
    --schedule "*/2 * * * *" \
    --data '{"message": "Hello world!"}' \
    --sink ksvc:event-display</code></pre>
</div>
</div>
</li>
<li>
<p>Check that the controller is mapped correctly by entering the following command and inspecting the output:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ kn source ping describe test-ping-source</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">Name:         test-ping-source
Namespace:    default
Annotations:  sources.knative.dev/creator=developer, sources.knative.dev/lastModifier=developer
Age:          15s
Schedule:     */2 * * * *
Data:         {"message": "Hello world!"}

Sink:
  Name:       event-display
  Namespace:  default
  Resource:   Service (serving.knative.dev/v1)

Conditions:
  OK TYPE                 AGE REASON
  ++ Ready                 8s
  ++ Deployed              8s
  ++ SinkProvided         15s
  ++ ValidSchedule        15s
  ++ EventTypeProvided    15s
  ++ ResourcesCorrect     15s</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">Verification</div>
<p>You can verify that the Kubernetes events were sent to the Knative event sink by looking at the logs of the sink pod.</p>
</div>
<div class="paragraph">
<p>By default, Knative services terminate their pods if no traffic is received within a 60 second period.
The example shown in this guide creates a ping source that sends a message every 2 minutes, so each message should be observed in a newly created pod.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Watch for new pods created:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ watch oc get pods</code></pre>
</div>
</div>
</li>
<li>
<p>Cancel watching the pods using Ctrl+C, then look at the logs of the created pod:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc logs $(oc get pod -o name | grep event-display) -c user-container</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">☁️  cloudevents.Event
Validation: valid
Context Attributes,
  specversion: 1.0
  type: dev.knative.sources.ping
  source: /apis/v1/namespaces/default/pingsources/test-ping-source
  id: 99e4f4f6-08ff-4bff-acf1-47f61ded68c9
  time: 2020-04-07T16:16:00.000601161Z
  datacontenttype: application/json
Data,
  {
    "message": "Hello world!"
  }</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Deleting the ping source</div>
<ul>
<li>
<p>Delete the ping source:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ kn delete pingsources.sources.knative.dev &lt;ping_source_name&gt;</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="specifying-sink-flag-kn_serverless-pingsource">Knative CLI sink flag</h5>
<div class="paragraph">
<p>When you create an event source by using the Knative (<code>kn</code>) CLI, you can specify a sink where events are sent to from that resource by using the <code>--sink</code> flag. The sink can be any addressable or callable resource that can receive incoming events from other resources.</p>
</div>
<div class="paragraph">
<p>The following example creates a sink binding that uses a service, <code>http://event-display.svc.cluster.local</code>, as the sink:</p>
</div>
<div class="listingblock">
<div class="title">Example command using the sink flag</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ kn source binding create bind-heartbeat \
  --namespace sinkbinding-example \
  --subject "Job:batch/v1:app=heartbeat-cron" \
  --sink http://event-display.svc.cluster.local \ <b class="conum">(1)</b>
  --ce-override "sink=bound"</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p><code>svc</code> in <code>http://event-display.svc.cluster.local</code> determines that the sink is a Knative service. Other default sink prefixes include <code>channel</code>, and <code>broker</code>.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="serverless-pingsource-yaml_serverless-pingsource">Creating a ping source by using YAML</h4>
<div class="paragraph">
<p>Creating Knative resources by using YAML files uses a declarative API, which enables you to describe event sources declaratively and in a reproducible manner. To create a serverless ping source by using YAML, you must create a YAML file that defines a <code>PingSource</code> object, then apply it by using <code>oc apply</code>.</p>
</div>
<div class="listingblock">
<div class="title">Example <code>PingSource</code> object</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: sources.knative.dev/v1
kind: PingSource
metadata:
  name: test-ping-source
spec:
  schedule: "*/2 * * * *" <b class="conum">(1)</b>
  data: '{"message": "Hello world!"}' <b class="conum">(2)</b>
  sink: <b class="conum">(3)</b>
    ref:
      apiVersion: serving.knative.dev/v1
      kind: Service
      name: event-display</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The schedule of the event specified using <a href="https://kubernetes.io/docs/tasks/job/automated-tasks-with-cron-jobs/#schedule">CRON expression</a>.</p>
</li>
<li>
<p>The event message body expressed as a JSON encoded data string.</p>
</li>
<li>
<p>These are the details of the event consumer. In this example, we are using a Knative service named <code>event-display</code>.</p>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>The OpenShift Serverless Operator, Knative Serving and Knative Eventing are installed on the cluster.</p>
</li>
<li>
<p>Install the OpenShift CLI (<code>oc</code>).</p>
</li>
<li>
<p>You have created a project or have access to a project with the appropriate roles and permissions to create applications and other workloads in OpenShift Container Platform.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>To verify that the ping source is working, create a simple Knative
service that dumps incoming messages to the service&#8217;s logs.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Create a service YAML file:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: serving.knative.dev/v1
kind: Service
metadata:
  name: event-display
spec:
  template:
    spec:
      containers:
        - image: quay.io/openshift-knative/knative-eventing-sources-event-display:latest</code></pre>
</div>
</div>
</li>
<li>
<p>Create the service:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc apply -f &lt;filename&gt;</code></pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>For each set of ping events that you want to request, create a ping source in the same namespace as the event consumer.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Create a YAML file for the ping source:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: sources.knative.dev/v1
kind: PingSource
metadata:
  name: test-ping-source
spec:
  schedule: "*/2 * * * *"
  data: '{"message": "Hello world!"}'
  sink:
    ref:
      apiVersion: serving.knative.dev/v1
      kind: Service
      name: event-display</code></pre>
</div>
</div>
</li>
<li>
<p>Create the ping source:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc apply -f &lt;filename&gt;</code></pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Check that the controller is mapped correctly by entering the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc get pingsource.sources.knative.dev &lt;ping_source_name&gt; -oyaml</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">apiVersion: sources.knative.dev/v1
kind: PingSource
metadata:
  annotations:
    sources.knative.dev/creator: developer
    sources.knative.dev/lastModifier: developer
  creationTimestamp: "2020-04-07T16:11:14Z"
  generation: 1
  name: test-ping-source
  namespace: default
  resourceVersion: "55257"
  selfLink: /apis/sources.knative.dev/v1/namespaces/default/pingsources/test-ping-source
  uid: 3d80d50b-f8c7-4c1b-99f7-3ec00e0a8164
spec:
  data: '{ value: "hello" }'
  schedule: '*/2 * * * *'
  sink:
    ref:
      apiVersion: serving.knative.dev/v1
      kind: Service
      name: event-display
      namespace: default</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">Verification</div>
<p>You can verify that the Kubernetes events were sent to the Knative event sink by looking at the sink pod&#8217;s logs.</p>
</div>
<div class="paragraph">
<p>By default, Knative services terminate their pods if no traffic is received within a 60 second period.
The example shown in this guide creates a PingSource that sends a message every 2 minutes, so each message should be observed in a newly created pod.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Watch for new pods created:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ watch oc get pods</code></pre>
</div>
</div>
</li>
<li>
<p>Cancel watching the pods using Ctrl+C, then look at the logs of the created pod:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc logs $(oc get pod -o name | grep event-display) -c user-container</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">☁️  cloudevents.Event
Validation: valid
Context Attributes,
  specversion: 1.0
  type: dev.knative.sources.ping
  source: /apis/v1/namespaces/default/pingsources/test-ping-source
  id: 042ff529-240e-45ee-b40c-3a908129853e
  time: 2020-04-07T16:22:00.000791674Z
  datacontenttype: application/json
Data,
  {
    "message": "Hello world!"
  }</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Deleting the ping source</div>
<ul>
<li>
<p>Delete the ping source:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc delete -f &lt;filename&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example command</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc delete -f ping-source.yaml</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="serverless-kafka-developer-source">Source for Apache Kafka</h3>
<div class="paragraph">
<p>You can create an Apache Kafka source that reads events from an Apache Kafka cluster and passes these events to a sink. You can create a Kafka source by using the OpenShift Container Platform web console, the Knative (<code>kn</code>) CLI, or by creating a <code>KafkaSource</code> object directly as a YAML file and using the OpenShift CLI (<code>oc</code>) to apply it.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>See the documentation for <a href="https://access.redhat.com/documentation/en-us/red_hat_openshift_serverless/1.29/html-single/installing_serverless/#serverless-install-kafka-odc_installing-knative-eventing">Installing Knative broker for Apache Kafka</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="serverless-kafka-source-odc_serverless-kafka-developer-source">Creating an Apache Kafka event source by using the web console</h4>
<div class="paragraph">
<p>After the Knative broker implementation for Apache Kafka is installed on your cluster, you can create an Apache Kafka source by using the web console. Using the OpenShift Container Platform web console provides a streamlined and intuitive user interface to create a Kafka source.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>The OpenShift Serverless Operator, Knative Eventing, and the <code>KnativeKafka</code> custom resource are installed on your cluster.</p>
</li>
<li>
<p>You have logged in to the web console.</p>
</li>
<li>
<p>You have access to a Red Hat AMQ Streams (Kafka) cluster that produces the Kafka messages you want to import.</p>
</li>
<li>
<p>You have created a project or have access to a project with the appropriate roles and permissions to create applications and other workloads in OpenShift Container Platform.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the <strong>Developer</strong> perspective, navigate to the <strong>+Add</strong> page and select <strong>Event Source</strong>.</p>
</li>
<li>
<p>In the <strong>Event Sources</strong> page, select <strong>Kafka Source</strong> in the <strong>Type</strong> section.</p>
</li>
<li>
<p>Configure the <strong>Kafka Source</strong> settings:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Add a comma-separated list of <strong>Bootstrap Servers</strong>.</p>
</li>
<li>
<p>Add a comma-separated list of <strong>Topics</strong>.</p>
</li>
<li>
<p>Add a <strong>Consumer Group</strong>.</p>
</li>
<li>
<p>Select the <strong>Service Account Name</strong> for the service account that you created.</p>
</li>
<li>
<p>Select the <strong>Sink</strong> for the event source. A <strong>Sink</strong> can be either a <strong>Resource</strong>, such as a channel, broker, or service, or a <strong>URI</strong>.</p>
</li>
<li>
<p>Enter a <strong>Name</strong> for the Kafka event source.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Click <strong>Create</strong>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">Verification</div>
<p>You can verify that the Kafka event source was created and is connected to the sink by viewing the <strong>Topology</strong> page.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the <strong>Developer</strong> perspective, navigate to <strong>Topology</strong>.</p>
</li>
<li>
<p>View the Kafka event source and sink.</p>
<div class="imageblock">
<div class="content">
<img src="images/verify-kafka-ODC.png" alt="View the Kafka source and service in the Topology view">
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="serverless-kafka-source-kn_serverless-kafka-developer-source">Creating an Apache Kafka event source by using the Knative CLI</h4>
<div class="paragraph">
<p>You can use the <code>kn source kafka create</code> command to create a Kafka source by using the Knative (<code>kn</code>) CLI. Using the Knative CLI to create event sources provides a more streamlined and intuitive user interface than modifying YAML files directly.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>The OpenShift Serverless Operator, Knative Eventing, Knative Serving, and the <code>KnativeKafka</code> custom resource (CR) are installed on your cluster.</p>
</li>
<li>
<p>You have created a project or have access to a project with the appropriate roles and permissions to create applications and other workloads in OpenShift Container Platform.</p>
</li>
<li>
<p>You have access to a Red Hat AMQ Streams (Kafka) cluster that produces the Kafka messages you want to import.</p>
</li>
<li>
<p>You have installed the Knative (<code>kn</code>) CLI.</p>
</li>
<li>
<p>Optional: You have installed the OpenShift CLI (<code>oc</code>) if you want to use the verification steps in this procedure.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>To verify that the Kafka event source is working, create a Knative service that dumps incoming events into the service logs:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ kn service create event-display \
    --image quay.io/openshift-knative/knative-eventing-sources-event-display</code></pre>
</div>
</div>
</li>
<li>
<p>Create a <code>KafkaSource</code> CR:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ kn source kafka create &lt;kafka_source_name&gt; \
    --servers &lt;cluster_kafka_bootstrap&gt;.kafka.svc:9092 \
    --topics &lt;topic_name&gt; --consumergroup my-consumer-group \
    --sink event-display</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Replace the placeholder values in this command with values for your source name, bootstrap servers, and topics.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>--servers</code>, <code>--topics</code>, and <code>--consumergroup</code> options specify the connection parameters to the Kafka cluster. The <code>--consumergroup</code> option is optional.</p>
</div>
</li>
<li>
<p>Optional: View details about the <code>KafkaSource</code> CR you created:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ kn source kafka describe &lt;kafka_source_name&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">Name:              example-kafka-source
Namespace:         kafka
Age:               1h
BootstrapServers:  example-cluster-kafka-bootstrap.kafka.svc:9092
Topics:            example-topic
ConsumerGroup:     example-consumer-group

Sink:
  Name:       event-display
  Namespace:  default
  Resource:   Service (serving.knative.dev/v1)

Conditions:
  OK TYPE            AGE REASON
  ++ Ready            1h
  ++ Deployed         1h
  ++ SinkProvided     1h</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="olist arabic">
<div class="title">Verification steps</div>
<ol class="arabic">
<li>
<p>Trigger the Kafka instance to send a message to the topic:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc -n kafka run kafka-producer \
    -ti --image=quay.io/strimzi/kafka:latest-kafka-2.7.0 --rm=true \
    --restart=Never -- bin/kafka-console-producer.sh \
    --broker-list &lt;cluster_kafka_bootstrap&gt;:9092 --topic my-topic</code></pre>
</div>
</div>
<div class="paragraph">
<p>Enter the message in the prompt. This command assumes that:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The Kafka cluster is installed in the <code>kafka</code> namespace.</p>
</li>
<li>
<p>The <code>KafkaSource</code> object has been configured to use the <code>my-topic</code> topic.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Verify that the message arrived by viewing the logs:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc logs $(oc get pod -o name | grep event-display) -c user-container</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">☁️  cloudevents.Event
Validation: valid
Context Attributes,
  specversion: 1.0
  type: dev.knative.kafka.event
  source: /apis/v1/namespaces/default/kafkasources/example-kafka-source#example-topic
  subject: partition:46#0
  id: partition:46/offset:0
  time: 2021-03-10T11:21:49.4Z
Extensions,
  traceparent: 00-161ff3815727d8755848ec01c866d1cd-7ff3916c44334678-00
Data,
  Hello!</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="sect4">
<h5 id="specifying-sink-flag-kn_serverless-kafka-developer-source">Knative CLI sink flag</h5>
<div class="paragraph">
<p>When you create an event source by using the Knative (<code>kn</code>) CLI, you can specify a sink where events are sent to from that resource by using the <code>--sink</code> flag. The sink can be any addressable or callable resource that can receive incoming events from other resources.</p>
</div>
<div class="paragraph">
<p>The following example creates a sink binding that uses a service, <code>http://event-display.svc.cluster.local</code>, as the sink:</p>
</div>
<div class="listingblock">
<div class="title">Example command using the sink flag</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ kn source binding create bind-heartbeat \
  --namespace sinkbinding-example \
  --subject "Job:batch/v1:app=heartbeat-cron" \
  --sink http://event-display.svc.cluster.local \ <b class="conum">(1)</b>
  --ce-override "sink=bound"</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p><code>svc</code> in <code>http://event-display.svc.cluster.local</code> determines that the sink is a Knative service. Other default sink prefixes include <code>channel</code>, and <code>broker</code>.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="serverless-kafka-source-yaml_serverless-kafka-developer-source">Creating an Apache Kafka event source by using YAML</h4>
<div class="paragraph">
<p>Creating Knative resources by using YAML files uses a declarative API, which enables you to describe applications declaratively and in a reproducible manner. To create a Kafka source by using YAML, you must create a YAML file that defines a <code>KafkaSource</code> object, then apply it by using the <code>oc apply</code> command.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>The OpenShift Serverless Operator, Knative Eventing, and the <code>KnativeKafka</code> custom resource are installed on your cluster.</p>
</li>
<li>
<p>You have created a project or have access to a project with the appropriate roles and permissions to create applications and other workloads in OpenShift Container Platform.</p>
</li>
<li>
<p>You have access to a Red Hat AMQ Streams (Kafka) cluster that produces the Kafka messages you want to import.</p>
</li>
<li>
<p>Install the OpenShift CLI (<code>oc</code>).</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create a <code>KafkaSource</code> object as a YAML file:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: sources.knative.dev/v1beta1
kind: KafkaSource
metadata:
  name: &lt;source_name&gt;
spec:
  consumerGroup: &lt;group_name&gt; <b class="conum">(1)</b>
  bootstrapServers:
  - &lt;list_of_bootstrap_servers&gt;
  topics:
  - &lt;list_of_topics&gt; <b class="conum">(2)</b>
  sink:
  - &lt;list_of_sinks&gt; <b class="conum">(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>A consumer group is a group of consumers that use the same group ID, and consume data from a topic.</p>
</li>
<li>
<p>A topic provides a destination for the storage of data. Each topic is split into one or more partitions.</p>
</li>
<li>
<p>A sink specifies where events are sent to from a source.</p>
</li>
</ol>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>Only the <code>v1beta1</code> version of the API for <code>KafkaSource</code> objects on OpenShift Serverless is supported. Do not use the <code>v1alpha1</code> version of this API, as this version is now deprecated.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Example <code>KafkaSource</code> object</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: sources.knative.dev/v1beta1
kind: KafkaSource
metadata:
  name: kafka-source
spec:
  consumerGroup: knative-group
  bootstrapServers:
  - my-cluster-kafka-bootstrap.kafka:9092
  topics:
  - knative-demo-topic
  sink:
    ref:
      apiVersion: serving.knative.dev/v1
      kind: Service
      name: event-display</code></pre>
</div>
</div>
</li>
<li>
<p>Apply the <code>KafkaSource</code> YAML file:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc apply -f &lt;filename&gt;</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Verification</div>
<ul>
<li>
<p>Verify that the Kafka event source was created by entering the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc get pods</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">NAME                                    READY     STATUS    RESTARTS   AGE
kafkasource-kafka-source-5ca0248f-...   1/1       Running   0          13m</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="serverless-kafka-sasl-source_serverless-kafka-developer-source">Configuring SASL authentication for Apache Kafka sources</h4>
<div class="paragraph">
<p><em>Simple Authentication and Security Layer</em> (SASL) is used by Apache Kafka for authentication. If you use SASL authentication on your cluster, users must provide credentials to Knative for communicating with the Kafka cluster; otherwise events cannot be produced or consumed.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You have cluster or dedicated administrator permissions on OpenShift Container Platform.</p>
</li>
<li>
<p>The OpenShift Serverless Operator, Knative Eventing, and the <code>KnativeKafka</code> CR are installed on your OpenShift Container Platform cluster.</p>
</li>
<li>
<p>You have created a project or have access to a project with the appropriate roles and permissions to create applications and other workloads in OpenShift Container Platform.</p>
</li>
<li>
<p>You have a username and password for a Kafka cluster.</p>
</li>
<li>
<p>You have chosen the SASL mechanism to use, for example, <code>PLAIN</code>, <code>SCRAM-SHA-256</code>, or <code>SCRAM-SHA-512</code>.</p>
</li>
<li>
<p>If TLS is enabled, you also need the <code>ca.crt</code> certificate file for the Kafka cluster.</p>
</li>
<li>
<p>You have installed the OpenShift (<code>oc</code>) CLI.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create the certificate files as secrets in your chosen namespace:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc create secret -n &lt;namespace&gt; generic &lt;kafka_auth_secret&gt; \
  --from-file=ca.crt=caroot.pem \
  --from-literal=password="SecretPassword" \
  --from-literal=saslType="SCRAM-SHA-512" \ <b class="conum">(1)</b>
  --from-literal=user="my-sasl-user"</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The SASL type can be <code>PLAIN</code>, <code>SCRAM-SHA-256</code>, or <code>SCRAM-SHA-512</code>.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Create or modify your Kafka source so that it contains the following <code>spec</code> configuration:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: sources.knative.dev/v1beta1
kind: KafkaSource
metadata:
  name: example-source
spec:
...
  net:
    sasl:
      enable: true
      user:
        secretKeyRef:
          name: &lt;kafka_auth_secret&gt;
          key: user
      password:
        secretKeyRef:
          name: &lt;kafka_auth_secret&gt;
          key: password
      type:
        secretKeyRef:
          name: &lt;kafka_auth_secret&gt;
          key: saslType
    tls:
      enable: true
      caCert: <b class="conum">(1)</b>
        secretKeyRef:
          name: &lt;kafka_auth_secret&gt;
          key: ca.crt
...</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The <code>caCert</code> spec is not required if you are using a public cloud Kafka service.</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="serverless-custom-event-sources">Custom event sources</h3>
<div class="paragraph">
<p>If you need to ingress events from an event producer that is not included in Knative, or from a producer that emits events which are not in the <code>CloudEvent</code> format, you can do this by creating a custom event source. You can create a custom event source by using one of the following methods:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Use a <code>PodSpecable</code> object as an event source, by creating a sink binding.</p>
</li>
<li>
<p>Use a container as an event source, by creating a container source.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="serverless-sinkbinding-intro_context">Sink binding</h4>
<div class="paragraph">
<p>The <code>SinkBinding</code> object supports decoupling event production from delivery addressing. Sink binding is used to connect <em>event producers</em> to an event consumer, or <em>sink</em>. An event producer is a Kubernetes resource that embeds a <code>PodSpec</code> template and produces events. A sink is an addressable Kubernetes object that can receive events.</p>
</div>
<div class="paragraph">
<p>The <code>SinkBinding</code> object injects environment variables into the <code>PodTemplateSpec</code> of the sink, which means that the application code does not need to interact directly with the Kubernetes API to locate the event destination. These environment variables are as follows:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>K_SINK</code></dt>
<dd>
<p>The URL of the resolved sink.</p>
</dd>
<dt class="hdlist1"><code>K_CE_OVERRIDES</code></dt>
<dd>
<p>A JSON object that specifies overrides to the outbound event.</p>
</dd>
</dl>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>SinkBinding</code> object currently does not support custom revision names for services.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="serverless-sinkbinding-yaml_serverless-custom-event-sources">Creating a sink binding by using YAML</h5>
<div class="paragraph">
<p>Creating Knative resources by using YAML files uses a declarative API, which enables you to describe event sources declaratively and in a reproducible manner. To create a sink binding by using YAML, you must create a YAML file that defines an <code>SinkBinding</code> object, then apply it by using the <code>oc apply</code> command.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>The OpenShift Serverless Operator, Knative Serving and Knative Eventing are installed on the cluster.</p>
</li>
<li>
<p>Install the OpenShift CLI (<code>oc</code>).</p>
</li>
<li>
<p>You have created a project or have access to a project with the appropriate roles and permissions to create applications and other workloads in OpenShift Container Platform.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>To check that sink binding is set up correctly, create a Knative event display service, or event sink, that dumps incoming messages to its log.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Create a service YAML file:</p>
<div class="listingblock">
<div class="title">Example service YAML file</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: serving.knative.dev/v1
kind: Service
metadata:
  name: event-display
spec:
  template:
    spec:
      containers:
        - image: quay.io/openshift-knative/knative-eventing-sources-event-display:latest</code></pre>
</div>
</div>
</li>
<li>
<p>Create the service:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc apply -f &lt;filename&gt;</code></pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Create a sink binding instance that directs events to the service.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Create a sink binding YAML file:</p>
<div class="listingblock">
<div class="title">Example service YAML file</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: sources.knative.dev/v1alpha1
kind: SinkBinding
metadata:
  name: bind-heartbeat
spec:
  subject:
    apiVersion: batch/v1
    kind: Job <b class="conum">(1)</b>
    selector:
      matchLabels:
        app: heartbeat-cron

  sink:
    ref:
      apiVersion: serving.knative.dev/v1
      kind: Service
      name: event-display</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>In this example, any Job with the label <code>app: heartbeat-cron</code> will be bound to the event sink.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Create the sink binding:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc apply -f &lt;filename&gt;</code></pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Create a <code>CronJob</code> object.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Create a cron job YAML file:</p>
<div class="listingblock">
<div class="title">Example cron job YAML file</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: batch/v1
kind: CronJob
metadata:
  name: heartbeat-cron
spec:
  # Run every minute
  schedule: "* * * * *"
  jobTemplate:
    metadata:
      labels:
        app: heartbeat-cron
        bindings.knative.dev/include: "true"
    spec:
      template:
        spec:
          restartPolicy: Never
          containers:
            - name: single-heartbeat
              image: quay.io/openshift-knative/heartbeats:latest
              args:
                - --period=1
              env:
                - name: ONE_SHOT
                  value: "true"
                - name: POD_NAME
                  valueFrom:
                    fieldRef:
                      fieldPath: metadata.name
                - name: POD_NAMESPACE
                  valueFrom:
                    fieldRef:
                      fieldPath: metadata.namespace</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>To use sink binding, you must manually add a <code>bindings.knative.dev/include=true</code> label to your Knative resources.</p>
</div>
<div class="paragraph">
<p>For example, to add this label to a <code>CronJob</code> resource, add the following lines to the <code>Job</code> resource YAML definition:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">  jobTemplate:
    metadata:
      labels:
        app: heartbeat-cron
        bindings.knative.dev/include: "true"</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Create the cron job:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc apply -f &lt;filename&gt;</code></pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Check that the controller is mapped correctly by entering the following command and inspecting the output:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc get sinkbindings.sources.knative.dev bind-heartbeat -oyaml</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">spec:
  sink:
    ref:
      apiVersion: serving.knative.dev/v1
      kind: Service
      name: event-display
      namespace: default
  subject:
    apiVersion: batch/v1
    kind: Job
    namespace: default
    selector:
      matchLabels:
        app: heartbeat-cron</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">Verification</div>
<p>You can verify that the Kubernetes events were sent to the Knative event sink by looking at the message dumper function logs.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Enter the command:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc get pods</code></pre>
</div>
</div>
</li>
<li>
<p>Enter the command:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc logs $(oc get pod -o name | grep event-display) -c user-container</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">☁️  cloudevents.Event
Validation: valid
Context Attributes,
  specversion: 1.0
  type: dev.knative.eventing.samples.heartbeat
  source: https://knative.dev/eventing-contrib/cmd/heartbeats/#event-test/mypod
  id: 2b72d7bf-c38f-4a98-a433-608fbcdd2596
  time: 2019-10-18T15:23:20.809775386Z
  contenttype: application/json
Extensions,
  beats: true
  heart: yes
  the: 42
Data,
  {
    "id": 1,
    "label": ""
  }</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="serverless-sinkbinding-kn_serverless-custom-event-sources">Creating a sink binding by using the Knative CLI</h5>
<div class="paragraph">
<p>You can use the <code>kn source binding create</code> command to create a sink binding by using the Knative (<code>kn</code>) CLI. Using the Knative CLI to create event sources provides a more streamlined and intuitive user interface than modifying YAML files directly.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>The OpenShift Serverless Operator, Knative Serving and Knative Eventing are installed on the cluster.</p>
</li>
<li>
<p>You have created a project or have access to a project with the appropriate roles and permissions to create applications and other workloads in OpenShift Container Platform.</p>
</li>
<li>
<p>Install the Knative (<code>kn</code>) CLI.</p>
</li>
<li>
<p>Install the OpenShift CLI (<code>oc</code>).</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>The following procedure requires you to create YAML files.</p>
</div>
<div class="paragraph">
<p>If you change the names of the YAML files from those used in the examples, you must ensure that you also update the corresponding CLI commands.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>To check that sink binding is set up correctly, create a Knative event display service, or event sink, that dumps incoming messages to its log:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ kn service create event-display --image quay.io/openshift-knative/knative-eventing-sources-event-display:latest</code></pre>
</div>
</div>
</li>
<li>
<p>Create a sink binding instance that directs events to the service:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ kn source binding create bind-heartbeat --subject Job:batch/v1:app=heartbeat-cron --sink ksvc:event-display</code></pre>
</div>
</div>
</li>
<li>
<p>Create a <code>CronJob</code> object.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Create a cron job YAML file:</p>
<div class="listingblock">
<div class="title">Example cron job YAML file</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: batch/v1
kind: CronJob
metadata:
  name: heartbeat-cron
spec:
  # Run every minute
  schedule: "* * * * *"
  jobTemplate:
    metadata:
      labels:
        app: heartbeat-cron
        bindings.knative.dev/include: "true"
    spec:
      template:
        spec:
          restartPolicy: Never
          containers:
            - name: single-heartbeat
              image: quay.io/openshift-knative/heartbeats:latest
              args:
                - --period=1
              env:
                - name: ONE_SHOT
                  value: "true"
                - name: POD_NAME
                  valueFrom:
                    fieldRef:
                      fieldPath: metadata.name
                - name: POD_NAMESPACE
                  valueFrom:
                    fieldRef:
                      fieldPath: metadata.namespace</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>To use sink binding, you must manually add a <code>bindings.knative.dev/include=true</code> label to your Knative CRs.</p>
</div>
<div class="paragraph">
<p>For example, to add this label to a <code>CronJob</code> CR, add the following lines to the <code>Job</code> CR YAML definition:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">  jobTemplate:
    metadata:
      labels:
        app: heartbeat-cron
        bindings.knative.dev/include: "true"</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Create the cron job:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc apply -f &lt;filename&gt;</code></pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Check that the controller is mapped correctly by entering the following command and inspecting the output:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ kn source binding describe bind-heartbeat</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">Name:         bind-heartbeat
Namespace:    demo-2
Annotations:  sources.knative.dev/creator=minikube-user, sources.knative.dev/lastModifier=minikub ...
Age:          2m
Subject:
  Resource:   job (batch/v1)
  Selector:
    app:      heartbeat-cron
Sink:
  Name:       event-display
  Resource:   Service (serving.knative.dev/v1)

Conditions:
  OK TYPE     AGE REASON
  ++ Ready     2m</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">Verification</div>
<p>You can verify that the Kubernetes events were sent to the Knative event sink by looking at the message dumper function logs.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>View the message dumper function logs by entering the following commands:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc get pods</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc logs $(oc get pod -o name | grep event-display) -c user-container</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">☁️  cloudevents.Event
Validation: valid
Context Attributes,
  specversion: 1.0
  type: dev.knative.eventing.samples.heartbeat
  source: https://knative.dev/eventing-contrib/cmd/heartbeats/#event-test/mypod
  id: 2b72d7bf-c38f-4a98-a433-608fbcdd2596
  time: 2019-10-18T15:23:20.809775386Z
  contenttype: application/json
Extensions,
  beats: true
  heart: yes
  the: 42
Data,
  {
    "id": 1,
    "label": ""
  }</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="sect5">
<h6 id="specifying-sink-flag-kn_serverless-custom-event-sources">Knative CLI sink flag</h6>
<div class="paragraph">
<p>When you create an event source by using the Knative (<code>kn</code>) CLI, you can specify a sink where events are sent to from that resource by using the <code>--sink</code> flag. The sink can be any addressable or callable resource that can receive incoming events from other resources.</p>
</div>
<div class="paragraph">
<p>The following example creates a sink binding that uses a service, <code>http://event-display.svc.cluster.local</code>, as the sink:</p>
</div>
<div class="listingblock">
<div class="title">Example command using the sink flag</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ kn source binding create bind-heartbeat \
  --namespace sinkbinding-example \
  --subject "Job:batch/v1:app=heartbeat-cron" \
  --sink http://event-display.svc.cluster.local \ <b class="conum">(1)</b>
  --ce-override "sink=bound"</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p><code>svc</code> in <code>http://event-display.svc.cluster.local</code> determines that the sink is a Knative service. Other default sink prefixes include <code>channel</code>, and <code>broker</code>.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect4">
<h5 id="serverless-sinkbinding-odc_serverless-custom-event-sources">Creating a sink binding by using the web console</h5>
<div class="paragraph">
<p>After Knative Eventing is installed on your cluster, you can create a sink binding by using the web console. Using the OpenShift Container Platform web console provides a streamlined and intuitive user interface to create an event source.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You have logged in to the OpenShift Container Platform web console.</p>
</li>
<li>
<p>The OpenShift Serverless Operator, Knative Serving, and Knative Eventing are installed on your OpenShift Container Platform cluster.</p>
</li>
<li>
<p>You have created a project or have access to a project with the appropriate roles and permissions to create applications and other workloads in OpenShift Container Platform.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create a Knative service to use as a sink:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>In the <strong>Developer</strong> perspective, navigate to <strong>+Add</strong> &#8594; <strong>YAML</strong>.</p>
</li>
<li>
<p>Copy the example YAML:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: serving.knative.dev/v1
kind: Service
metadata:
  name: event-display
spec:
  template:
    spec:
      containers:
        - image: quay.io/openshift-knative/knative-eventing-sources-event-display:latest</code></pre>
</div>
</div>
</li>
<li>
<p>Click <strong>Create</strong>.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Create a <code>CronJob</code> resource that is used as an event source and sends an event every minute.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>In the <strong>Developer</strong> perspective, navigate to <strong>+Add</strong> &#8594; <strong>YAML</strong>.</p>
</li>
<li>
<p>Copy the example YAML:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: batch/v1
kind: CronJob
metadata:
  name: heartbeat-cron
spec:
  # Run every minute
  schedule: "*/1 * * * *"
  jobTemplate:
    metadata:
      labels:
        app: heartbeat-cron
        bindings.knative.dev/include: true <b class="conum">(1)</b>
    spec:
      template:
        spec:
          restartPolicy: Never
          containers:
            - name: single-heartbeat
              image: quay.io/openshift-knative/heartbeats
              args:
              - --period=1
              env:
                - name: ONE_SHOT
                  value: "true"
                - name: POD_NAME
                  valueFrom:
                    fieldRef:
                      fieldPath: metadata.name
                - name: POD_NAMESPACE
                  valueFrom:
                    fieldRef:
                      fieldPath: metadata.namespace</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Ensure that you include the <code>bindings.knative.dev/include: true</code> label. The default namespace selection behavior of OpenShift Serverless uses inclusion mode.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Click <strong>Create</strong>.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Create a sink binding in the same namespace as the service created in the previous step, or any other sink that you want to send events to.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>In the <strong>Developer</strong> perspective, navigate to <strong>+Add</strong> &#8594; <strong>Event Source</strong>. The  <strong>Event Sources</strong> page is displayed.</p>
</li>
<li>
<p>Optional: If you have multiple providers for your event sources, select the required provider from the <strong>Providers</strong> list to filter the available event sources from the provider.</p>
</li>
<li>
<p>Select <strong>Sink Binding</strong> and then click <strong>Create Event Source</strong>. The <strong>Create Event Source</strong> page is displayed.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>You can configure the <strong>Sink Binding</strong> settings by using the <strong>Form view</strong> or <strong>YAML view</strong> and can switch between the views. The data is persisted when switching between the views.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>In the <strong>apiVersion</strong> field enter <code>batch/v1</code>.</p>
</li>
<li>
<p>In the <strong>Kind</strong> field enter <code>Job</code>.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>CronJob</code> kind is not supported directly by OpenShift Serverless sink binding, so the <strong>Kind</strong> field must target the <code>Job</code> objects created by the cron job, rather than the cron job object itself.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Select a <strong>Sink</strong>. This can be either a <strong>Resource</strong> or a <strong>URI</strong>. In this example, the <code>event-display</code> service created in the previous step is used as the <strong>Resource</strong> sink.</p>
</li>
<li>
<p>In the <strong>Match labels</strong> section:</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>Enter <code>app</code> in the <strong>Name</strong> field.</p>
</li>
<li>
<p>Enter <code>heartbeat-cron</code> in the <strong>Value</strong> field.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>The label selector is required when using cron jobs with sink binding, rather than the resource name. This is because jobs created by a cron job do not have a predictable name, and contain a randomly generated string in their name. For example, <code>hearthbeat-cron-1cc23f</code>.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Click <strong>Create</strong>.</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">Verification</div>
<p>You can verify that the sink binding, sink, and cron job have been created and are working correctly by viewing the <strong>Topology</strong> page and pod logs.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the <strong>Developer</strong> perspective, navigate to <strong>Topology</strong>.</p>
</li>
<li>
<p>View the sink binding, sink, and heartbeats cron job.</p>
<div class="imageblock">
<div class="content">
<img src="images/verify-sinkbinding-odc.png" alt="View the sink binding and service in the Topology view">
</div>
</div>
</li>
<li>
<p>Observe that successful jobs are being registered by the cron job once the sink binding is added. This means that the sink binding is successfully reconfiguring the jobs created by the cron job.</p>
</li>
<li>
<p>Browse the logs of the <code>event-display</code> service pod to see events produced by the heartbeats cron job.</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="serverless-sinkbinding-reference_serverless-custom-event-sources">Sink binding reference</h5>
<div class="paragraph">
<p>You can use a <code>PodSpecable</code> object as an event source by creating a sink binding. You can configure multiple parameters when creating a <code>SinkBinding</code> object.</p>
</div>
<div class="paragraph">
<p><code>SinkBinding</code> objects support the following parameters:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Field</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Required or optional</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>apiVersion</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies the API version, for example <code>sources.knative.dev/v1</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>kind</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Identifies this resource object as a <code>SinkBinding</code> object.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>metadata</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies metadata that uniquely identifies the <code>SinkBinding</code> object. For example, a <code>name</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spec</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies the configuration information for this <code>SinkBinding</code> object.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spec.sink</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A reference to an object that resolves to a URI to use as the sink.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spec.subject</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">References the resources for which the runtime contract is augmented by binding implementations.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spec.ceOverrides</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines overrides to control the output format and modifications to the event sent to the sink.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional</p></td>
</tr>
</tbody>
</table>
<div class="sect5">
<h6 id="serverless-sinkbinding-reference-subject-parameters_serverless-custom-event-sources">Subject parameter</h6>
<div class="paragraph">
<p>The <code>Subject</code> parameter references the resources for which the runtime contract is augmented by binding implementations. You can configure multiple fields for a <code>Subject</code> definition.</p>
</div>
<div class="paragraph">
<p>The <code>Subject</code> definition supports the following fields:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Field</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Required or optional</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>apiVersion</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">API version of the referent.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>kind</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kind of the referent.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>namespace</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Namespace of the referent. If omitted, this defaults to the namespace of the object.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of the referent.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Do not use if you configure <code>selector</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>selector</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Selector of the referents.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Do not use if you configure <code>name</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>selector.matchExpressions</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A list of label selector requirements.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only use one of either <code>matchExpressions</code> or <code>matchLabels</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>selector.matchExpressions.key</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The label key that the selector applies to.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required if using <code>matchExpressions</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>selector.matchExpressions.operator</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Represents a key&#8217;s relationship to a set of values. Valid operators are <code>In</code>, <code>NotIn</code>, <code>Exists</code> and <code>DoesNotExist</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required if using <code>matchExpressions</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>selector.matchExpressions.values</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An array of string values. If the <code>operator</code> parameter value is <code>In</code> or <code>NotIn</code>, the values array must be non-empty. If the <code>operator</code> parameter value is <code>Exists</code> or <code>DoesNotExist</code>, the values array must be empty. This array is replaced during a strategic merge patch.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required if using <code>matchExpressions</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>selector.matchLabels</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A map of key-value pairs. Each key-value pair in the <code>matchLabels</code> map is equivalent to an element of <code>matchExpressions</code>, where the key field is <code>matchLabels.&lt;key&gt;</code>, the <code>operator</code> is <code>In</code>, and the <code>values</code> array contains only <code>matchLabels.&lt;value&gt;</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only use one of either <code>matchExpressions</code> or <code>matchLabels</code>.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">Subject parameter examples</div>
<p>Given the following YAML, the <code>Deployment</code> object named <code>mysubject</code> in the <code>default</code> namespace is selected:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: sources.knative.dev/v1
kind: SinkBinding
metadata:
  name: bind-heartbeat
spec:
  subject:
    apiVersion: apps/v1
    kind: Deployment
    namespace: default
    name: mysubject
  ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>Given the following YAML, any <code>Job</code> object with the label <code>working=example</code> in the <code>default</code> namespace is selected:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: sources.knative.dev/v1
kind: SinkBinding
metadata:
  name: bind-heartbeat
spec:
  subject:
    apiVersion: batch/v1
    kind: Job
    namespace: default
    selector:
      matchLabels:
        working: example
  ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>Given the following YAML, any <code>Pod</code> object with the label <code>working=example</code> or <code>working=sample</code> in the <code>default</code> namespace is selected:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: sources.knative.dev/v1
kind: SinkBinding
metadata:
  name: bind-heartbeat
spec:
  subject:
    apiVersion: v1
    kind: Pod
    namespace: default
    selector:
      - matchExpression:
        key: working
        operator: In
        values:
          - example
          - sample
  ...</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="serverless-sinkbinding-reference-cloudevent-overrides_serverless-custom-event-sources">CloudEvent overrides</h6>
<div class="paragraph">
<p>A <code>ceOverrides</code> definition provides overrides that control the CloudEvent&#8217;s output format and modifications sent to the sink. You can configure multiple fields for the <code>ceOverrides</code> definition.</p>
</div>
<div class="paragraph">
<p>A <code>ceOverrides</code> definition supports the following fields:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Field</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Required or optional</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>extensions</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies which attributes are added or overridden on the outbound event. Each <code>extensions</code> key-value pair is set independently on the event as an attribute extension.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Only valid <code>CloudEvent</code> attribute names are allowed as extensions. You cannot set the spec defined attributes from the extensions override configuration. For example, you can not modify the <code>type</code> attribute.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">CloudEvent Overrides example</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: sources.knative.dev/v1
kind: SinkBinding
metadata:
  name: bind-heartbeat
spec:
  ...
  ceOverrides:
    extensions:
      extra: this is an extra attribute
      additional: 42</code></pre>
</div>
</div>
<div class="paragraph">
<p>This sets the <code>K_CE_OVERRIDES</code> environment variable on the <code>subject</code>:</p>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">{ "extensions": { "extra": "this is an extra attribute", "additional": "42" } }</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="serverless-sinkbinding-reference-include-label_serverless-custom-event-sources">The include label</h6>
<div class="paragraph">
<p>To use a sink binding, you need to do assign the <code>bindings.knative.dev/include: "true"</code> label to either the resource or the namespace that the resource is included in. If the resource definition does not include the label, a cluster administrator can attach it to the namespace by running:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc label namespace &lt;namespace&gt; bindings.knative.dev/include=true</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="serverless-custom-event-sources-containersource">Container source</h4>
<div class="paragraph">
<p>Container sources create a container image that generates events and sends events to a sink. You can use a container source to create a custom event source, by creating a container image and a <code>ContainerSource</code> object that uses your image URI.</p>
</div>
<div class="sect4">
<h5 id="serverless-containersource-guidelines_serverless-custom-event-sources">Guidelines for creating a container image</h5>
<div class="paragraph">
<p>Two environment variables are injected by the container source controller: <code>K_SINK</code> and <code>K_CE_OVERRIDES</code>. These variables are resolved from the <code>sink</code> and <code>ceOverrides</code> spec, respectively. Events are sent to the sink URI specified in the <code>K_SINK</code> environment variable. The message must be sent as a <code>POST</code> using the <a href="https://cloudevents.io/"><code>CloudEvent</code></a> HTTP format.</p>
</div>
<div class="paragraph">
<div class="title">Example container images</div>
<p>The following is an example of a heartbeats container image:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-go" data-lang="go">package main

import (
	"context"
	"encoding/json"
	"flag"
	"fmt"
	"log"
	"os"
	"strconv"
	"time"

	duckv1 "knative.dev/pkg/apis/duck/v1"

	cloudevents "github.com/cloudevents/sdk-go/v2"
	"github.com/kelseyhightower/envconfig"
)

type Heartbeat struct {
	Sequence int    `json:"id"`
	Label    string `json:"label"`
}

var (
	eventSource string
	eventType   string
	sink        string
	label       string
	periodStr   string
)

func init() {
	flag.StringVar(&amp;eventSource, "eventSource", "", "the event-source (CloudEvents)")
	flag.StringVar(&amp;eventType, "eventType", "dev.knative.eventing.samples.heartbeat", "the event-type (CloudEvents)")
	flag.StringVar(&amp;sink, "sink", "", "the host url to heartbeat to")
	flag.StringVar(&amp;label, "label", "", "a special label")
	flag.StringVar(&amp;periodStr, "period", "5", "the number of seconds between heartbeats")
}

type envConfig struct {
	// Sink URL where to send heartbeat cloud events
	Sink string `envconfig:"K_SINK"`

	// CEOverrides are the CloudEvents overrides to be applied to the outbound event.
	CEOverrides string `envconfig:"K_CE_OVERRIDES"`

	// Name of this pod.
	Name string `envconfig:"POD_NAME" required:"true"`

	// Namespace this pod exists in.
	Namespace string `envconfig:"POD_NAMESPACE" required:"true"`

	// Whether to run continuously or exit.
	OneShot bool `envconfig:"ONE_SHOT" default:"false"`
}

func main() {
	flag.Parse()

	var env envConfig
	if err := envconfig.Process("", &amp;env); err != nil {
		log.Printf("[ERROR] Failed to process env var: %s", err)
		os.Exit(1)
	}

	if env.Sink != "" {
		sink = env.Sink
	}

	var ceOverrides *duckv1.CloudEventOverrides
	if len(env.CEOverrides) &gt; 0 {
		overrides := duckv1.CloudEventOverrides{}
		err := json.Unmarshal([]byte(env.CEOverrides), &amp;overrides)
		if err != nil {
			log.Printf("[ERROR] Unparseable CloudEvents overrides %s: %v", env.CEOverrides, err)
			os.Exit(1)
		}
		ceOverrides = &amp;overrides
	}

	p, err := cloudevents.NewHTTP(cloudevents.WithTarget(sink))
	if err != nil {
		log.Fatalf("failed to create http protocol: %s", err.Error())
	}

	c, err := cloudevents.NewClient(p, cloudevents.WithUUIDs(), cloudevents.WithTimeNow())
	if err != nil {
		log.Fatalf("failed to create client: %s", err.Error())
	}

	var period time.Duration
	if p, err := strconv.Atoi(periodStr); err != nil {
		period = time.Duration(5) * time.Second
	} else {
		period = time.Duration(p) * time.Second
	}

	if eventSource == "" {
		eventSource = fmt.Sprintf("https://knative.dev/eventing-contrib/cmd/heartbeats/#%s/%s", env.Namespace, env.Name)
		log.Printf("Heartbeats Source: %s", eventSource)
	}

	if len(label) &gt; 0 &amp;&amp; label[0] == '"' {
		label, _ = strconv.Unquote(label)
	}
	hb := &amp;Heartbeat{
		Sequence: 0,
		Label:    label,
	}
	ticker := time.NewTicker(period)
	for {
		hb.Sequence++

		event := cloudevents.NewEvent("1.0")
		event.SetType(eventType)
		event.SetSource(eventSource)
		event.SetExtension("the", 42)
		event.SetExtension("heart", "yes")
		event.SetExtension("beats", true)

		if ceOverrides != nil &amp;&amp; ceOverrides.Extensions != nil {
			for n, v := range ceOverrides.Extensions {
				event.SetExtension(n, v)
			}
		}

		if err := event.SetData(cloudevents.ApplicationJSON, hb); err != nil {
			log.Printf("failed to set cloudevents data: %s", err.Error())
		}

		log.Printf("sending cloudevent to %s", sink)
		if res := c.Send(context.Background(), event); !cloudevents.IsACK(res) {
			log.Printf("failed to send cloudevent: %v", res)
		}

		if env.OneShot {
			return
		}

		// Wait for next tick
		&lt;-ticker.C
	}
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following is an example of a container source that references the previous heartbeats container image:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: sources.knative.dev/v1
kind: ContainerSource
metadata:
  name: test-heartbeats
spec:
  template:
    spec:
      containers:
        # This corresponds to a heartbeats image URI that you have built and published
        - image: gcr.io/knative-releases/knative.dev/eventing/cmd/heartbeats
          name: heartbeats
          args:
            - --period=1
          env:
            - name: POD_NAME
              value: "example-pod"
            - name: POD_NAMESPACE
              value: "event-test"
  sink:
    ref:
      apiVersion: serving.knative.dev/v1
      kind: Service
      name: example-service
...</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="serverless-kn-containersource_serverless-custom-event-sources">Creating and managing container sources by using the Knative CLI</h5>
<div class="paragraph">
<p>You can use the <code>kn source container</code> commands to create  and manage container sources by using the Knative (<code>kn</code>) CLI. Using the Knative CLI to create event sources provides a more streamlined and intuitive user interface than modifying YAML files directly.</p>
</div>
<div class="listingblock">
<div class="title">Create a container source</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ kn source container create &lt;container_source_name&gt; --image &lt;image_uri&gt; --sink &lt;sink&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Delete a container source</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ kn source container delete &lt;container_source_name&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Describe a container source</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ kn source container describe &lt;container_source_name&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">List existing container sources</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ kn source container list</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">List existing container sources in YAML format</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ kn source container list -o yaml</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Update a container source</div>
<p>This command updates the image URI for an existing container source:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ kn source container update &lt;container_source_name&gt; --image &lt;image_uri&gt;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="serverless-odc-create-containersource_serverless-custom-event-sources">Creating a container source by using the web console</h5>
<div class="paragraph">
<p>After Knative Eventing is installed on your cluster, you can create a container source by using the web console. Using the OpenShift Container Platform web console provides a streamlined and intuitive user interface to create an event source.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You have logged in to the OpenShift Container Platform web console.</p>
</li>
<li>
<p>The OpenShift Serverless Operator, Knative Serving, and Knative Eventing are installed on your OpenShift Container Platform cluster.</p>
</li>
<li>
<p>You have created a project or have access to a project with the appropriate roles and permissions to create applications and other workloads in OpenShift Container Platform.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the <strong>Developer</strong> perspective, navigate to <strong>+Add</strong> → <strong>Event Source</strong>. The  <strong>Event Sources</strong> page is displayed.</p>
</li>
<li>
<p>Select <strong>Container Source</strong> and then click <strong>Create Event Source</strong>. The  <strong>Create Event Source</strong> page is displayed.</p>
</li>
<li>
<p>Configure the <strong>Container Source</strong> settings by using the <strong>Form view</strong> or <strong>YAML view</strong>:</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>You can switch between the <strong>Form view</strong> and <strong>YAML view</strong>. The data is persisted when switching between the views.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>In the <strong>Image</strong> field, enter the URI of the image that you want to run in the container created by the container source.</p>
</li>
<li>
<p>In the <strong>Name</strong> field, enter the name of the image.</p>
</li>
<li>
<p>Optional: In the <strong>Arguments</strong> field, enter any arguments to be passed to the container.</p>
</li>
<li>
<p>Optional: In the <strong>Environment variables</strong> field, add any environment variables to set in the container.</p>
</li>
<li>
<p>In the <strong>Sink</strong> section, add a sink where events from the container source are routed to. If you are using the <strong>Form</strong> view, you can choose from the following options:</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>Select <strong>Resource</strong> to use a channel, broker, or service as a sink for the event source.</p>
</li>
<li>
<p>Select <strong>URI</strong> to specify where the events from the container source are routed to.</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>After you have finished configuring the container source, click <strong>Create</strong>.</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="serverless-containersource-reference_serverless-custom-event-sources">Container source reference</h5>
<div class="paragraph">
<p>You can use a container as an event source, by creating a <code>ContainerSource</code> object. You can configure multiple parameters when creating a <code>ContainerSource</code> object.</p>
</div>
<div class="paragraph">
<p><code>ContainerSource</code> objects support the following fields:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Field</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Required or optional</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>apiVersion</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies the API version, for example <code>sources.knative.dev/v1</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>kind</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Identifies this resource object as a <code>ContainerSource</code> object.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>metadata</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies metadata that uniquely identifies the <code>ContainerSource</code> object. For example, a <code>name</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spec</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies the configuration information for this <code>ContainerSource</code> object.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spec.sink</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A reference to an object that resolves to a URI to use as the sink.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spec.template</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A <code>template</code> spec for the <code>ContainerSource</code> object.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spec.ceOverrides</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines overrides to control the output format and modifications to the event sent to the sink.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">Template parameter example</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: sources.knative.dev/v1
kind: ContainerSource
metadata:
  name: test-heartbeats
spec:
  template:
    spec:
      containers:
        - image: quay.io/openshift-knative/heartbeats:latest
          name: heartbeats
          args:
            - --period=1
          env:
            - name: POD_NAME
              value: "mypod"
            - name: POD_NAMESPACE
              value: "event-test"
  ...</code></pre>
</div>
</div>
<div class="sect5">
<h6 id="serverless-containersource-reference-cloudevent-overrides_serverless-custom-event-sources">CloudEvent overrides</h6>
<div class="paragraph">
<p>A <code>ceOverrides</code> definition provides overrides that control the CloudEvent&#8217;s output format and modifications sent to the sink. You can configure multiple fields for the <code>ceOverrides</code> definition.</p>
</div>
<div class="paragraph">
<p>A <code>ceOverrides</code> definition supports the following fields:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Field</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Required or optional</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>extensions</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies which attributes are added or overridden on the outbound event. Each <code>extensions</code> key-value pair is set independently on the event as an attribute extension.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Only valid <code>CloudEvent</code> attribute names are allowed as extensions. You cannot set the spec defined attributes from the extensions override configuration. For example, you can not modify the <code>type</code> attribute.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">CloudEvent Overrides example</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: sources.knative.dev/v1
kind: ContainerSource
metadata:
  name: test-heartbeats
spec:
  ...
  ceOverrides:
    extensions:
      extra: this is an extra attribute
      additional: 42</code></pre>
</div>
</div>
<div class="paragraph">
<p>This sets the <code>K_CE_OVERRIDES</code> environment variable on the <code>subject</code>:</p>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">{ "extensions": { "extra": "this is an extra attribute", "additional": "42" } }</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="serverless-sink-source-odc">Connecting an event source to a sink using the Developer perspective</h3>
<div class="paragraph">
<p>When you create an event source by using the OpenShift Container Platform web console, you can specify a sink that events are sent to from that source. The sink can be any addressable or callable resource that can receive incoming events from other resources.</p>
</div>
<div class="sect3">
<h4 id="serverless-connect-sink-source-odc_serverless-sink-source-odc">Connect an event source to a sink using the Developer perspective</h4>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>The OpenShift Serverless Operator, Knative Serving, and Knative Eventing are installed on your OpenShift Container Platform cluster.</p>
</li>
<li>
<p>You have logged in to the web console and are in the <strong>Developer</strong> perspective.</p>
</li>
<li>
<p>You have created a project or have access to a project with the appropriate roles and permissions to create applications and other workloads in OpenShift Container Platform.</p>
</li>
<li>
<p>You have created a sink, such as a Knative service, channel or broker.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create an event source of any type, by navigating to <strong>+Add</strong> &#8594; <strong>Event Source</strong> and selecting the event source type that you want to create.</p>
</li>
<li>
<p>In the <strong>Sink</strong> section of the <strong>Create Event Source</strong> form view, select your sink in the <strong>Resource</strong> list.</p>
</li>
<li>
<p>Click <strong>Create</strong>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">Verification</div>
<p>You can verify that the event source was created and is connected to the sink by viewing the <strong>Topology</strong> page.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the <strong>Developer</strong> perspective, navigate to <strong>Topology</strong>.</p>
</li>
<li>
<p>View the event source and click the connected sink to see the sink details in the right panel.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_event-sinks">Event sinks</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="serverless-event-sinks">Event sinks</h3>
<div class="paragraph">
<p>When you create an event source, you can specify an event sink where events are sent to from the source. An event sink is an addressable or a callable resource that can receive incoming events from other resources. Knative services, channels, and brokers are all examples of event sinks. There is also a specific Apache Kafka sink type available.</p>
</div>
<div class="paragraph">
<p>Addressable objects receive and acknowledge an event delivered over HTTP to an address defined in their <code>status.address.url</code> field. As a special case, the core Kubernetes <code>Service</code> object also fulfills the addressable interface.</p>
</div>
<div class="paragraph">
<p>Callable objects are able to receive an event delivered over HTTP and transform the event, returning <code>0</code> or <code>1</code> new events in the HTTP response. These returned events may be further processed in the same way that events from an external event source are processed.</p>
</div>
<div class="sect3">
<h4 id="specifying-sink-flag-kn_serverless-event-sinks">Knative CLI sink flag</h4>
<div class="paragraph">
<p>When you create an event source by using the Knative (<code>kn</code>) CLI, you can specify a sink where events are sent to from that resource by using the <code>--sink</code> flag. The sink can be any addressable or callable resource that can receive incoming events from other resources.</p>
</div>
<div class="paragraph">
<p>The following example creates a sink binding that uses a service, <code>http://event-display.svc.cluster.local</code>, as the sink:</p>
</div>
<div class="listingblock">
<div class="title">Example command using the sink flag</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ kn source binding create bind-heartbeat \
  --namespace sinkbinding-example \
  --subject "Job:batch/v1:app=heartbeat-cron" \
  --sink http://event-display.svc.cluster.local \ <b class="conum">(1)</b>
  --ce-override "sink=bound"</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p><code>svc</code> in <code>http://event-display.svc.cluster.local</code> determines that the sink is a Knative service. Other default sink prefixes include <code>channel</code>, and <code>broker</code>.</p>
</li>
</ol>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph">
<p>You can configure which CRs can be used with the <code>--sink</code> flag for Knative (<code>kn</code>) CLI commands by <a href="https://access.redhat.com/documentation/en-us/red_hat_openshift_serverless/1.29/html-single/knative_cli/#advanced-kn-config">Customizing <code>kn</code></a>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="serverless-creating-sinks">Creating event sinks</h3>
<div class="paragraph">
<p>When you create an event source, you can specify an event sink where events are sent to from the source. An event sink is an addressable or a callable resource that can receive incoming events from other resources. Knative services, channels, and brokers are all examples of event sinks. There is also a specific Apache Kafka sink type available.</p>
</div>
<div class="paragraph">
<p>For information about creating resources that can be used as event sinks, see the following documentation:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://access.redhat.com/documentation/en-us/red_hat_openshift_serverless/1.29/html-single/serving/#serverless-applications">Serverless applications</a></p>
</li>
<li>
<p><a href="#serverless-using-brokers">Creating brokers</a></p>
</li>
<li>
<p><a href="#serverless-creating-channels">Creating channels</a></p>
</li>
<li>
<p><a href="#serverless-kafka-developer-sink">Kafka sink</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="serverless-kafka-developer-sink">Sink for Apache Kafka</h3>
<div class="paragraph">
<p>Apache Kafka sinks are a type of <a href="#serverless-event-sinks">event sink</a> that are available if a cluster administrator has enabled Apache Kafka on your cluster. You can send events directly from an <a href="#knative-event-sources">event source</a> to a Kafka topic by using a Kafka sink.</p>
</div>
<div class="sect3">
<h4 id="serverless-kafka-sink_serverless-kafka-developer-sink">Creating an Apache Kafka sink by using YAML</h4>
<div class="paragraph">
<p>You can create a Kafka sink that sends events to a Kafka topic. By default, a Kafka sink uses the binary content mode, which is more efficient than the structured mode. To create a Kafka sink by using YAML, you must create a YAML file that defines a <code>KafkaSink</code> object, then apply it by using the <code>oc apply</code> command.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>The OpenShift Serverless Operator, Knative Eventing, and the <code>KnativeKafka</code> custom resource (CR) are installed on your cluster.</p>
</li>
<li>
<p>You have created a project or have access to a project with the appropriate roles and permissions to create applications and other workloads in OpenShift Container Platform.</p>
</li>
<li>
<p>You have access to a Red Hat AMQ Streams (Kafka) cluster that produces the Kafka messages you want to import.</p>
</li>
<li>
<p>Install the OpenShift CLI (<code>oc</code>).</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create a <code>KafkaSink</code> object definition as a YAML file:</p>
<div class="listingblock">
<div class="title">Kafka sink YAML</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: eventing.knative.dev/v1alpha1
kind: KafkaSink
metadata:
  name: &lt;sink-name&gt;
  namespace: &lt;namespace&gt;
spec:
  topic: &lt;topic-name&gt;
  bootstrapServers:
   - &lt;bootstrap-server&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>To create the Kafka sink, apply the <code>KafkaSink</code> YAML file:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc apply -f &lt;filename&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>Configure an event source so that the sink is specified in its spec:</p>
<div class="listingblock">
<div class="title">Example of a Kafka sink connected to an API server source</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: sources.knative.dev/v1alpha2
kind: ApiServerSource
metadata:
  name: &lt;source-name&gt; <b class="conum">(1)</b>
  namespace: &lt;namespace&gt; <b class="conum">(2)</b>
spec:
  serviceAccountName: &lt;service-account-name&gt; <b class="conum">(3)</b>
  mode: Resource
  resources:
  - apiVersion: v1
    kind: Event
  sink:
    ref:
      apiVersion: eventing.knative.dev/v1alpha1
      kind: KafkaSink
      name: &lt;sink-name&gt; <b class="conum">(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The name of the event source.</p>
</li>
<li>
<p>The namespace of the event source.</p>
</li>
<li>
<p>The service account for the event source.</p>
</li>
<li>
<p>The Kafka sink name.</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="serverless-creating-a-kafka-event-sink_serverless-kafka-developer-sink">Creating an event sink for Apache Kafka by using the OpenShift Container Platform web console</h4>
<div class="paragraph">
<p>You can create a Kafka sink that sends events to a Kafka topic by using the <strong>Developer</strong> perspective in the OpenShift Container Platform web console. By default, a Kafka sink uses the binary content mode, which is more efficient than the structured mode.</p>
</div>
<div class="paragraph">
<p>As a developer, you can create an event sink to receive events from a particular source and send them to a Kafka topic.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You have installed the OpenShift Serverless Operator, with Knative Serving, Knative Eventing, and Knative broker for Apache Kafka APIs, from the OperatorHub.</p>
</li>
<li>
<p>You have created a Kafka topic in your Kafka environment.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the <strong>Developer</strong> perspective, navigate to the <strong>+Add</strong> view.</p>
</li>
<li>
<p>Click <strong>Event Sink</strong> in the <strong>Eventing catalog</strong>.</p>
</li>
<li>
<p>Search for <code>KafkaSink</code> in the catalog items and click it.</p>
</li>
<li>
<p>Click <strong>Create Event Sink</strong>.</p>
</li>
<li>
<p>In the form view, type the URL of the bootstrap server, which is a combination of host name and port.</p>
<div class="imageblock">
<div class="content">
<img src="images/create-event-sink.png" alt="create event sink">
</div>
</div>
</li>
<li>
<p>Type the name of the topic to send event data.</p>
</li>
<li>
<p>Type the name of the event sink.</p>
</li>
<li>
<p>Click <strong>Create</strong>.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<div class="title">Verification</div>
<ol class="arabic">
<li>
<p>In the <strong>Developer</strong> perspective, navigate to the <strong>Topology</strong> view.</p>
</li>
<li>
<p>Click the created event sink to view its details in the right panel.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="serverless-kafka-sink-security-config_serverless-kafka-developer-sink">Configuring security for Apache Kafka sinks</h4>
<div class="paragraph">
<p><em>Transport Layer Security</em> (TLS) is used by Apache Kafka clients and servers to encrypt traffic between Knative and Kafka, as well as for authentication. TLS is the only supported method of traffic encryption for the Knative broker implementation for Apache Kafka.</p>
</div>
<div class="paragraph">
<p><em>Simple Authentication and Security Layer</em> (SASL) is used by Apache Kafka for authentication. If you use SASL authentication on your cluster, users must provide credentials to Knative for communicating with the Kafka cluster; otherwise events cannot be produced or consumed.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>The OpenShift Serverless Operator, Knative Eventing, and the <code>KnativeKafka</code> custom resources (CRs) are installed on your OpenShift Container Platform cluster.</p>
</li>
<li>
<p>Kafka sink is enabled in the <code>KnativeKafka</code> CR.</p>
</li>
<li>
<p>You have created a project or have access to a project with the appropriate roles and permissions to create applications and other workloads in OpenShift Container Platform.</p>
</li>
<li>
<p>You have a Kafka cluster CA certificate stored as a <code>.pem</code> file.</p>
</li>
<li>
<p>You have a Kafka cluster client certificate and a key stored as <code>.pem</code> files.</p>
</li>
<li>
<p>You have installed the OpenShift (<code>oc</code>) CLI.</p>
</li>
<li>
<p>You have chosen the SASL mechanism to use, for example, <code>PLAIN</code>, <code>SCRAM-SHA-256</code>, or <code>SCRAM-SHA-512</code>.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create the certificate files as a secret in the same namespace as your <code>KafkaSink</code> object:</p>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>Certificates and keys must be in PEM format.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p>For authentication using SASL without encryption:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc create secret -n &lt;namespace&gt; generic &lt;secret_name&gt; \
  --from-literal=protocol=SASL_PLAINTEXT \
  --from-literal=sasl.mechanism=&lt;sasl_mechanism&gt; \
  --from-literal=user=&lt;username&gt; \
  --from-literal=password=&lt;password&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>For authentication using SASL and encryption using TLS:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc create secret -n &lt;namespace&gt; generic &lt;secret_name&gt; \
  --from-literal=protocol=SASL_SSL \
  --from-literal=sasl.mechanism=&lt;sasl_mechanism&gt; \
  --from-file=ca.crt=&lt;my_caroot.pem_file_path&gt; \ <b class="conum">(1)</b>
  --from-literal=user=&lt;username&gt; \
  --from-literal=password=&lt;password&gt;</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The <code>ca.crt</code> can be omitted to use the system&#8217;s root CA set if you are using a public cloud managed Kafka service.</p>
</li>
</ol>
</div>
</li>
<li>
<p>For authentication and encryption using TLS:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc create secret -n &lt;namespace&gt; generic &lt;secret_name&gt; \
  --from-literal=protocol=SSL \
  --from-file=ca.crt=&lt;my_caroot.pem_file_path&gt; \ <b class="conum">(1)</b>
  --from-file=user.crt=&lt;my_cert.pem_file_path&gt; \
  --from-file=user.key=&lt;my_key.pem_file_path&gt;</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The <code>ca.crt</code> can be omitted to use the system&#8217;s root CA set if you are using a public cloud managed Kafka service.</p>
</li>
</ol>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Create or modify a <code>KafkaSink</code> object and add a reference to your secret in the <code>auth</code> spec:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: eventing.knative.dev/v1alpha1
kind: KafkaSink
metadata:
   name: &lt;sink_name&gt;
   namespace: &lt;namespace&gt;
spec:
...
   auth:
     secret:
       ref:
         name: &lt;secret_name&gt;
...</code></pre>
</div>
</div>
</li>
<li>
<p>Apply the <code>KafkaSink</code> object:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc apply -f &lt;filename&gt;</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_brokers">Brokers</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="serverless-brokers">Brokers</h3>
<div class="paragraph">
<p>Brokers can be used in combination with triggers to deliver events from an event source to an event sink. Events are sent from an event source to a broker as an HTTP <code>POST</code> request. After events have entered the broker, they can be filtered by <a href="https://github.com/cloudevents/spec/blob/v1.0/spec.md#context-attributes">CloudEvent attributes</a> using triggers, and sent as an HTTP <code>POST</code> request to an event sink.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/serverless-event-broker-workflow.png" alt="Broker event delivery overview">
</div>
</div>
</div>
<div class="sect2">
<h3 id="serverless-broker-types">Broker types</h3>
<div class="paragraph">
<p>Cluster administrators can set the default broker implementation for a cluster. When you create a broker, the default broker implementation is used, unless you provide set configurations in the <code>Broker</code> object.</p>
</div>
<div class="sect3">
<h4 id="serverless-broker-types-default_serverless-broker-types">Default broker implementation for development purposes</h4>
<div class="paragraph">
<p>Knative provides a default, channel-based broker implementation. This channel-based broker can be used for development and testing purposes, but does not provide adequate event delivery guarantees for production environments. The default broker is backed by the <code>InMemoryChannel</code> channel implementation by default.</p>
</div>
<div class="paragraph">
<p>If you want to use Apache Kafka to reduce network hops, use the Knative broker implementation for Apache Kafka. Do not configure the channel-based broker to be backed by the <code>KafkaChannel</code> channel implementation.</p>
</div>
</div>
<div class="sect3">
<h4 id="serverless-broker-types-production_serverless-broker-types">Production-ready Knative broker implementation for Apache Kafka</h4>
<div class="paragraph">
<p>For production-ready Knative Eventing deployments, Red Hat recommends using the Knative broker implementation for Apache Kafka. The broker is an Apache Kafka native implementation of the Knative broker, which sends CloudEvents directly to the Kafka instance.</p>
</div>
<div class="paragraph">
<p>The Knative broker has a native integration with Kafka for storing and routing events. This allows better integration with Kafka for the broker and trigger model over other broker types, and reduces network hops. Other benefits of the Knative broker implementation include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>At-least-once delivery guarantees</p>
</li>
<li>
<p>Ordered delivery of events, based on the CloudEvents partitioning extension</p>
</li>
<li>
<p>Control plane high availability</p>
</li>
<li>
<p>A horizontally scalable data plane</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The  Knative broker implementation for Apache Kafka stores incoming CloudEvents as Kafka records, using the binary content mode. This means that all CloudEvent attributes and extensions are mapped as headers on the Kafka record, while the <code>data</code> spec of the CloudEvent corresponds to the value of the Kafka record.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="serverless-using-brokers">Creating brokers</h3>
<div class="paragraph">
<p>Knative provides a default, channel-based broker implementation. This channel-based broker can be used for development and testing purposes, but does not provide adequate event delivery guarantees for production environments.</p>
</div>
<div class="paragraph">
<p>If a cluster administrator has configured your OpenShift Serverless deployment to use Apache Kafka as the default broker type, creating a broker by using the default settings creates a Knative broker for Apache Kafka.</p>
</div>
<div class="paragraph">
<p>If your OpenShift Serverless deployment is not configured to use the Knative broker for Apache Kafka as the default broker type, the channel-based broker is created when you use the default settings in the following procedures.</p>
</div>
<div class="sect3">
<h4 id="serverless-create-broker-kn_serverless-using-brokers">Creating a broker by using the Knative CLI</h4>
<div class="paragraph">
<p>Brokers can be used in combination with triggers to deliver events from an event source to an event sink. Using the Knative (<code>kn</code>) CLI to create brokers provides a more streamlined and intuitive user interface over modifying YAML files directly. You can use the <code>kn broker create</code> command to create a broker.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>The OpenShift Serverless Operator and Knative Eventing are installed on your OpenShift Container Platform cluster.</p>
</li>
<li>
<p>You have installed the Knative (<code>kn</code>) CLI.</p>
</li>
<li>
<p>You have created a project or have access to a project with the appropriate roles and permissions to create applications and other workloads in OpenShift Container Platform.</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Create a broker:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ kn broker create &lt;broker_name&gt;</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Verification</div>
<ol class="arabic">
<li>
<p>Use the <code>kn</code> command to list all existing brokers:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ kn broker list</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">NAME      URL                                                                     AGE   CONDITIONS   READY   REASON
default   http://broker-ingress.knative-eventing.svc.cluster.local/test/default   45s   5 OK / 5     True</code></pre>
</div>
</div>
</li>
<li>
<p>Optional: If you are using the OpenShift Container Platform web console, you can navigate to the <strong>Topology</strong> view in the <strong>Developer</strong> perspective, and observe that the broker exists:</p>
<div class="imageblock">
<div class="content">
<img src="images/odc-view-broker.png" alt="View the broker in the web console Topology view">
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="serverless-creating-broker-annotation_serverless-using-brokers">Creating a broker by annotating a trigger</h4>
<div class="paragraph">
<p>Brokers can be used in combination with triggers to deliver events from an event source to an event sink. You can create a broker by adding the <code>eventing.knative.dev/injection: enabled</code> annotation to a <code>Trigger</code> object.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>If you create a broker by using the <code>eventing.knative.dev/injection: enabled</code> annotation, you cannot delete this broker without cluster administrator permissions.
If you delete the broker without having a cluster administrator remove this annotation first, the broker is created again after deletion.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>The OpenShift Serverless Operator and Knative Eventing are installed on your OpenShift Container Platform cluster.</p>
</li>
<li>
<p>Install the OpenShift CLI (<code>oc</code>).</p>
</li>
<li>
<p>You have created a project or have access to a project with the appropriate roles and permissions to create applications and other workloads in OpenShift Container Platform.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create a <code>Trigger</code> object as a YAML file that has the <code>eventing.knative.dev/injection: enabled</code> annotation:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: eventing.knative.dev/v1
kind: Trigger
metadata:
  annotations:
    eventing.knative.dev/injection: enabled
  name: &lt;trigger_name&gt;
spec:
  broker: default
  subscriber: <b class="conum">(1)</b>
    ref:
      apiVersion: serving.knative.dev/v1
      kind: Service
      name: &lt;service_name&gt;</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Specify details about the event sink, or <em>subscriber</em>, that the trigger sends events to.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Apply the <code>Trigger</code> YAML file:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc apply -f &lt;filename&gt;</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">Verification</div>
<p>You can verify that the broker has been created successfully by using the <code>oc</code> CLI, or by observing it in the <strong>Topology</strong> view in the web console.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Enter the following <code>oc</code> command to get the broker:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc -n &lt;namespace&gt; get broker default</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">NAME      READY     REASON    URL                                                                     AGE
default   True                http://broker-ingress.knative-eventing.svc.cluster.local/test/default   3m56s</code></pre>
</div>
</div>
</li>
<li>
<p>Optional: If you are using the OpenShift Container Platform web console, you can navigate to the <strong>Topology</strong> view in the <strong>Developer</strong> perspective, and observe that the broker exists:</p>
<div class="imageblock">
<div class="content">
<img src="images/odc-view-broker.png" alt="View the broker in the web console Topology view">
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="serverless-creating-broker-labeling_serverless-using-brokers">Creating a broker by labeling a namespace</h4>
<div class="paragraph">
<p>Brokers can be used in combination with triggers to deliver events from an event source to an event sink. You can create the <code>default</code> broker automatically by labelling a namespace that you own or have write permissions for.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Brokers created using this method are not removed if you remove the label. You must manually delete them.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>The OpenShift Serverless Operator and Knative Eventing are installed on your OpenShift Container Platform cluster.</p>
</li>
<li>
<p>Install the OpenShift CLI (<code>oc</code>).</p>
</li>
<li>
<p>You have created a project or have access to a project with the appropriate roles and permissions to create applications and other workloads in OpenShift Container Platform.</p>
</li>
<li>
<p>You have cluster or dedicated administrator permissions if you are using Red Hat OpenShift Service on AWS or OpenShift Dedicated.</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Label a namespace with <code>eventing.knative.dev/injection=enabled</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc label namespace &lt;namespace&gt; eventing.knative.dev/injection=enabled</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">Verification</div>
<p>You can verify that the broker has been created successfully by using the <code>oc</code> CLI, or by observing it in the <strong>Topology</strong> view in the web console.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Use the <code>oc</code> command to get the broker:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc -n &lt;namespace&gt; get broker &lt;broker_name&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example command</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc -n default get broker default</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">NAME      READY     REASON    URL                                                                     AGE
default   True                http://broker-ingress.knative-eventing.svc.cluster.local/test/default   3m56s</code></pre>
</div>
</div>
</li>
<li>
<p>Optional: If you are using the OpenShift Container Platform web console, you can navigate to the <strong>Topology</strong> view in the <strong>Developer</strong> perspective, and observe that the broker exists:</p>
<div class="imageblock">
<div class="content">
<img src="images/odc-view-broker.png" alt="View the broker in the web console Topology view">
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="serverless-deleting-broker-injection_serverless-using-brokers">Deleting a broker that was created by injection</h4>
<div class="paragraph">
<p>If you create a broker by injection and later want to delete it, you must delete it manually. Brokers created by using a namespace label or trigger annotation are not deleted permanently if you remove the label or annotation.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Install the OpenShift CLI (<code>oc</code>).</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Remove the <code>eventing.knative.dev/injection=enabled</code> label from the namespace:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc label namespace &lt;namespace&gt; eventing.knative.dev/injection-</code></pre>
</div>
</div>
<div class="paragraph">
<p>Removing the annotation prevents Knative from recreating the broker after you delete it.</p>
</div>
</li>
<li>
<p>Delete the broker from the selected namespace:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc -n &lt;namespace&gt; delete broker &lt;broker_name&gt;</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Verification</div>
<ul>
<li>
<p>Use the <code>oc</code> command to get the broker:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc -n &lt;namespace&gt; get broker &lt;broker_name&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example command</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc -n default get broker default</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">No resources found.
Error from server (NotFound): brokers.eventing.knative.dev "default" not found</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="serverless-creating-a-broker-odc_serverless-using-brokers">Creating a broker by using the web console</h4>
<div class="paragraph">
<p>After Knative Eventing is installed on your cluster, you can create a broker by using the web console. Using the OpenShift Container Platform web console provides a streamlined and intuitive user interface to create a broker.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You have logged in to the OpenShift Container Platform web console.</p>
</li>
<li>
<p>The OpenShift Serverless Operator, Knative Serving and Knative Eventing are installed on the cluster.</p>
</li>
<li>
<p>You have created a project or have access to a project with the appropriate roles and permissions to create applications and other workloads in OpenShift Container Platform.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the <strong>Developer</strong> perspective, navigate to <strong>+Add</strong> &#8594; <strong>Broker</strong>. The <strong>Broker</strong> page is displayed.</p>
</li>
<li>
<p>Optional. Update the <strong>Name</strong> of the broker. If you do not update the name, the generated broker is named <code>default</code>.</p>
</li>
<li>
<p>Click <strong>Create</strong>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">Verification</div>
<p>You can verify that the broker was created by viewing broker components in the <strong>Topology</strong> page.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the <strong>Developer</strong> perspective, navigate to <strong>Topology</strong>.</p>
</li>
<li>
<p>View the <code>mt-broker-ingress</code>, <code>mt-broker-filter</code>, and <code>mt-broker-controller</code> components.</p>
<div class="imageblock">
<div class="content">
<img src="images/serverless-verify-broker-odc.png" alt="View the broker components in the Topology view">
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="serverless-creating-broker-admin-web-console_serverless-using-brokers">Creating a broker by using the Administrator perspective</h4>
<div class="paragraph">
<p>Brokers can be used in combination with triggers to deliver events from an event source to an event sink. Events are sent from an event source to a broker as an HTTP <code>POST</code> request. After events have entered the broker, they can be filtered by <a href="https://github.com/cloudevents/spec/blob/v1.0/spec.md#context-attributes">CloudEvent attributes</a> using triggers, and sent as an HTTP <code>POST</code> request to an event sink.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/serverless-event-broker-workflow.png" alt="Broker event delivery overview">
</div>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>The OpenShift Serverless Operator and Knative Eventing are installed on your OpenShift Container Platform cluster.</p>
</li>
<li>
<p>You have logged in to the web console and are in the <strong>Administrator</strong> perspective.</p>
</li>
<li>
<p>You have cluster administrator permissions on OpenShift Container Platform, or you have cluster or dedicated administrator permissions on Red Hat OpenShift Service on AWS or OpenShift Dedicated.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the <strong>Administrator</strong> perspective of the OpenShift Container Platform web console, navigate to <strong>Serverless</strong> &#8594; <strong>Eventing</strong>.</p>
</li>
<li>
<p>In the <strong>Create</strong> list, select <strong>Broker</strong>. You will be directed to the <strong>Create Broker</strong> page.</p>
</li>
<li>
<p>Optional: Modify the YAML configuration for the broker.</p>
</li>
<li>
<p>Click <strong>Create</strong>.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="next-steps_serverless-using-brokers">Next steps</h4>
<div class="ulist">
<ul>
<li>
<p>Configure event delivery parameters that are applied in cases where an event fails to be delivered to an event sink. See <a href="#serverless-configuring-event-delivery-examples_serverless-event-delivery">Examples of configuring event delivery parameters</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect3 _additional-resources">
<h4 id="additional-resources_serverless-using-brokers">Additional resources</h4>
<div class="ulist">
<ul>
<li>
<p><a href="#serverless-global-config-broker-class-default">Configuring the default broker class</a></p>
</li>
<li>
<p><a href="#serverless-triggers">Triggers</a>
<a href="#knative-event-sources">Event sources</a></p>
</li>
<li>
<p><a href="#serverless-event-delivery">Event delivery</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="serverless-broker-backing-channel-default">Configuring the default broker backing channel</h3>
<div class="paragraph">
<p>If you are using a channel-based broker, you can set the default backing channel type for the broker to either <code>InMemoryChannel</code> or <code>KafkaChannel</code>.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You have administrator permissions on OpenShift Container Platform.</p>
</li>
<li>
<p>You have installed the OpenShift Serverless Operator and Knative Eventing on your cluster.</p>
</li>
<li>
<p>You have installed the OpenShift (<code>oc</code>) CLI.</p>
</li>
<li>
<p>If you want to use Apache Kafka channels as the default backing channel type, you must also install the <code>KnativeKafka</code> CR on your cluster.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Modify the <code>KnativeEventing</code> custom resource (CR) to add configuration details for the <code>config-br-default-channel</code> config map:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: operator.knative.dev/v1beta1
kind: KnativeEventing
metadata:
  name: knative-eventing
  namespace: knative-eventing
spec:
  config: <b class="conum">(1)</b>
    config-br-default-channel:
      channel-template-spec: |
        apiVersion: messaging.knative.dev/v1beta1
        kind: KafkaChannel <b class="conum">(2)</b>
        spec:
          numPartitions: 6 <b class="conum">(3)</b>
          replicationFactor: 3 <b class="conum">(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>In <code>spec.config</code>, you can specify the config maps that you want to add modified configurations for.</p>
</li>
<li>
<p>The default backing channel type configuration. In this example, the default channel implementation for the cluster is <code>KafkaChannel</code>.</p>
</li>
<li>
<p>The number of partitions for the Kafka channel that backs the broker.</p>
</li>
<li>
<p>The replication factor for the Kafka channel that backs the broker.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Apply the updated <code>KnativeEventing</code> CR:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc apply -f &lt;filename&gt;</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="serverless-global-config-broker-class-default">Configuring the default broker class</h3>
<div class="paragraph">
<p>You can use the <code>config-br-defaults</code> config map to specify default broker class settings for Knative Eventing. You can specify the default broker class for the entire cluster or for one or more namespaces. Currently the <code>MTChannelBasedBroker</code> and <code>Kafka</code> broker types are supported.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You have administrator permissions on OpenShift Container Platform.</p>
</li>
<li>
<p>You have installed the OpenShift Serverless Operator and Knative Eventing on your cluster.</p>
</li>
<li>
<p>If you want to use the Knative broker for Apache Kafka as the default broker implementation, you must also install the <code>KnativeKafka</code> CR on your cluster.</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Modify the <code>KnativeEventing</code> custom resource to add configuration details for the <code>config-br-defaults</code> config map:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: operator.knative.dev/v1beta1
kind: KnativeEventing
metadata:
  name: knative-eventing
  namespace: knative-eventing
spec:
  defaultBrokerClass: Kafka <b class="conum">(1)</b>
  config: <b class="conum">(2)</b>
    config-br-defaults: <b class="conum">(3)</b>
      default-br-config: |
        clusterDefault: <b class="conum">(4)</b>
          brokerClass: Kafka
          apiVersion: v1
          kind: ConfigMap
          name: kafka-broker-config <b class="conum">(5)</b>
          namespace: knative-eventing <b class="conum">(6)</b>
        namespaceDefaults: <b class="conum">(7)</b>
          my-namespace:
            brokerClass: MTChannelBasedBroker
            apiVersion: v1
            kind: ConfigMap
            name: config-br-default-channel <b class="conum">(8)</b>
            namespace: knative-eventing <b class="conum">(9)</b>
...</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The default broker class for Knative Eventing.</p>
</li>
<li>
<p>In <code>spec.config</code>, you can specify the config maps that you want to add modified configurations for.</p>
</li>
<li>
<p>The <code>config-br-defaults</code> config map specifies the default settings for any broker that does not specify <code>spec.config</code> settings or a broker class.</p>
</li>
<li>
<p>The cluster-wide default broker class configuration. In this example, the default broker class implementation for the cluster is <code>Kafka</code>.</p>
</li>
<li>
<p>The <code>kafka-broker-config</code> config map specifies default settings for the Kafka broker. See "Configuring Knative broker for Apache Kafka settings" in the "Additional resources" section.</p>
</li>
<li>
<p>The namespace where the <code>kafka-broker-config</code> config map exists.</p>
</li>
<li>
<p>The namespace-scoped default broker class configuration. In this example, the default broker class implementation for the <code>my-namespace</code> namespace is <code>MTChannelBasedBroker</code>. You can specify default broker class implementations for multiple namespaces.</p>
</li>
<li>
<p>The <code>config-br-default-channel</code> config map specifies the default backing channel for the broker. See "Configuring the default broker backing channel" in the "Additional resources" section.</p>
</li>
<li>
<p>The namespace where the <code>config-br-default-channel</code> config map exists.</p>
</li>
</ol>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>Configuring a namespace-specific default overrides any cluster-wide settings.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="kafka-broker">Knative broker implementation for Apache Kafka</h3>
<div class="paragraph">
<p>For production-ready Knative Eventing deployments, Red Hat recommends using the Knative broker implementation for Apache Kafka. The broker is an Apache Kafka native implementation of the Knative broker, which sends CloudEvents directly to the Kafka instance.</p>
</div>
<div class="paragraph">
<p>The Knative broker has a native integration with Kafka for storing and routing events. This allows better integration with Kafka for the broker and trigger model over other broker types, and reduces network hops. Other benefits of the Knative broker implementation include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>At-least-once delivery guarantees</p>
</li>
<li>
<p>Ordered delivery of events, based on the CloudEvents partitioning extension</p>
</li>
<li>
<p>Control plane high availability</p>
</li>
<li>
<p>A horizontally scalable data plane</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The  Knative broker implementation for Apache Kafka stores incoming CloudEvents as Kafka records, using the binary content mode. This means that all CloudEvent attributes and extensions are mapped as headers on the Kafka record, while the <code>data</code> spec of the CloudEvent corresponds to the value of the Kafka record.</p>
</div>
<div class="sect3">
<h4 id="creating-kafka-broker">Creating an Apache Kafka broker when it is not configured as the default broker type</h4>
<div class="paragraph">
<p>If your OpenShift Serverless deployment is not configured to use Kafka broker as the default broker type, you can use one of the following procedures to create a Kafka-based broker.</p>
</div>
<div class="sect4">
<h5 id="serverless-kafka-broker_kafka-broker">Creating an Apache Kafka broker by using YAML</h5>
<div class="paragraph">
<p>Creating Knative resources by using YAML files uses a declarative API, which enables you to describe applications declaratively and in a reproducible manner. To create a Kafka broker by using YAML, you must create a YAML file that defines a <code>Broker</code> object, then apply it by using the <code>oc apply</code> command.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>The OpenShift Serverless Operator, Knative Eventing, and the <code>KnativeKafka</code> custom resource are installed on your OpenShift Container Platform cluster.</p>
</li>
<li>
<p>You have created a project or have access to a project with the appropriate roles and permissions to create applications and other workloads in OpenShift Container Platform.</p>
</li>
<li>
<p>You have installed the OpenShift CLI (<code>oc</code>).</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create a Kafka-based broker as a YAML file:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: eventing.knative.dev/v1
kind: Broker
metadata:
  annotations:
    eventing.knative.dev/broker.class: Kafka <b class="conum">(1)</b>
  name: example-kafka-broker
spec:
  config:
    apiVersion: v1
    kind: ConfigMap
    name: kafka-broker-config <b class="conum">(2)</b>
    namespace: knative-eventing</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The broker class. If not specified, brokers use the default class as configured by cluster administrators. To use the Kafka broker, this value must be <code>Kafka</code>.</p>
</li>
<li>
<p>The default config map for Knative brokers for Apache Kafka. This config map is created when the Kafka broker functionality is enabled on the cluster by a cluster administrator.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Apply the Kafka-based broker YAML file:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc apply -f &lt;filename&gt;</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="serverless-kafka-broker-with-kafka-topic_kafka-broker">Creating an Apache Kafka broker that uses an externally managed Kafka topic</h5>
<div class="paragraph">
<p>If you want to use a Kafka broker without allowing it to create its own internal topic, you can use an externally managed Kafka topic instead. To do this, you must create a Kafka <code>Broker</code> object that uses the <code>kafka.eventing.knative.dev/external.topic</code> annotation.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>The OpenShift Serverless Operator, Knative Eventing, and the <code>KnativeKafka</code> custom resource are installed on your OpenShift Container Platform cluster.</p>
</li>
<li>
<p>You have access to a Kafka instance such as <a href="https://access.redhat.com/documentation/en-us/red_hat_amq/7.6/html/amq_streams_on_openshift_overview/kafka-concepts_str#kafka-concepts-key_str">Red Hat AMQ Streams</a>, and have created a Kafka topic.</p>
</li>
<li>
<p>You have created a project or have access to a project with the appropriate roles and permissions to create applications and other workloads in OpenShift Container Platform.</p>
</li>
<li>
<p>You have installed the OpenShift CLI (<code>oc</code>).</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create a Kafka-based broker as a YAML file:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: eventing.knative.dev/v1
kind: Broker
metadata:
  annotations:
    eventing.knative.dev/broker.class: Kafka <b class="conum">(1)</b>
    kafka.eventing.knative.dev/external.topic: &lt;topic_name&gt; <b class="conum">(2)</b>
...</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The broker class. If not specified, brokers use the default class as configured by cluster administrators. To use the Kafka broker, this value must be <code>Kafka</code>.</p>
</li>
<li>
<p>The name of the Kafka topic that you want to use.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Apply the Kafka-based broker YAML file:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc apply -f &lt;filename&gt;</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="serverless-kafka-broker-with-isolated-dataplane_kafka-broker">Knative Broker implementation for Apache Kafka with isolated data plane</h5>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>The Knative Broker implementation for Apache Kafka with isolated data plane is a Technology Preview feature only. Technology Preview features
are not supported with Red Hat production service level agreements (SLAs) and
might not be functionally complete. Red Hat does not recommend using them
in production. These features provide early access to upcoming product
features, enabling customers to test functionality and provide feedback during
the development process.</p>
</div>
<div class="paragraph">
<p>For more information about the support scope of Red Hat Technology Preview features, see <a href="https://access.redhat.com/support/offerings/techpreview/">Technology Preview Features Support Scope</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The Knative Broker implementation for Apache Kafka has 2 planes:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Control plane</dt>
<dd>
<p>Consists of controllers that talk to the Kubernetes API, watch for custom objects, and manage the data plane.</p>
</dd>
<dt class="hdlist1">Data plane</dt>
<dd>
<p>The collection of components that listen for incoming events, talk to Apache Kafka, and send events to the event sinks. The Knative Broker implementation for Apache Kafka data plane is where events flow. The implementation consists of <code>kafka-broker-receiver</code> and <code>kafka-broker-dispatcher</code> deployments.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>When you configure a Broker class of <code>Kafka</code>, the Knative Broker implementation for Apache Kafka uses a shared data plane. This means that the <code>kafka-broker-receiver</code> and <code>kafka-broker-dispatcher</code> deployments in the <code>knative-eventing</code> namespace are used for all Apache Kafka Brokers in the cluster.</p>
</div>
<div class="paragraph">
<p>However, when you configure a Broker class of <code>KafkaNamespaced</code>, the Apache Kafka broker controller creates a new data plane for each namespace where a broker exists. This data plane is used by all <code>KafkaNamespaced</code> brokers in that namespace. This provides isolation between the data planes, so that the <code>kafka-broker-receiver</code> and <code>kafka-broker-dispatcher</code> deployments in the user namespace are only used for the broker in that namespace.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>As a consequence of having separate data planes, this security feature creates more deployments and uses more resources. Unless you have such isolation requirements, use a <strong>regular</strong> Broker with a class of <code>Kafka</code>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="serverless-create-kafka-namespaced-broker-kafka-broker">Creating a Knative broker for Apache Kafka that uses an isolated data plane</h5>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>The Knative Broker implementation for Apache Kafka with isolated data plane is a Technology Preview feature only. Technology Preview features
are not supported with Red Hat production service level agreements (SLAs) and
might not be functionally complete. Red Hat does not recommend using them
in production. These features provide early access to upcoming product
features, enabling customers to test functionality and provide feedback during
the development process.</p>
</div>
<div class="paragraph">
<p>For more information about the support scope of Red Hat Technology Preview features, see <a href="https://access.redhat.com/support/offerings/techpreview/">Technology Preview Features Support Scope</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To create a <code>KafkaNamespaced</code> broker, you must set the <code>eventing.knative.dev/broker.class</code> annotation to <code>KafkaNamespaced</code>.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>The OpenShift Serverless Operator, Knative Eventing, and the <code>KnativeKafka</code> custom resource are installed on your OpenShift Container Platform cluster.</p>
</li>
<li>
<p>You have access to an Apache Kafka instance, such as <a href="https://access.redhat.com/documentation/en-us/red_hat_amq/7.6/html/amq_streams_on_openshift_overview/kafka-concepts_str#kafka-concepts-key_str">Red Hat AMQ Streams</a>, and have created a Kafka topic.</p>
</li>
<li>
<p>You have created a project, or have access to a project, with the appropriate roles and permissions to create applications and other workloads in OpenShift Container Platform.</p>
</li>
<li>
<p>You have installed the OpenShift CLI (<code>oc</code>).</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create an Apache Kafka-based broker by using a YAML file:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: eventing.knative.dev/v1
kind: Broker
metadata:
  annotations:
    eventing.knative.dev/broker.class: KafkaNamespaced <b class="conum">(1)</b>
  name: default
  namespace: my-namespace <b class="conum">(2)</b>
spec:
  config:
    apiVersion: v1
    kind: ConfigMap
    name: my-config <b class="conum">(2)</b>
...</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>To use the Apache Kafka broker with isolated data planes, the broker class value must be <code>KafkaNamespaced</code>.</p>
</li>
<li>
<p>The referenced <code>ConfigMap</code> object <code>my-config</code> must be in the same namespace as the <code>Broker</code> object, in this case <code>my-namespace</code>.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Apply the Apache Kafka-based broker YAML file:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc apply -f &lt;filename&gt;</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>ConfigMap</code> object in <code>spec.config</code> must be in the same namespace as the <code>Broker</code> object:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: v1
kind: ConfigMap
metadata:
  name: my-config
  namespace: my-namespace
data:
  ...</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>After the creation of the first <code>Broker</code> object with the <code>KafkaNamespaced</code> class, the <code>kafka-broker-receiver</code> and <code>kafka-broker-dispatcher</code> deployments are created in the namespace. Subsequently, all brokers with the <code>KafkaNamespaced</code> class in the same namespace will use the same data plane. If no brokers with the <code>KafkaNamespaced</code> class exist in the namespace, the data plane in the namespace is deleted.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="serverless-kafka-broker-configmap_kafka-broker">Configuring Apache Kafka broker settings</h4>
<div class="paragraph">
<p>You can configure the replication factor, bootstrap servers, and the number of topic partitions for a Kafka broker, by creating a config map and referencing this config map in the Kafka <code>Broker</code> object.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You have cluster or dedicated administrator permissions on OpenShift Container Platform.</p>
</li>
<li>
<p>The OpenShift Serverless Operator, Knative Eventing, and the <code>KnativeKafka</code> custom resource (CR) are installed on your OpenShift Container Platform cluster.</p>
</li>
<li>
<p>You have created a project or have access to a project that has the appropriate roles and permissions to create applications and other workloads in OpenShift Container Platform.</p>
</li>
<li>
<p>You have installed the OpenShift CLI (<code>oc</code>).</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Modify the <code>kafka-broker-config</code> config map, or create your own config map that contains the following configuration:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: v1
kind: ConfigMap
metadata:
  name: &lt;config_map_name&gt; <b class="conum">(1)</b>
  namespace: &lt;namespace&gt; <b class="conum">(2)</b>
data:
  default.topic.partitions: &lt;integer&gt; <b class="conum">(3)</b>
  default.topic.replication.factor: &lt;integer&gt; <b class="conum">(4)</b>
  bootstrap.servers: &lt;list_of_servers&gt; <b class="conum">(5)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The config map name.</p>
</li>
<li>
<p>The namespace where the config map exists.</p>
</li>
<li>
<p>The number of topic partitions for the Kafka broker. This controls how quickly events can be sent to the broker. A higher number of partitions requires greater compute resources.</p>
</li>
<li>
<p>The replication factor of topic messages. This prevents against data loss. A higher replication factor requires greater compute resources and more storage.</p>
</li>
<li>
<p>A comma separated list of bootstrap servers. This can be inside or outside of the OpenShift Container Platform cluster, and is a list of Kafka clusters that the broker receives events from and sends events to.</p>
</li>
</ol>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>default.topic.replication.factor</code> value must be less than or equal to the number of Kafka broker instances in your cluster. For example, if you only have one Kafka broker, the <code>default.topic.replication.factor</code> value should not be more than <code>"1"</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Example Kafka broker config map</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: v1
kind: ConfigMap
metadata:
  name: kafka-broker-config
  namespace: knative-eventing
data:
  default.topic.partitions: "10"
  default.topic.replication.factor: "3"
  bootstrap.servers: "my-cluster-kafka-bootstrap.kafka:9092"</code></pre>
</div>
</div>
</li>
<li>
<p>Apply the config map:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">$ oc apply -f &lt;config_map_filename&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>Specify the config map for the Kafka <code>Broker</code> object:</p>
<div class="listingblock">
<div class="title">Example Broker object</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: eventing.knative.dev/v1
kind: Broker
metadata:
  name: &lt;broker_name&gt; <b class="conum">(1)</b>
  namespace: &lt;namespace&gt; <b class="conum">(2)</b>
  annotations:
    eventing.knative.dev/broker.class: Kafka <b class="conum">(3)</b>
spec:
  config:
    apiVersion: v1
    kind: ConfigMap
    name: &lt;config_map_name&gt; <b class="conum">(4)</b>
    namespace: &lt;namespace&gt; <b class="conum">(5)</b>
...</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The broker name.</p>
</li>
<li>
<p>The namespace where the broker exists.</p>
</li>
<li>
<p>The broker class annotation. In this example, the broker is a Kafka broker that uses the class value <code>Kafka</code>.</p>
</li>
<li>
<p>The config map name.</p>
</li>
<li>
<p>The namespace where the config map exists.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Apply the broker:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">$ oc apply -f &lt;broker_filename&gt;</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="serverless-kafka-admin-security">Security configuration for the Knative broker implementation for Apache Kafka</h4>
<div class="paragraph">
<p>Kafka clusters are generally secured by using the TLS or SASL authentication methods. You can configure a Kafka broker or channel to work against a protected Red Hat AMQ Streams cluster by using TLS or SASL.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Red Hat recommends that you enable both SASL and TLS together.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="serverless-kafka-broker-tls-default-config_kafka-broker">Configuring TLS authentication for Apache Kafka brokers</h5>
<div class="paragraph">
<p><em>Transport Layer Security</em> (TLS) is used by Apache Kafka clients and servers to encrypt traffic between Knative and Kafka, as well as for authentication. TLS is the only supported method of traffic encryption for the Knative broker implementation for Apache Kafka.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You have cluster or dedicated administrator permissions on OpenShift Container Platform.</p>
</li>
<li>
<p>The OpenShift Serverless Operator, Knative Eventing, and the <code>KnativeKafka</code> CR are installed on your OpenShift Container Platform cluster.</p>
</li>
<li>
<p>You have created a project or have access to a project with the appropriate roles and permissions to create applications and other workloads in OpenShift Container Platform.</p>
</li>
<li>
<p>You have a Kafka cluster CA certificate stored as a <code>.pem</code> file.</p>
</li>
<li>
<p>You have a Kafka cluster client certificate and a key stored as <code>.pem</code> files.</p>
</li>
<li>
<p>Install the OpenShift CLI (<code>oc</code>).</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create the certificate files as a secret in the <code>knative-eventing</code> namespace:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc create secret -n knative-eventing generic &lt;secret_name&gt; \
  --from-literal=protocol=SSL \
  --from-file=ca.crt=caroot.pem \
  --from-file=user.crt=certificate.pem \
  --from-file=user.key=key.pem</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>Use the key names <code>ca.crt</code>, <code>user.crt</code>, and <code>user.key</code>. Do not change them.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Edit the <code>KnativeKafka</code> CR and add a reference to your secret in the <code>broker</code> spec:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: operator.serverless.openshift.io/v1alpha1
kind: KnativeKafka
metadata:
  namespace: knative-eventing
  name: knative-kafka
spec:
  broker:
    enabled: true
    defaultConfig:
      authSecretName: &lt;secret_name&gt;
...</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="serverless-kafka-broker-sasl-default-config_kafka-broker">Configuring SASL authentication for Apache Kafka brokers</h5>
<div class="paragraph">
<p><em>Simple Authentication and Security Layer</em> (SASL) is used by Apache Kafka for authentication. If you use SASL authentication on your cluster, users must provide credentials to Knative for communicating with the Kafka cluster; otherwise events cannot be produced or consumed.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You have cluster or dedicated administrator permissions on OpenShift Container Platform.</p>
</li>
<li>
<p>The OpenShift Serverless Operator, Knative Eventing, and the <code>KnativeKafka</code> CR are installed on your OpenShift Container Platform cluster.</p>
</li>
<li>
<p>You have created a project or have access to a project with the appropriate roles and permissions to create applications and other workloads in OpenShift Container Platform.</p>
</li>
<li>
<p>You have a username and password for a Kafka cluster.</p>
</li>
<li>
<p>You have chosen the SASL mechanism to use, for example, <code>PLAIN</code>, <code>SCRAM-SHA-256</code>, or <code>SCRAM-SHA-512</code>.</p>
</li>
<li>
<p>If TLS is enabled, you also need the <code>ca.crt</code> certificate file for the Kafka cluster.</p>
</li>
<li>
<p>Install the OpenShift CLI (<code>oc</code>).</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create the certificate files as a secret in the <code>knative-eventing</code> namespace:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc create secret -n knative-eventing generic &lt;secret_name&gt; \
  --from-literal=protocol=SASL_SSL \
  --from-literal=sasl.mechanism=&lt;sasl_mechanism&gt; \
  --from-file=ca.crt=caroot.pem \
  --from-literal=password="SecretPassword" \
  --from-literal=user="my-sasl-user"</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Use the key names <code>ca.crt</code>, <code>password</code>, and <code>sasl.mechanism</code>. Do not change them.</p>
</li>
<li>
<p>If you want to use SASL with public CA certificates, you must use the <code>tls.enabled=true</code> flag, rather than the <code>ca.crt</code> argument, when creating the secret. For example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc create secret -n &lt;namespace&gt; generic &lt;kafka_auth_secret&gt; \
  --from-literal=tls.enabled=true \
  --from-literal=password="SecretPassword" \
  --from-literal=saslType="SCRAM-SHA-512" \
  --from-literal=user="my-sasl-user"</code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Edit the <code>KnativeKafka</code> CR and add a reference to your secret in the <code>broker</code> spec:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: operator.serverless.openshift.io/v1alpha1
kind: KnativeKafka
metadata:
  namespace: knative-eventing
  name: knative-kafka
spec:
  broker:
    enabled: true
    defaultConfig:
      authSecretName: &lt;secret_name&gt;
...</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3 _additional-resources">
<h4 id="additional-resources_serverless-kafka-admin">Additional resources</h4>
<div class="ulist">
<ul>
<li>
<p><a href="https://access.redhat.com/documentation/en-us/red_hat_amq/7.6/html/amq_streams_on_openshift_overview/kafka-concepts_str#kafka-concepts-key_str">Red Hat AMQ Streams documentation</a></p>
</li>
<li>
<p><a href="https://access.redhat.com/documentation/en-us/red_hat_amq/7.5/html-single/using_amq_streams_on_rhel/index#assembly-kafka-encryption-and-authentication-str">TLS and SASL on Kafka</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="serverless-using-brokers-managing-brokers">Managing brokers</h3>
<div class="paragraph">
<p>The Knative (<code>kn</code>) CLI provides commands that can be used to describe and list existing brokers.</p>
</div>
<div class="sect3">
<h4 id="serverless-list-broker-kn_serverless-using-brokers-managing-brokers">Listing existing brokers by using the Knative CLI</h4>
<div class="paragraph">
<p>Using the Knative (<code>kn</code>) CLI to list brokers provides a streamlined and intuitive user interface. You can use the <code>kn broker list</code> command to list existing brokers in your cluster by using the Knative CLI.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>The OpenShift Serverless Operator and Knative Eventing are installed on your OpenShift Container Platform cluster.</p>
</li>
<li>
<p>You have installed the Knative (<code>kn</code>) CLI.</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>List all existing brokers:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ kn broker list</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">NAME      URL                                                                     AGE   CONDITIONS   READY   REASON
default   http://broker-ingress.knative-eventing.svc.cluster.local/test/default   45s   5 OK / 5     True</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="serverless-describe-broker-kn_serverless-using-brokers-managing-brokers">Describing an existing broker by using the Knative CLI</h4>
<div class="paragraph">
<p>Using the Knative (<code>kn</code>) CLI to describe brokers provides a streamlined and intuitive user interface. You can use the <code>kn broker describe</code> command to print information about existing brokers in your cluster by using the Knative CLI.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>The OpenShift Serverless Operator and Knative Eventing are installed on your OpenShift Container Platform cluster.</p>
</li>
<li>
<p>You have installed the Knative (<code>kn</code>) CLI.</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Describe an existing broker:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ kn broker describe &lt;broker_name&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example command using default broker</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ kn broker describe default</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">Name:         default
Namespace:    default
Annotations:  eventing.knative.dev/broker.class=MTChannelBasedBroker, eventing.knative.dev/creato ...
Age:          22s

Address:
  URL:    http://broker-ingress.knative-eventing.svc.cluster.local/default/default

Conditions:
  OK TYPE                   AGE REASON
  ++ Ready                  22s
  ++ Addressable            22s
  ++ FilterReady            22s
  ++ IngressReady           22s
  ++ TriggerChannelReady    22s</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="serverless-event-delivery">Event delivery</h3>
<div class="paragraph">
<p>You can configure event delivery parameters that are applied in cases where an event fails to be delivered to an event sink. Configuring event delivery parameters, including a dead letter sink, ensures that any events that fail to be delivered to an event sink are retried. Otherwise, undelivered events are dropped.</p>
</div>
<div class="sect3">
<h4 id="serverless-event-delivery-component-behaviors_serverless-event-delivery">Event delivery behavior patterns for channels and brokers</h4>
<div class="paragraph">
<p>Different channel and broker types have their own behavior patterns that are followed for event delivery.</p>
</div>
<div class="sect4">
<h5 id="serverless-event-delivery-component-behaviors-kafka_serverless-event-delivery">Knative channels and brokers for Apache Kafka</h5>
<div class="paragraph">
<p>If an event is successfully delivered to a Kafka channel or broker receiver, the receiver responds with a <code>202</code> status code, which means that the event has been safely stored inside a Kafka topic and is not lost.</p>
</div>
<div class="paragraph">
<p>If the receiver responds with any other status code, the event is not safely stored, and steps must be taken by the user to resolve the issue.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="serverless-event-delivery-parameters_serverless-event-delivery">Configurable event delivery parameters</h4>
<div class="paragraph">
<p>The following parameters can be configured for event delivery:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Dead letter sink</dt>
<dd>
<p>You can configure the <code>deadLetterSink</code> delivery parameter so that if an event fails to be delivered, it is stored in the specified event sink. Undelivered events that are not stored in a dead letter sink are dropped. The dead letter sink be any addressable object that conforms to the Knative Eventing sink contract, such as a Knative service, a Kubernetes service, or a URI.</p>
</dd>
<dt class="hdlist1">Retries</dt>
<dd>
<p>You can set a minimum number of times that the delivery must be retried before the event is sent to the dead letter sink, by configuring the <code>retry</code> delivery parameter with an integer value.</p>
</dd>
<dt class="hdlist1">Back off delay</dt>
<dd>
<p>You can set the <code>backoffDelay</code> delivery parameter to specify the time delay before an event delivery retry is attempted after a failure. The duration of the <code>backoffDelay</code> parameter is specified using the <a href="https://en.wikipedia.org/wiki/ISO_8601#Durations">ISO 8601</a> format. For example, <code>PT1S</code> specifies a 1 second delay.</p>
</dd>
<dt class="hdlist1">Back off policy</dt>
<dd>
<p>The <code>backoffPolicy</code> delivery parameter can be used to specify the retry back off policy. The policy can be specified as either <code>linear</code> or <code>exponential</code>. When using the <code>linear</code> back off policy, the back off delay is equal to <code>backoffDelay * &lt;numberOfRetries&gt;</code>. When using the <code>exponential</code> backoff policy, the back off delay is equal to <code>backoffDelay*2^&lt;numberOfRetries&gt;</code>.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="serverless-configuring-event-delivery-examples_serverless-event-delivery">Examples of configuring event delivery parameters</h4>
<div class="paragraph">
<p>You can configure event delivery parameters for <code>Broker</code>, <code>Trigger</code>, <code>Channel</code>, and <code>Subscription</code> objects. If you configure event delivery parameters for a broker or channel, these parameters are propagated to triggers or subscriptions created for those objects. You can also set event delivery parameters for triggers or subscriptions to override the settings for the broker or channel.</p>
</div>
<div class="listingblock">
<div class="title">Example <code>Broker</code> object</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: eventing.knative.dev/v1
kind: Broker
metadata:
...
spec:
  delivery:
    deadLetterSink:
      ref:
        apiVersion: eventing.knative.dev/v1alpha1
        kind: KafkaSink
        name: &lt;sink_name&gt;
    backoffDelay: &lt;duration&gt;
    backoffPolicy: &lt;policy_type&gt;
    retry: &lt;integer&gt;
...</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example <code>Trigger</code> object</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: eventing.knative.dev/v1
kind: Trigger
metadata:
...
spec:
  broker: &lt;broker_name&gt;
  delivery:
    deadLetterSink:
      ref:
        apiVersion: serving.knative.dev/v1
        kind: Service
        name: &lt;sink_name&gt;
    backoffDelay: &lt;duration&gt;
    backoffPolicy: &lt;policy_type&gt;
    retry: &lt;integer&gt;
...</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example <code>Channel</code> object</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: messaging.knative.dev/v1
kind: Channel
metadata:
...
spec:
  delivery:
    deadLetterSink:
      ref:
        apiVersion: serving.knative.dev/v1
        kind: Service
        name: &lt;sink_name&gt;
    backoffDelay: &lt;duration&gt;
    backoffPolicy: &lt;policy_type&gt;
    retry: &lt;integer&gt;
...</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example <code>Subscription</code> object</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: messaging.knative.dev/v1
kind: Subscription
metadata:
...
spec:
  channel:
    apiVersion: messaging.knative.dev/v1
    kind: Channel
    name: &lt;channel_name&gt;
  delivery:
    deadLetterSink:
      ref:
        apiVersion: serving.knative.dev/v1
        kind: Service
        name: &lt;sink_name&gt;
    backoffDelay: &lt;duration&gt;
    backoffPolicy: &lt;policy_type&gt;
    retry: &lt;integer&gt;
...</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="trigger-event-delivery-config_serverless-event-delivery">Configuring event delivery ordering for triggers</h4>
<div class="paragraph">
<p>If you are using a Kafka broker, you can configure the delivery order of events from triggers to event sinks.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>The OpenShift Serverless Operator, Knative Eventing, and Knative Kafka are installed on your OpenShift Container Platform cluster.</p>
</li>
<li>
<p>Kafka broker is enabled for use on your cluster, and you have created a Kafka broker.</p>
</li>
<li>
<p>You have created a project or have access to a project with the appropriate roles and permissions to create applications and other workloads in OpenShift Container Platform.</p>
</li>
<li>
<p>You have installed the OpenShift (<code>oc</code>) CLI.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create or modify a <code>Trigger</code> object and set the <code>kafka.eventing.knative.dev/delivery.order</code> annotation:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: eventing.knative.dev/v1
kind: Trigger
metadata:
  name: &lt;trigger_name&gt;
  annotations:
     kafka.eventing.knative.dev/delivery.order: ordered
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>The supported consumer delivery guarantees are:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>unordered</code></dt>
<dd>
<p>An unordered consumer is a non-blocking consumer that delivers messages unordered, while preserving proper offset management.</p>
</dd>
<dt class="hdlist1"><code>ordered</code></dt>
<dd>
<p>An ordered consumer is a per-partition blocking consumer that waits for a successful response from the CloudEvent subscriber before it delivers the next message of the partition.</p>
<div class="paragraph">
<p>The default ordering guarantee is <code>unordered</code>.</p>
</div>
</dd>
</dl>
</div>
</li>
<li>
<p>Apply the <code>Trigger</code> object:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc apply -f &lt;filename&gt;</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_triggers">Triggers</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="serverless-triggers">Triggers overview</h3>
<div class="paragraph">
<p>Brokers can be used in combination with triggers to deliver events from an event source to an event sink. Events are sent from an event source to a broker as an HTTP <code>POST</code> request. After events have entered the broker, they can be filtered by <a href="https://github.com/cloudevents/spec/blob/v1.0/spec.md#context-attributes">CloudEvent attributes</a> using triggers, and sent as an HTTP <code>POST</code> request to an event sink.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/serverless-event-broker-workflow.png" alt="Broker event delivery overview">
</div>
</div>
<div class="paragraph">
<p>If you are using a Knative broker for Apache Kafka, you can configure the delivery order of events from triggers to event sinks. See <a href="#trigger-event-delivery-config_serverless-triggers">Configuring event delivery ordering for triggers</a>.</p>
</div>
<div class="sect3">
<h4 id="trigger-event-delivery-config_serverless-triggers">Configuring event delivery ordering for triggers</h4>
<div class="paragraph">
<p>If you are using a Kafka broker, you can configure the delivery order of events from triggers to event sinks.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>The OpenShift Serverless Operator, Knative Eventing, and Knative Kafka are installed on your OpenShift Container Platform cluster.</p>
</li>
<li>
<p>Kafka broker is enabled for use on your cluster, and you have created a Kafka broker.</p>
</li>
<li>
<p>You have created a project or have access to a project with the appropriate roles and permissions to create applications and other workloads in OpenShift Container Platform.</p>
</li>
<li>
<p>You have installed the OpenShift (<code>oc</code>) CLI.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create or modify a <code>Trigger</code> object and set the <code>kafka.eventing.knative.dev/delivery.order</code> annotation:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: eventing.knative.dev/v1
kind: Trigger
metadata:
  name: &lt;trigger_name&gt;
  annotations:
     kafka.eventing.knative.dev/delivery.order: ordered
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>The supported consumer delivery guarantees are:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>unordered</code></dt>
<dd>
<p>An unordered consumer is a non-blocking consumer that delivers messages unordered, while preserving proper offset management.</p>
</dd>
<dt class="hdlist1"><code>ordered</code></dt>
<dd>
<p>An ordered consumer is a per-partition blocking consumer that waits for a successful response from the CloudEvent subscriber before it delivers the next message of the partition.</p>
<div class="paragraph">
<p>The default ordering guarantee is <code>unordered</code>.</p>
</div>
</dd>
</dl>
</div>
</li>
<li>
<p>Apply the <code>Trigger</code> object:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc apply -f &lt;filename&gt;</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="next-steps_serverless-triggers">Next steps</h4>
<div class="ulist">
<ul>
<li>
<p>Configure event delivery parameters that are applied in cases where an event fails to be delivered to an event sink. See <a href="#serverless-configuring-event-delivery-examples_serverless-event-delivery">Examples of configuring event delivery parameters</a>.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="create-triggers">Creating triggers</h3>
<div class="paragraph">
<p>Brokers can be used in combination with triggers to deliver events from an event source to an event sink. Events are sent from an event source to a broker as an HTTP <code>POST</code> request. After events have entered the broker, they can be filtered by <a href="https://github.com/cloudevents/spec/blob/v1.0/spec.md#context-attributes">CloudEvent attributes</a> using triggers, and sent as an HTTP <code>POST</code> request to an event sink.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/serverless-event-broker-workflow.png" alt="Broker event delivery overview">
</div>
</div>
<div class="sect3">
<h4 id="serverless-creating-trigger-admin-web-console_serverless-triggers">Creating a trigger by using the Administrator perspective</h4>
<div class="paragraph">
<p>Using the OpenShift Container Platform web console provides a streamlined and intuitive user interface to create a trigger. After Knative Eventing is installed on your cluster and you have created a broker, you can create a trigger by using the web console.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>The OpenShift Serverless Operator and Knative Eventing are installed on your OpenShift Container Platform cluster.</p>
</li>
<li>
<p>You have logged in to the web console and are in the <strong>Administrator</strong> perspective.</p>
</li>
<li>
<p>You have cluster administrator permissions on OpenShift Container Platform, or you have cluster or dedicated administrator permissions on Red Hat OpenShift Service on AWS or OpenShift Dedicated.</p>
</li>
<li>
<p>You have created a Knative broker.</p>
</li>
<li>
<p>You have created a Knative service to use as a subscriber.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the <strong>Administrator</strong> perspective of the OpenShift Container Platform web console, navigate to <strong>Serverless</strong> &#8594; <strong>Eventing</strong>.</p>
</li>
<li>
<p>In the <strong>Broker</strong> tab, select the Options menu <span class="image"><img src="images/kebab.png" alt="kebab" title="Options menu"></span> for the broker that you want to add a trigger to.</p>
</li>
<li>
<p>Click <strong>Add Trigger</strong> in the list.</p>
</li>
<li>
<p>In the <strong>Add Trigger</strong> dialogue box, select a <strong>Subscriber</strong> for the trigger. The subscriber is the Knative service that will receive events from the broker.</p>
</li>
<li>
<p>Click <strong>Add</strong>.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="serverless-create-trigger-odc_serverless-triggers">Creating a trigger by using the Developer perspective</h4>
<div class="paragraph">
<p>Using the OpenShift Container Platform web console provides a streamlined and intuitive user interface to create a trigger. After Knative Eventing is installed on your cluster and you have created a broker, you can create a trigger by using the web console.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>The OpenShift Serverless Operator, Knative Serving, and Knative Eventing are installed on your OpenShift Container Platform cluster.</p>
</li>
<li>
<p>You have logged in to the web console.</p>
</li>
<li>
<p>You have created a project or have access to a project with the appropriate roles and permissions to create applications and other workloads in OpenShift Container Platform.</p>
</li>
<li>
<p>You have created a broker and a Knative service or other event sink to connect to the trigger.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the <strong>Developer</strong> perspective, navigate to the <strong>Topology</strong> page.</p>
</li>
<li>
<p>Hover over the broker that you want to create a trigger for, and drag the arrow. The <strong>Add Trigger</strong> option is displayed.</p>
</li>
<li>
<p>Click <strong>Add Trigger</strong>.</p>
</li>
<li>
<p>Select your sink in the <strong>Subscriber</strong> list.</p>
</li>
<li>
<p>Click <strong>Add</strong>.</p>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Verification</div>
<ul>
<li>
<p>After the subscription has been created, you can view it in the <strong>Topology</strong> page, where it is represented as a line that connects the broker to the event sink.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Deleting a trigger</div>
<ol class="arabic">
<li>
<p>In the <strong>Developer</strong> perspective, navigate to the <strong>Topology</strong> page.</p>
</li>
<li>
<p>Click on the trigger that you want to delete.</p>
</li>
<li>
<p>In the <strong>Actions</strong> context menu, select <strong>Delete Trigger</strong>.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="serverless-create-kn-trigger_serverless-triggers">Creating a trigger by using the Knative CLI</h4>
<div class="paragraph">
<p>You can use the <code>kn trigger create</code> command to create a trigger.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>The OpenShift Serverless Operator and Knative Eventing are installed on your OpenShift Container Platform cluster.</p>
</li>
<li>
<p>You have installed the Knative (<code>kn</code>) CLI.</p>
</li>
<li>
<p>You have created a project or have access to a project with the appropriate roles and permissions to create applications and other workloads in OpenShift Container Platform.</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Create a trigger:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ kn trigger create &lt;trigger_name&gt; --broker &lt;broker_name&gt; --filter &lt;key=value&gt; --sink &lt;sink_name&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively, you can create a trigger and simultaneously create the <code>default</code> broker using broker injection:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ kn trigger create &lt;trigger_name&gt; --inject-broker --filter &lt;key=value&gt; --sink &lt;sink_name&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>By default, triggers forward all events sent to a broker to sinks that are subscribed to that broker.
Using the <code>--filter</code> attribute for triggers allows you to filter events from a broker, so that subscribers will only receive a subset of events based on your defined criteria.</p>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="list-triggers-cli">List triggers from the command line</h3>
<div class="paragraph">
<p>Using the Knative (<code>kn</code>) CLI to list triggers provides a streamlined and intuitive user interface.</p>
</div>
<div class="sect3">
<h4 id="kn-trigger-list_list-triggers-cli">Listing triggers by using the Knative CLI</h4>
<div class="paragraph">
<p>You can use the <code>kn trigger list</code> command to list existing triggers in your cluster.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>The OpenShift Serverless Operator and Knative Eventing are installed on your OpenShift Container Platform cluster.</p>
</li>
<li>
<p>You have installed the Knative (<code>kn</code>) CLI.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Print a list of available triggers:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ kn trigger list</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">NAME    BROKER    SINK           AGE   CONDITIONS   READY   REASON
email   default   ksvc:edisplay   4s    5 OK / 5     True
ping    default   ksvc:edisplay   32s   5 OK / 5     True</code></pre>
</div>
</div>
</li>
<li>
<p>Optional: Print a list of triggers in JSON format:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ kn trigger list -o json</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="describe-triggers-cli">Describe triggers from the command line</h3>
<div class="paragraph">
<p>Using the Knative (<code>kn</code>) CLI to describe triggers provides a streamlined and intuitive user interface.</p>
</div>
<div class="sect3">
<h4 id="kn-trigger-describe_describe-triggers-cli">Describing a trigger by using the Knative CLI</h4>
<div class="paragraph">
<p>You can use the <code>kn trigger describe</code> command to print information about existing triggers in your cluster by using the Knative CLI.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>The OpenShift Serverless Operator and Knative Eventing are installed on your OpenShift Container Platform cluster.</p>
</li>
<li>
<p>You have installed the Knative (<code>kn</code>) CLI.</p>
</li>
<li>
<p>You have created a trigger.</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Enter the command:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ kn trigger describe &lt;trigger_name&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">Name:         ping
Namespace:    default
Labels:       eventing.knative.dev/broker=default
Annotations:  eventing.knative.dev/creator=kube:admin, eventing.knative.dev/lastModifier=kube:admin
Age:          2m
Broker:       default
Filter:
  type:       dev.knative.event

Sink:
  Name:       edisplay
  Namespace:  default
  Resource:   Service (serving.knative.dev/v1)

Conditions:
  OK TYPE                  AGE REASON
  ++ Ready                  2m
  ++ BrokerReady            2m
  ++ DependencyReady        2m
  ++ Subscribed             2m
  ++ SubscriberResolved     2m</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="connect-trigger-sink">Connecting a trigger to a sink</h3>
<div class="paragraph">
<p>You can connect a trigger to a sink, so that events from a broker are filtered before they are sent to the sink. A sink that is connected to a trigger is configured as a <code>subscriber</code> in the <code>Trigger</code> object&#8217;s resource spec.</p>
</div>
<div class="listingblock">
<div class="title">Example of a <code>Trigger</code> object connected to an Apache Kafka sink</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: eventing.knative.dev/v1
kind: Trigger
metadata:
  name: &lt;trigger_name&gt; <b class="conum">(1)</b>
spec:
...
  subscriber:
    ref:
      apiVersion: eventing.knative.dev/v1alpha1
      kind: KafkaSink
      name: &lt;kafka_sink_name&gt; <b class="conum">(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The name of the trigger being connected to the sink.</p>
</li>
<li>
<p>The name of a <code>KafkaSink</code> object.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="filter-triggers-cli">Filtering triggers from the command line</h3>
<div class="paragraph">
<p>Using the Knative (<code>kn</code>) CLI to filter events by using triggers provides a streamlined and intuitive user interface. You can use the <code>kn trigger create</code> command, along with the appropriate flags, to filter events by using triggers.</p>
</div>
<div class="sect3">
<h4 id="kn-trigger-filtering_filter-triggers-cli">Filtering events with triggers by using the Knative CLI</h4>
<div class="paragraph">
<p>In the following trigger example, only events with the attribute <code>type: dev.knative.samples.helloworld</code> are sent to the event sink:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ kn trigger create &lt;trigger_name&gt; --broker &lt;broker_name&gt; --filter type=dev.knative.samples.helloworld --sink ksvc:&lt;service_name&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also filter events by using multiple attributes. The following example shows how to filter events using the type, source, and extension attributes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ kn trigger create &lt;trigger_name&gt; --broker &lt;broker_name&gt; --sink ksvc:&lt;service_name&gt; \
--filter type=dev.knative.samples.helloworld \
--filter source=dev.knative.samples/helloworldsource \
--filter myextension=my-extension-value</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="update-triggers-cli">Updating triggers from the command line</h3>
<div class="paragraph">
<p>Using the Knative (<code>kn</code>) CLI to update triggers provides a streamlined and intuitive user interface.</p>
</div>
<div class="sect3">
<h4 id="kn-trigger-update_update-triggers-cli">Updating a trigger by using the Knative CLI</h4>
<div class="paragraph">
<p>You can use the <code>kn trigger update</code> command with certain flags to update attributes for a trigger.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>The OpenShift Serverless Operator and Knative Eventing are installed on your OpenShift Container Platform cluster.</p>
</li>
<li>
<p>You have installed the Knative (<code>kn</code>) CLI.</p>
</li>
<li>
<p>You have created a project or have access to a project with the appropriate roles and permissions to create applications and other workloads in OpenShift Container Platform.</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Update a trigger:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ kn trigger update &lt;trigger_name&gt; --filter &lt;key=value&gt; --sink &lt;sink_name&gt; [flags]</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>You can update a trigger to filter exact event attributes that match incoming events. For example, using the <code>type</code> attribute:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ kn trigger update &lt;trigger_name&gt; --filter type=knative.dev.event</code></pre>
</div>
</div>
</li>
<li>
<p>You can remove a filter attribute from a trigger. For example, you can remove the filter attribute with key <code>type</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ kn trigger update &lt;trigger_name&gt; --filter type-</code></pre>
</div>
</div>
</li>
<li>
<p>You can use the <code>--sink</code> parameter to change the event sink of a trigger:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ kn trigger update &lt;trigger_name&gt; --sink ksvc:my-event-sink</code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="delete-triggers-cli">Deleting triggers from the command line</h3>
<div class="paragraph">
<p>Using the Knative (<code>kn</code>) CLI to delete a trigger provides a streamlined and intuitive user interface.</p>
</div>
<div class="sect3">
<h4 id="delete-kn-trigger_delete-triggers-cli">Deleting a trigger by using the Knative CLI</h4>
<div class="paragraph">
<p>You can use the <code>kn trigger delete</code> command to delete a trigger.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>The OpenShift Serverless Operator and Knative Eventing are installed on your OpenShift Container Platform cluster.</p>
</li>
<li>
<p>You have installed the Knative (<code>kn</code>) CLI.</p>
</li>
<li>
<p>You have created a project or have access to a project with the appropriate roles and permissions to create applications and other workloads in OpenShift Container Platform.</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Delete a trigger:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ kn trigger delete &lt;trigger_name&gt;</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Verification</div>
<ol class="arabic">
<li>
<p>List existing triggers:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ kn trigger list</code></pre>
</div>
</div>
</li>
<li>
<p>Verify that the trigger no longer exists:</p>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">No triggers found.</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_channels">Channels</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="serverless-channels">Channels and subscriptions</h3>
<div class="paragraph">
<p>Channels are custom resources that define a single event-forwarding and persistence layer. After events have been sent to a channel from an event source or producer, these events can be sent to multiple Knative services or other sinks by using a subscription.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/serverless-event-channel-workflow.png" alt="Channel workflow overview">
</div>
</div>
<div class="paragraph">
<p>You can create channels by instantiating a supported <code>Channel</code> object, and configure re-delivery attempts by modifying the <code>delivery</code> spec in a <code>Subscription</code> object.</p>
</div>
<div class="paragraph">
<p>After you create a <code>Channel</code> object, a mutating admission webhook adds a set of <code>spec.channelTemplate</code> properties for the <code>Channel</code> object based on the default channel implementation. For example, for an <code>InMemoryChannel</code> default implementation, the <code>Channel</code> object looks as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: messaging.knative.dev/v1
kind: Channel
metadata:
  name: example-channel
  namespace: default
spec:
  channelTemplate:
    apiVersion: messaging.knative.dev/v1
    kind: InMemoryChannel</code></pre>
</div>
</div>
<div class="paragraph">
<p>The channel controller then creates the backing channel instance based on the <code>spec.channelTemplate</code> configuration.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>spec.channelTemplate</code> properties cannot be changed after creation, because they are set by the default channel mechanism rather than by the user.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When this mechanism is used with the preceding example, two objects are created: a generic backing channel and an <code>InMemoryChannel</code> channel. If you are using a different default channel implementation, the <code>InMemoryChannel</code> is replaced with one that is specific to your implementation. For example, with the Knative broker for Apache Kafka, the <code>KafkaChannel</code> channel is created.</p>
</div>
<div class="paragraph">
<p>The backing channel acts as a proxy that copies its subscriptions to the user-created channel object, and sets the user-created channel object status to reflect the status of the backing channel.</p>
</div>
<div class="sect3">
<h4 id="serverless-channels-implementations">Channel implementation types</h4>
<div class="paragraph">
<p><code>InMemoryChannel</code> and <code>KafkaChannel</code> channel implementations can be used with OpenShift Serverless for development use.</p>
</div>
<div class="paragraph">
<p>The following are limitations of <code>InMemoryChannel</code> type channels:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>No event persistence is available. If a pod goes down, events on that pod are lost.</p>
</li>
<li>
<p><code>InMemoryChannel</code> channels do not implement event ordering, so two events that are received in the channel at the same time can be delivered to a subscriber in any order.</p>
</li>
<li>
<p>If a subscriber rejects an event, there are no re-delivery attempts by default. You can configure re-delivery attempts by modifying the <code>delivery</code> spec in the <code>Subscription</code> object.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="serverless-creating-channels">Creating channels</h3>
<div class="paragraph">
<p>Channels are custom resources that define a single event-forwarding and persistence layer. After events have been sent to a channel from an event source or producer, these events can be sent to multiple Knative services or other sinks by using a subscription.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/serverless-event-channel-workflow.png" alt="Channel workflow overview">
</div>
</div>
<div class="paragraph">
<p>You can create channels by instantiating a supported <code>Channel</code> object, and configure re-delivery attempts by modifying the <code>delivery</code> spec in a <code>Subscription</code> object.</p>
</div>
<div class="sect3">
<h4 id="serverless-creating-channel-admin-web-console_serverless-creating-channels">Creating a channel by using the Administrator perspective</h4>
<div class="paragraph">
<p>After Knative Eventing is installed on your cluster, you can create a channel by using the Administrator perspective.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>The OpenShift Serverless Operator and Knative Eventing are installed on your OpenShift Container Platform cluster.</p>
</li>
<li>
<p>You have logged in to the web console and are in the <strong>Administrator</strong> perspective.</p>
</li>
<li>
<p>You have cluster administrator permissions on OpenShift Container Platform, or you have cluster or dedicated administrator permissions on Red Hat OpenShift Service on AWS or OpenShift Dedicated.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the <strong>Administrator</strong> perspective of the OpenShift Container Platform web console, navigate to <strong>Serverless</strong> &#8594; <strong>Eventing</strong>.</p>
</li>
<li>
<p>In the <strong>Create</strong> list, select <strong>Channel</strong>. You will be directed to the <strong>Channel</strong> page.</p>
</li>
<li>
<p>Select the type of <code>Channel</code> object that you want to create in the <strong>Type</strong> list.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Currently only <code>InMemoryChannel</code> channel objects are supported by default. Knative channels for Apache Kafka are available if you have installed the Knative broker implementation for Apache Kafka on OpenShift Serverless.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Click <strong>Create</strong>.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="serverless-create-channel-odc_serverless-creating-channels">Creating a channel by using the Developer perspective</h4>
<div class="paragraph">
<p>Using the OpenShift Container Platform web console provides a streamlined and intuitive user interface to create a channel. After Knative Eventing is installed on your cluster, you can create a channel by using the web console.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You have logged in to the OpenShift Container Platform web console.</p>
</li>
<li>
<p>The OpenShift Serverless Operator and Knative Eventing are installed on your OpenShift Container Platform cluster.</p>
</li>
<li>
<p>You have created a project or have access to a project with the appropriate roles and permissions to create applications and other workloads in OpenShift Container Platform.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the <strong>Developer</strong> perspective, navigate to <strong>+Add</strong> &#8594; <strong>Channel</strong>.</p>
</li>
<li>
<p>Select the type of <code>Channel</code> object that you want to create in the <strong>Type</strong> list.</p>
</li>
<li>
<p>Click <strong>Create</strong>.</p>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Verification</div>
<ul>
<li>
<p>Confirm that the channel now exists by navigating to the <strong>Topology</strong> page.</p>
<div class="imageblock">
<div class="content">
<img src="images/verify-channel-odc.png" alt="View the channel in the Topology view">
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="serverless-create-channel-kn_serverless-creating-channels">Creating a channel by using the Knative CLI</h4>
<div class="paragraph">
<p>Using the Knative (<code>kn</code>) CLI to create channels provides a more streamlined and intuitive user interface than modifying YAML files directly. You can use the <code>kn channel create</code> command to create a channel.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>The OpenShift Serverless Operator and Knative Eventing are installed on the cluster.</p>
</li>
<li>
<p>You have installed the Knative (<code>kn</code>) CLI.</p>
</li>
<li>
<p>You have created a project or have access to a project with the appropriate roles and permissions to create applications and other workloads in OpenShift Container Platform.</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Create a channel:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ kn channel create &lt;channel_name&gt; --type &lt;channel_type&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The channel type is optional, but where specified, must be given in the format <code>Group:Version:Kind</code>.
For example, you can create an <code>InMemoryChannel</code> object:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ kn channel create mychannel --type messaging.knative.dev:v1:InMemoryChannel</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">Channel 'mychannel' created in namespace 'default'.</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Verification</div>
<ul>
<li>
<p>To confirm that the channel now exists, list the existing channels and inspect the output:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ kn channel list</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">kn channel list
NAME        TYPE              URL                                                     AGE   READY   REASON
mychannel   InMemoryChannel   http://mychannel-kn-channel.default.svc.cluster.local   93s   True</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Deleting a channel</div>
<ul>
<li>
<p>Delete a channel:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ kn channel delete &lt;channel_name&gt;</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="serverless-create-default-channel-yaml_serverless-creating-channels">Creating a default implementation channel by using YAML</h4>
<div class="paragraph">
<p>Creating Knative resources by using YAML files uses a declarative API, which enables you to describe channels declaratively and in a reproducible manner. To create a serverless channel by using YAML, you must create a YAML file that defines a <code>Channel</code> object, then apply it by using the <code>oc apply</code> command.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>The OpenShift Serverless Operator and Knative Eventing are installed on the cluster.</p>
</li>
<li>
<p>Install the OpenShift CLI (<code>oc</code>).</p>
</li>
<li>
<p>You have created a project or have access to a project with the appropriate roles and permissions to create applications and other workloads in OpenShift Container Platform.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create a <code>Channel</code> object as a YAML file:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: messaging.knative.dev/v1
kind: Channel
metadata:
  name: example-channel
  namespace: default</code></pre>
</div>
</div>
</li>
<li>
<p>Apply the YAML file:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc apply -f &lt;filename&gt;</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="serverless-create-kafka-channel-yaml_serverless-creating-channels">Creating a channel for Apache Kafka by using YAML</h4>
<div class="paragraph">
<p>Creating Knative resources by using YAML files uses a declarative API, which enables you to describe channels declaratively and in a reproducible manner. You can create a Knative Eventing channel that is backed by Kafka topics by creating a Kafka channel. To create a Kafka channel by using YAML, you must create a YAML file that defines a <code>KafkaChannel</code> object, then apply it by using the <code>oc apply</code> command.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>The OpenShift Serverless Operator, Knative Eventing, and the <code>KnativeKafka</code> custom resource are installed on your OpenShift Container Platform cluster.</p>
</li>
<li>
<p>Install the OpenShift CLI (<code>oc</code>).</p>
</li>
<li>
<p>You have created a project or have access to a project with the appropriate roles and permissions to create applications and other workloads in OpenShift Container Platform.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create a <code>KafkaChannel</code> object as a YAML file:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: messaging.knative.dev/v1beta1
kind: KafkaChannel
metadata:
  name: example-channel
  namespace: default
spec:
  numPartitions: 3
  replicationFactor: 1</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>Only the <code>v1beta1</code> version of the API for <code>KafkaChannel</code> objects on OpenShift Serverless is supported. Do not use the <code>v1alpha1</code> version of this API, as this version is now deprecated.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Apply the <code>KafkaChannel</code> YAML file:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc apply -f &lt;filename&gt;</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="next-steps_serverless-creating-channels">Next steps</h4>
<div class="ulist">
<ul>
<li>
<p>After you have created a channel, you can <a href="#connecting-channels-sinks">connect the channel to a sink</a> so that the sink can receive events.</p>
</li>
<li>
<p>Configure event delivery parameters that are applied in cases where an event fails to be delivered to an event sink. See <a href="#serverless-configuring-event-delivery-examples_serverless-event-delivery">Examples of configuring event delivery parameters</a>.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="connecting-channels-sinks">Connecting channels to sinks</h3>
<div class="paragraph">
<p>Events that have been sent to a channel from an event source or producer can be forwarded to one or more sinks by using <em>subscriptions</em>.
You can create subscriptions by configuring a <code>Subscription</code> object, which specifies the channel and the sink (also known as a <em>subscriber</em>) that consumes the events sent to that channel.</p>
</div>
<div class="sect3">
<h4 id="serverless-creating-subscriptions-odc_connecting-channels-sinks">Creating a subscription by using the Developer perspective</h4>
<div class="paragraph">
<p>After you have created a channel and an event sink, you can create a subscription to enable event delivery. Using the OpenShift Container Platform web console provides a streamlined and intuitive user interface to create a subscription.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>The OpenShift Serverless Operator, Knative Serving, and Knative Eventing are installed on your OpenShift Container Platform cluster.</p>
</li>
<li>
<p>You have logged in to the web console.</p>
</li>
<li>
<p>You have created an event sink, such as a Knative service, and a channel.</p>
</li>
<li>
<p>You have created a project or have access to a project with the appropriate roles and permissions to create applications and other workloads in OpenShift Container Platform.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the <strong>Developer</strong> perspective, navigate to the <strong>Topology</strong> page.</p>
</li>
<li>
<p>Create a subscription using one of the following methods:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Hover over the channel that you want to create a subscription for, and drag the arrow. The <strong>Add Subscription</strong> option is displayed.</p>
<div class="imageblock">
<div class="content">
<img src="images/create-sub-ODC.png" alt="Create a subscription for the channel">
</div>
</div>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>Select your sink in the <strong>Subscriber</strong> list.</p>
</li>
<li>
<p>Click <strong>Add</strong>.</p>
</li>
</ol>
</div>
</li>
<li>
<p>If the service is available in the <strong>Topology</strong> view under the same namespace or project as the channel, click on the channel that you want to create a subscription for, and drag the arrow directly to a service to immediately create a subscription from the channel to that service.</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Verification</div>
<ul>
<li>
<p>After the subscription has been created, you can see it represented as a line that connects the channel to the service in the <strong>Topology</strong> view:</p>
<div class="imageblock">
<div class="content">
<img src="images/verify-subscription-odc.png" alt="Subscription in the Topology view">
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="serverless-creating-subscriptions-yaml_connecting-channels-sinks">Creating a subscription by using YAML</h4>
<div class="paragraph">
<p>After you have created a channel and an event sink, you can create a subscription to enable event delivery. Creating Knative resources by using YAML files uses a declarative API, which enables you to describe subscriptions declaratively and in a reproducible manner. To create a subscription by using YAML, you must create a YAML file that defines a <code>Subscription</code> object, then apply it by using the <code>oc apply</code> command.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>The OpenShift Serverless Operator and Knative Eventing are installed on the cluster.</p>
</li>
<li>
<p>Install the OpenShift CLI (<code>oc</code>).</p>
</li>
<li>
<p>You have created a project or have access to a project with the appropriate roles and permissions to create applications and other workloads in OpenShift Container Platform.</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Create a <code>Subscription</code> object:</p>
<div class="ulist">
<ul>
<li>
<p>Create a YAML file and copy the following sample code into it:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: messaging.knative.dev/v1beta1
kind: Subscription
metadata:
  name: my-subscription <b class="conum">(1)</b>
  namespace: default
spec:
  channel: <b class="conum">(2)</b>
    apiVersion: messaging.knative.dev/v1beta1
    kind: Channel
    name: example-channel
  delivery: <b class="conum">(3)</b>
    deadLetterSink:
      ref:
        apiVersion: serving.knative.dev/v1
        kind: Service
        name: error-handler
  subscriber: <b class="conum">(4)</b>
    ref:
      apiVersion: serving.knative.dev/v1
      kind: Service
      name: event-display</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Name of the subscription.</p>
</li>
<li>
<p>Configuration settings for the channel that the subscription connects to.</p>
</li>
<li>
<p>Configuration settings for event delivery. This tells the subscription what happens to events that cannot be delivered to the subscriber. When this is configured, events that failed to be consumed are sent to the <code>deadLetterSink</code>. The event is dropped, no re-delivery of the event is attempted, and an error is logged in the system. The <code>deadLetterSink</code> value must be a <a href="https://pkg.go.dev/knative.dev/pkg/apis/duck/v1?tab=doc#Destination">Destination</a>.</p>
</li>
<li>
<p>Configuration settings for the subscriber. This is the event sink that events are delivered to from the channel.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Apply the YAML file:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc apply -f &lt;filename&gt;</code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="serverless-creating-subscriptions-kn_connecting-channels-sinks">Creating a subscription by using the Knative CLI</h4>
<div class="paragraph">
<p>After you have created a channel and an event sink, you can create a subscription to enable event delivery. Using the Knative (<code>kn</code>) CLI to create subscriptions provides a more streamlined and intuitive user interface than modifying YAML files directly. You can use the <code>kn subscription create</code> command with the appropriate flags to create a subscription.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>The OpenShift Serverless Operator and Knative Eventing are installed on your OpenShift Container Platform cluster.</p>
</li>
<li>
<p>You have installed the Knative (<code>kn</code>) CLI.</p>
</li>
<li>
<p>You have created a project or have access to a project with the appropriate roles and permissions to create applications and other workloads in OpenShift Container Platform.</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Create a subscription to connect a sink to a channel:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ kn subscription create &lt;subscription_name&gt; \
  --channel &lt;group:version:kind&gt;:&lt;channel_name&gt; \ <b class="conum">(1)</b>
  --sink &lt;sink_prefix&gt;:&lt;sink_name&gt; \ <b class="conum">(2)</b>
  --sink-dead-letter &lt;sink_prefix&gt;:&lt;sink_name&gt; <b class="conum">(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p><code>--channel</code> specifies the source for cloud events that should be processed. You must provide the channel name. If you are not using the default <code>InMemoryChannel</code> channel that is backed by the <code>Channel</code> custom resource, you must prefix the channel name with the <code>&lt;group:version:kind&gt;</code> for the specified channel type. For example, this will be <code>messaging.knative.dev:v1beta1:KafkaChannel</code> for an Apache Kafka backed channel.</p>
</li>
<li>
<p><code>--sink</code> specifies the target destination to which the event should be delivered. By default, the <code>&lt;sink_name&gt;</code> is interpreted as a Knative service of this name, in the same namespace as the subscription. You can specify the type of the sink by using one of the following prefixes:</p>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>ksvc</code></dt>
<dd>
<p>A Knative service.</p>
</dd>
<dt class="hdlist1"><code>channel</code></dt>
<dd>
<p>A channel that should be used as destination. Only default channel types can be referenced here.</p>
</dd>
<dt class="hdlist1"><code>broker</code></dt>
<dd>
<p>An Eventing broker.</p>
</dd>
</dl>
</div>
</li>
<li>
<p>Optional: <code>--sink-dead-letter</code> is an optional flag that can be used to specify a sink which events should be sent to in cases where events fail to be delivered. For more information, see the OpenShift Serverless <em>Event delivery</em> documentation.</p>
<div class="listingblock">
<div class="title">Example command</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ kn subscription create mysubscription --channel mychannel --sink ksvc:event-display</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">Subscription 'mysubscription' created in namespace 'default'.</code></pre>
</div>
</div>
</li>
</ol>
</div>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Verification</div>
<ul>
<li>
<p>To confirm that the channel is connected to the event sink, or <em>subscriber</em>, by a subscription, list the existing subscriptions and inspect the output:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ kn subscription list</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">NAME            CHANNEL             SUBSCRIBER           REPLY   DEAD LETTER SINK   READY   REASON
mysubscription   Channel:mychannel   ksvc:event-display                              True</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Deleting a subscription</div>
<ul>
<li>
<p>Delete a subscription:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ kn subscription delete &lt;subscription_name&gt;</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="serverless-creating-subscription-admin-web-console_connecting-channels-sinks">Creating a subscription by using the Administrator perspective</h4>
<div class="paragraph">
<p>After you have created a channel and an event sink, also known as a <em>subscriber</em>, you can create a subscription to enable event delivery. Subscriptions are created by configuring a <code>Subscription</code> object, which specifies the channel and the subscriber to deliver events to. You can also specify some subscriber-specific options, such as how to handle failures.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>The OpenShift Serverless Operator and Knative Eventing are installed on your OpenShift Container Platform cluster.</p>
</li>
<li>
<p>You have logged in to the web console and are in the <strong>Administrator</strong> perspective.</p>
</li>
<li>
<p>You have cluster administrator permissions on OpenShift Container Platform, or you have cluster or dedicated administrator permissions on Red Hat OpenShift Service on AWS or OpenShift Dedicated.</p>
</li>
<li>
<p>You have created a Knative channel.</p>
</li>
<li>
<p>You have created a Knative service to use as a subscriber.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the <strong>Administrator</strong> perspective of the OpenShift Container Platform web console, navigate to <strong>Serverless</strong> &#8594; <strong>Eventing</strong>.</p>
</li>
<li>
<p>In the <strong>Channel</strong> tab, select the Options menu <span class="image"><img src="images/kebab.png" alt="kebab" title="Options menu"></span> for the channel that you want to add a subscription to.</p>
</li>
<li>
<p>Click <strong>Add Subscription</strong> in the list.</p>
</li>
<li>
<p>In the <strong>Add Subscription</strong> dialogue box, select a <strong>Subscriber</strong> for the subscription. The subscriber is the Knative service that receives events from the channel.</p>
</li>
<li>
<p>Click <strong>Add</strong>.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="next-steps_connecting-channels-sinks">Next steps</h4>
<div class="ulist">
<ul>
<li>
<p>Configure event delivery parameters that are applied in cases where an event fails to be delivered to an event sink. See <a href="#serverless-configuring-event-delivery-examples_serverless-event-delivery">Examples of configuring event delivery parameters</a>.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="serverless-channel-default">Default channel implementation</h3>
<div class="paragraph">
<p>You can use the <code>default-ch-webhook</code> config map to specify the default channel implementation of Knative Eventing. You can specify the default channel implementation for the entire cluster or for one or more namespaces. Currently the <code>InMemoryChannel</code> and <code>KafkaChannel</code> channel types are supported.</p>
</div>
<div class="sect3">
<h4 id="serverless-channel-default_serverless-channel-default">Configuring the default channel implementation</h4>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You have administrator permissions on OpenShift Container Platform.</p>
</li>
<li>
<p>You have installed the OpenShift Serverless Operator and Knative Eventing on your cluster.</p>
</li>
<li>
<p>If you want to use Knative channels for Apache Kafka as the default channel implementation, you must also install the <code>KnativeKafka</code> CR on your cluster.</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Modify the <code>KnativeEventing</code> custom resource to add configuration details for the <code>default-ch-webhook</code> config map:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: operator.knative.dev/v1beta1
kind: KnativeEventing
metadata:
  name: knative-eventing
  namespace: knative-eventing
spec:
  config: <b class="conum">(1)</b>
    default-ch-webhook: <b class="conum">(2)</b>
      default-ch-config: |
        clusterDefault: <b class="conum">(3)</b>
          apiVersion: messaging.knative.dev/v1
          kind: InMemoryChannel
          spec:
            delivery:
              backoffDelay: PT0.5S
              backoffPolicy: exponential
              retry: 5
        namespaceDefaults: <b class="conum">(4)</b>
          my-namespace:
            apiVersion: messaging.knative.dev/v1beta1
            kind: KafkaChannel
            spec:
              numPartitions: 1
              replicationFactor: 1</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>In <code>spec.config</code>, you can specify the config maps that you want to add modified configurations for.</p>
</li>
<li>
<p>The <code>default-ch-webhook</code> config map can be used to specify the default channel implementation for the cluster or for one or more namespaces.</p>
</li>
<li>
<p>The cluster-wide default channel type configuration. In this example, the default channel implementation for the cluster is <code>InMemoryChannel</code>.</p>
</li>
<li>
<p>The namespace-scoped default channel type configuration. In this example, the default channel implementation for the <code>my-namespace</code> namespace is <code>KafkaChannel</code>.</p>
</li>
</ol>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>Configuring a namespace-specific default overrides any cluster-wide settings.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="serverless-kafka-admin-security-channels">Security configuration for channels</h3>
<div class="sect3">
<h4 id="serverless-kafka-tls-channels_serverless-kafka-admin-security-channels">Configuring TLS authentication for Knative channels for Apache Kafka</h4>
<div class="paragraph">
<p><em>Transport Layer Security</em> (TLS) is used by Apache Kafka clients and servers to encrypt traffic between Knative and Kafka, as well as for authentication. TLS is the only supported method of traffic encryption for the Knative broker implementation for Apache Kafka.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You have cluster or dedicated administrator permissions on OpenShift Container Platform.</p>
</li>
<li>
<p>The OpenShift Serverless Operator, Knative Eventing, and the <code>KnativeKafka</code> CR are installed on your OpenShift Container Platform cluster.</p>
</li>
<li>
<p>You have created a project or have access to a project with the appropriate roles and permissions to create applications and other workloads in OpenShift Container Platform.</p>
</li>
<li>
<p>You have a Kafka cluster CA certificate stored as a <code>.pem</code> file.</p>
</li>
<li>
<p>You have a Kafka cluster client certificate and a key stored as <code>.pem</code> files.</p>
</li>
<li>
<p>Install the OpenShift CLI (<code>oc</code>).</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create the certificate files as secrets in your chosen namespace:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc create secret -n &lt;namespace&gt; generic &lt;kafka_auth_secret&gt; \
  --from-file=ca.crt=caroot.pem \
  --from-file=user.crt=certificate.pem \
  --from-file=user.key=key.pem</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>Use the key names <code>ca.crt</code>, <code>user.crt</code>, and <code>user.key</code>. Do not change them.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Start editing the <code>KnativeKafka</code> custom resource:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc edit knativekafka</code></pre>
</div>
</div>
</li>
<li>
<p>Reference your secret and the namespace of the secret:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: operator.serverless.openshift.io/v1alpha1
kind: KnativeKafka
metadata:
  namespace: knative-eventing
  name: knative-kafka
spec:
  channel:
    authSecretName: &lt;kafka_auth_secret&gt;
    authSecretNamespace: &lt;kafka_auth_secret_namespace&gt;
    bootstrapServers: &lt;bootstrap_servers&gt;
    enabled: true
  source:
    enabled: true</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Make sure to specify the matching port in the bootstrap server.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: operator.serverless.openshift.io/v1alpha1
kind: KnativeKafka
metadata:
  namespace: knative-eventing
  name: knative-kafka
spec:
  channel:
    authSecretName: tls-user
    authSecretNamespace: kafka
    bootstrapServers: eventing-kafka-bootstrap.kafka.svc:9094
    enabled: true
  source:
    enabled: true</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="serverless-kafka-sasl-channels_serverless-kafka-admin-security-channels">Configuring SASL authentication for Knative channels for Apache Kafka</h4>
<div class="paragraph">
<p><em>Simple Authentication and Security Layer</em> (SASL) is used by Apache Kafka for authentication. If you use SASL authentication on your cluster, users must provide credentials to Knative for communicating with the Kafka cluster; otherwise events cannot be produced or consumed.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You have cluster or dedicated administrator permissions on OpenShift Container Platform.</p>
</li>
<li>
<p>The OpenShift Serverless Operator, Knative Eventing, and the <code>KnativeKafka</code> CR are installed on your OpenShift Container Platform cluster.</p>
</li>
<li>
<p>You have created a project or have access to a project with the appropriate roles and permissions to create applications and other workloads in OpenShift Container Platform.</p>
</li>
<li>
<p>You have a username and password for a Kafka cluster.</p>
</li>
<li>
<p>You have chosen the SASL mechanism to use, for example, <code>PLAIN</code>, <code>SCRAM-SHA-256</code>, or <code>SCRAM-SHA-512</code>.</p>
</li>
<li>
<p>If TLS is enabled, you also need the <code>ca.crt</code> certificate file for the Kafka cluster.</p>
</li>
<li>
<p>Install the OpenShift CLI (<code>oc</code>).</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create the certificate files as secrets in your chosen namespace:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc create secret -n &lt;namespace&gt; generic &lt;kafka_auth_secret&gt; \
  --from-file=ca.crt=caroot.pem \
  --from-literal=password="SecretPassword" \
  --from-literal=saslType="SCRAM-SHA-512" \
  --from-literal=user="my-sasl-user"</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Use the key names <code>ca.crt</code>, <code>password</code>, and <code>sasl.mechanism</code>. Do not change them.</p>
</li>
<li>
<p>If you want to use SASL with public CA certificates, you must use the <code>tls.enabled=true</code> flag, rather than the <code>ca.crt</code> argument, when creating the secret. For example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc create secret -n &lt;namespace&gt; generic &lt;kafka_auth_secret&gt; \
  --from-literal=tls.enabled=true \
  --from-literal=password="SecretPassword" \
  --from-literal=saslType="SCRAM-SHA-512" \
  --from-literal=user="my-sasl-user"</code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Start editing the <code>KnativeKafka</code> custom resource:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc edit knativekafka</code></pre>
</div>
</div>
</li>
<li>
<p>Reference your secret and the namespace of the secret:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: operator.serverless.openshift.io/v1alpha1
kind: KnativeKafka
metadata:
  namespace: knative-eventing
  name: knative-kafka
spec:
  channel:
    authSecretName: &lt;kafka_auth_secret&gt;
    authSecretNamespace: &lt;kafka_auth_secret_namespace&gt;
    bootstrapServers: &lt;bootstrap_servers&gt;
    enabled: true
  source:
    enabled: true</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Make sure to specify the matching port in the bootstrap server.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: operator.serverless.openshift.io/v1alpha1
kind: KnativeKafka
metadata:
  namespace: knative-eventing
  name: knative-kafka
spec:
  channel:
    authSecretName: scram-user
    authSecretNamespace: kafka
    bootstrapServers: eventing-kafka-bootstrap.kafka.svc:9093
    enabled: true
  source:
    enabled: true</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_subscriptions">Subscriptions</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="serverless-subs">Creating subscriptions</h3>
<div class="paragraph">
<p>After you have created a channel and an event sink, you can create a subscription to enable event delivery. Subscriptions are created by configuring a <code>Subscription</code> object, which specifies the channel and the sink (also known as a <em>subscriber</em>) to deliver events to.</p>
</div>
<div class="sect3">
<h4 id="serverless-creating-subscription-admin-web-console_serverless-subs">Creating a subscription by using the Administrator perspective</h4>
<div class="paragraph">
<p>After you have created a channel and an event sink, also known as a <em>subscriber</em>, you can create a subscription to enable event delivery. Subscriptions are created by configuring a <code>Subscription</code> object, which specifies the channel and the subscriber to deliver events to. You can also specify some subscriber-specific options, such as how to handle failures.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>The OpenShift Serverless Operator and Knative Eventing are installed on your OpenShift Container Platform cluster.</p>
</li>
<li>
<p>You have logged in to the web console and are in the <strong>Administrator</strong> perspective.</p>
</li>
<li>
<p>You have cluster administrator permissions on OpenShift Container Platform, or you have cluster or dedicated administrator permissions on Red Hat OpenShift Service on AWS or OpenShift Dedicated.</p>
</li>
<li>
<p>You have created a Knative channel.</p>
</li>
<li>
<p>You have created a Knative service to use as a subscriber.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the <strong>Administrator</strong> perspective of the OpenShift Container Platform web console, navigate to <strong>Serverless</strong> &#8594; <strong>Eventing</strong>.</p>
</li>
<li>
<p>In the <strong>Channel</strong> tab, select the Options menu <span class="image"><img src="images/kebab.png" alt="kebab" title="Options menu"></span> for the channel that you want to add a subscription to.</p>
</li>
<li>
<p>Click <strong>Add Subscription</strong> in the list.</p>
</li>
<li>
<p>In the <strong>Add Subscription</strong> dialogue box, select a <strong>Subscriber</strong> for the subscription. The subscriber is the Knative service that receives events from the channel.</p>
</li>
<li>
<p>Click <strong>Add</strong>.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="serverless-creating-subscriptions-odc_serverless-subs">Creating a subscription by using the Developer perspective</h4>
<div class="paragraph">
<p>After you have created a channel and an event sink, you can create a subscription to enable event delivery. Using the OpenShift Container Platform web console provides a streamlined and intuitive user interface to create a subscription.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>The OpenShift Serverless Operator, Knative Serving, and Knative Eventing are installed on your OpenShift Container Platform cluster.</p>
</li>
<li>
<p>You have logged in to the web console.</p>
</li>
<li>
<p>You have created an event sink, such as a Knative service, and a channel.</p>
</li>
<li>
<p>You have created a project or have access to a project with the appropriate roles and permissions to create applications and other workloads in OpenShift Container Platform.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the <strong>Developer</strong> perspective, navigate to the <strong>Topology</strong> page.</p>
</li>
<li>
<p>Create a subscription using one of the following methods:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Hover over the channel that you want to create a subscription for, and drag the arrow. The <strong>Add Subscription</strong> option is displayed.</p>
<div class="imageblock">
<div class="content">
<img src="images/create-sub-ODC.png" alt="Create a subscription for the channel">
</div>
</div>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>Select your sink in the <strong>Subscriber</strong> list.</p>
</li>
<li>
<p>Click <strong>Add</strong>.</p>
</li>
</ol>
</div>
</li>
<li>
<p>If the service is available in the <strong>Topology</strong> view under the same namespace or project as the channel, click on the channel that you want to create a subscription for, and drag the arrow directly to a service to immediately create a subscription from the channel to that service.</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Verification</div>
<ul>
<li>
<p>After the subscription has been created, you can see it represented as a line that connects the channel to the service in the <strong>Topology</strong> view:</p>
<div class="imageblock">
<div class="content">
<img src="images/verify-subscription-odc.png" alt="Subscription in the Topology view">
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="serverless-creating-subscriptions-yaml_serverless-subs">Creating a subscription by using YAML</h4>
<div class="paragraph">
<p>After you have created a channel and an event sink, you can create a subscription to enable event delivery. Creating Knative resources by using YAML files uses a declarative API, which enables you to describe subscriptions declaratively and in a reproducible manner. To create a subscription by using YAML, you must create a YAML file that defines a <code>Subscription</code> object, then apply it by using the <code>oc apply</code> command.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>The OpenShift Serverless Operator and Knative Eventing are installed on the cluster.</p>
</li>
<li>
<p>Install the OpenShift CLI (<code>oc</code>).</p>
</li>
<li>
<p>You have created a project or have access to a project with the appropriate roles and permissions to create applications and other workloads in OpenShift Container Platform.</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Create a <code>Subscription</code> object:</p>
<div class="ulist">
<ul>
<li>
<p>Create a YAML file and copy the following sample code into it:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: messaging.knative.dev/v1beta1
kind: Subscription
metadata:
  name: my-subscription <b class="conum">(1)</b>
  namespace: default
spec:
  channel: <b class="conum">(2)</b>
    apiVersion: messaging.knative.dev/v1beta1
    kind: Channel
    name: example-channel
  delivery: <b class="conum">(3)</b>
    deadLetterSink:
      ref:
        apiVersion: serving.knative.dev/v1
        kind: Service
        name: error-handler
  subscriber: <b class="conum">(4)</b>
    ref:
      apiVersion: serving.knative.dev/v1
      kind: Service
      name: event-display</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Name of the subscription.</p>
</li>
<li>
<p>Configuration settings for the channel that the subscription connects to.</p>
</li>
<li>
<p>Configuration settings for event delivery. This tells the subscription what happens to events that cannot be delivered to the subscriber. When this is configured, events that failed to be consumed are sent to the <code>deadLetterSink</code>. The event is dropped, no re-delivery of the event is attempted, and an error is logged in the system. The <code>deadLetterSink</code> value must be a <a href="https://pkg.go.dev/knative.dev/pkg/apis/duck/v1?tab=doc#Destination">Destination</a>.</p>
</li>
<li>
<p>Configuration settings for the subscriber. This is the event sink that events are delivered to from the channel.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Apply the YAML file:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc apply -f &lt;filename&gt;</code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="serverless-creating-subscriptions-kn_serverless-subs">Creating a subscription by using the Knative CLI</h4>
<div class="paragraph">
<p>After you have created a channel and an event sink, you can create a subscription to enable event delivery. Using the Knative (<code>kn</code>) CLI to create subscriptions provides a more streamlined and intuitive user interface than modifying YAML files directly. You can use the <code>kn subscription create</code> command with the appropriate flags to create a subscription.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>The OpenShift Serverless Operator and Knative Eventing are installed on your OpenShift Container Platform cluster.</p>
</li>
<li>
<p>You have installed the Knative (<code>kn</code>) CLI.</p>
</li>
<li>
<p>You have created a project or have access to a project with the appropriate roles and permissions to create applications and other workloads in OpenShift Container Platform.</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Create a subscription to connect a sink to a channel:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ kn subscription create &lt;subscription_name&gt; \
  --channel &lt;group:version:kind&gt;:&lt;channel_name&gt; \ <b class="conum">(1)</b>
  --sink &lt;sink_prefix&gt;:&lt;sink_name&gt; \ <b class="conum">(2)</b>
  --sink-dead-letter &lt;sink_prefix&gt;:&lt;sink_name&gt; <b class="conum">(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p><code>--channel</code> specifies the source for cloud events that should be processed. You must provide the channel name. If you are not using the default <code>InMemoryChannel</code> channel that is backed by the <code>Channel</code> custom resource, you must prefix the channel name with the <code>&lt;group:version:kind&gt;</code> for the specified channel type. For example, this will be <code>messaging.knative.dev:v1beta1:KafkaChannel</code> for an Apache Kafka backed channel.</p>
</li>
<li>
<p><code>--sink</code> specifies the target destination to which the event should be delivered. By default, the <code>&lt;sink_name&gt;</code> is interpreted as a Knative service of this name, in the same namespace as the subscription. You can specify the type of the sink by using one of the following prefixes:</p>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>ksvc</code></dt>
<dd>
<p>A Knative service.</p>
</dd>
<dt class="hdlist1"><code>channel</code></dt>
<dd>
<p>A channel that should be used as destination. Only default channel types can be referenced here.</p>
</dd>
<dt class="hdlist1"><code>broker</code></dt>
<dd>
<p>An Eventing broker.</p>
</dd>
</dl>
</div>
</li>
<li>
<p>Optional: <code>--sink-dead-letter</code> is an optional flag that can be used to specify a sink which events should be sent to in cases where events fail to be delivered. For more information, see the OpenShift Serverless <em>Event delivery</em> documentation.</p>
<div class="listingblock">
<div class="title">Example command</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ kn subscription create mysubscription --channel mychannel --sink ksvc:event-display</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">Subscription 'mysubscription' created in namespace 'default'.</code></pre>
</div>
</div>
</li>
</ol>
</div>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Verification</div>
<ul>
<li>
<p>To confirm that the channel is connected to the event sink, or <em>subscriber</em>, by a subscription, list the existing subscriptions and inspect the output:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ kn subscription list</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">NAME            CHANNEL             SUBSCRIBER           REPLY   DEAD LETTER SINK   READY   REASON
mysubscription   Channel:mychannel   ksvc:event-display                              True</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Deleting a subscription</div>
<ul>
<li>
<p>Delete a subscription:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ kn subscription delete &lt;subscription_name&gt;</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="next-steps_serverless-subs">Next steps</h4>
<div class="ulist">
<ul>
<li>
<p>Configure event delivery parameters that are applied in cases where an event fails to be delivered to an event sink. See <a href="#serverless-configuring-event-delivery-examples_serverless-event-delivery">Examples of configuring event delivery parameters</a>.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="serverless-subs-managing">Managing subscriptions</h3>
<div class="sect3">
<h4 id="serverless-describe-subs-kn_serverless-subs-managing">Describing subscriptions by using the Knative CLI</h4>
<div class="paragraph">
<p>You can use the <code>kn subscription describe</code> command to print information about a subscription in the terminal by using the Knative (<code>kn</code>) CLI. Using the Knative CLI to describe subscriptions provides a more streamlined and intuitive user interface than viewing YAML files directly.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You have installed the Knative (<code>kn</code>) CLI.</p>
</li>
<li>
<p>You have created a subscription in your cluster.</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Describe a subscription:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ kn subscription describe &lt;subscription_name&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">Name:            my-subscription
Namespace:       default
Annotations:     messaging.knative.dev/creator=openshift-user, messaging.knative.dev/lastModifier=min ...
Age:             43s
Channel:         Channel:my-channel (messaging.knative.dev/v1)
Subscriber:
  URI:           http://edisplay.default.example.com
Reply:
  Name:          default
  Resource:      Broker (eventing.knative.dev/v1)
DeadLetterSink:
  Name:          my-sink
  Resource:      Service (serving.knative.dev/v1)

Conditions:
  OK TYPE                  AGE REASON
  ++ Ready                 43s
  ++ AddedToChannel        43s
  ++ ChannelReady          43s
  ++ ReferencesResolved    43s</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="serverless-list-subs-kn_serverless-subs-managing">Listing subscriptions by using the Knative CLI</h4>
<div class="paragraph">
<p>You can use the <code>kn subscription list</code> command to list existing subscriptions on your cluster by using the Knative (<code>kn</code>) CLI. Using the Knative CLI to list subscriptions provides a streamlined and intuitive user interface.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You have installed the Knative (<code>kn</code>) CLI.</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>List subscriptions on your cluster:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ kn subscription list</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">NAME             CHANNEL             SUBSCRIBER           REPLY   DEAD LETTER SINK   READY   REASON
mysubscription   Channel:mychannel   ksvc:event-display                              True</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="serverless-update-subscriptions-kn_serverless-subs-managing">Updating subscriptions by using the Knative CLI</h4>
<div class="paragraph">
<p>You can use the <code>kn subscription update</code> command as well as the appropriate flags to update a subscription from the terminal by using the Knative (<code>kn</code>) CLI. Using the Knative CLI to update subscriptions provides a more streamlined and intuitive user interface than updating YAML files directly.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You have installed the Knative (<code>kn</code>) CLI.</p>
</li>
<li>
<p>You have created a subscription.</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Update a subscription:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ kn subscription update &lt;subscription_name&gt; \
  --sink &lt;sink_prefix&gt;:&lt;sink_name&gt; \ <b class="conum">(1)</b>
  --sink-dead-letter &lt;sink_prefix&gt;:&lt;sink_name&gt; <b class="conum">(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p><code>--sink</code> specifies the updated target destination to which the event should be delivered. You can specify the type of the sink by using one of the following prefixes:</p>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>ksvc</code></dt>
<dd>
<p>A Knative service.</p>
</dd>
<dt class="hdlist1"><code>channel</code></dt>
<dd>
<p>A channel that should be used as destination. Only default channel types can be referenced here.</p>
</dd>
<dt class="hdlist1"><code>broker</code></dt>
<dd>
<p>An Eventing broker.</p>
</dd>
</dl>
</div>
</li>
<li>
<p>Optional: <code>--sink-dead-letter</code> is an optional flag that can be used to specify a sink which events should be sent to in cases where events fail to be delivered. For more information, see the OpenShift Serverless <em>Event delivery</em> documentation.</p>
<div class="listingblock">
<div class="title">Example command</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ kn subscription update mysubscription --sink ksvc:event-display</code></pre>
</div>
</div>
</li>
</ol>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_event-discovery">Event discovery</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="serverless-listing-event-sources">Listing event sources and event source types</h3>
<div class="paragraph">
<p>It is possible to view a list of all event sources or event source types that exist or are available for use on your OpenShift Container Platform cluster. You can use the Knative (<code>kn</code>) CLI or the <strong>Developer</strong> perspective in the OpenShift Container Platform web console to list available event sources or event source types.</p>
</div>
</div>
<div class="sect2">
<h3 id="list-event-source-types-cli">Listing event source types from the command line</h3>
<div class="paragraph">
<p>Using the Knative (<code>kn</code>) CLI provides a streamlined and intuitive user interface to view available event source types on your cluster.</p>
</div>
<div class="sect3">
<h4 id="serverless-list-source-types-kn_list-event-source-types-cli">Listing available event source types by using the Knative CLI</h4>
<div class="paragraph">
<p>You can list event source types that can be created and used on your cluster by using the <code>kn source list-types</code> CLI command.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>The OpenShift Serverless Operator and Knative Eventing are installed on the cluster.</p>
</li>
<li>
<p>You have installed the Knative (<code>kn</code>) CLI.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>List the available event source types in the terminal:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ kn source list-types</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">TYPE              NAME                                            DESCRIPTION
ApiServerSource   apiserversources.sources.knative.dev            Watch and send Kubernetes API events to a sink
PingSource        pingsources.sources.knative.dev                 Periodically send ping events to a sink
SinkBinding       sinkbindings.sources.knative.dev                Binding for connecting a PodSpecable to a sink</code></pre>
</div>
</div>
</li>
<li>
<p>Optional: On OpenShift Container Platform, you can also list the available event source types in YAML format:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ kn source list-types -o yaml</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="list-event-source-types-odc">Listing event source types from the Developer perspective</h3>
<div class="paragraph">
<p>It is possible to view a list of all available event source types on your cluster. Using the OpenShift Container Platform web console provides a streamlined and intuitive user interface to view available event source types.</p>
</div>
<div class="sect3">
<h4 id="serverless-list-source-types-odc_list-event-source-types-odc">Viewing available event source types within the Developer perspective</h4>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You have logged in to the OpenShift Container Platform web console.</p>
</li>
<li>
<p>The OpenShift Serverless Operator and Knative Eventing are installed on your OpenShift Container Platform cluster.</p>
</li>
<li>
<p>You have created a project or have access to a project with the appropriate roles and permissions to create applications and other workloads in OpenShift Container Platform.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Access the <strong>Developer</strong> perspective.</p>
</li>
<li>
<p>Click <strong>+Add</strong>.</p>
</li>
<li>
<p>Click <strong>Event Source</strong>.</p>
</li>
<li>
<p>View the available event source types.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="list-event-sources-cli">Listing event sources from the command line</h3>
<div class="paragraph">
<p>Using the Knative (<code>kn</code>) CLI provides a streamlined and intuitive user interface to view existing event sources on your cluster.</p>
</div>
<div class="sect3">
<h4 id="serverless-list-source-cli_list-event-sources-cli">Listing available event sources by using the Knative CLI</h4>
<div class="paragraph">
<p>You can list existing event sources by using the <code>kn source list</code> command.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>The OpenShift Serverless Operator and Knative Eventing are installed on the cluster.</p>
</li>
<li>
<p>You have installed the Knative (<code>kn</code>) CLI.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>List the existing event sources in the terminal:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ kn source list</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">NAME   TYPE              RESOURCE                               SINK         READY
a1     ApiServerSource   apiserversources.sources.knative.dev   ksvc:eshow2   True
b1     SinkBinding       sinkbindings.sources.knative.dev       ksvc:eshow3   False
p1     PingSource        pingsources.sources.knative.dev        ksvc:eshow1   True</code></pre>
</div>
</div>
</li>
<li>
<p>Optional: You can list event sources of a specific type only, by using the <code>--type</code> flag:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ kn source list --type &lt;event_source_type&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example command</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ kn source list --type PingSource</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">NAME   TYPE              RESOURCE                               SINK         READY
p1     PingSource        pingsources.sources.knative.dev        ksvc:eshow1   True</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_tuning-eventing-configuration">Tuning eventing configuration</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="overriding-config-eventing">Overriding Knative Eventing system deployment configurations</h3>
<div class="paragraph">
<p>You can override the default configurations for some specific deployments by modifying the <code>deployments</code> spec in the <code>KnativeEventing</code> custom resource (CR). Currently, overriding default configuration settings is supported for the <code>eventing-controller</code>, <code>eventing-webhook</code>, and <code>imc-controller</code> fields, as well as for the <code>readiness</code> and <code>liveness</code> fields for probes.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>replicas</code> spec cannot override the number of replicas for deployments that use the Horizontal Pod Autoscaler (HPA), and does not work for the <code>eventing-webhook</code> deployment.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>You can only override probes that are defined in the deployment by default.</p>
</div>
<div class="paragraph">
<p>All Knative Serving deployments define a readiness and a liveness probe by default, with these exceptions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>net-kourier-controller</code> and <code>3scale-kourier-gateway</code> only define a readiness probe.</p>
</li>
<li>
<p><code>net-istio-controller</code> and <code>net-istio-webhook</code> define no probes.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="knative-eventing-CR-system-deployments_overriding-config-eventing">Overriding deployment configurations</h4>
<div class="paragraph">
<p>Currently, overriding default configuration settings is supported for the <code>eventing-controller</code>, <code>eventing-webhook</code>, and <code>imc-controller</code> fields, as well as for the <code>readiness</code> and <code>liveness</code> fields for probes.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>replicas</code> spec cannot override the number of replicas for deployments that use the Horizontal Pod Autoscaler (HPA), and does not work for the <code>eventing-webhook</code> deployment.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In the following example, a <code>KnativeEventing</code> CR overrides the <code>eventing-controller</code> deployment so that:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>readiness</code> probe timeout <code>eventing-controller</code> is set to be 10 seconds.</p>
</li>
<li>
<p>The deployment has specified CPU and memory resource limits.</p>
</li>
<li>
<p>The deployment has 3 replicas.</p>
</li>
<li>
<p>The <code>example-label: label</code> label is added.</p>
</li>
<li>
<p>The <code>example-annotation: annotation</code> annotation is added.</p>
</li>
<li>
<p>The <code>nodeSelector</code> field is set to select nodes with the <code>disktype: hdd</code> label.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">KnativeEventing CR example</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: operator.knative.dev/v1beta1
kind: KnativeEventing
metadata:
  name: knative-eventing
  namespace: knative-eventing
spec:
  deployments:
  - name: eventing-controller
    readinessProbes: <b class="conum">(1)</b>
      - container: controller
        timeoutSeconds: 10
    resources:
    - container: eventing-controller
      requests:
        cpu: 300m
        memory: 100Mi
      limits:
        cpu: 1000m
        memory: 250Mi
    replicas: 3
    labels:
      example-label: label
    annotations:
      example-annotation: annotation
    nodeSelector:
      disktype: hdd</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>You can use the <code>readiness</code> and <code>liveness</code> probe overrides to override all fields of a probe in a container of a deployment as specified in the Kubernetes API except for the fields related to the probe handler: <code>exec</code>, <code>grpc</code>, <code>httpGet</code>, and <code>tcpSocket</code>.</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>KnativeEventing</code> CR label and annotation settings override the deployment&#8217;s labels and annotations for both the deployment itself and the resulting pods.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.25/#probe-v1-core">Probe configuration section of the Kubernetes API documentation</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="serverless-ha">High availability</h3>
<div class="paragraph">
<p>High availability (HA) is a standard feature of Kubernetes APIs that helps to ensure that APIs stay operational if a disruption occurs. In an HA deployment, if an active controller crashes or is deleted, another controller is readily available. This controller takes over processing of the APIs that were being serviced by the controller that is now unavailable.</p>
</div>
<div class="paragraph">
<p>HA in OpenShift Serverless is available through leader election, which is enabled by default after the Knative Serving or Eventing control plane is installed. When using a leader election HA pattern, instances of controllers are already scheduled and running inside the cluster before they are required.
These controller instances compete to use a shared resource, known as the leader election lock. The instance of the controller that has access to the leader election lock resource at any given time is called the leader.</p>
</div>
<div class="paragraph">
<p>HA in OpenShift Serverless is available through leader election, which is enabled by default after the Knative Serving or Eventing control plane is installed. When using a leader election HA pattern, instances of controllers are already scheduled and running inside the cluster before they are required.
These controller instances compete to use a shared resource, known as the leader election lock. The instance of the controller that has access to the leader election lock resource at any given time is called the leader.</p>
</div>
<div class="sect3">
<h4 id="serverless-config-replicas-eventing_serverless-ha">Configuring high availability replicas for Knative Eventing</h4>
<div class="paragraph">
<p>High availability (HA) is available by default for the Knative Eventing <code>eventing-controller</code>, <code>eventing-webhook</code>, <code>imc-controller</code>, <code>imc-dispatcher</code>, and <code>mt-broker-controller</code> components, which are configured to have two replicas each by default. You can change the number of replicas for these components by modifying the <code>spec.high-availability.replicas</code> value in the <code>KnativeEventing</code> custom resource (CR).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>For Knative Eventing, the <code>mt-broker-filter</code> and <code>mt-broker-ingress</code> deployments are not scaled by HA. If multiple deployments are needed, scale these components manually.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You have cluster administrator permissions on OpenShift Container Platform, or you have cluster or dedicated administrator permissions on Red Hat OpenShift Service on AWS or OpenShift Dedicated.</p>
</li>
<li>
<p>The OpenShift Serverless Operator and Knative Eventing are installed on your cluster.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the OpenShift Container Platform web console <strong>Administrator</strong> perspective, navigate to <strong>OperatorHub</strong> &#8594; <strong>Installed Operators</strong>.</p>
</li>
<li>
<p>Select the <code>knative-eventing</code> namespace.</p>
</li>
<li>
<p>Click <strong>Knative Eventing</strong> in the list of <strong>Provided APIs</strong> for the OpenShift Serverless Operator to go to the <strong>Knative Eventing</strong> tab.</p>
</li>
<li>
<p>Click <strong>knative-eventing</strong>, then go to the <strong>YAML</strong> tab in the <strong>knative-eventing</strong> page.</p>
<div class="imageblock">
<div class="content">
<img src="images/eventing-YAML-HA.png" alt="Knative Eventing YAML">
</div>
</div>
</li>
<li>
<p>Modify the number of replicas in the <code>KnativeEventing</code> CR:</p>
<div class="listingblock">
<div class="title">Example YAML</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: operator.knative.dev/v1beta1
kind: KnativeEventing
metadata:
  name: knative-eventing
  namespace: knative-eventing
spec:
  high-availability:
    replicas: 3</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="serverless-config-replicas-kafka_serverless-ha">Configuring high availability replicas for the Knative broker implementation for Apache Kafka</h4>
<div class="paragraph">
<p>High availability (HA) is available by default for the Knative broker implementation for Apache Kafka components <code>kafka-controller</code> and <code>kafka-webhook-eventing</code>, which are configured to have two each replicas by default. You can change the number of replicas for these components by modifying the <code>spec.high-availability.replicas</code> value in the <code>KnativeKafka</code> custom resource (CR).</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You have cluster administrator permissions on OpenShift Container Platform, or you have cluster or dedicated administrator permissions on Red Hat OpenShift Service on AWS or OpenShift Dedicated.</p>
</li>
<li>
<p>The OpenShift Serverless Operator and Knative broker for Apache Kafka are installed on your cluster.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the OpenShift Container Platform web console <strong>Administrator</strong> perspective, navigate to <strong>OperatorHub</strong> &#8594; <strong>Installed Operators</strong>.</p>
</li>
<li>
<p>Select the <code>knative-eventing</code> namespace.</p>
</li>
<li>
<p>Click <strong>Knative Kafka</strong> in the list of <strong>Provided APIs</strong> for the OpenShift Serverless Operator to go to the <strong>Knative Kafka</strong> tab.</p>
</li>
<li>
<p>Click <strong>knative-kafka</strong>, then go to the <strong>YAML</strong> tab in the <strong>knative-kafka</strong> page.</p>
<div class="imageblock">
<div class="content">
<img src="images/kafka-YAML-HA.png" alt="Knative Kafka YAML">
</div>
</div>
</li>
<li>
<p>Modify the number of replicas in the <code>KnativeKafka</code> CR:</p>
<div class="listingblock">
<div class="title">Example YAML</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: operator.serverless.openshift.io/v1alpha1
kind: KnativeKafka
metadata:
  name: knative-kafka
  namespace: knative-eventing
spec:
  high-availability:
    replicas: 3</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="kube-rbac-proxy-eventing">Configuring kube-rbac-proxy for Eventing</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <code>kube-rbac-proxy</code> component provides internal authentication and authorization capabilities for Knative Eventing.</p>
</div>
<div class="sect2">
<h3 id="serverless-configuring-kube-rbac-proxy-resources-for-eventing_kube-rbac-proxy-eventing">Configuring kube-rbac-proxy resources for Eventing</h3>
<div class="paragraph">
<p>You can globally override resource allocation for the <code>kube-rbac-proxy</code> container by using the OpenShift Serverless Operator CR.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">You can also override resource allocation for a specific deployment.</pre>
</div>
</div>
<div class="paragraph">
<p>The following configuration sets Knative Eventing <code>kube-rbac-proxy</code> minimum and maximum CPU and memory allocation:</p>
</div>
<div class="listingblock">
<div class="title">KnativeEventing CR example</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: operator.knative.dev/v1beta1
kind: KnativeEventing
metadata:
  name: knative-eventing
  namespace: knative-eventing
spec:
  config:
    deployment:
      "kube-rbac-proxy-cpu-request": "10m" <b class="conum">(1)</b>
      "kube-rbac-proxy-memory-request": "20Mi" <b class="conum">(2)</b>
      "kube-rbac-proxy-cpu-limit": "100m" <b class="conum">(3)</b>
      "kube-rbac-proxy-memory-limit": "100Mi" <b class="conum">(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Sets minimum CPU allocation.</p>
</li>
<li>
<p>Sets minimum RAM allocation.</p>
</li>
<li>
<p>Sets maximum CPU allocation.</p>
</li>
<li>
<p>Sets maximum RAM allocation.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2023-06-25 13:31:34 UTC
</div>
</div>
</body>
</html>