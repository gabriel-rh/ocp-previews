<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.20">
<title>Architecture</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.square{list-style-type:square}
ul.circle ul:not([class]),ul.disc ul:not([class]),ul.square ul:not([class]){list-style:inherit}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:first-child,.sidebarblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child,.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,td.hdlist1,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<style>.toc-current{font-weight: bold;} .toc-root{font-family: "Open Sans","DejaVu Sans",sans-serif;
                       font-size: 0.9em;} #content{display: flex; flex-direction: column; flex: 1 1 auto;}
             .nav-footer{text-align: center; margin-top: auto;}
             .nav-footer > p > a {white-space: nowrap;}</style>
</head>
<body id="admission-plug-ins" class="article">
<div id="header">
<h1>Architecture</h1>
</div>
<div id="content">
<div class="sect1">
<h2 id="admission-plug-ins">Admission plugins</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="admission-plug-ins-about_admission-plug-ins">About admission plugins</h3>
<div class="paragraph">
<p>Admission plugins are used to help regulate how OpenShift Container Platform 4.13 functions. Admission plugins intercept requests to the master API to validate resource requests and ensure policies are adhered to, after the request is authenticated and authorized. For example, they are commonly used to enforce security policy, resource limitations or configuration requirements.</p>
</div>
<div class="paragraph">
<p>Admission plugins run in sequence as an admission chain. If any admission plugin in the sequence rejects a request, the whole chain is aborted and an error is returned.</p>
</div>
<div class="paragraph">
<p>OpenShift Container Platform has a default set of admission plugins enabled for each resource type. These are required for proper functioning of the cluster. Admission plugins ignore resources that they are not responsible for.</p>
</div>
<div class="paragraph">
<p>In addition to the defaults, the admission chain can be extended dynamically through webhook admission plugins that call out to custom webhook servers. There are two types of webhook admission plugins: a mutating admission plugin and a validating admission plugin. The mutating admission plugin runs first and can both modify resources and validate requests. The validating admission plugin validates requests and runs after the mutating admission plugin so that modifications triggered by the mutating admission plugin can also be validated.</p>
</div>
<div class="paragraph">
<p>Calling webhook servers through a mutating admission plugin can produce side effects on resources related to the target object. In such situations, you must take steps to validate that the end result is as expected.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph">
<p>Dynamic admission should be used cautiously because it impacts cluster control plane operations. When calling webhook servers through webhook admission plugins in OpenShift Container Platform 4.13, ensure that you have read the documentation fully and tested for side effects of mutations. Include steps to restore resources back to their original state prior to mutation, in the event that a request does not pass through the entire admission chain.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="admission-plug-ins-default_admission-plug-ins">Default admission plugins</h3>
<div class="paragraph">
<p>Default validating and admission plugins are enabled in OpenShift Container Platform 4.13. These default plugins contribute to fundamental control plane functionality, such as ingress policy, cluster resource limit override and quota policy. The following lists contain the default admission plugins:</p>
</div>
<details>
<summary class="title">Validating admission plugins</summary>
<div class="content">
<div class="ulist">
<ul>
<li>
<p><code>LimitRanger</code></p>
</li>
<li>
<p><code>ServiceAccount</code></p>
</li>
<li>
<p><code>PodNodeSelector</code></p>
</li>
<li>
<p><code>Priority</code></p>
</li>
<li>
<p><code>PodTolerationRestriction</code></p>
</li>
<li>
<p><code>OwnerReferencesPermissionEnforcement</code></p>
</li>
<li>
<p><code>PersistentVolumeClaimResize</code></p>
</li>
<li>
<p><code>RuntimeClass</code></p>
</li>
<li>
<p><code>CertificateApproval</code></p>
</li>
<li>
<p><code>CertificateSigning</code></p>
</li>
<li>
<p><code>CertificateSubjectRestriction</code></p>
</li>
<li>
<p><code>autoscaling.openshift.io/ManagementCPUsOverride</code></p>
</li>
<li>
<p><code>authorization.openshift.io/RestrictSubjectBindings</code></p>
</li>
<li>
<p><code>scheduling.openshift.io/OriginPodNodeEnvironment</code></p>
</li>
<li>
<p><code>network.openshift.io/ExternalIPRanger</code></p>
</li>
<li>
<p><code>network.openshift.io/RestrictedEndpointsAdmission</code></p>
</li>
<li>
<p><code>image.openshift.io/ImagePolicy</code></p>
</li>
<li>
<p><code>security.openshift.io/SecurityContextConstraint</code></p>
</li>
<li>
<p><code>security.openshift.io/SCCExecRestrictions</code></p>
</li>
<li>
<p><code>route.openshift.io/IngressAdmission</code></p>
</li>
<li>
<p><code>config.openshift.io/ValidateAPIServer</code></p>
</li>
<li>
<p><code>config.openshift.io/ValidateAuthentication</code></p>
</li>
<li>
<p><code>config.openshift.io/ValidateFeatureGate</code></p>
</li>
<li>
<p><code>config.openshift.io/ValidateConsole</code></p>
</li>
<li>
<p><code>operator.openshift.io/ValidateDNS</code></p>
</li>
<li>
<p><code>config.openshift.io/ValidateImage</code></p>
</li>
<li>
<p><code>config.openshift.io/ValidateOAuth</code></p>
</li>
<li>
<p><code>config.openshift.io/ValidateProject</code></p>
</li>
<li>
<p><code>config.openshift.io/DenyDeleteClusterConfiguration</code></p>
</li>
<li>
<p><code>config.openshift.io/ValidateScheduler</code></p>
</li>
<li>
<p><code>quota.openshift.io/ValidateClusterResourceQuota</code></p>
</li>
<li>
<p><code>security.openshift.io/ValidateSecurityContextConstraints</code></p>
</li>
<li>
<p><code>authorization.openshift.io/ValidateRoleBindingRestriction</code></p>
</li>
<li>
<p><code>config.openshift.io/ValidateNetwork</code></p>
</li>
<li>
<p><code>operator.openshift.io/ValidateKubeControllerManager</code></p>
</li>
<li>
<p><code>ValidatingAdmissionWebhook</code></p>
</li>
<li>
<p><code>ResourceQuota</code></p>
</li>
<li>
<p><code>quota.openshift.io/ClusterResourceQuota</code></p>
</li>
</ul>
</div>
</div>
</details>
<details>
<summary class="title">Mutating admission plugins</summary>
<div class="content">
<div class="ulist">
<ul>
<li>
<p><code>NamespaceLifecycle</code></p>
</li>
<li>
<p><code>LimitRanger</code></p>
</li>
<li>
<p><code>ServiceAccount</code></p>
</li>
<li>
<p><code>NodeRestriction</code></p>
</li>
<li>
<p><code>TaintNodesByCondition</code></p>
</li>
<li>
<p><code>PodNodeSelector</code></p>
</li>
<li>
<p><code>Priority</code></p>
</li>
<li>
<p><code>DefaultTolerationSeconds</code></p>
</li>
<li>
<p><code>PodTolerationRestriction</code></p>
</li>
<li>
<p><code>DefaultStorageClass</code></p>
</li>
<li>
<p><code>StorageObjectInUseProtection</code></p>
</li>
<li>
<p><code>RuntimeClass</code></p>
</li>
<li>
<p><code>DefaultIngressClass</code></p>
</li>
<li>
<p><code>autoscaling.openshift.io/ManagementCPUsOverride</code></p>
</li>
<li>
<p><code>scheduling.openshift.io/OriginPodNodeEnvironment</code></p>
</li>
<li>
<p><code>image.openshift.io/ImagePolicy</code></p>
</li>
<li>
<p><code>security.openshift.io/SecurityContextConstraint</code></p>
</li>
<li>
<p><code>security.openshift.io/DefaultSecurityContextConstraints</code></p>
</li>
<li>
<p><code>MutatingAdmissionWebhook</code></p>
</li>
</ul>
</div>
</div>
</details>
</div>
<div class="sect2">
<h3 id="admission-webhooks-about_admission-plug-ins">Webhook admission plugins</h3>
<div class="paragraph">
<p>In addition to OpenShift Container Platform default admission plugins, dynamic admission can be implemented through webhook admission plugins that call webhook servers, to extend the functionality of the admission chain. Webhook servers are called over HTTP at defined endpoints.</p>
</div>
<div class="paragraph">
<p>There are two types of webhook admission plugins in OpenShift Container Platform:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>During the admission process, the <em>mutating admission plugin</em> can perform tasks, such as injecting affinity labels.</p>
</li>
</ul>
</div>
<div class="ulist">
<ul>
<li>
<p>At the end of the admission process, the <em>validating admission plugin</em> can be used to make sure an object is configured properly, for example ensuring affinity labels are as expected. If the validation passes, OpenShift Container Platform schedules the object as configured.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When an API request comes in, mutating or validating admission plugins use the list of external webhooks in the configuration and call them in parallel:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If all of the webhooks approve the request, the admission chain continues.</p>
</li>
<li>
<p>If any of the webhooks deny the request, the admission request is denied and the reason for doing so is based on the first denial.</p>
</li>
<li>
<p>If more than one webhook denies the admission request, only the first denial reason is returned to the user.</p>
</li>
<li>
<p>If an error is encountered when calling a webhook, the request is either denied or the webhook is ignored depending on the error policy set. If the error policy is set to <code>Ignore</code>, the request is unconditionally accepted in the event of a failure. If the policy is set to <code>Fail</code>, failed requests are denied. Using <code>Ignore</code> can result in unpredictable behavior for all clients.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Communication between the webhook admission plugin and the webhook server must use TLS. Generate a CA certificate and use the certificate to sign the server certificate that is used by your webhook admission server. The PEM-encoded CA certificate is supplied to the webhook admission plugin using a mechanism, such as service serving certificate secrets.</p>
</div>
<div class="paragraph">
<p>The following diagram illustrates the sequential admission chain process within which multiple webhook servers are called.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/api-admission-chain.png" alt="API admission stage">
</div>
<div class="title">Figure 6. API admission chain with mutating and validating admission plugins</div>
</div>
<div class="paragraph">
<p>An example webhook admission plugin use case is where all pods must have a common set of labels. In this example, the mutating admission plugin can inject labels and the validating admission plugin can check that labels are as expected. OpenShift Container Platform would subsequently schedule pods that include required labels and reject those that do not.</p>
</div>
<div class="paragraph">
<p>Some common webhook admission plugin use cases include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Namespace reservation.</p>
</li>
<li>
<p>Limiting custom network resources managed by the SR-IOV network device plugin.</p>
</li>
<li>
<p>Defining tolerations that enable taints to qualify which pods should be scheduled on a node.</p>
</li>
<li>
<p>Pod priority class validation.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>The maximum default webhook timeout value in OpenShift Container Platform is 13 seconds, and it cannot be changed.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="admission-webhook-types_admission-plug-ins">Types of webhook admission plugins</h3>
<div class="paragraph">
<p>Cluster administrators can call out to webhook servers through the mutating admission plugin or the validating admission plugin in the API server admission chain.</p>
</div>
<div class="sect3">
<h4 id="mutating-admission-plug-in_admission-plug-ins">Mutating admission plugin</h4>
<div class="paragraph">
<p>The mutating admission plugin is invoked during the mutation phase of the admission process, which allows modification of resource content before it is persisted. One example webhook that can be called through the mutating admission plugin is the Pod Node Selector feature, which uses an annotation on a namespace to find a label selector and add it to the pod specification.</p>
</div>
<div id="mutating-admission-plug-in-config_admission-plug-ins" class="listingblock">
<div class="title">Sample mutating admission plugin configuration</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: admissionregistration.k8s.io/v1beta1
kind: MutatingWebhookConfiguration <b class="conum">(1)</b>
metadata:
  name: &lt;webhook_name&gt; <b class="conum">(2)</b>
webhooks:
- name: &lt;webhook_name&gt; <b class="conum">(3)</b>
  clientConfig: <b class="conum">(4)</b>
    service:
      namespace: default <b class="conum">(5)</b>
      name: kubernetes <b class="conum">(6)</b>
      path: &lt;webhook_url&gt; <b class="conum">(7)</b>
    caBundle: &lt;ca_signing_certificate&gt; <b class="conum">(8)</b>
  rules: <b class="conum">(9)</b>
  - operations: <b class="conum">(10)</b>
    - &lt;operation&gt;
    apiGroups:
    - ""
    apiVersions:
    - "*"
    resources:
    - &lt;resource&gt;
  failurePolicy: &lt;policy&gt; <b class="conum">(11)</b>
  sideEffects: None</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Specifies a mutating admission plugin configuration.</p>
</li>
<li>
<p>The name for the <code>MutatingWebhookConfiguration</code> object. Replace <code>&lt;webhook_name&gt;</code> with the appropriate value.</p>
</li>
<li>
<p>The name of the webhook to call. Replace <code>&lt;webhook_name&gt;</code> with the appropriate value.</p>
</li>
<li>
<p>Information about how to connect to, trust, and send data to the webhook server.</p>
</li>
<li>
<p>The namespace where the front-end service is created.</p>
</li>
<li>
<p>The name of the front-end service.</p>
</li>
<li>
<p>The webhook URL used for admission requests. Replace <code>&lt;webhook_url&gt;</code> with the appropriate value.</p>
</li>
<li>
<p>A PEM-encoded CA certificate that signs the server certificate that is used by the webhook server.  Replace <code>&lt;ca_signing_certificate&gt;</code> with the appropriate certificate in base64 format.</p>
</li>
<li>
<p>Rules that define when the API server should use this webhook admission plugin.</p>
</li>
<li>
<p>One or more operations that trigger the API server to call this webhook admission plugin. Possible values are <code>create</code>, <code>update</code>, <code>delete</code> or <code>connect</code>. Replace <code>&lt;operation&gt;</code> and <code>&lt;resource&gt;</code> with the appropriate values.</p>
</li>
<li>
<p>Specifies how the policy should proceed if the webhook server is unavailable.
Replace <code>&lt;policy&gt;</code> with either <code>Ignore</code> (to unconditionally accept the request in the event of a failure) or <code>Fail</code> (to deny the failed request). Using <code>Ignore</code> can result in unpredictable behavior for all clients.</p>
</li>
</ol>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>In OpenShift Container Platform 4.13, objects created by users or control loops through a mutating admission plugin might return unexpected results, especially if values set in an initial request are overwritten, which is not recommended.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="validating-admission-plug-in_admission-plug-ins">Validating admission plugin</h4>
<div class="paragraph">
<p>A validating admission plugin is invoked during the validation phase of the admission process. This phase allows the enforcement of invariants on particular API resources to ensure that the resource does not change again. The Pod Node Selector is also an example of a webhook which is called by the validating admission plugin, to ensure that all <code>nodeSelector</code> fields are constrained by the node selector restrictions on the namespace.</p>
</div>
<div id="validating-admission-plug-in-config_admission-plug-ins" class="listingblock">
<div class="title">Sample validating admission plugin configuration</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: admissionregistration.k8s.io/v1beta1
kind: ValidatingWebhookConfiguration <b class="conum">(1)</b>
metadata:
  name: &lt;webhook_name&gt; <b class="conum">(2)</b>
webhooks:
- name: &lt;webhook_name&gt; <b class="conum">(3)</b>
  clientConfig: <b class="conum">(4)</b>
    service:
      namespace: default  <b class="conum">(5)</b>
      name: kubernetes <b class="conum">(6)</b>
      path: &lt;webhook_url&gt; <b class="conum">(7)</b>
    caBundle: &lt;ca_signing_certificate&gt; <b class="conum">(8)</b>
  rules: <b class="conum">(9)</b>
  - operations: <b class="conum">(10)</b>
    - &lt;operation&gt;
    apiGroups:
    - ""
    apiVersions:
    - "*"
    resources:
    - &lt;resource&gt;
  failurePolicy: &lt;policy&gt; <b class="conum">(11)</b>
  sideEffects: Unknown</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Specifies a validating admission plugin configuration.</p>
</li>
<li>
<p>The name for the <code>ValidatingWebhookConfiguration</code> object. Replace <code>&lt;webhook_name&gt;</code> with the appropriate value.</p>
</li>
<li>
<p>The name of the webhook to call. Replace <code>&lt;webhook_name&gt;</code> with the appropriate value.</p>
</li>
<li>
<p>Information about how to connect to, trust, and send data to the webhook server.</p>
</li>
<li>
<p>The namespace where the front-end service is created.</p>
</li>
<li>
<p>The name of the front-end service.</p>
</li>
<li>
<p>The webhook URL used for admission requests. Replace <code>&lt;webhook_url&gt;</code> with the appropriate value.</p>
</li>
<li>
<p>A PEM-encoded CA certificate that signs the server certificate that is used by the webhook server.  Replace <code>&lt;ca_signing_certificate&gt;</code> with the appropriate certificate in base64 format.</p>
</li>
<li>
<p>Rules that define when the API server should use this webhook admission plugin.</p>
</li>
<li>
<p>One or more operations that trigger the API server to call this webhook admission plugin. Possible values are <code>create</code>, <code>update</code>, <code>delete</code> or <code>connect</code>. Replace <code>&lt;operation&gt;</code> and <code>&lt;resource&gt;</code> with the appropriate values.</p>
</li>
<li>
<p>Specifies how the policy should proceed if the webhook server is unavailable.
Replace <code>&lt;policy&gt;</code> with either <code>Ignore</code> (to unconditionally accept the request in the event of a failure) or <code>Fail</code> (to deny the failed request). Using <code>Ignore</code> can result in unpredictable behavior for all clients.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configuring-dynamic-admission_admission-plug-ins">Configuring dynamic admission</h3>
<div class="paragraph">
<p>This procedure outlines high-level steps to configure dynamic admission. The functionality of the admission chain is extended by configuring a webhook admission plugin to call out to a webhook server.</p>
</div>
<div class="paragraph">
<p>The webhook server is also configured as an aggregated API server. This allows other OpenShift Container Platform components to communicate with the webhook using internal credentials and facilitates testing using the <code>oc</code> command. Additionally, this enables role based access control (RBAC) into the webhook and prevents token information from other API servers from being disclosed to the webhook.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>An OpenShift Container Platform account with cluster administrator access.</p>
</li>
<li>
<p>The OpenShift Container Platform CLI (<code>oc</code>) installed.</p>
</li>
<li>
<p>A published webhook server container image.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Build a webhook server container image and make it available to the cluster using an image registry.</p>
</li>
<li>
<p>Create a local CA key and certificate and use them to sign the webhook server&#8217;s certificate signing request (CSR).</p>
</li>
<li>
<p>Create a new project for webhook resources:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc new-project my-webhook-namespace  <b class="conum">(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Note that the webhook server might expect a specific name.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Define RBAC rules for the aggregated API service in a file called <code>rbac.yaml</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: v1
kind: List
items:

- apiVersion: rbac.authorization.k8s.io/v1  <b class="conum">(1)</b>
  kind: ClusterRoleBinding
  metadata:
    name: auth-delegator-my-webhook-namespace
  roleRef:
    kind: ClusterRole
    apiGroup: rbac.authorization.k8s.io
    name: system:auth-delegator
  subjects:
  - kind: ServiceAccount
    namespace: my-webhook-namespace
    name: server

- apiVersion: rbac.authorization.k8s.io/v1  <b class="conum">(2)</b>
  kind: ClusterRole
  metadata:
    annotations:
    name: system:openshift:online:my-webhook-server
  rules:
  - apiGroups:
    - online.openshift.io
    resources:
    - namespacereservations  <b class="conum">(3)</b>
    verbs:
    - get
    - list
    - watch

- apiVersion: rbac.authorization.k8s.io/v1  <b class="conum">(4)</b>
  kind: ClusterRole
  metadata:
    name: system:openshift:online:my-webhook-requester
  rules:
  - apiGroups:
    - admission.online.openshift.io
    resources:
    - namespacereservations <b class="conum">(5)</b>
    verbs:
    - create

- apiVersion: rbac.authorization.k8s.io/v1  <b class="conum">(6)</b>
  kind: ClusterRoleBinding
  metadata:
    name: my-webhook-server-my-webhook-namespace
  roleRef:
    kind: ClusterRole
    apiGroup: rbac.authorization.k8s.io
    name: system:openshift:online:my-webhook-server
  subjects:
  - kind: ServiceAccount
    namespace: my-webhook-namespace
    name: server

- apiVersion: rbac.authorization.k8s.io/v1  <b class="conum">(7)</b>
  kind: RoleBinding
  metadata:
    namespace: kube-system
    name: extension-server-authentication-reader-my-webhook-namespace
  roleRef:
    kind: Role
    apiGroup: rbac.authorization.k8s.io
    name: extension-apiserver-authentication-reader
  subjects:
  - kind: ServiceAccount
    namespace: my-webhook-namespace
    name: server

- apiVersion: rbac.authorization.k8s.io/v1  <b class="conum">(8)</b>
  kind: ClusterRole
  metadata:
    name: my-cluster-role
  rules:
  - apiGroups:
    - admissionregistration.k8s.io
    resources:
    - validatingwebhookconfigurations
    - mutatingwebhookconfigurations
    verbs:
    - get
    - list
    - watch
  - apiGroups:
    - ""
    resources:
    - namespaces
    verbs:
    - get
    - list
    - watch

- apiVersion: rbac.authorization.k8s.io/v1
  kind: ClusterRoleBinding
  metadata:
    name: my-cluster-role
  roleRef:
    kind: ClusterRole
    apiGroup: rbac.authorization.k8s.io
    name: my-cluster-role
  subjects:
  - kind: ServiceAccount
    namespace: my-webhook-namespace
    name: server</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Delegates authentication and authorization to the webhook server API.</p>
</li>
<li>
<p>Allows the webhook server to access cluster resources.</p>
</li>
<li>
<p>Points to resources. This example points to the <code>namespacereservations</code> resource.</p>
</li>
<li>
<p>Enables the aggregated API server to create admission reviews.</p>
</li>
<li>
<p>Points to resources. This example points to the <code>namespacereservations</code> resource.</p>
</li>
<li>
<p>Enables the webhook server to access cluster resources.</p>
</li>
<li>
<p>Role binding to read the configuration for terminating authentication.</p>
</li>
<li>
<p>Default cluster role and cluster role bindings for an aggregated API server.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Apply those RBAC rules to the cluster:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc auth reconcile -f rbac.yaml</code></pre>
</div>
</div>
</li>
<li>
<p>Create a YAML file called <code>webhook-daemonset.yaml</code> that is used to deploy a webhook as a daemon set server in a namespace:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: apps/v1
kind: DaemonSet
metadata:
  namespace: my-webhook-namespace
  name: server
  labels:
    server: "true"
spec:
  selector:
    matchLabels:
      server: "true"
  template:
    metadata:
      name: server
      labels:
        server: "true"
    spec:
      serviceAccountName: server
      containers:
      - name: my-webhook-container  <b class="conum">(1)</b>
        image: &lt;image_registry_username&gt;/&lt;image_path&gt;:&lt;tag&gt;  <b class="conum">(2)</b>
        imagePullPolicy: IfNotPresent
        command:
        - &lt;container_commands&gt;  <b class="conum">(3)</b>
        ports:
        - containerPort: 8443 <b class="conum">(4)</b>
        volumeMounts:
        - mountPath: /var/serving-cert
          name: serving-cert
        readinessProbe:
          httpGet:
            path: /healthz
            port: 8443 <b class="conum">(5)</b>
            scheme: HTTPS
      volumes:
      - name: serving-cert
        secret:
          defaultMode: 420
          secretName: server-serving-cert</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Note that the webhook server might expect a specific container name.</p>
</li>
<li>
<p>Points to a webhook server container image. Replace <code>&lt;image_registry_username&gt;/&lt;image_path&gt;:&lt;tag&gt;</code> with the appropriate value.</p>
</li>
<li>
<p>Specifies webhook container run commands. Replace <code>&lt;container_commands&gt;</code> with the appropriate value.</p>
</li>
<li>
<p>Defines the target port within pods. This example uses port 8443.</p>
</li>
<li>
<p>Specifies the port used by the readiness probe. This example uses port 8443.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Deploy the daemon set:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc apply -f webhook-daemonset.yaml</code></pre>
</div>
</div>
</li>
<li>
<p>Define a secret for the service serving certificate signer, within a YAML file called <code>webhook-secret.yaml</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: v1
kind: Secret
metadata:
  namespace: my-webhook-namespace
  name: server-serving-cert
type: kubernetes.io/tls
data:
  tls.crt: &lt;server_certificate&gt;  <b class="conum">(1)</b>
  tls.key: &lt;server_key&gt;  <b class="conum">(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>References the signed webhook server certificate. Replace <code>&lt;server_certificate&gt;</code> with the appropriate certificate in base64 format.</p>
</li>
<li>
<p>References the signed webhook server key. Replace <code>&lt;server_key&gt;</code> with the appropriate key in base64 format.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Create the secret:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc apply -f webhook-secret.yaml</code></pre>
</div>
</div>
</li>
<li>
<p>Define a service account and service, within a YAML file called <code>webhook-service.yaml</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: v1
kind: List
items:

- apiVersion: v1
  kind: ServiceAccount
  metadata:
    namespace: my-webhook-namespace
    name: server

- apiVersion: v1
  kind: Service
  metadata:
    namespace: my-webhook-namespace
    name: server
    annotations:
      service.beta.openshift.io/serving-cert-secret-name: server-serving-cert
  spec:
    selector:
      server: "true"
    ports:
    - port: 443  <b class="conum">(1)</b>
      targetPort: 8443  <b class="conum">(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Defines the port that the service listens on. This example uses port 443.</p>
</li>
<li>
<p>Defines the target port within pods that the service forwards connections to. This example uses port 8443.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Expose the webhook server within the cluster:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc apply -f webhook-service.yaml</code></pre>
</div>
</div>
</li>
<li>
<p>Define a custom resource definition for the webhook server, in a file called <code>webhook-crd.yaml</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: apiextensions.k8s.io/v1beta1
kind: CustomResourceDefinition
metadata:
  name: namespacereservations.online.openshift.io  <b class="conum">(1)</b>
spec:
  group: online.openshift.io  <b class="conum">(2)</b>
  version: v1alpha1  <b class="conum">(3)</b>
  scope: Cluster  <b class="conum">(4)</b>
  names:
    plural: namespacereservations  <b class="conum">(5)</b>
    singular: namespacereservation  <b class="conum">(6)</b>
    kind: NamespaceReservation  <b class="conum">(7)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Reflects <code>CustomResourceDefinition</code> <code>spec</code> values and is in the format <code>&lt;plural&gt;.&lt;group&gt;</code>. This example uses the <code>namespacereservations</code> resource.</p>
</li>
<li>
<p>REST API group name.</p>
</li>
<li>
<p>REST API version name.</p>
</li>
<li>
<p>Accepted values are <code>Namespaced</code> or <code>Cluster</code>.</p>
</li>
<li>
<p>Plural name to be included in URL.</p>
</li>
<li>
<p>Alias seen in <code>oc</code> output.</p>
</li>
<li>
<p>The reference for resource manifests.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Apply the custom resource definition:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc apply -f webhook-crd.yaml</code></pre>
</div>
</div>
</li>
<li>
<p>Configure the webhook server also as an aggregated API server, within a file called <code>webhook-api-service.yaml</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: apiregistration.k8s.io/v1beta1
kind: APIService
metadata:
  name: v1beta1.admission.online.openshift.io
spec:
  caBundle: &lt;ca_signing_certificate&gt;  <b class="conum">(1)</b>
  group: admission.online.openshift.io
  groupPriorityMinimum: 1000
  versionPriority: 15
  service:
    name: server
    namespace: my-webhook-namespace
  version: v1beta1</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>A PEM-encoded CA certificate that signs the server certificate that is used by the webhook server. Replace <code>&lt;ca_signing_certificate&gt;</code> with the appropriate certificate in base64 format.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Deploy the aggregated API service:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc apply -f webhook-api-service.yaml</code></pre>
</div>
</div>
</li>
<li>
<p>Define the webhook admission plugin configuration within a file called <code>webhook-config.yaml</code>. This example uses the validating admission plugin:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: admissionregistration.k8s.io/v1beta1
kind: ValidatingWebhookConfiguration
metadata:
  name: namespacereservations.admission.online.openshift.io  <b class="conum">(1)</b>
webhooks:
- name: namespacereservations.admission.online.openshift.io  <b class="conum">(2)</b>
  clientConfig:
    service:  <b class="conum">(3)</b>
      namespace: default
      name: kubernetes
      path: /apis/admission.online.openshift.io/v1beta1/namespacereservations  <b class="conum">(4)</b>
    caBundle: &lt;ca_signing_certificate&gt;  <b class="conum">(5)</b>
  rules:
  - operations:
    - CREATE
    apiGroups:
    - project.openshift.io
    apiVersions:
    - "*"
    resources:
    - projectrequests
  - operations:
    - CREATE
    apiGroups:
    - ""
    apiVersions:
    - "*"
    resources:
    - namespaces
  failurePolicy: Fail</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Name for the <code>ValidatingWebhookConfiguration</code> object. This example uses the <code>namespacereservations</code> resource.</p>
</li>
<li>
<p>Name of the webhook to call. This example uses the <code>namespacereservations</code> resource.</p>
</li>
<li>
<p>Enables access to the webhook server through the aggregated API.</p>
</li>
<li>
<p>The webhook URL used for admission requests. This example uses the <code>namespacereservation</code> resource.</p>
</li>
<li>
<p>A PEM-encoded CA certificate that signs the server certificate that is used by the webhook server. Replace <code>&lt;ca_signing_certificate&gt;</code> with the appropriate certificate in base64 format.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Deploy the webhook:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc apply -f webhook-config.yaml</code></pre>
</div>
</div>
</li>
<li>
<p>Verify that the webhook is functioning as expected. For example, if you have configured dynamic admission to reserve specific namespaces, confirm that requests to create those namespaces are rejected and that requests to create non-reserved namespaces succeed.</p>
</li>
</ol>
</div>
</div>
<div class="sect2 _additional-resources">
<h3 id="admission-plug-ins-additional-resources">Additional resources</h3>
<div class="ulist">
<ul>
<li>
<p><a href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.13/html-single/networking/#configuring-sriov-operator">Limiting custom network resources managed by the SR-IOV network device plugin</a></p>
</li>
<li>
<p><a href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.13/html-single/nodes/#nodes-scheduler-taints-tolerations_dedicating_nodes-scheduler-taints-tolerations">Defining tolerations that enable taints to qualify which pods should be scheduled on a node</a></p>
</li>
<li>
<p><a href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.13/html-single/nodes/#admin-guide-priority-preemption-names_nodes-pods-priority">Pod priority class validation</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="paragraph nav-footer">
<p>← Previous: <a href="architecture-rhcos.html">Red Hat Enterprise Linux CoreOS (RHCOS)</a> | ↑ Up: <a href="master.html">Architecture</a></p>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2023-07-17 11:00:01 +0100
</div>
</div>
</body>
</html>