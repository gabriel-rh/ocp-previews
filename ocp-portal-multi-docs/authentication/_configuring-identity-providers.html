<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.20">
<title>Authentication and authorization</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.square{list-style-type:square}
ul.circle ul:not([class]),ul.disc ul:not([class]),ul.square ul:not([class]){list-style:inherit}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:first-child,.sidebarblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child,.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,td.hdlist1,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<style>.toc-current{font-weight: bold;} .toc-root{font-family: "Open Sans","DejaVu Sans",sans-serif;
                       font-size: 0.9em;} #content{display: flex; flex-direction: column; flex: 1 1 auto;}
             .nav-footer{text-align: center; margin-top: auto;}
             .nav-footer > p > a {white-space: nowrap;}</style>
</head>
<body id="_configuring-identity-providers" class="article">
<div id="header">
<h1>Authentication and authorization</h1>
</div>
<div id="content">
<div class="sect1">
<h2 id="_configuring-identity-providers">Configuring identity providers</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="configuring-htpasswd-identity-provider">Configuring an htpasswd identity provider</h3>
<div class="paragraph">
<p>Configure the <code>htpasswd</code> identity provider to allow users to log in to OpenShift Container Platform with credentials from an htpasswd file.</p>
</div>
<div class="paragraph">
<p>To define an htpasswd identity provider, perform the following tasks:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="_configuring-identity-providers.html#creating-htpasswd-file">Create an <code>htpasswd</code> file</a> to store the user and password information.</p>
</li>
<li>
<p><a href="../../authentication/identity_providers/configuring-htpasswd-identity-provider.html#identity-provider-creating-htpasswd-secret_configuring-htpasswd-identity-provider">Create
a secret</a> to represent the <code>htpasswd</code> file.</p>
</li>
<li>
<p><a href="../../authentication/identity_providers/configuring-htpasswd-identity-provider.html#identity-provider-htpasswd-CR_configuring-htpasswd-identity-provider">Define an htpasswd identity provider resource</a> that references the secret.</p>
</li>
<li>
<p><a href="../../authentication/identity_providers/configuring-htpasswd-identity-provider.html#add-identity-provider_configuring-htpasswd-identity-provider">Apply the resource</a> to
the default OAuth configuration to add the identity provider.</p>
</li>
</ol>
</div>
<div class="sect3">
<h4 id="identity-provider-overview_configuring-htpasswd-identity-provider">About identity providers in OpenShift Container Platform</h4>
<div class="paragraph">
<p>By default, only a <code>kubeadmin</code> user exists on your cluster. To specify an
identity provider, you must create a custom resource (CR) that describes
that identity provider and add it to the cluster.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>OpenShift Container Platform user names containing <code>/</code>, <code>:</code>, and <code>%</code> are not supported.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="identity-provider-htpasswd-about_configuring-htpasswd-identity-provider">About htpasswd authentication</h4>
<div class="paragraph">
<p>Using htpasswd authentication in OpenShift Container Platform allows you to identify users based on an htpasswd file. An htpasswd file is a flat file that contains the user name and hashed password for each user. You can use the <code>htpasswd</code> utility to create this file.</p>
</div>
</div>
<div class="sect3">
<h4 id="creating-htpasswd-file">Creating the htpasswd file</h4>
<div class="paragraph">
<p>See one of the following sections for instructions about how to create the htpasswd file:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="_configuring-identity-providers.html#identity-provider-creating-htpasswd-file-linux_configuring-htpasswd-identity-provider">Creating an htpasswd file using Linux</a></p>
</li>
<li>
<p><a href="_configuring-identity-providers.html#identity-provider-creating-htpasswd-file-windows_configuring-htpasswd-identity-provider">Creating an htpasswd file using Windows</a></p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="identity-provider-creating-htpasswd-file-linux_configuring-htpasswd-identity-provider">Creating an htpasswd file using Linux</h5>
<div class="paragraph">
<p>To use the htpasswd identity provider, you must generate a flat file that
contains the user names and passwords for your cluster by using
<a href="http://httpd.apache.org/docs/2.4/programs/htpasswd.html"><code>htpasswd</code></a>.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Have access to the <code>htpasswd</code> utility. On Red Hat Enterprise Linux
this is available by installing the <code>httpd-tools</code> package.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create or update your flat file with a user name and hashed password:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ htpasswd -c -B -b &lt;/path/to/users.htpasswd&gt; &lt;user_name&gt; &lt;password&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The command generates a hashed version of the password.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ htpasswd -c -B -b users.htpasswd user1 MyPassword!</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">Adding password for user user1</code></pre>
</div>
</div>
</li>
<li>
<p>Continue to add or update credentials to the file:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ htpasswd -B -b &lt;/path/to/users.htpasswd&gt; &lt;user_name&gt; &lt;password&gt;</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="identity-provider-creating-htpasswd-file-windows_configuring-htpasswd-identity-provider">Creating an htpasswd file using Windows</h5>
<div class="paragraph">
<p>To use the htpasswd identity provider, you must generate a flat file that
contains the user names and passwords for your cluster by using
<a href="http://httpd.apache.org/docs/2.4/programs/htpasswd.html"><code>htpasswd</code></a>.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Have access to <code>htpasswd.exe</code>. This file is included in the <code>\bin</code>
directory of many Apache httpd distributions.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create or update your flat file with a user name and hashed password:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">&gt; htpasswd.exe -c -B -b &lt;\path\to\users.htpasswd&gt; &lt;user_name&gt; &lt;password&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The command generates a hashed version of the password.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">&gt; htpasswd.exe -c -B -b users.htpasswd user1 MyPassword!</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">Adding password for user user1</code></pre>
</div>
</div>
</li>
<li>
<p>Continue to add or update credentials to the file:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">&gt; htpasswd.exe -b &lt;\path\to\users.htpasswd&gt; &lt;user_name&gt; &lt;password&gt;</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="identity-provider-creating-htpasswd-secret_configuring-htpasswd-identity-provider">Creating the htpasswd secret</h4>
<div class="paragraph">
<p>To use the htpasswd identity provider, you must define a secret that
contains the htpasswd user file.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Create an htpasswd file.</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Create a <code>Secret</code> object that contains the htpasswd users file:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc create secret generic htpass-secret --from-file=htpasswd=&lt;path_to_users.htpasswd&gt; -n openshift-config <b class="conum">(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The secret key containing the users file for the <code>--from-file</code> argument must be named <code>htpasswd</code>, as shown in the above command.</p>
</li>
</ol>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph">
<p>You can alternatively apply the following YAML to create the secret:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: v1
kind: Secret
metadata:
  name: htpass-secret
  namespace: openshift-config
type: Opaque
data:
  htpasswd: &lt;base64_encoded_htpasswd_file_contents&gt;</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="identity-provider-htpasswd-CR_configuring-htpasswd-identity-provider">Sample htpasswd CR</h4>
<div class="paragraph">
<p>The following custom resource (CR) shows the parameters and acceptable values for an
htpasswd identity provider.</p>
</div>
<div class="listingblock">
<div class="title">htpasswd CR</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: config.openshift.io/v1
kind: OAuth
metadata:
  name: cluster
spec:
  identityProviders:
  - name: my_htpasswd_provider <b class="conum">(1)</b>
    mappingMethod: claim <b class="conum">(2)</b>
    type: HTPasswd
    htpasswd:
      fileData:
        name: htpass-secret <b class="conum">(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>This provider name is prefixed to provider user names to form an identity
name.</p>
</li>
<li>
<p>Controls how mappings are established between this provider&#8217;s identities and <code>User</code> objects.</p>
</li>
<li>
<p>An existing secret containing a file generated using
<a href="http://httpd.apache.org/docs/2.4/programs/htpasswd.html"><code>htpasswd</code></a>.</p>
</li>
</ol>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p>See <a href="understanding-identity-provider.html#identity-provider-parameters_understanding-identity-provider">Identity provider parameters</a> for information on parameters, such as <code>mappingMethod</code>, that are common to all identity providers.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="add-identity-provider_configuring-htpasswd-identity-provider">Adding an identity provider to your cluster</h4>
<div class="paragraph">
<p>After you install your cluster, add an identity provider to it so your
users can authenticate.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Create an OpenShift Container Platform cluster.</p>
</li>
<li>
<p>Create the custom resource (CR) for your identity providers.</p>
</li>
<li>
<p>You must be logged in as an administrator.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Apply the defined CR:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc apply -f &lt;/path/to/CR&gt;</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>If a CR does not exist, <code>oc apply</code> creates a new CR and might trigger the following warning: <code>Warning: oc apply should be used on resources created by either oc create --save-config or oc apply</code>. In this case you can safely ignore this warning.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Log in to the cluster as a user from your identity provider, entering the
password when prompted.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc login -u &lt;username&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>Confirm that the user logged in successfully, and display the user name.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc whoami</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="identity-provider-htpasswd-update-users_configuring-htpasswd-identity-provider">Updating users for an htpasswd identity provider</h4>
<div class="paragraph">
<p>You can add or remove users from an existing htpasswd identity provider.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You have created a <code>Secret</code> object that contains the htpasswd user file. This procedure assumes that it is named <code>htpass-secret</code>.</p>
</li>
<li>
<p>You have configured an htpasswd identity provider. This procedure assumes that it is named <code>my_htpasswd_provider</code>.</p>
</li>
<li>
<p>You have access to the <code>htpasswd</code> utility. On Red Hat Enterprise Linux this is available by installing the <code>httpd-tools</code> package.</p>
</li>
<li>
<p>You have cluster administrator privileges.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Retrieve the htpasswd file from the <code>htpass-secret</code> <code>Secret</code> object and save the file to your file system:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc get secret htpass-secret -ojsonpath={.data.htpasswd} -n openshift-config | base64 --decode &gt; users.htpasswd</code></pre>
</div>
</div>
</li>
<li>
<p>Add or remove users from the <code>users.htpasswd</code> file.</p>
<div class="ulist">
<ul>
<li>
<p>To add a new user:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ htpasswd -bB users.htpasswd &lt;username&gt; &lt;password&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">Adding password for user &lt;username&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>To remove an existing user:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ htpasswd -D users.htpasswd &lt;username&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">Deleting password for user &lt;username&gt;</code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Replace the <code>htpass-secret</code> <code>Secret</code> object with the updated users in the <code>users.htpasswd</code> file:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc create secret generic htpass-secret --from-file=htpasswd=users.htpasswd --dry-run=client -o yaml -n openshift-config | oc replace -f -</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph">
<p>You can alternatively apply the following YAML to replace the secret:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: v1
kind: Secret
metadata:
  name: htpass-secret
  namespace: openshift-config
type: Opaque
data:
  htpasswd: &lt;base64_encoded_htpasswd_file_contents&gt;</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>If you removed one or more users, you must additionally remove existing resources for each user.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Delete the <code>User</code> object:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc delete user &lt;username&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">user.user.openshift.io "&lt;username&gt;" deleted</code></pre>
</div>
</div>
<div class="paragraph">
<p>Be sure to remove the user, otherwise the user can continue using their token as long as it has not expired.</p>
</div>
</li>
<li>
<p>Delete the <code>Identity</code> object for the user:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc delete identity my_htpasswd_provider:&lt;username&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">identity.user.openshift.io "my_htpasswd_provider:&lt;username&gt;" deleted</code></pre>
</div>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="identity-provider-configuring-using-the-web-console_configuring-htpasswd-identity-provider">Configuring identity providers using the web console</h4>
<div class="paragraph">
<p>Configure your identity provider (IDP) through the web console instead of the CLI.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You must be logged in to the web console as a cluster administrator.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Navigate to <strong>Administration</strong> &#8594; <strong>Cluster Settings</strong>.</p>
</li>
<li>
<p>Under the <strong>Configuration</strong> tab, click <strong>OAuth</strong>.</p>
</li>
<li>
<p>Under the <strong>Identity Providers</strong> section, select your identity provider from the
<strong>Add</strong> drop-down menu.</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>You can specify multiple IDPs through the web console without overwriting
existing IDPs.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configuring-keystone-identity-provider">Configuring a Keystone identity provider</h3>
<div class="paragraph">
<p>Configure the <code>keystone</code> identity provider to integrate your OpenShift Container Platform cluster with Keystone to enable shared authentication with an OpenStack Keystone v3 server configured to store users in an internal database. This configuration allows users to log in to OpenShift Container Platform with their Keystone credentials.</p>
</div>
<div class="sect3">
<h4 id="identity-provider-overview_configuring-keystone-identity-provider">About identity providers in OpenShift Container Platform</h4>
<div class="paragraph">
<p>By default, only a <code>kubeadmin</code> user exists on your cluster. To specify an
identity provider, you must create a custom resource (CR) that describes
that identity provider and add it to the cluster.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>OpenShift Container Platform user names containing <code>/</code>, <code>:</code>, and <code>%</code> are not supported.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="identity-provider-keystone-about_configuring-keystone-identity-provider">About Keystone authentication</h4>
<div class="paragraph">
<p><a href="http://docs.openstack.org/developer/keystone/">Keystone</a> is an OpenStack project that provides identity, token, catalog, and policy services.</p>
</div>
<div class="paragraph">
<p>You can configure the integration with Keystone so that the new OpenShift Container Platform users are based on either the Keystone user names or unique Keystone IDs. With both methods, users log in by entering their Keystone user name and password. Basing the OpenShift Container Platform users on the Keystone ID is more secure because if you delete a Keystone user and create a new Keystone user with that user name, the new user might have access to the old user&#8217;s resources.</p>
</div>
</div>
<div class="sect3">
<h4 id="identity-provider-creating-secret-tls_configuring-keystone-identity-provider">Creating the secret</h4>
<div class="paragraph">
<p>Identity providers use OpenShift Container Platform <code>Secret</code> objects in the <code>openshift-config</code> namespace to contain the client secret, client certificates, and keys.</p>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Create a <code>Secret</code> object that contains the key and certificate by using the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc create secret tls &lt;secret_name&gt; --key=key.pem --cert=cert.pem -n openshift-config</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph">
<p>You can alternatively apply the following YAML to create the secret:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: v1
kind: Secret
metadata:
  name: &lt;secret_name&gt;
  namespace: openshift-config
type: kubernetes.io/tls
data:
  tls.crt: &lt;base64_encoded_cert&gt;
  tls.key: &lt;base64_encoded_key&gt;</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="identity-provider-creating-configmap_configuring-keystone-identity-provider">Creating a config map</h4>
<div class="paragraph">
<p>Identity providers use OpenShift Container Platform <code>ConfigMap</code> objects in the <code>openshift-config</code>
namespace to contain the certificate authority bundle. These are primarily
used to contain certificate bundles needed by the identity provider.</p>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Define an OpenShift Container Platform <code>ConfigMap</code> object containing the
certificate authority by using the following command. The certificate
authority must be stored in the <code>ca.crt</code> key of the <code>ConfigMap</code> object.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc create configmap ca-config-map --from-file=ca.crt=/path/to/ca -n openshift-config</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph">
<p>You can alternatively apply the following YAML to create the config map:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: v1
kind: ConfigMap
metadata:
  name: ca-config-map
  namespace: openshift-config
data:
  ca.crt: |
    &lt;CA_certificate_PEM&gt;</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="identity-provider-keystone-CR_configuring-keystone-identity-provider">Sample Keystone CR</h4>
<div class="paragraph">
<p>The following custom resource (CR) shows the parameters and acceptable values for a
Keystone identity provider.</p>
</div>
<div class="listingblock">
<div class="title">Keystone CR</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: config.openshift.io/v1
kind: OAuth
metadata:
  name: cluster
spec:
  identityProviders:
  - name: keystoneidp <b class="conum">(1)</b>
    mappingMethod: claim <b class="conum">(2)</b>
    type: Keystone
    keystone:
      domainName: default <b class="conum">(3)</b>
      url: https://keystone.example.com:5000 <b class="conum">(4)</b>
      ca: <b class="conum">(5)</b>
        name: ca-config-map
      tlsClientCert: <b class="conum">(6)</b>
        name: client-cert-secret
      tlsClientKey: <b class="conum">(7)</b>
        name: client-key-secret</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>This provider name is prefixed to provider user names to form an identity name.</p>
</li>
<li>
<p>Controls how mappings are established between this provider&#8217;s identities and <code>User</code> objects.</p>
</li>
<li>
<p>Keystone domain name. In Keystone, usernames are domain-specific. Only a single domain is supported.</p>
</li>
<li>
<p>The URL to use to connect to the Keystone server (required). This must
use https.</p>
</li>
<li>
<p>Optional: Reference to an OpenShift Container Platform <code>ConfigMap</code> object containing the
PEM-encoded certificate authority bundle to use in validating server
certificates for the configured URL.</p>
</li>
<li>
<p>Optional: Reference to an OpenShift Container Platform <code>Secret</code> object containing the client
certificate to present when making requests to the configured URL.</p>
</li>
<li>
<p>Reference to an OpenShift Container Platform <code>Secret</code> object containing the key for the
client certificate. Required if <code>tlsClientCert</code> is specified.</p>
</li>
</ol>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p>See <a href="understanding-identity-provider.html#identity-provider-parameters_understanding-identity-provider">Identity provider parameters</a> for information on parameters, such as <code>mappingMethod</code>, that are common to all identity providers.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="add-identity-provider_configuring-keystone-identity-provider">Adding an identity provider to your cluster</h4>
<div class="paragraph">
<p>After you install your cluster, add an identity provider to it so your
users can authenticate.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Create an OpenShift Container Platform cluster.</p>
</li>
<li>
<p>Create the custom resource (CR) for your identity providers.</p>
</li>
<li>
<p>You must be logged in as an administrator.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Apply the defined CR:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc apply -f &lt;/path/to/CR&gt;</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>If a CR does not exist, <code>oc apply</code> creates a new CR and might trigger the following warning: <code>Warning: oc apply should be used on resources created by either oc create --save-config or oc apply</code>. In this case you can safely ignore this warning.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Log in to the cluster as a user from your identity provider, entering the
password when prompted.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc login -u &lt;username&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>Confirm that the user logged in successfully, and display the user name.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc whoami</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configuring-ldap-identity-provider">Configuring an LDAP identity provider</h3>
<div class="paragraph">
<p>Configure the <code>ldap</code> identity provider to validate user names and passwords against an LDAPv3 server, using simple bind authentication.</p>
</div>
<div class="sect3">
<h4 id="identity-provider-overview_configuring-ldap-identity-provider">About identity providers in OpenShift Container Platform</h4>
<div class="paragraph">
<p>By default, only a <code>kubeadmin</code> user exists on your cluster. To specify an
identity provider, you must create a custom resource (CR) that describes
that identity provider and add it to the cluster.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>OpenShift Container Platform user names containing <code>/</code>, <code>:</code>, and <code>%</code> are not supported.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="identity-provider-about-ldap_configuring-ldap-identity-provider">About LDAP authentication</h4>
<div class="paragraph">
<p>During authentication, the LDAP directory is searched for an entry that matches
the provided user name. If a single unique match is found, a simple bind is
attempted using the distinguished name (DN) of the entry plus the provided
password.</p>
</div>
<div class="paragraph">
<p>These are the steps taken:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Generate a search filter by combining the attribute and filter in the
configured <code>url</code> with the user-provided user name.</p>
</li>
<li>
<p>Search the directory using the generated filter. If the search does not return
exactly one entry, deny access.</p>
</li>
<li>
<p>Attempt to bind to the LDAP server using the DN of the entry retrieved from
the search, and the user-provided password.</p>
</li>
<li>
<p>If the bind is unsuccessful, deny access.</p>
</li>
<li>
<p>If the bind is successful, build an identity using the configured attributes
as the identity, email address, display name, and preferred user name.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The configured <code>url</code> is an RFC 2255 URL, which specifies the LDAP host and
search parameters to use. The syntax of the URL is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">ldap://host:port/basedn?attribute?scope?filter</pre>
</div>
</div>
<div class="paragraph">
<p>For this URL:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">URL component</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-middle"><div class="content"><div class="paragraph">
<p><code>ldap</code></p>
</div>
<div class="ulist">
<ul>
</ul>
</div>
<div class="paragraph nav-footer">
<p></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>For regular LDAP, use the string <code>ldap</code>. For secure LDAP
(LDAPS), use <code>ldaps</code> instead.</p>
</div>
<div class="ulist">
<ul>
</ul>
</div>
<div class="paragraph nav-footer">
<p></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><div class="content"><div class="paragraph">
<p><code>host:port</code></p>
</div>
<div class="ulist">
<ul>
</ul>
</div>
<div class="paragraph nav-footer">
<p></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The name and port of the LDAP server. Defaults to
<code>localhost:389</code> for ldap and <code>localhost:636</code> for LDAPS.</p>
</div>
<div class="ulist">
<ul>
</ul>
</div>
<div class="paragraph nav-footer">
<p></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><div class="content"><div class="paragraph">
<p><code>basedn</code></p>
</div>
<div class="ulist">
<ul>
</ul>
</div>
<div class="paragraph nav-footer">
<p></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The DN of the branch of the directory where all searches should
start from. At the very least, this must be the top of your directory tree, but
it could also specify a subtree in the directory.</p>
</div>
<div class="ulist">
<ul>
</ul>
</div>
<div class="paragraph nav-footer">
<p></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><div class="content"><div class="paragraph">
<p><code>attribute</code></p>
</div>
<div class="ulist">
<ul>
</ul>
</div>
<div class="paragraph nav-footer">
<p></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The attribute to search for. Although RFC 2255 allows a
comma-separated list of attributes, only the first attribute will be used, no
matter how many are provided. If no attributes are provided, the default is to
use <code>uid</code>. It is recommended to choose an attribute that will be unique across
all entries in the subtree you will be using.</p>
</div>
<div class="ulist">
<ul>
</ul>
</div>
<div class="paragraph nav-footer">
<p></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><div class="content"><div class="paragraph">
<p><code>scope</code></p>
</div>
<div class="ulist">
<ul>
</ul>
</div>
<div class="paragraph nav-footer">
<p></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The scope of the search. Can be either <code>one</code> or <code>sub</code>.
If the scope is not provided, the default is to use a scope of <code>sub</code>.</p>
</div>
<div class="ulist">
<ul>
</ul>
</div>
<div class="paragraph nav-footer">
<p></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><div class="content"><div class="paragraph">
<p><code>filter</code></p>
</div>
<div class="ulist">
<ul>
</ul>
</div>
<div class="paragraph nav-footer">
<p></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>A valid LDAP search filter. If not provided, defaults to
<code>(objectClass=*)</code></p>
</div>
<div class="ulist">
<ul>
</ul>
</div>
<div class="paragraph nav-footer">
<p></p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>When doing searches, the attribute, filter, and provided user name are combined
to create a search filter that looks like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">(&amp;(&lt;filter&gt;)(&lt;attribute&gt;=&lt;username&gt;))</pre>
</div>
</div>
<div class="paragraph">
<p>For example, consider a URL of:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">ldap://ldap.example.com/o=Acme?cn?sub?(enabled=true)</pre>
</div>
</div>
<div class="paragraph">
<p>When a client attempts to connect using a user name of <code>bob</code>, the resulting
search filter will be <code>(&amp;(enabled=true)(cn=bob))</code>.</p>
</div>
<div class="paragraph">
<p>If the LDAP directory requires authentication to search, specify a <code>bindDN</code> and
<code>bindPassword</code> to use to perform the entry search.</p>
</div>
</div>
<div class="sect3">
<h4 id="identity-provider-creating-ldap-secret_configuring-ldap-identity-provider">Creating the LDAP secret</h4>
<div class="paragraph">
<p>To use the identity provider, you must define an OpenShift Container Platform <code>Secret</code> object that contains the <code>bindPassword</code> field.</p>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Create a <code>Secret</code> object that contains the <code>bindPassword</code> field:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc create secret generic ldap-secret --from-literal=bindPassword=&lt;secret&gt; -n openshift-config <b class="conum">(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The secret key containing the bindPassword for the <code>--from-literal</code> argument must be called <code>bindPassword</code>.</p>
</li>
</ol>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph">
<p>You can alternatively apply the following YAML to create the secret:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: v1
kind: Secret
metadata:
  name: ldap-secret
  namespace: openshift-config
type: Opaque
data:
  bindPassword: &lt;base64_encoded_bind_password&gt;</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="identity-provider-creating-configmap_configuring-ldap-identity-provider">Creating a config map</h4>
<div class="paragraph">
<p>Identity providers use OpenShift Container Platform <code>ConfigMap</code> objects in the <code>openshift-config</code>
namespace to contain the certificate authority bundle. These are primarily
used to contain certificate bundles needed by the identity provider.</p>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Define an OpenShift Container Platform <code>ConfigMap</code> object containing the
certificate authority by using the following command. The certificate
authority must be stored in the <code>ca.crt</code> key of the <code>ConfigMap</code> object.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc create configmap ca-config-map --from-file=ca.crt=/path/to/ca -n openshift-config</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph">
<p>You can alternatively apply the following YAML to create the config map:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: v1
kind: ConfigMap
metadata:
  name: ca-config-map
  namespace: openshift-config
data:
  ca.crt: |
    &lt;CA_certificate_PEM&gt;</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="identity-provider-ldap-CR_configuring-ldap-identity-provider">Sample LDAP CR</h4>
<div class="paragraph">
<p>The following custom resource (CR) shows the parameters and acceptable values for an
LDAP identity provider.</p>
</div>
<div class="listingblock">
<div class="title">LDAP CR</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: config.openshift.io/v1
kind: OAuth
metadata:
  name: cluster
spec:
  identityProviders:
  - name: ldapidp <b class="conum">(1)</b>
    mappingMethod: claim <b class="conum">(2)</b>
    type: LDAP
    ldap:
      attributes:
        id: <b class="conum">(3)</b>
        - dn
        email: <b class="conum">(4)</b>
        - mail
        name: <b class="conum">(5)</b>
        - cn
        preferredUsername: <b class="conum">(6)</b>
        - uid
      bindDN: "" <b class="conum">(7)</b>
      bindPassword: <b class="conum">(8)</b>
        name: ldap-secret
      ca: <b class="conum">(9)</b>
        name: ca-config-map
      insecure: false <b class="conum">(10)</b>
      url: "ldaps://ldaps.example.com/ou=users,dc=acme,dc=com?uid" <b class="conum">(11)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>This provider name is prefixed to the returned user ID to form an identity
name.</p>
</li>
<li>
<p>Controls how mappings are established between this provider&#8217;s identities and <code>User</code> objects.</p>
</li>
<li>
<p>List of attributes to use as the identity. First non-empty attribute is
used. At least one attribute is required. If none of the listed attribute
have a value, authentication fails. Defined attributes are retrieved as raw,
allowing for binary values to be used.</p>
</li>
<li>
<p>List of attributes to use as the email address. First non-empty
attribute is used.</p>
</li>
<li>
<p>List of attributes to use as the display name. First non-empty
attribute is used.</p>
</li>
<li>
<p>List of attributes to use as the preferred user name when provisioning a
user for this identity. First non-empty attribute is used.</p>
</li>
<li>
<p>Optional DN to use to bind during the search phase. Must be set if
<code>bindPassword</code> is defined.</p>
</li>
<li>
<p>Optional reference to an OpenShift Container Platform <code>Secret</code> object containing the bind
password. Must be set if <code>bindDN</code> is defined.</p>
</li>
<li>
<p>Optional: Reference to an OpenShift Container Platform <code>ConfigMap</code> object containing the
PEM-encoded certificate authority bundle to use in validating server
certificates for the configured URL. Only used when <code>insecure</code> is <code>false</code>.</p>
</li>
<li>
<p>When <code>true</code>, no TLS connection is made to the server. When <code>false</code>,
<code>ldaps://</code> URLs connect using TLS, and <code>ldap://</code> URLs are upgraded to TLS.
This must be set to <code>false</code> when <code>ldaps://</code> URLs are in use, as these
URLs always attempt to connect using TLS.</p>
</li>
<li>
<p>An RFC 2255 URL which specifies the LDAP host and search parameters to use.</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>To whitelist users for an LDAP integration, use the <code>lookup</code> mapping method.
Before a login from LDAP would be allowed, a cluster administrator must create
an <code>Identity</code> object and a <code>User</code> object for each LDAP user.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p>See <a href="understanding-identity-provider.html#identity-provider-parameters_understanding-identity-provider">Identity provider parameters</a> for information on parameters, such as <code>mappingMethod</code>, that are common to all identity providers.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="add-identity-provider_configuring-ldap-identity-provider">Adding an identity provider to your cluster</h4>
<div class="paragraph">
<p>After you install your cluster, add an identity provider to it so your
users can authenticate.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Create an OpenShift Container Platform cluster.</p>
</li>
<li>
<p>Create the custom resource (CR) for your identity providers.</p>
</li>
<li>
<p>You must be logged in as an administrator.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Apply the defined CR:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc apply -f &lt;/path/to/CR&gt;</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>If a CR does not exist, <code>oc apply</code> creates a new CR and might trigger the following warning: <code>Warning: oc apply should be used on resources created by either oc create --save-config or oc apply</code>. In this case you can safely ignore this warning.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Log in to the cluster as a user from your identity provider, entering the
password when prompted.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc login -u &lt;username&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>Confirm that the user logged in successfully, and display the user name.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc whoami</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configuring-basic-authentication-identity-provider">Configuring a basic authentication identity provider</h3>
<div class="paragraph">
<p>Configure the <code>basic-authentication</code> identity provider for users to log in to OpenShift Container Platform with credentials validated against a remote identity provider. Basic authentication is a generic back-end integration mechanism.</p>
</div>
<div class="sect3">
<h4 id="identity-provider-overview_configuring-basic-authentication-identity-provider">About identity providers in OpenShift Container Platform</h4>
<div class="paragraph">
<p>By default, only a <code>kubeadmin</code> user exists on your cluster. To specify an
identity provider, you must create a custom resource (CR) that describes
that identity provider and add it to the cluster.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>OpenShift Container Platform user names containing <code>/</code>, <code>:</code>, and <code>%</code> are not supported.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="identity-provider-about-basic-authentication_configuring-basic-authentication-identity-provider">About basic authentication</h4>
<div class="paragraph">
<p>Basic authentication is a generic back-end integration mechanism that allows
users to log in to OpenShift Container Platform with credentials validated against a remote
identity provider.</p>
</div>
<div class="paragraph">
<p>Because basic authentication is generic, you can use this identity
provider for advanced authentication configurations.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>Basic authentication must use an HTTPS connection to the remote server to
prevent potential snooping of the user ID and password and man-in-the-middle
attacks.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>With basic authentication configured, users send their user name
and password to OpenShift Container Platform, which then validates those credentials against
a remote server by making a server-to-server request, passing the credentials as
a basic authentication header. This requires users to send their credentials to
OpenShift Container Platform during login.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>This only works for user name/password login mechanisms, and OpenShift Container Platform must
be able to make network requests to the remote authentication server.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>User names and passwords are validated against a remote URL that is protected
by basic authentication and returns JSON.</p>
</div>
<div class="paragraph">
<p>A <code>401</code> response indicates failed authentication.</p>
</div>
<div class="paragraph">
<p>A non-<code>200</code> status, or the presence of a non-empty "error" key, indicates an
error:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">{"error":"Error message"}</code></pre>
</div>
</div>
<div class="paragraph">
<p>A <code>200</code> status with a <code>sub</code> (subject) key indicates success:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">{"sub":"userid"} <b class="conum">(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The subject must be unique to the authenticated user and must not be able to
be modified.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>A successful response can optionally provide additional data, such as:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A display name using the <code>name</code> key. For example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">{"sub":"userid", "name": "User Name", ...}</code></pre>
</div>
</div>
</li>
<li>
<p>An email address using the <code>email</code> key. For example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">{"sub":"userid", "email":"user@example.com", ...}</code></pre>
</div>
</div>
</li>
<li>
<p>A preferred user name using the <code>preferred_username</code> key. This is useful when
the unique, unchangeable subject is a database key or UID, and a more
human-readable name exists. This is used as a hint when provisioning the
OpenShift Container Platform user for the authenticated identity. For example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">{"sub":"014fbff9a07c", "preferred_username":"bob", ...}</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="identity-provider-creating-secret-tls_configuring-basic-authentication-identity-provider">Creating the secret</h4>
<div class="paragraph">
<p>Identity providers use OpenShift Container Platform <code>Secret</code> objects in the <code>openshift-config</code> namespace to contain the client secret, client certificates, and keys.</p>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Create a <code>Secret</code> object that contains the key and certificate by using the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc create secret tls &lt;secret_name&gt; --key=key.pem --cert=cert.pem -n openshift-config</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph">
<p>You can alternatively apply the following YAML to create the secret:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: v1
kind: Secret
metadata:
  name: &lt;secret_name&gt;
  namespace: openshift-config
type: kubernetes.io/tls
data:
  tls.crt: &lt;base64_encoded_cert&gt;
  tls.key: &lt;base64_encoded_key&gt;</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="identity-provider-creating-configmap_configuring-basic-authentication-identity-provider">Creating a config map</h4>
<div class="paragraph">
<p>Identity providers use OpenShift Container Platform <code>ConfigMap</code> objects in the <code>openshift-config</code>
namespace to contain the certificate authority bundle. These are primarily
used to contain certificate bundles needed by the identity provider.</p>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Define an OpenShift Container Platform <code>ConfigMap</code> object containing the
certificate authority by using the following command. The certificate
authority must be stored in the <code>ca.crt</code> key of the <code>ConfigMap</code> object.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc create configmap ca-config-map --from-file=ca.crt=/path/to/ca -n openshift-config</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph">
<p>You can alternatively apply the following YAML to create the config map:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: v1
kind: ConfigMap
metadata:
  name: ca-config-map
  namespace: openshift-config
data:
  ca.crt: |
    &lt;CA_certificate_PEM&gt;</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="identity-provider-basic-authentication-CR_configuring-basic-authentication-identity-provider">Sample basic authentication CR</h4>
<div class="paragraph">
<p>The following custom resource (CR) shows the parameters and acceptable values for a
basic authentication identity provider.</p>
</div>
<div class="listingblock">
<div class="title">Basic authentication CR</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: config.openshift.io/v1
kind: OAuth
metadata:
  name: cluster
spec:
  identityProviders:
  - name: basicidp <b class="conum">(1)</b>
    mappingMethod: claim <b class="conum">(2)</b>
    type: BasicAuth
    basicAuth:
      url: https://www.example.com/remote-idp <b class="conum">(3)</b>
      ca: <b class="conum">(4)</b>
        name: ca-config-map
      tlsClientCert: <b class="conum">(5)</b>
        name: client-cert-secret
      tlsClientKey: <b class="conum">(6)</b>
        name: client-key-secret</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>This provider name is prefixed to the returned user ID to form an identity
name.</p>
</li>
<li>
<p>Controls how mappings are established between this provider&#8217;s identities and <code>User</code> objects.</p>
</li>
<li>
<p>URL accepting credentials in Basic authentication headers.</p>
</li>
<li>
<p>Optional: Reference to an OpenShift Container Platform <code>ConfigMap</code> object containing the
PEM-encoded certificate authority bundle to use in validating server
certificates for the configured URL.</p>
</li>
<li>
<p>Optional: Reference to an OpenShift Container Platform <code>Secret</code> object containing the client
certificate to present when making requests to the configured URL.</p>
</li>
<li>
<p>Reference to an OpenShift Container Platform <code>Secret</code> object containing the key for the
client certificate. Required if <code>tlsClientCert</code> is specified.</p>
</li>
</ol>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p>See <a href="understanding-identity-provider.html#identity-provider-parameters_understanding-identity-provider">Identity provider parameters</a> for information on parameters, such as <code>mappingMethod</code>, that are common to all identity providers.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="add-identity-provider_configuring-basic-authentication-identity-provider">Adding an identity provider to your cluster</h4>
<div class="paragraph">
<p>After you install your cluster, add an identity provider to it so your
users can authenticate.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Create an OpenShift Container Platform cluster.</p>
</li>
<li>
<p>Create the custom resource (CR) for your identity providers.</p>
</li>
<li>
<p>You must be logged in as an administrator.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Apply the defined CR:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc apply -f &lt;/path/to/CR&gt;</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>If a CR does not exist, <code>oc apply</code> creates a new CR and might trigger the following warning: <code>Warning: oc apply should be used on resources created by either oc create --save-config or oc apply</code>. In this case you can safely ignore this warning.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Log in to the cluster as a user from your identity provider, entering the
password when prompted.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc login -u &lt;username&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>Confirm that the user logged in successfully, and display the user name.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc whoami</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="example-apache-httpd-configuration_configuring-basic-authentication-identity-provider">Example Apache HTTPD configuration for basic identity providers</h4>
<div class="paragraph">
<p>The basic identify provider (IDP) configuration in OpenShift Container Platform 4 requires
that the IDP server respond with JSON for success and failures. You can use CGI
scripting in Apache HTTPD to accomplish this. This section provides examples.</p>
</div>
<div class="listingblock">
<div class="title">Example <code>/etc/httpd/conf.d/login.conf</code></div>
<div class="content">
<pre class="nowrap">&lt;VirtualHost *:443&gt;
  # CGI Scripts in here
  DocumentRoot /var/www/cgi-bin

  # SSL Directives
  SSLEngine on
  SSLCipherSuite PROFILE=SYSTEM
  SSLProxyCipherSuite PROFILE=SYSTEM
  SSLCertificateFile /etc/pki/tls/certs/localhost.crt
  SSLCertificateKeyFile /etc/pki/tls/private/localhost.key

  # Configure HTTPD to execute scripts
  ScriptAlias /basic /var/www/cgi-bin

  # Handles a failed login attempt
  ErrorDocument 401 /basic/fail.cgi

  # Handles authentication
  &lt;Location /basic/login.cgi&gt;
    AuthType Basic
    AuthName "Please Log In"
    AuthBasicProvider file
    AuthUserFile /etc/httpd/conf/passwords
    Require valid-user
  &lt;/Location&gt;
&lt;/VirtualHost&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example <code>/var/www/cgi-bin/login.cgi</code></div>
<div class="content">
<pre class="nowrap">#!/bin/bash
echo "Content-Type: application/json"
echo ""
echo '{"sub":"userid", "name":"'$REMOTE_USER'"}'
exit 0</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example <code>/var/www/cgi-bin/fail.cgi</code></div>
<div class="content">
<pre class="nowrap">#!/bin/bash
echo "Content-Type: application/json"
echo ""
echo '{"error": "Login failure"}'
exit 0</pre>
</div>
</div>
<div class="sect4">
<h5 id="_file-requirements">File requirements</h5>
<div class="paragraph">
<p>These are the requirements for the files you create on an Apache HTTPD web
server:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>login.cgi</code> and <code>fail.cgi</code> must be executable (<code>chmod +x</code>).</p>
</li>
<li>
<p><code>login.cgi</code> and <code>fail.cgi</code> must have proper SELinux contexts if SELinux is
enabled: <code>restorecon -RFv /var/www/cgi-bin</code>, or ensure that the context is
<code>httpd_sys_script_exec_t</code> using <code>ls -laZ</code>.</p>
</li>
<li>
<p><code>login.cgi</code> is only executed if your user successfully logs in per <code>Require
and Auth</code> directives.</p>
</li>
<li>
<p><code>fail.cgi</code> is executed if the user fails to log in, resulting in an <code>HTTP 401</code>
response.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="identity-provider-basic-authentication-troubleshooting_configuring-basic-authentication-identity-provider">Basic authentication troubleshooting</h4>
<div class="paragraph">
<p>The most common issue relates to network connectivity to the backend server. For
simple debugging, run <code>curl</code> commands on the master. To test for a successful
login, replace the <code>&lt;user&gt;</code> and <code>&lt;password&gt;</code> in the following example command
with valid credentials. To test an invalid login, replace them with false
credentials.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ curl --cacert /path/to/ca.crt --cert /path/to/client.crt --key /path/to/client.key -u &lt;user&gt;:&lt;password&gt; -v https://www.example.com/remote-idp</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Successful responses</strong></p>
</div>
<div class="paragraph">
<p>A <code>200</code> status with a <code>sub</code> (subject) key indicates success:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">{"sub":"userid"}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The subject must be unique to the authenticated user, and must not be able to
be modified.</p>
</div>
<div class="paragraph">
<p>A successful response can optionally provide additional data, such as:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A display name using the <code>name</code> key:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">{"sub":"userid", "name": "User Name", ...}</code></pre>
</div>
</div>
</li>
<li>
<p>An email address using the <code>email</code> key:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">{"sub":"userid", "email":"user@example.com", ...}</code></pre>
</div>
</div>
</li>
<li>
<p>A preferred user name using the <code>preferred_username</code> key:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">{"sub":"014fbff9a07c", "preferred_username":"bob", ...}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>preferred_username</code> key is useful when
the unique, unchangeable subject is a database key or UID, and a more
human-readable name exists. This is used as a hint when provisioning the
OpenShift Container Platform user for the authenticated identity.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Failed responses</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>A <code>401</code> response indicates failed authentication.</p>
</li>
<li>
<p>A non-<code>200</code> status or the presence of a non-empty "error" key indicates an
error: <code>{"error":"Error message"}</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configuring-request-header-identity-provider">Configuring a request header identity provider</h3>
<div class="paragraph">
<p>Configure the <code>request-header</code> identity provider to identify users from request header values, such as <code>X-Remote-User</code>. It is typically used in combination with an authenticating proxy, which sets the request header value.</p>
</div>
<div class="sect3">
<h4 id="identity-provider-overview_configuring-request-header-identity-provider">About identity providers in OpenShift Container Platform</h4>
<div class="paragraph">
<p>By default, only a <code>kubeadmin</code> user exists on your cluster. To specify an
identity provider, you must create a custom resource (CR) that describes
that identity provider and add it to the cluster.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>OpenShift Container Platform user names containing <code>/</code>, <code>:</code>, and <code>%</code> are not supported.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="identity-provider-about-request-header_configuring-request-header-identity-provider">About request header authentication</h4>
<div class="paragraph">
<p>A request header identity provider identifies users from request
header values, such as <code>X-Remote-User</code>. It is typically used in combination with
an authenticating proxy, which sets the request header value. The
request header identity provider cannot be combined with other identity providers
that use direct password logins, such as htpasswd, Keystone, LDAP or basic authentication.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>You can also use the request header identity provider for advanced configurations
such as the community-supported <a href="https://github.com/openshift/request-header-saml-service-provider">SAML authentication</a>.
Note that this solution is not supported by Red Hat.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For users to authenticate using this identity provider, they must access
<code>https://<em>&lt;namespace_route&gt;</em>/oauth/authorize</code> (and subpaths) via an authenticating proxy.
To accomplish this, configure the OAuth server to redirect unauthenticated
requests for OAuth tokens to the proxy endpoint that proxies to
<code>https://<em>&lt;namespace_route&gt;</em>/oauth/authorize</code>.</p>
</div>
<div class="paragraph">
<p>To redirect unauthenticated requests from clients expecting browser-based login flows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Set the <code>provider.loginURL</code> parameter to the authenticating proxy URL that
will authenticate interactive clients and then proxy the request to
<code>https://<em>&lt;namespace_route&gt;</em>/oauth/authorize</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To redirect unauthenticated requests from clients expecting <code>WWW-Authenticate</code> challenges:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Set the <code>provider.challengeURL</code> parameter to the authenticating proxy URL that
will authenticate clients expecting <code>WWW-Authenticate</code> challenges and then proxy
the request to <code>https://<em>&lt;namespace_route&gt;</em>/oauth/authorize</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>provider.challengeURL</code> and <code>provider.loginURL</code> parameters can include
the following tokens in the query portion of the URL:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>${url}</code> is replaced with the current URL, escaped to be safe in a query parameter.</p>
<div class="paragraph">
<p>For example: <code>https://www.example.com/sso-login?then=${url}</code></p>
</div>
</li>
<li>
<p><code>${query}</code> is replaced with the current query string, unescaped.</p>
<div class="paragraph">
<p>For example: <code>https://www.example.com/auth-proxy/oauth/authorize?${query}</code></p>
</div>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>As of OpenShift Container Platform 4.1, your proxy must support mutual TLS.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="sspi-windows_configuring-request-header-identity-provider">SSPI connection support on Microsoft Windows</h5>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>Using SSPI connection support on Microsoft Windows is a Technology Preview feature only. Technology Preview features
are not supported with Red Hat production service level agreements (SLAs) and
might not be functionally complete. Red Hat does not recommend using them
in production. These features provide early access to upcoming product
features, enabling customers to test functionality and provide feedback during
the development process.</p>
</div>
<div class="paragraph">
<p>For more information about the support scope of Red Hat Technology Preview features, see <a href="https://access.redhat.com/support/offerings/techpreview/">Technology Preview Features Support Scope</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The OpenShift CLI (<code>oc</code>) supports the Security Support Provider Interface (SSPI) to allow for SSO
flows on Microsft Windows. If you use the request header identity provider with a
GSSAPI-enabled proxy to connect an Active Directory server to OpenShift Container Platform,
users can automatically authenticate to OpenShift Container Platform by using the <code>oc</code>  command
line interface from a domain-joined Microsoft Windows computer.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="identity-provider-creating-configmap_configuring-request-header-identity-provider">Creating a config map</h4>
<div class="paragraph">
<p>Identity providers use OpenShift Container Platform <code>ConfigMap</code> objects in the <code>openshift-config</code>
namespace to contain the certificate authority bundle. These are primarily
used to contain certificate bundles needed by the identity provider.</p>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Define an OpenShift Container Platform <code>ConfigMap</code> object containing the
certificate authority by using the following command. The certificate
authority must be stored in the <code>ca.crt</code> key of the <code>ConfigMap</code> object.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc create configmap ca-config-map --from-file=ca.crt=/path/to/ca -n openshift-config</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph">
<p>You can alternatively apply the following YAML to create the config map:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: v1
kind: ConfigMap
metadata:
  name: ca-config-map
  namespace: openshift-config
data:
  ca.crt: |
    &lt;CA_certificate_PEM&gt;</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="identity-provider-request-header-CR_configuring-request-header-identity-provider">Sample request header CR</h4>
<div class="paragraph">
<p>The following custom resource (CR) shows the parameters and
acceptable values for a request header identity provider.</p>
</div>
<div class="listingblock">
<div class="title">Request header CR</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: config.openshift.io/v1
kind: OAuth
metadata:
  name: cluster
spec:
  identityProviders:
  - name: requestheaderidp <b class="conum">(1)</b>
    mappingMethod: claim <b class="conum">(2)</b>
    type: RequestHeader
    requestHeader:
      challengeURL: "https://www.example.com/challenging-proxy/oauth/authorize?${query}" <b class="conum">(3)</b>
      loginURL: "https://www.example.com/login-proxy/oauth/authorize?${query}" <b class="conum">(4)</b>
      ca: <b class="conum">(5)</b>
        name: ca-config-map
      clientCommonNames: <b class="conum">(6)</b>
      - my-auth-proxy
      headers: <b class="conum">(7)</b>
      - X-Remote-User
      - SSO-User
      emailHeaders: <b class="conum">(8)</b>
      - X-Remote-User-Email
      nameHeaders: <b class="conum">(9)</b>
      - X-Remote-User-Display-Name
      preferredUsernameHeaders: <b class="conum">(10)</b>
      - X-Remote-User-Login</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>This provider name is prefixed to the user name in the request header to
form an identity name.</p>
</li>
<li>
<p>Controls how mappings are established between this provider&#8217;s identities and <code>User</code> objects.</p>
</li>
<li>
<p>Optional: URL to redirect unauthenticated <code>/oauth/authorize</code> requests to,
that will authenticate browser-based clients and then proxy their request to
<code>https://<em>&lt;namespace_route&gt;</em>/oauth/authorize</code>.
The URL that proxies to <code>https://<em>&lt;namespace_route&gt;</em>/oauth/authorize</code> must end with <code>/authorize</code> (with no trailing slash),
and also proxy subpaths, in order for OAuth approval flows to work properly.
<code>${url}</code> is replaced with the current URL, escaped to be safe in a query parameter.
<code>${query}</code> is replaced with the current query string.
If this attribute is not defined, then <code>loginURL</code> must be used.</p>
</li>
<li>
<p>Optional: URL to redirect unauthenticated <code>/oauth/authorize</code> requests to,
that will authenticate clients which expect <code>WWW-Authenticate</code> challenges, and
then proxy them to <code>https://<em>&lt;namespace_route&gt;</em>/oauth/authorize</code>.
<code>${url}</code> is replaced with the current URL, escaped to be safe in a query parameter.
<code>${query}</code> is replaced with the current query string.
If this attribute is not defined, then <code>challengeURL</code> must be used.</p>
</li>
<li>
<p>Reference to an OpenShift Container Platform <code>ConfigMap</code> object containing a PEM-encoded
certificate bundle. Used as a trust anchor to validate the TLS
certificates presented by the remote server.</p>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>As of OpenShift Container Platform 4.1, the <code>ca</code> field is required for this identity
provider. This means that your proxy must support mutual TLS.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Optional: list of common names (<code>cn</code>). If set, a valid client certificate with
a Common Name (<code>cn</code>) in the specified list must be presented before the request headers
are checked for user names. If empty, any Common Name is allowed. Can only be used in combination
with <code>ca</code>.</p>
</li>
<li>
<p>Header names to check, in order, for the user identity. The first header containing
a value is used as the identity. Required, case-insensitive.</p>
</li>
<li>
<p>Header names to check, in order, for an email address. The first header containing
a value is used as the email address. Optional, case-insensitive.</p>
</li>
<li>
<p>Header names to check, in order, for a display name. The first header containing
a value is used as the display name. Optional, case-insensitive.</p>
</li>
<li>
<p>Header names to check, in order, for a preferred user name, if different than the immutable
identity determined from the headers specified in <code>headers</code>. The first header containing
a value is used as the preferred user name when provisioning. Optional, case-insensitive.</p>
</li>
</ol>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p>See <a href="understanding-identity-provider.html#identity-provider-parameters_understanding-identity-provider">Identity provider parameters</a> for information on parameters, such as <code>mappingMethod</code>, that are common to all identity providers.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="add-identity-provider_configuring-request-header-identity-provider">Adding an identity provider to your cluster</h4>
<div class="paragraph">
<p>After you install your cluster, add an identity provider to it so your
users can authenticate.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Create an OpenShift Container Platform cluster.</p>
</li>
<li>
<p>Create the custom resource (CR) for your identity providers.</p>
</li>
<li>
<p>You must be logged in as an administrator.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Apply the defined CR:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc apply -f &lt;/path/to/CR&gt;</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>If a CR does not exist, <code>oc apply</code> creates a new CR and might trigger the following warning: <code>Warning: oc apply should be used on resources created by either oc create --save-config or oc apply</code>. In this case you can safely ignore this warning.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Log in to the cluster as a user from your identity provider, entering the
password when prompted.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc login -u &lt;username&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>Confirm that the user logged in successfully, and display the user name.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc whoami</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="example-apache-auth-config-using-request-header">Example Apache authentication configuration using request header</h4>
<div class="paragraph">
<p>This example configures an Apache authentication proxy for the OpenShift Container Platform
using the request header identity provider.</p>
</div>
<h5 id="identity-provider-apache-custom-proxy-configuration_configuring-request-header-identity-provider" class="discrete">Custom proxy configuration</h5>
<div class="paragraph">
<p>Using the <code>mod_auth_gssapi</code> module is a popular way to configure the Apache
authentication proxy using the request header identity provider; however, it is
not required. Other proxies can easily be used if the following requirements are
met:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Block the <code>X-Remote-User</code> header from client requests to prevent spoofing.</p>
</li>
<li>
<p>Enforce client certificate authentication in the <code>RequestHeaderIdentityProvider</code>
configuration.</p>
</li>
<li>
<p>Require the <code>X-Csrf-Token</code> header be set for all authentication requests using
the challenge flow.</p>
</li>
<li>
<p>Make sure only the <code>/oauth/authorize</code> endpoint and its subpaths are proxied;
redirects must be rewritten to allow the backend server to send the client to
the correct location.</p>
</li>
<li>
<p>The URL that proxies to <code>https://&lt;namespace_route&gt;/oauth/authorize</code> must end
with <code>/authorize</code> with no trailing slash. For example, <code>https://proxy.example.com/login-proxy/authorize?&#8230;&#8203;</code>
must proxy to <code>https://&lt;namespace_route&gt;/oauth/authorize?&#8230;&#8203;</code>.</p>
</li>
<li>
<p>Subpaths of the URL that proxies to <code>https://&lt;namespace_route&gt;/oauth/authorize</code>
must proxy to subpaths of <code>https://&lt;namespace_route&gt;/oauth/authorize</code>. For
example, <code>https://proxy.example.com/login-proxy/authorize/approve?&#8230;&#8203;</code> must
proxy to <code>https://&lt;namespace_route&gt;/oauth/authorize/approve?&#8230;&#8203;</code>.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>https://&lt;namespace_route&gt;</code> address is the route to the OAuth server and
can be obtained by running <code>oc get route -n openshift-authentication</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<h5 id="identity-provider-configuring-apache-request-header_configuring-request-header-identity-provider" class="discrete">Configuring Apache authentication using request header</h5>
<div class="paragraph">
<p>This example uses the <code>mod_auth_gssapi</code> module to configure an Apache
authentication proxy using the request header identity provider.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Obtain the <code>mod_auth_gssapi</code> module from the
<a href="https://access.redhat.com/solutions/392003">Optional channel</a>.
You must have the following packages installed on your local machine:</p>
<div class="ulist">
<ul>
<li>
<p><code>httpd</code></p>
</li>
<li>
<p><code>mod_ssl</code></p>
</li>
<li>
<p><code>mod_session</code></p>
</li>
<li>
<p><code>apr-util-openssl</code></p>
</li>
<li>
<p><code>mod_auth_gssapi</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>Generate a CA for validating requests that submit the trusted header. Define
an OpenShift Container Platform <code>ConfigMap</code> object containing the CA. This is done by running:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc create configmap ca-config-map --from-file=ca.crt=/path/to/ca -n openshift-config <b class="conum">(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The CA must be stored in the <code>ca.crt</code> key of the <code>ConfigMap</code> object.</p>
</li>
</ol>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph">
<p>You can alternatively apply the following YAML to create the config map:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: v1
kind: ConfigMap
metadata:
  name: ca-config-map
  namespace: openshift-config
data:
  ca.crt: |
    &lt;CA_certificate_PEM&gt;</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Generate a client certificate for the proxy. You can generate this certificate
by using any x509 certificate tooling. The client certificate must be signed by
the CA you generated for validating requests that submit the trusted header.</p>
</li>
<li>
<p>Create the custom resource (CR) for your identity providers.</p>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>This proxy uses a client certificate to connect to the OAuth server, which
is configured to trust the <code>X-Remote-User</code> header.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create the certificate for the Apache configuration. The certificate that you
specify as the <code>SSLProxyMachineCertificateFile</code> parameter value is the proxy&#8217;s
client certificate that is used to authenticate the proxy to the server. It must
use <code>TLS Web Client Authentication</code> as the extended key type.</p>
</li>
<li>
<p>Create the Apache configuration. Use the following template to provide your
required settings and values:</p>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>Carefully review the template and customize its contents to fit your
environment.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">LoadModule request_module modules/mod_request.so
LoadModule auth_gssapi_module modules/mod_auth_gssapi.so
# Some Apache configurations might require these modules.
# LoadModule auth_form_module modules/mod_auth_form.so
# LoadModule session_module modules/mod_session.so

# Nothing needs to be served over HTTP.  This virtual host simply redirects to
# HTTPS.
&lt;VirtualHost *:80&gt;
  DocumentRoot /var/www/html
  RewriteEngine              On
  RewriteRule     ^(.*)$     https://%{HTTP_HOST}$1 [R,L]
&lt;/VirtualHost&gt;

&lt;VirtualHost *:443&gt;
  # This needs to match the certificates you generated.  See the CN and X509v3
  # Subject Alternative Name in the output of:
  # openssl x509 -text -in /etc/pki/tls/certs/localhost.crt
  ServerName www.example.com

  DocumentRoot /var/www/html
  SSLEngine on
  SSLCertificateFile /etc/pki/tls/certs/localhost.crt
  SSLCertificateKeyFile /etc/pki/tls/private/localhost.key
  SSLCACertificateFile /etc/pki/CA/certs/ca.crt

  SSLProxyEngine on
  SSLProxyCACertificateFile /etc/pki/CA/certs/ca.crt
  # It is critical to enforce client certificates. Otherwise, requests can
  # spoof the X-Remote-User header by accessing the /oauth/authorize endpoint
  # directly.
  SSLProxyMachineCertificateFile /etc/pki/tls/certs/authproxy.pem

  # To use the challenging-proxy, an X-Csrf-Token must be present.
  RewriteCond %{REQUEST_URI} ^/challenging-proxy
  RewriteCond %{HTTP:X-Csrf-Token} ^$ [NC]
  RewriteRule ^.* - [F,L]

  &lt;Location /challenging-proxy/oauth/authorize&gt;
      # Insert your backend server name/ip here.
      ProxyPass https://&lt;namespace_route&gt;/oauth/authorize
      AuthName "SSO Login"
      # For Kerberos
      AuthType GSSAPI
      Require valid-user
      RequestHeader set X-Remote-User %{REMOTE_USER}s

      GssapiCredStore keytab:/etc/httpd/protected/auth-proxy.keytab
      # Enable the following if you want to allow users to fallback
      # to password based authentication when they do not have a client
      # configured to perform kerberos authentication.
      GssapiBasicAuth On

      # For ldap:
      # AuthBasicProvider ldap
      # AuthLDAPURL "ldap://ldap.example.com:389/ou=People,dc=my-domain,dc=com?uid?sub?(objectClass=*)"
    &lt;/Location&gt;

    &lt;Location /login-proxy/oauth/authorize&gt;
    # Insert your backend server name/ip here.
    ProxyPass https://&lt;namespace_route&gt;/oauth/authorize

      AuthName "SSO Login"
      AuthType GSSAPI
      Require valid-user
      RequestHeader set X-Remote-User %{REMOTE_USER}s env=REMOTE_USER

      GssapiCredStore keytab:/etc/httpd/protected/auth-proxy.keytab
      # Enable the following if you want to allow users to fallback
      # to password based authentication when they do not have a client
      # configured to perform kerberos authentication.
      GssapiBasicAuth On

      ErrorDocument 401 /login.html
    &lt;/Location&gt;

&lt;/VirtualHost&gt;

RequestHeader unset X-Remote-User</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>https://&lt;namespace_route&gt;</code> address is the route to the OAuth server and
can be obtained by running <code>oc get route -n openshift-authentication</code>.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Update the <code>identityProviders</code> stanza in the custom resource (CR):</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">identityProviders:
  - name: requestheaderidp
    type: RequestHeader
    requestHeader:
      challengeURL: "https://&lt;namespace_route&gt;/challenging-proxy/oauth/authorize?${query}"
      loginURL: "https://&lt;namespace_route&gt;/login-proxy/oauth/authorize?${query}"
      ca:
        name: ca-config-map
        clientCommonNames:
        - my-auth-proxy
        headers:
        - X-Remote-User</code></pre>
</div>
</div>
</li>
<li>
<p>Verify the configuration.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Confirm that you can bypass the proxy by requesting a token by supplying the
correct client certificate and header:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal"># curl -L -k -H "X-Remote-User: joe" \
   --cert /etc/pki/tls/certs/authproxy.pem \
   https://&lt;namespace_route&gt;/oauth/token/request</code></pre>
</div>
</div>
</li>
<li>
<p>Confirm that requests that do not supply the client certificate fail by
requesting a token without the certificate:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal"># curl -L -k -H "X-Remote-User: joe" \
   https://&lt;namespace_route&gt;/oauth/token/request</code></pre>
</div>
</div>
</li>
<li>
<p>Confirm that the <code>challengeURL</code> redirect is active:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal"># curl -k -v -H 'X-Csrf-Token: 1' \
   https://&lt;namespace_route&gt;/oauth/authorize?client_id=openshift-challenging-client&amp;response_type=token</code></pre>
</div>
</div>
<div class="paragraph">
<p>Copy the <code>challengeURL</code> redirect to use in the next step.</p>
</div>
</li>
<li>
<p>Run this command to show a <code>401</code> response with a <code>WWW-Authenticate</code> basic
challenge, a negotiate challenge, or both challenges:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal"># curl -k -v -H 'X-Csrf-Token: 1' \
   &lt;challengeURL_redirect + query&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>Test logging in to the OpenShift CLI (<code>oc</code>) with and without using a Kerberos
ticket:</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>If you generated a Kerberos ticket by using <code>kinit</code>, destroy it:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal"># kdestroy -c cache_name <b class="conum">(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Make sure to provide the name of your Kerberos cache.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Log in to the <code>oc</code> tool by using your Kerberos credentials:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal"># oc login -u &lt;username&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Enter your Kerberos password at the prompt.</p>
</div>
</li>
<li>
<p>Log out of the <code>oc</code> tool:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal"># oc logout</code></pre>
</div>
</div>
</li>
<li>
<p>Use your Kerberos credentials to get a ticket:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal"># kinit</code></pre>
</div>
</div>
<div class="paragraph">
<p>Enter your Kerberos user name and password at the prompt.</p>
</div>
</li>
<li>
<p>Confirm that you can log in to the <code>oc</code> tool:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal"># oc login</code></pre>
</div>
</div>
<div class="paragraph">
<p>If your configuration is correct, you are logged in without entering separate
credentials.</p>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configuring-github-identity-provider">Configuring a GitHub or GitHub Enterprise identity provider</h3>
<div class="paragraph">
<p>Configure the <code>github</code> identity provider to validate user names and passwords against GitHub or GitHub Enterprise&#8217;s OAuth authentication server. OAuth facilitates a token exchange flow between OpenShift Container Platform and GitHub or GitHub Enterprise.</p>
</div>
<div class="paragraph">
<p>You can use the GitHub integration to connect to either GitHub or GitHub Enterprise. For GitHub Enterprise integrations, you must provide the <code>hostname</code> of your instance and can optionally provide a <code>ca</code> certificate bundle to use in requests to the server.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>The following steps apply to both GitHub and GitHub Enterprise unless noted.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="identity-provider-overview_configuring-github-identity-provider">About identity providers in OpenShift Container Platform</h4>
<div class="paragraph">
<p>By default, only a <code>kubeadmin</code> user exists on your cluster. To specify an
identity provider, you must create a custom resource (CR) that describes
that identity provider and add it to the cluster.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>OpenShift Container Platform user names containing <code>/</code>, <code>:</code>, and <code>%</code> are not supported.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="identity-provider-github-about_configuring-github-identity-provider">About GitHub authentication</h4>
<div class="paragraph">
<p>Configuring <a href="https://docs.github.com/en/authentication/keeping-your-account-and-data-secure/authorizing-oauth-apps">GitHub authentication</a> allows users to log in to OpenShift Container Platform with their GitHub credentials. To prevent anyone with any GitHub user ID from logging in to your OpenShift Container Platform cluster, you can restrict access to only those in specific GitHub organizations.</p>
</div>
</div>
<div class="sect3">
<h4 id="identity-provider-registering-github_configuring-github-identity-provider">Registering a GitHub application</h4>
<div class="paragraph">
<p>To use GitHub or GitHub Enterprise as an identity provider, you must register
an application to use.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Register an application on GitHub:</p>
<div class="ulist">
<ul>
<li>
<p>For GitHub, click <a href="https://github.com/settings/profile"><strong>Settings</strong></a> &#8594;
<a href="https://github.com/settings/apps"><strong>Developer settings</strong></a> &#8594;
<a href="https://github.com/settings/developers"><strong>OAuth Apps</strong></a> &#8594;
<a href="https://github.com/settings/applications/new"><strong>Register a new OAuth application</strong></a>.</p>
</li>
<li>
<p>For GitHub Enterprise, go to your GitHub Enterprise home page and then click
<strong>Settings &#8594; Developer settings &#8594; Register a new application</strong>.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Enter an application name, for example <code>My OpenShift Install</code>.</p>
</li>
<li>
<p>Enter a homepage URL, such as
<code>https://oauth-openshift.apps.&lt;cluster-name&gt;.&lt;cluster-domain&gt;</code>.</p>
</li>
<li>
<p>Optional: Enter an application description.</p>
</li>
<li>
<p>Enter the authorization callback URL, where the end of the URL contains the
identity provider <code>name</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">https://oauth-openshift.apps.&lt;cluster-name&gt;.&lt;cluster-domain&gt;/oauth2callback/&lt;idp-provider-name&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">https://oauth-openshift.apps.openshift-cluster.example.com/oauth2callback/github</pre>
</div>
</div>
</li>
<li>
<p>Click <strong>Register application</strong>. GitHub provides a client ID and a client secret.
You need these values to complete the identity provider configuration.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="identity-provider-creating-secret_configuring-github-identity-provider">Creating the secret</h4>
<div class="paragraph">
<p>Identity providers use OpenShift Container Platform <code>Secret</code> objects in the <code>openshift-config</code> namespace to contain the client secret, client certificates, and keys.</p>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Create a <code>Secret</code> object containing a string by using the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc create secret generic &lt;secret_name&gt; --from-literal=clientSecret=&lt;secret&gt; -n openshift-config</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph">
<p>You can alternatively apply the following YAML to create the secret:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: v1
kind: Secret
metadata:
  name: &lt;secret_name&gt;
  namespace: openshift-config
type: Opaque
data:
  clientSecret: &lt;base64_encoded_client_secret&gt;</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>You can define a <code>Secret</code> object containing the contents of a file, such as a certificate file, by using the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc create secret generic &lt;secret_name&gt; --from-file=&lt;path_to_file&gt; -n openshift-config</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="identity-provider-creating-configmap_configuring-github-identity-provider">Creating a config map</h4>
<div class="paragraph">
<p>Identity providers use OpenShift Container Platform <code>ConfigMap</code> objects in the <code>openshift-config</code>
namespace to contain the certificate authority bundle. These are primarily
used to contain certificate bundles needed by the identity provider.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>This procedure is only required for GitHub Enterprise.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Define an OpenShift Container Platform <code>ConfigMap</code> object containing the
certificate authority by using the following command. The certificate
authority must be stored in the <code>ca.crt</code> key of the <code>ConfigMap</code> object.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc create configmap ca-config-map --from-file=ca.crt=/path/to/ca -n openshift-config</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph">
<p>You can alternatively apply the following YAML to create the config map:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: v1
kind: ConfigMap
metadata:
  name: ca-config-map
  namespace: openshift-config
data:
  ca.crt: |
    &lt;CA_certificate_PEM&gt;</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="identity-provider-github-CR_configuring-github-identity-provider">Sample GitHub CR</h4>
<div class="paragraph">
<p>The following custom resource (CR) shows the parameters and acceptable values for a
GitHub identity provider.</p>
</div>
<div class="listingblock">
<div class="title">GitHub CR</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: config.openshift.io/v1
kind: OAuth
metadata:
  name: cluster
spec:
  identityProviders:
  - name: githubidp <b class="conum">(1)</b>
    mappingMethod: claim <b class="conum">(2)</b>
    type: GitHub
    github:
      ca: <b class="conum">(3)</b>
        name: ca-config-map
      clientID: {...} <b class="conum">(4)</b>
      clientSecret: <b class="conum">(5)</b>
        name: github-secret
      hostname: ... <b class="conum">(6)</b>
      organizations: <b class="conum">(7)</b>
      - myorganization1
      - myorganization2
      teams: <b class="conum">(8)</b>
      - myorganization1/team-a
      - myorganization2/team-b</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>This provider name is prefixed to the GitHub numeric user ID to form an
identity name. It is also used to build the callback URL.</p>
</li>
<li>
<p>Controls how mappings are established between this provider&#8217;s identities and <code>User</code> objects.</p>
</li>
<li>
<p>Optional: Reference to an OpenShift Container Platform <code>ConfigMap</code> object containing the
PEM-encoded certificate authority bundle to use in validating server
certificates for the configured URL. Only for use in GitHub Enterprise
with a non-publicly trusted root certificate.</p>
</li>
<li>
<p>The client ID of a
<a href="https://github.com/settings/applications/new">registered GitHub OAuth
application</a>. The application must be configured with a callback URL of
<code>https://oauth-openshift.apps.&lt;cluster-name&gt;.&lt;cluster-domain&gt;/oauth2callback/&lt;idp-provider-name&gt;</code>.</p>
</li>
<li>
<p>Reference to an OpenShift Container Platform <code>Secret</code> object containing the client secret
issued by GitHub.</p>
</li>
<li>
<p>For GitHub Enterprise, you must provide the hostname of your instance, such as
<code>example.com</code>. This value must match the GitHub Enterprise <code>hostname</code> value in
in the <code>/setup/settings</code> file and cannot include a port number. If this
value is not set, then either <code>teams</code> or <code>organizations</code> must be defined.
For GitHub, omit this parameter.</p>
</li>
<li>
<p>The list of organizations. Either the <code>organizations</code> or <code>teams</code> field must be set unless the <code>hostname</code> field is set, or if <code>mappingMethod</code> is set to <code>lookup</code>. Cannot be used in combination with the <code>teams</code> field.</p>
</li>
<li>
<p>The list of teams. Either the <code>teams</code> or <code>organizations</code> field must be set unless the <code>hostname</code> field is set, or if <code>mappingMethod</code> is set to <code>lookup</code>. Cannot be used in combination with the <code>organizations</code> field.</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>If <code>organizations</code> or <code>teams</code> is specified, only GitHub users that are members of
at least one of the listed organizations will be allowed to log in. If the GitHub OAuth
application configured in <code>clientID</code> is not owned by the organization, an organization
owner must grant third-party access to use this option. This can be done during
the first GitHub login by the organization&#8217;s administrator, or from the GitHub organization settings.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p>See <a href="understanding-identity-provider.html#identity-provider-parameters_understanding-identity-provider">Identity provider parameters</a> for information on parameters, such as <code>mappingMethod</code>, that are common to all identity providers.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="add-identity-provider_configuring-github-identity-provider">Adding an identity provider to your cluster</h4>
<div class="paragraph">
<p>After you install your cluster, add an identity provider to it so your
users can authenticate.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Create an OpenShift Container Platform cluster.</p>
</li>
<li>
<p>Create the custom resource (CR) for your identity providers.</p>
</li>
<li>
<p>You must be logged in as an administrator.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Apply the defined CR:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc apply -f &lt;/path/to/CR&gt;</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>If a CR does not exist, <code>oc apply</code> creates a new CR and might trigger the following warning: <code>Warning: oc apply should be used on resources created by either oc create --save-config or oc apply</code>. In this case you can safely ignore this warning.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Obtain a token from the OAuth server.</p>
<div class="paragraph">
<p>As long as the <code>kubeadmin</code> user has been removed, the <code>oc login</code> command provides instructions on how to access a web page where you can retrieve the token.</p>
</div>
<div class="paragraph">
<p>You can also access this page from the web console by navigating to <strong>(?) Help</strong> &#8594; <strong>Command Line Tools</strong> &#8594; <strong>Copy Login Command</strong>.</p>
</div>
</li>
<li>
<p>Log in to the cluster, passing in the token to authenticate.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc login --token=&lt;token&gt;</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>This identity provider does not support logging in with a user name and password.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Confirm that the user logged in successfully, and display the user name.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc whoami</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configuring-gitlab-identity-provider">Configuring a GitLab identity provider</h3>
<div class="paragraph">
<p>Configure the <code>gitlab</code> identity provider using <a href="https://gitlab.com/">GitLab.com</a> or any other GitLab instance as an identity provider.</p>
</div>
<div class="sect3">
<h4 id="identity-provider-overview_configuring-gitlab-identity-provider">About identity providers in OpenShift Container Platform</h4>
<div class="paragraph">
<p>By default, only a <code>kubeadmin</code> user exists on your cluster. To specify an
identity provider, you must create a custom resource (CR) that describes
that identity provider and add it to the cluster.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>OpenShift Container Platform user names containing <code>/</code>, <code>:</code>, and <code>%</code> are not supported.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="identity-provider-gitlab-about_configuring-gitlab-identity-provider">About GitLab authentication</h4>
<div class="paragraph">
<p>Configuring GitLab authentication allows users to log in to OpenShift Container Platform with their GitLab credentials.</p>
</div>
<div class="paragraph">
<p>If you use GitLab version 7.7.0 to 11.0, you connect using the <a href="http://doc.gitlab.com/ce/integration/oauth_provider.html">OAuth integration</a>. If you use GitLab version 11.1 or later, you can use <a href="https://docs.gitlab.com/ce/integration/openid_connect_provider.html">OpenID Connect</a> (OIDC) to connect instead of OAuth.</p>
</div>
</div>
<div class="sect3">
<h4 id="identity-provider-creating-secret_configuring-gitlab-identity-provider">Creating the secret</h4>
<div class="paragraph">
<p>Identity providers use OpenShift Container Platform <code>Secret</code> objects in the <code>openshift-config</code> namespace to contain the client secret, client certificates, and keys.</p>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Create a <code>Secret</code> object containing a string by using the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc create secret generic &lt;secret_name&gt; --from-literal=clientSecret=&lt;secret&gt; -n openshift-config</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph">
<p>You can alternatively apply the following YAML to create the secret:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: v1
kind: Secret
metadata:
  name: &lt;secret_name&gt;
  namespace: openshift-config
type: Opaque
data:
  clientSecret: &lt;base64_encoded_client_secret&gt;</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>You can define a <code>Secret</code> object containing the contents of a file, such as a certificate file, by using the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc create secret generic &lt;secret_name&gt; --from-file=&lt;path_to_file&gt; -n openshift-config</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="identity-provider-creating-configmap_configuring-gitlab-identity-provider">Creating a config map</h4>
<div class="paragraph">
<p>Identity providers use OpenShift Container Platform <code>ConfigMap</code> objects in the <code>openshift-config</code>
namespace to contain the certificate authority bundle. These are primarily
used to contain certificate bundles needed by the identity provider.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>This procedure is only required for GitHub Enterprise.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Define an OpenShift Container Platform <code>ConfigMap</code> object containing the
certificate authority by using the following command. The certificate
authority must be stored in the <code>ca.crt</code> key of the <code>ConfigMap</code> object.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc create configmap ca-config-map --from-file=ca.crt=/path/to/ca -n openshift-config</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph">
<p>You can alternatively apply the following YAML to create the config map:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: v1
kind: ConfigMap
metadata:
  name: ca-config-map
  namespace: openshift-config
data:
  ca.crt: |
    &lt;CA_certificate_PEM&gt;</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="identity-provider-gitlab-CR_configuring-gitlab-identity-provider">Sample GitLab CR</h4>
<div class="paragraph">
<p>The following custom resource (CR) shows the parameters and acceptable values for a
GitLab identity provider.</p>
</div>
<div class="listingblock">
<div class="title">GitLab CR</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: config.openshift.io/v1
kind: OAuth
metadata:
  name: cluster
spec:
  identityProviders:
  - name: gitlabidp <b class="conum">(1)</b>
    mappingMethod: claim <b class="conum">(2)</b>
    type: GitLab
    gitlab:
      clientID: {...} <b class="conum">(3)</b>
      clientSecret: <b class="conum">(4)</b>
        name: gitlab-secret
      url: https://gitlab.com <b class="conum">(5)</b>
      ca: <b class="conum">(6)</b>
        name: ca-config-map</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>This provider name is prefixed to the GitLab numeric user ID to form an
identity name. It is also used to build the callback URL.</p>
</li>
<li>
<p>Controls how mappings are established between this provider&#8217;s identities and <code>User</code> objects.</p>
</li>
<li>
<p>The client ID of a
<a href="https://docs.gitlab.com/ce/api/oauth2.html">registered GitLab OAuth application</a>.
The application must be configured with a callback URL of
<code>https://oauth-openshift.apps.&lt;cluster-name&gt;.&lt;cluster-domain&gt;/oauth2callback/&lt;idp-provider-name&gt;</code>.</p>
</li>
<li>
<p>Reference to an OpenShift Container Platform <code>Secret</code> object containing the client secret
issued by GitLab.</p>
</li>
<li>
<p>The host URL of a GitLab provider. This could either be <code>https://gitlab.com/</code>
or any other self hosted instance of GitLab.</p>
</li>
<li>
<p>Optional: Reference to an OpenShift Container Platform <code>ConfigMap</code> object containing the
PEM-encoded certificate authority bundle to use in validating server
certificates for the configured URL.</p>
</li>
</ol>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p>See <a href="understanding-identity-provider.html#identity-provider-parameters_understanding-identity-provider">Identity provider parameters</a> for information on parameters, such as <code>mappingMethod</code>, that are common to all identity providers.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="add-identity-provider_configuring-gitlab-identity-provider">Adding an identity provider to your cluster</h4>
<div class="paragraph">
<p>After you install your cluster, add an identity provider to it so your
users can authenticate.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Create an OpenShift Container Platform cluster.</p>
</li>
<li>
<p>Create the custom resource (CR) for your identity providers.</p>
</li>
<li>
<p>You must be logged in as an administrator.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Apply the defined CR:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc apply -f &lt;/path/to/CR&gt;</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>If a CR does not exist, <code>oc apply</code> creates a new CR and might trigger the following warning: <code>Warning: oc apply should be used on resources created by either oc create --save-config or oc apply</code>. In this case you can safely ignore this warning.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Log in to the cluster as a user from your identity provider, entering the
password when prompted.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc login -u &lt;username&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>Confirm that the user logged in successfully, and display the user name.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc whoami</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configuring-google-identity-provider">Configuring a Google identity provider</h3>
<div class="paragraph">
<p>Configure the <code>google</code> identity provider using the <a href="https://developers.google.com/identity/protocols/OpenIDConnect">Google OpenID Connect integration</a>.</p>
</div>
<div class="sect3">
<h4 id="identity-provider-overview_configuring-google-identity-provider">About identity providers in OpenShift Container Platform</h4>
<div class="paragraph">
<p>By default, only a <code>kubeadmin</code> user exists on your cluster. To specify an
identity provider, you must create a custom resource (CR) that describes
that identity provider and add it to the cluster.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>OpenShift Container Platform user names containing <code>/</code>, <code>:</code>, and <code>%</code> are not supported.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="identity-provider-google-about_configuring-google-identity-provider">About Google authentication</h4>
<div class="paragraph">
<p>Using Google as an identity provider allows any Google user to authenticate to your server. You can limit authentication to members of a specific hosted domain with the <code>hostedDomain</code> configuration attribute.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Using Google as an identity provider requires users to get a token using <code>&lt;namespace_route&gt;/oauth/token/request</code> to use with command-line tools.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="identity-provider-creating-secret_configuring-google-identity-provider">Creating the secret</h4>
<div class="paragraph">
<p>Identity providers use OpenShift Container Platform <code>Secret</code> objects in the <code>openshift-config</code> namespace to contain the client secret, client certificates, and keys.</p>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Create a <code>Secret</code> object containing a string by using the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc create secret generic &lt;secret_name&gt; --from-literal=clientSecret=&lt;secret&gt; -n openshift-config</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph">
<p>You can alternatively apply the following YAML to create the secret:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: v1
kind: Secret
metadata:
  name: &lt;secret_name&gt;
  namespace: openshift-config
type: Opaque
data:
  clientSecret: &lt;base64_encoded_client_secret&gt;</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>You can define a <code>Secret</code> object containing the contents of a file, such as a certificate file, by using the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc create secret generic &lt;secret_name&gt; --from-file=&lt;path_to_file&gt; -n openshift-config</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="identity-provider-google-CR_configuring-google-identity-provider">Sample Google CR</h4>
<div class="paragraph">
<p>The following custom resource (CR) shows the parameters and acceptable
values for a Google identity provider.</p>
</div>
<div class="listingblock">
<div class="title">Google CR</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: config.openshift.io/v1
kind: OAuth
metadata:
  name: cluster
spec:
  identityProviders:
  - name: googleidp <b class="conum">(1)</b>
    mappingMethod: claim <b class="conum">(2)</b>
    type: Google
    google:
      clientID: {...} <b class="conum">(3)</b>
      clientSecret: <b class="conum">(4)</b>
        name: google-secret
      hostedDomain: "example.com" <b class="conum">(5)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>This provider name is prefixed to the Google numeric user ID to form an
identity name. It is also used to build the redirect URL.</p>
</li>
<li>
<p>Controls how mappings are established between this provider&#8217;s identities and <code>User</code> objects.</p>
</li>
<li>
<p>The client ID of a <a href="https://console.developers.google.com/">registered
Google project</a>. The project must be configured with a redirect URI of
<code>https://oauth-openshift.apps.&lt;cluster-name&gt;.&lt;cluster-domain&gt;/oauth2callback/&lt;idp-provider-name&gt;</code>.</p>
</li>
<li>
<p>Reference to an OpenShift Container Platform <code>Secret</code> object containing the client secret
issued by Google.</p>
</li>
<li>
<p>A
<a href="https://developers.google.com/identity/protocols/OpenIDConnect#hd-param">hosted domain</a>
used to restrict sign-in accounts. Optional if the <code>lookup</code> <code>mappingMethod</code>
is used. If empty, any Google account is allowed to authenticate.</p>
</li>
</ol>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p>See <a href="understanding-identity-provider.html#identity-provider-parameters_understanding-identity-provider">Identity provider parameters</a> for information on parameters, such as <code>mappingMethod</code>, that are common to all identity providers.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="add-identity-provider_configuring-google-identity-provider">Adding an identity provider to your cluster</h4>
<div class="paragraph">
<p>After you install your cluster, add an identity provider to it so your
users can authenticate.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Create an OpenShift Container Platform cluster.</p>
</li>
<li>
<p>Create the custom resource (CR) for your identity providers.</p>
</li>
<li>
<p>You must be logged in as an administrator.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Apply the defined CR:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc apply -f &lt;/path/to/CR&gt;</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>If a CR does not exist, <code>oc apply</code> creates a new CR and might trigger the following warning: <code>Warning: oc apply should be used on resources created by either oc create --save-config or oc apply</code>. In this case you can safely ignore this warning.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Obtain a token from the OAuth server.</p>
<div class="paragraph">
<p>As long as the <code>kubeadmin</code> user has been removed, the <code>oc login</code> command provides instructions on how to access a web page where you can retrieve the token.</p>
</div>
<div class="paragraph">
<p>You can also access this page from the web console by navigating to <strong>(?) Help</strong> &#8594; <strong>Command Line Tools</strong> &#8594; <strong>Copy Login Command</strong>.</p>
</div>
</li>
<li>
<p>Log in to the cluster, passing in the token to authenticate.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc login --token=&lt;token&gt;</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>This identity provider does not support logging in with a user name and password.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Confirm that the user logged in successfully, and display the user name.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc whoami</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configuring-oidc-identity-provider">Configuring an OpenID Connect identity provider</h3>
<div class="paragraph">
<p>Configure the <code>oidc</code> identity provider to integrate with an OpenID Connect identity provider using an <a href="http://openid.net/specs/openid-connect-core-1_0.html#CodeFlowAuth">Authorization Code Flow</a>.</p>
</div>
<div class="sect3">
<h4 id="identity-provider-overview_configuring-oidc-identity-provider">About identity providers in OpenShift Container Platform</h4>
<div class="paragraph">
<p>By default, only a <code>kubeadmin</code> user exists on your cluster. To specify an
identity provider, you must create a custom resource (CR) that describes
that identity provider and add it to the cluster.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>OpenShift Container Platform user names containing <code>/</code>, <code>:</code>, and <code>%</code> are not supported.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="identity-provider-oidc-about_configuring-oidc-identity-provider">About OpenID Connect authentication</h4>
<div class="paragraph">
<p>The Authentication Operator in OpenShift Container Platform requires that the configured OpenID Connect identity provider implements the <a href="https://openid.net/specs/openid-connect-discovery-1_0.html">OpenID Connect Discovery</a> specification.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p><code>ID Token</code> and <code>UserInfo</code> decryptions are not supported.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>By default, the <code>openid</code> scope is requested. If required, extra scopes can be specified in the <code>extraScopes</code> field.</p>
</div>
<div class="paragraph">
<p>Claims are read from the JWT <code>id_token</code> returned from the OpenID identity provider and, if specified, from the JSON returned by the <code>UserInfo</code> URL.</p>
</div>
<div class="paragraph">
<p>At least one claim must be configured to use as the user&#8217;s identity. The standard identity claim is <code>sub</code>.</p>
</div>
<div class="paragraph">
<p>You can also indicate which claims to use as the user&#8217;s preferred user name, display name, and email address. If multiple claims are specified, the first one with a non-empty value is used. The following table lists the standard claims:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 66.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Claim</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sub</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Short for "subject identifier." The remote identity for the user at the
issuer.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>preferred_username</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The preferred user name when provisioning a user. A shorthand name that the user wants to be referred to as, such as <code>janedoe</code>. Typically a value that corresponding to the user&#8217;s login or username in the authentication system, such as username or email.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>email</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Email address.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Display name.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>See the <a href="http://openid.net/specs/openid-connect-core-1_0.html#StandardClaims">OpenID claims documentation</a> for more information.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Unless your OpenID Connect identity provider supports the resource owner password credentials (ROPC) grant flow, users must get a token from <code>&lt;namespace_route&gt;/oauth/token/request</code> to use with command-line tools.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="identity-provider-oidc-supported_configuring-oidc-identity-provider">Supported OIDC providers</h4>
<div class="paragraph">
<p>Red Hat tests and supports specific OpenID Connect (OIDC) providers with OpenShift Container Platform. The following OpenID Connect (OIDC) providers are tested and supported with OpenShift Container Platform. Using an OIDC provider that is not on the following list might work with OpenShift Container Platform, but the provider was not tested by Red Hat and therefore is not supported by Red Hat.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Active Directory Federation Services for Windows Server</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Currently, it is not supported to use Active Directory Federation Services for Windows Server with OpenShift Container Platform when custom claims are used.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>GitLab</p>
</li>
<li>
<p>Google</p>
</li>
<li>
<p>Keycloak</p>
</li>
<li>
<p>Microsoft identity platform (Azure Active Directory v2.0)</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Currently, it is not supported to use Microsoft identity platform when group names are required to be synced.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Okta</p>
</li>
<li>
<p>Ping Identity</p>
</li>
<li>
<p>Red Hat Single Sign-On</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="identity-provider-creating-secret_configuring-oidc-identity-provider">Creating the secret</h4>
<div class="paragraph">
<p>Identity providers use OpenShift Container Platform <code>Secret</code> objects in the <code>openshift-config</code> namespace to contain the client secret, client certificates, and keys.</p>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Create a <code>Secret</code> object containing a string by using the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc create secret generic &lt;secret_name&gt; --from-literal=clientSecret=&lt;secret&gt; -n openshift-config</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph">
<p>You can alternatively apply the following YAML to create the secret:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: v1
kind: Secret
metadata:
  name: &lt;secret_name&gt;
  namespace: openshift-config
type: Opaque
data:
  clientSecret: &lt;base64_encoded_client_secret&gt;</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>You can define a <code>Secret</code> object containing the contents of a file, such as a certificate file, by using the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc create secret generic &lt;secret_name&gt; --from-file=&lt;path_to_file&gt; -n openshift-config</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="identity-provider-creating-configmap_configuring-oidc-identity-provider">Creating a config map</h4>
<div class="paragraph">
<p>Identity providers use OpenShift Container Platform <code>ConfigMap</code> objects in the <code>openshift-config</code>
namespace to contain the certificate authority bundle. These are primarily
used to contain certificate bundles needed by the identity provider.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>This procedure is only required for GitHub Enterprise.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Define an OpenShift Container Platform <code>ConfigMap</code> object containing the
certificate authority by using the following command. The certificate
authority must be stored in the <code>ca.crt</code> key of the <code>ConfigMap</code> object.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc create configmap ca-config-map --from-file=ca.crt=/path/to/ca -n openshift-config</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph">
<p>You can alternatively apply the following YAML to create the config map:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: v1
kind: ConfigMap
metadata:
  name: ca-config-map
  namespace: openshift-config
data:
  ca.crt: |
    &lt;CA_certificate_PEM&gt;</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="identity-provider-oidc-CR_configuring-oidc-identity-provider">Sample OpenID Connect CRs</h4>
<div class="paragraph">
<p>The following custom resources (CRs) show the parameters and acceptable values for an OpenID Connect identity provider.</p>
</div>
<div class="paragraph">
<p>If you must specify a custom certificate bundle, extra scopes, extra authorization request parameters, or a <code>userInfo</code> URL, use the full OpenID Connect CR.</p>
</div>
<div class="listingblock">
<div class="title">Standard OpenID Connect CR</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: config.openshift.io/v1
kind: OAuth
metadata:
  name: cluster
spec:
  identityProviders:
  - name: oidcidp <b class="conum">(1)</b>
    mappingMethod: claim <b class="conum">(2)</b>
    type: OpenID
    openID:
      clientID: ... <b class="conum">(3)</b>
      clientSecret: <b class="conum">(4)</b>
        name: idp-secret
      claims: <b class="conum">(5)</b>
        preferredUsername:
        - preferred_username
        name:
        - name
        email:
        - email
        groups:
        - groups
      issuer: https://www.idp-issuer.com <b class="conum">(6)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>This provider name is prefixed to the value of the identity claim to form an identity name. It is also used to build the redirect URL.</p>
</li>
<li>
<p>Controls how mappings are established between this provider&#8217;s identities and <code>User</code> objects.</p>
</li>
<li>
<p>The client ID of a client registered with the OpenID provider. The client must be allowed to redirect to <code>https://oauth-openshift.apps.&lt;cluster_name&gt;.&lt;cluster_domain&gt;/oauth2callback/&lt;idp_provider_name&gt;</code>.</p>
</li>
<li>
<p>A reference to an OpenShift Container Platform <code>Secret</code> object containing the client secret.</p>
</li>
<li>
<p>The list of claims to use as the identity. The first non-empty claim is used.</p>
</li>
<li>
<p>The <a href="https://openid.net/specs/openid-connect-core-1_0.html#IssuerIdentifier">Issuer Identifier</a> described in the OpenID spec. Must use <code>https</code> without query or fragment component.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="title">Full OpenID Connect CR</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: config.openshift.io/v1
kind: OAuth
metadata:
  name: cluster
spec:
  identityProviders:
  - name: oidcidp
    mappingMethod: claim
    type: OpenID
    openID:
      clientID: ...
      clientSecret:
        name: idp-secret
      ca: <b class="conum">(1)</b>
        name: ca-config-map
      extraScopes: <b class="conum">(2)</b>
      - email
      - profile
      extraAuthorizeParameters: <b class="conum">(3)</b>
        include_granted_scopes: "true"
      claims:
        preferredUsername: <b class="conum">(4)</b>
        - preferred_username
        - email
        name: <b class="conum">(5)</b>
        - nickname
        - given_name
        - name
        email: <b class="conum">(6)</b>
        - custom_email_claim
        - email
        groups: <b class="conum">(7)</b>
        - groups
      issuer: https://www.idp-issuer.com</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Optional: Reference to an OpenShift Container Platform config map containing the PEM-encoded certificate authority bundle to use in validating server certificates for the configured URL.</p>
</li>
<li>
<p>Optional: The list of scopes to request, in addition to the <code>openid</code> scope, during the authorization token request.</p>
</li>
<li>
<p>Optional: A map of extra parameters to add to the authorization token request.</p>
</li>
<li>
<p>The list of claims to use as the preferred user name when provisioning a user
for this identity. The first non-empty claim is used.</p>
</li>
<li>
<p>The list of claims to use as the display name. The first non-empty claim is used.</p>
</li>
<li>
<p>The list of claims to use as the email address. The first non-empty claim is used.</p>
</li>
<li>
<p>The list of claims to use to synchronize groups from the OpenID Connect provider to OpenShift Container Platform upon user login. The first non-empty claim is used.</p>
</li>
</ol>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p>See <a href="understanding-identity-provider.html#identity-provider-parameters_understanding-identity-provider">Identity provider parameters</a> for information on parameters, such as <code>mappingMethod</code>, that are common to all identity providers.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="add-identity-provider_configuring-oidc-identity-provider">Adding an identity provider to your cluster</h4>
<div class="paragraph">
<p>After you install your cluster, add an identity provider to it so your
users can authenticate.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Create an OpenShift Container Platform cluster.</p>
</li>
<li>
<p>Create the custom resource (CR) for your identity providers.</p>
</li>
<li>
<p>You must be logged in as an administrator.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Apply the defined CR:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc apply -f &lt;/path/to/CR&gt;</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>If a CR does not exist, <code>oc apply</code> creates a new CR and might trigger the following warning: <code>Warning: oc apply should be used on resources created by either oc create --save-config or oc apply</code>. In this case you can safely ignore this warning.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Obtain a token from the OAuth server.</p>
<div class="paragraph">
<p>As long as the <code>kubeadmin</code> user has been removed, the <code>oc login</code> command provides instructions on how to access a web page where you can retrieve the token.</p>
</div>
<div class="paragraph">
<p>You can also access this page from the web console by navigating to <strong>(?) Help</strong> &#8594; <strong>Command Line Tools</strong> &#8594; <strong>Copy Login Command</strong>.</p>
</div>
</li>
<li>
<p>Log in to the cluster, passing in the token to authenticate.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc login --token=&lt;token&gt;</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>If your OpenID Connect identity provider supports the resource owner password credentials (ROPC) grant flow, you can log in with a user name and password. You might need to take steps to enable the ROPC grant flow for your identity provider.</p>
</div>
<div class="paragraph">
<p>After the OIDC identity provider is configured in OpenShift Container Platform, you can log in by using the following command, which prompts for your user name and password:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc login -u &lt;identity_provider_username&gt; --server=&lt;api_server_url_and_port&gt;</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Confirm that the user logged in successfully, and display the user name.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc whoami</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="identity-provider-configuring-using-the-web-console_configuring-oidc-identity-provider">Configuring identity providers using the web console</h4>
<div class="paragraph">
<p>Configure your identity provider (IDP) through the web console instead of the CLI.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You must be logged in to the web console as a cluster administrator.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Navigate to <strong>Administration</strong> &#8594; <strong>Cluster Settings</strong>.</p>
</li>
<li>
<p>Under the <strong>Configuration</strong> tab, click <strong>OAuth</strong>.</p>
</li>
<li>
<p>Under the <strong>Identity Providers</strong> section, select your identity provider from the
<strong>Add</strong> drop-down menu.</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>You can specify multiple IDPs through the web console without overwriting
existing IDPs.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph nav-footer">
<p>← Previous: <a href="understanding-identity-provider.html">Understanding identity provider configuration</a> | ↑ Up: <a href="master.html">Authentication and authorization</a> | Next: <a href="using-rbac.html">Using RBAC to define and apply permissions</a> →</p>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2023-07-17 11:00:01 +0100
</div>
</div>
</body>
</html>