<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.20">
<title>Authentication and authorization</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.square{list-style-type:square}
ul.circle ul:not([class]),ul.disc ul:not([class]),ul.square ul:not([class]){list-style:inherit}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:first-child,.sidebarblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child,.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,td.hdlist1,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<style>.toc-current{font-weight: bold;} .toc-root{font-family: "Open Sans","DejaVu Sans",sans-serif;
                       font-size: 0.9em;} #content{display: flex; flex-direction: column; flex: 1 1 auto;}
             .nav-footer{text-align: center; margin-top: auto;}
             .nav-footer > p > a {white-space: nowrap;}</style>
</head>
<body id="_managing-cloud-provider-credentials" class="article">
<div id="header">
<h1>Authentication and authorization</h1>
</div>
<div id="content">
<div class="sect1">
<h2 id="_managing-cloud-provider-credentials">Managing cloud provider credentials</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="about-cloud-credential-operator">About the Cloud Credential Operator</h3>
<div class="paragraph">
<p>The Cloud Credential Operator (CCO) manages cloud provider credentials as  custom resource definitions (CRDs). The CCO syncs on <code>CredentialsRequest</code> custom resources (CRs) to allow OpenShift Container Platform components to request cloud provider credentials with the specific permissions that are required for the cluster to run.</p>
</div>
<div class="paragraph">
<p>By setting different values for the <code>credentialsMode</code> parameter in the <code>install-config.yaml</code> file, the CCO can be configured to operate in several different modes. If no mode is specified, or the <code>credentialsMode</code> parameter is set to an empty string (<code>""</code>), the CCO operates in its default mode.</p>
</div>
<div class="sect3">
<h4 id="about-cloud-credential-operator-modes_about-cloud-credential-operator">Modes</h4>
<div class="paragraph">
<p>By setting different values for the <code>credentialsMode</code> parameter in the <code>install-config.yaml</code> file, the CCO can be configured to operate in <em>mint</em>, <em>passthrough</em>, or <em>manual</em> mode. These options provide transparency and flexibility in how the CCO uses cloud credentials to process <code>CredentialsRequest</code> CRs in the cluster, and allow the CCO to be configured to suit the security requirements of your organization. Not all CCO modes are supported for all cloud providers.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong><a href="_managing-cloud-provider-credentials.html#cco-mode-mint">Mint</a></strong>: In mint mode, the CCO uses the provided admin-level cloud credential to create new credentials for components in the cluster with only the specific permissions that are required.</p>
</li>
<li>
<p><strong><a href="_managing-cloud-provider-credentials.html#cco-mode-passthrough">Passthrough</a></strong>: In passthrough mode, the CCO passes the provided cloud credential to the components that request cloud credentials.</p>
</li>
<li>
<p><strong><a href="_managing-cloud-provider-credentials.html#cco-mode-manual">Manual</a></strong>: In manual mode, a user manages cloud credentials instead of the CCO.</p>
<div class="ulist">
<ul>
<li>
<p><strong><a href="_managing-cloud-provider-credentials.html#cco-mode-sts">Manual with AWS Security Token Service</a></strong>: In manual mode, you can configure an AWS cluster to use Amazon Web Services Security Token Service (AWS STS). With this configuration, the CCO uses temporary credentials for different components.</p>
</li>
<li>
<p><strong><a href="_managing-cloud-provider-credentials.html#cco-mode-gcp-workload-identity">Manual with GCP Workload Identity</a></strong>: In manual mode, you can configure a GCP cluster to use GCP Workload Identity. With this configuration, the CCO uses temporary credentials for different components.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 6. CCO mode support matrix</caption>
<colgroup>
<col style="width: 40%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-middle">Cloud provider</th>
<th class="tableblock halign-center valign-middle">Mint</th>
<th class="tableblock halign-center valign-middle">Passthrough</th>
<th class="tableblock halign-center valign-middle">Manual</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock">Alibaba Cloud</p></td>
<td class="tableblock halign-center valign-middle"></td>
<td class="tableblock halign-center valign-middle"></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock">Amazon Web Services (AWS)</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">X</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">X</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock">Microsoft Azure</p></td>
<td class="tableblock halign-center valign-middle"></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">X <sup>[1]</sup></p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock">Google Cloud Platform (GCP)</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">X</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">X</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock">IBM Cloud</p></td>
<td class="tableblock halign-center valign-middle"></td>
<td class="tableblock halign-center valign-middle"></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock">Nutanix</p></td>
<td class="tableblock halign-center valign-middle"></td>
<td class="tableblock halign-center valign-middle"></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock">Red Hat OpenStack Platform (RHOSP)</p></td>
<td class="tableblock halign-center valign-middle"></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">X</p></td>
<td class="tableblock halign-center valign-middle"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock">Red Hat Virtualization (RHV)</p></td>
<td class="tableblock halign-center valign-middle"></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">X</p></td>
<td class="tableblock halign-center valign-middle"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock">VMware vSphere</p></td>
<td class="tableblock halign-center valign-middle"></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">X</p></td>
<td class="tableblock halign-center valign-middle"></td>
</tr>
</tbody>
</table>
<div class="openblock small">
<div class="content">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Manual mode is the only supported CCO configuration for Microsoft Azure Stack Hub.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="cco-determine-mode_about-cloud-credential-operator">Determining the Cloud Credential Operator mode</h4>
<div class="paragraph">
<p>For platforms that support using the CCO in multiple modes, you can determine what mode the CCO is configured to use by using the web console or the CLI.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/334_OpenShift_cluster_updating_and_CCO_workflows_0523_4.11_A.png" alt="Decision tree showing how to determine the configured CCO credentials mode for your cluster.">
</div>
<div class="title">Figure 1. Determining the CCO configuration</div>
</div>
<div class="sect4">
<h5 id="cco-determine-mode-gui_about-cloud-credential-operator">Determining the Cloud Credential Operator mode by using the web console</h5>
<div class="paragraph">
<p>You can determine what mode the Cloud Credential Operator (CCO) is configured to use by using the web console.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Only Amazon Web Services (AWS), global Microsoft Azure, and Google Cloud Platform (GCP) clusters support multiple CCO modes.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You have access to an OpenShift Container Platform account with cluster administrator permissions.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Log in to the OpenShift Container Platform web console as a user with the <code>cluster-admin</code> role.</p>
</li>
<li>
<p>Navigate to <strong>Administration</strong> &#8594; <strong>Cluster Settings</strong>.</p>
</li>
<li>
<p>On the <strong>Cluster Settings</strong> page, select the <strong>Configuration</strong> tab.</p>
</li>
<li>
<p>Under <strong>Configuration resource</strong>, select <strong>CloudCredential</strong>.</p>
</li>
<li>
<p>On the <strong>CloudCredential details</strong> page, select the <strong>YAML</strong> tab.</p>
</li>
<li>
<p>In the YAML block, check the value of <code>spec.credentialsMode</code>. The following values are possible, though not all are supported on all platforms:</p>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p><code>''</code>: The CCO is operating in the default mode. In this configuration, the CCO operates in mint or passthrough mode, depending on the credentials provided during installation.</p>
</li>
<li>
<p><code>Mint</code>: The CCO is operating in mint mode.</p>
</li>
<li>
<p><code>Passthrough</code>: The CCO is operating in passthrough mode.</p>
</li>
<li>
<p><code>Manual</code>: The CCO is operating in manual mode.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>To determine the specific configuration of an AWS or GCP cluster that has a <code>spec.credentialsMode</code> of <code>''</code>, <code>Mint</code>, or <code>Manual</code>, you must investigate further.</p>
</div>
<div class="paragraph">
<p>AWS and GCP clusters support using mint mode with the root secret deleted.</p>
</div>
<div class="paragraph">
<p>An AWS or GCP cluster that uses manual mode might be configured to create and manage cloud credentials from outside of the cluster using the AWS Security Token Service (STS) or GCP Workload Identity. You can determine whether your cluster uses this strategy by examining the cluster <code>Authentication</code> object.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>AWS or GCP clusters that use the default (<code>''</code>) only: To determine whether the cluster is operating in mint or passthrough mode, inspect the annotations on the cluster root secret:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Navigate to <strong>Workloads</strong> &#8594; <strong>Secrets</strong> and look for the root secret for your cloud provider.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Ensure that the <strong>Project</strong> dropdown is set to <strong>All Projects</strong>.</p>
</div>
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Platform</th>
<th class="tableblock halign-left valign-top">Secret name</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">AWS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>aws-creds</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">GCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>gcp-credentials</code></p></td>
</tr>
</tbody>
</table>
</li>
<li>
<p>To view the CCO mode that the cluster is using, click <code>1 annotation</code> under <strong>Annotations</strong>, and check the value field. The following values are possible:</p>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p><code>Mint</code>: The CCO is operating in mint mode.</p>
</li>
<li>
<p><code>Passthrough</code>: The CCO is operating in passthrough mode.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="paragraph">
<p>If your cluster uses mint mode, you can also determine whether the cluster is operating without the root secret.</p>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>AWS or GCP clusters that use mint mode only: To determine whether the cluster is operating without the root secret, navigate to <strong>Workloads</strong> &#8594; <strong>Secrets</strong> and look for the root secret for your cloud provider.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Ensure that the <strong>Project</strong> dropdown is set to <strong>All Projects</strong>.</p>
</div>
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Platform</th>
<th class="tableblock halign-left valign-top">Secret name</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">AWS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>aws-creds</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">GCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>gcp-credentials</code></p></td>
</tr>
</tbody>
</table>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p>If you see one of these values, your cluster is using mint or passthrough mode with the root secret present.</p>
</li>
<li>
<p>If you do not see these values, your cluster is using the CCO in mint mode with the root secret removed.</p>
</li>
</ul>
</div>
</div>
</div>
</li>
<li>
<p>AWS or GCP clusters that use manual mode only: To determine whether the cluster is configured to create and manage cloud credentials from outside of the cluster, you must check the cluster <code>Authentication</code> object YAML values.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Navigate to <strong>Administration</strong> &#8594; <strong>Cluster Settings</strong>.</p>
</li>
<li>
<p>On the <strong>Cluster Settings</strong> page, select the <strong>Configuration</strong> tab.</p>
</li>
<li>
<p>Under <strong>Configuration resource</strong>, select <strong>Authentication</strong>.</p>
</li>
<li>
<p>On the <strong>Authentication details</strong> page, select the <strong>YAML</strong> tab.</p>
</li>
<li>
<p>In the YAML block, check the value of the <code>.spec.serviceAccountIssuer</code> parameter.</p>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p>A value that contains a URL that is associated with your cloud provider indicates that the CCO is using manual mode with AWS STS or GCP Workload Identity to create and manage cloud credentials from outside of the cluster. These clusters are configured using the <code>ccoctl</code> utility.</p>
</li>
<li>
<p>An empty value (<code>''</code>) indicates that the cluster is using the CCO in manual mode but was not configured using the <code>ccoctl</code> utility.</p>
</li>
</ul>
</div>
</div>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="cco-determine-mode-cli_about-cloud-credential-operator">Determining the Cloud Credential Operator mode by using the CLI</h5>
<div class="paragraph">
<p>You can determine what mode the Cloud Credential Operator (CCO) is configured to use by using the CLI.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Only Amazon Web Services (AWS), global Microsoft Azure, and Google Cloud Platform (GCP) clusters support multiple CCO modes.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You have access to an OpenShift Container Platform account with cluster administrator permissions.</p>
</li>
<li>
<p>You have installed the OpenShift CLI (<code>oc</code>).</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Log in to <code>oc</code> on the cluster as a user with the <code>cluster-admin</code> role.</p>
</li>
<li>
<p>To determine the mode that the CCO is configured to use, enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc get cloudcredentials cluster \
  -o=jsonpath={.spec.credentialsMode}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following output values are possible, though not all are supported on all platforms:</p>
</div>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p><code>''</code>: The CCO is operating in the default mode. In this configuration, the CCO operates in mint or passthrough mode, depending on the credentials provided during installation.</p>
</li>
<li>
<p><code>Mint</code>: The CCO is operating in mint mode.</p>
</li>
<li>
<p><code>Passthrough</code>: The CCO is operating in passthrough mode.</p>
</li>
<li>
<p><code>Manual</code>: The CCO is operating in manual mode.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>To determine the specific configuration of an AWS or GCP cluster that has a <code>spec.credentialsMode</code> of <code>''</code>, <code>Mint</code>, or <code>Manual</code>, you must investigate further.</p>
</div>
<div class="paragraph">
<p>AWS and GCP clusters support using mint mode with the root secret deleted.</p>
</div>
<div class="paragraph">
<p>An AWS or GCP cluster that uses manual mode might be configured to create and manage cloud credentials from outside of the cluster using the AWS Security Token Service (STS) or GCP Workload Identity. You can determine whether your cluster uses this strategy by examining the cluster <code>Authentication</code> object.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>AWS or GCP clusters that use the default (<code>''</code>) only: To determine whether the cluster is operating in mint or passthrough mode, run the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc get secret &lt;secret_name&gt; \
  -n kube-system \
  -o jsonpath \
  --template '{ .metadata.annotations }'</code></pre>
</div>
</div>
<div class="paragraph">
<p>where <code>&lt;secret_name&gt;</code> is <code>aws-creds</code> for AWS or <code>gcp-credentials</code> for GCP.</p>
</div>
<div class="paragraph">
<p>This command displays the value of the <code>.metadata.annotations</code> parameter in the cluster root secret object. The following output values are possible:</p>
</div>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p><code>Mint</code>: The CCO is operating in mint mode.</p>
</li>
<li>
<p><code>Passthrough</code>: The CCO is operating in passthrough mode.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="paragraph">
<p>If your cluster uses mint mode, you can also determine whether the cluster is operating without the root secret.</p>
</div>
</li>
<li>
<p>AWS or GCP clusters that use mint mode only: To determine whether the cluster is operating without the root secret, run the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc get secret &lt;secret_name&gt; \
  -n=kube-system</code></pre>
</div>
</div>
<div class="paragraph">
<p>where <code>&lt;secret_name&gt;</code> is <code>aws-creds</code> for AWS or <code>gcp-credentials</code> for GCP.</p>
</div>
<div class="paragraph">
<p>If the root secret is present, the output of this command returns information about the secret. An error indicates that the root secret is not present on the cluster.</p>
</div>
</li>
<li>
<p>AWS or GCP clusters that use manual mode only: To determine whether the cluster is configured to create and manage cloud credentials from outside of the cluster, run the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc get authentication cluster \
  -o jsonpath \
  --template='{ .spec.serviceAccountIssuer }'</code></pre>
</div>
</div>
<div class="paragraph">
<p>This command displays the value of the <code>.spec.serviceAccountIssuer</code> parameter in the cluster <code>Authentication</code> object.</p>
</div>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p>An output of a URL that is associated with your cloud provider indicates that the CCO is using manual mode with AWS STS or GCP Workload Identity to create and manage cloud credentials from outside of the cluster. These clusters are configured using the <code>ccoctl</code> utility.</p>
</li>
<li>
<p>An empty output indicates that the cluster is using the CCO in manual mode but was not configured using the <code>ccoctl</code> utility.</p>
</li>
</ul>
</div>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="about-cloud-credential-operator-default_about-cloud-credential-operator">Default behavior</h4>
<div class="paragraph">
<p>For platforms on which multiple modes are supported (AWS, Azure, and GCP), when the CCO operates in its default mode, it checks the provided credentials dynamically to determine for which mode they are sufficient to process <code>CredentialsRequest</code> CRs.</p>
</div>
<div class="paragraph">
<p>By default, the CCO determines whether the credentials are sufficient for mint mode, which is the preferred mode of operation, and uses those credentials to create appropriate credentials for components in the cluster. If the credentials are not sufficient for mint mode, it determines whether they are sufficient for passthrough mode. If the credentials are not sufficient for passthrough mode, the CCO cannot adequately process <code>CredentialsRequest</code> CRs.</p>
</div>
<div class="paragraph">
<p>If the provided credentials are determined to be insufficient during installation, the installation fails. For AWS, the installer fails early in the process and indicates which required permissions are missing. Other providers might not provide specific information about the cause of the error until errors are encountered.</p>
</div>
<div class="paragraph">
<p>If the credentials are changed after a successful installation and the CCO determines that the new credentials are insufficient, the CCO puts conditions on any new <code>CredentialsRequest</code> CRs to indicate that it cannot process them because of the insufficient credentials.</p>
</div>
<div class="paragraph">
<p>To resolve insufficient credentials issues, provide a credential with sufficient permissions. If an error occurred during installation, try installing again. For issues with new <code>CredentialsRequest</code> CRs, wait for the CCO to try to process the CR again. As an alternative, you can manually create IAM for <a href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.13/html-single/installing/#manually-creating-iam-aws">AWS</a>, <a href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.13/html-single/installing/#manually-creating-iam-azure">Azure</a>, and <a href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.13/html-single/installing/#manually-creating-iam-gcp">GCP</a>.</p>
</div>
</div>
<div class="sect3 _additional-resources">
<h4 id="additional-resources_about-cloud-credential-operator_about-cloud-credential-operator">Additional resources</h4>
<div class="ulist">
<ul>
<li>
<p><a href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.13/html-single/operators/#cloud-credential-operator_cluster-operators-ref">Cluster Operators reference page for the Cloud Credential Operator</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="cco-mode-mint">Using mint mode</h3>
<div class="paragraph">
<p>Mint mode is supported for Amazon Web Services (AWS) and Google Cloud Platform (GCP).</p>
</div>
<div class="paragraph">
<p>Mint mode is the default mode on the platforms for which it is supported. In this mode, the Cloud Credential Operator (CCO) uses the provided administrator-level cloud credential to create new credentials for components in the cluster with only the specific permissions that are required.</p>
</div>
<div class="paragraph">
<p>If the credential is not removed after installation, it is stored and used by the CCO to process <code>CredentialsRequest</code> CRs for components in the cluster and create new credentials for each with only the specific permissions that are required. The continuous reconciliation of cloud credentials in mint mode allows actions that require additional credentials or permissions, such as upgrading, to proceed.</p>
</div>
<div class="paragraph">
<p>Mint mode stores the administrator-level credential in the cluster <code>kube-system</code> namespace. If this approach does not meet the security requirements of your organization, see <em>Alternatives to storing administrator-level secrets in the kube-system project</em> for <a href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.13/html-single/installing/#alternatives-to-storing-admin-secrets-in-kube-system_manually-creating-iam-aws">AWS</a> or <a href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.13/html-single/installing/#alternatives-to-storing-admin-secrets-in-kube-system_manually-creating-iam-gcp">GCP</a>.</p>
</div>
<div class="sect3">
<h4 id="mint-mode-permissions">Mint mode permissions requirements</h4>
<div class="paragraph">
<p>When using the CCO in mint mode, ensure that the credential you provide meets the requirements of the cloud on which you are running or installing OpenShift Container Platform. If the provided credentials are not sufficient for mint mode, the CCO cannot create an IAM user.</p>
</div>
<div class="sect4">
<h5 id="mint-mode-permissions-aws">Amazon Web Services (AWS) permissions</h5>
<div class="paragraph">
<p>The credential you provide for mint mode in AWS must have the following permissions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>iam:CreateAccessKey</code></p>
</li>
<li>
<p><code>iam:CreateUser</code></p>
</li>
<li>
<p><code>iam:DeleteAccessKey</code></p>
</li>
<li>
<p><code>iam:DeleteUser</code></p>
</li>
<li>
<p><code>iam:DeleteUserPolicy</code></p>
</li>
<li>
<p><code>iam:GetUser</code></p>
</li>
<li>
<p><code>iam:GetUserPolicy</code></p>
</li>
<li>
<p><code>iam:ListAccessKeys</code></p>
</li>
<li>
<p><code>iam:PutUserPolicy</code></p>
</li>
<li>
<p><code>iam:TagUser</code></p>
</li>
<li>
<p><code>iam:SimulatePrincipalPolicy</code></p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="mint-mode-permissions-gcp">Google Cloud Platform (GCP) permissions</h5>
<div class="paragraph">
<p>The credential you provide for mint mode in GCP must have the following permissions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>resourcemanager.projects.get</code></p>
</li>
<li>
<p><code>serviceusage.services.list</code></p>
</li>
<li>
<p><code>iam.serviceAccountKeys.create</code></p>
</li>
<li>
<p><code>iam.serviceAccountKeys.delete</code></p>
</li>
<li>
<p><code>iam.serviceAccounts.create</code></p>
</li>
<li>
<p><code>iam.serviceAccounts.delete</code></p>
</li>
<li>
<p><code>iam.serviceAccounts.get</code></p>
</li>
<li>
<p><code>iam.roles.get</code></p>
</li>
<li>
<p><code>resourcemanager.projects.getIamPolicy</code></p>
</li>
<li>
<p><code>resourcemanager.projects.setIamPolicy</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="admin-credentials-root-secret-formats_cco-mode-mint">Admin credentials root secret format</h4>
<div class="paragraph">
<p>Each cloud provider uses a credentials root secret in the <code>kube-system</code>
namespace by convention, which is then used to satisfy all credentials requests
and create their respective secrets.
This is done either by minting new credentials with <em>mint mode</em>, or by copying the credentials root secret with <em>passthrough mode</em>.</p>
</div>
<div class="paragraph">
<p>The format for the secret varies by cloud, and is also used for each
<code>CredentialsRequest</code> secret.</p>
</div>
<div class="listingblock">
<div class="title">Amazon Web Services (AWS) secret format</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: v1
kind: Secret
metadata:
  namespace: kube-system
  name: aws-creds
stringData:
  aws_access_key_id: &lt;base64-encoded_access_key_id&gt;
  aws_secret_access_key: &lt;base64-encoded_secret_access_key&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Google Cloud Platform (GCP) secret format</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: v1
kind: Secret
metadata:
  namespace: kube-system
  name: gcp-credentials
stringData:
  service_account.json: &lt;base64-encoded_service_account&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="mint-mode-with-removal-or-rotation-of-admin-credential_cco-mode-mint">Mint mode with removal or rotation of the administrator-level credential</h4>
<div class="paragraph">
<p>Currently, this mode is only supported on AWS and GCP.</p>
</div>
<div class="paragraph">
<p>In this mode, a user installs OpenShift Container Platform with an administrator-level credential just like the normal mint mode. However, this process removes the administrator-level credential secret from the cluster post-installation.</p>
</div>
<div class="paragraph">
<p>The administrator can have the Cloud Credential Operator make its own request for a read-only credential that allows it to verify if all <code>CredentialsRequest</code> objects have their required permissions, thus the administrator-level credential is not required unless something needs to be changed. After the associated credential is removed, it can be deleted or deactivated on the underlying cloud, if desired.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Prior to a non z-stream upgrade, you must reinstate the credential secret with the administrator-level credential. If the credential is not present, the upgrade might be blocked.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The administrator-level credential is not stored in the cluster permanently.</p>
</div>
<div class="paragraph">
<p>Following these steps still requires the administrator-level credential in the cluster for brief periods of time. It also requires manually re-instating the secret with administrator-level credentials for each upgrade.</p>
</div>
<div class="sect4">
<h5 id="manually-rotating-cloud-creds_cco-mode-mint">Rotating cloud provider credentials manually</h5>
<div class="paragraph">
<p>If your cloud provider credentials are changed for any reason, you must manually update the secret that the Cloud Credential Operator (CCO) uses to manage cloud provider credentials.</p>
</div>
<div class="paragraph">
<p>The process for rotating cloud credentials depends on the mode that the CCO is configured to use. After you rotate credentials for a cluster that is using mint mode, you must manually remove the component credentials that were created by the removed credential.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Your cluster is installed on a platform that supports rotating cloud credentials manually with the CCO mode that you are using:</p>
<div class="ulist">
<ul>
<li>
<p>For mint mode, Amazon Web Services (AWS) and Google Cloud Platform (GCP) are supported.</p>
</li>
</ul>
</div>
</li>
<li>
<p>You have changed the credentials that are used to interface with your cloud provider.</p>
</li>
<li>
<p>The new credentials have sufficient permissions for the mode CCO is configured to use in your cluster.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the <strong>Administrator</strong> perspective of the web console, navigate to <strong>Workloads</strong> &#8594; <strong>Secrets</strong>.</p>
</li>
<li>
<p>In the table on the <strong>Secrets</strong> page, find the root secret for your cloud provider.</p>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Platform</th>
<th class="tableblock halign-left valign-top">Secret name</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">AWS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>aws-creds</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">GCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>gcp-credentials</code></p></td>
</tr>
</tbody>
</table>
</li>
<li>
<p>Click the <strong>Options</strong> menu <span class="image"><img src="images/kebab.png" alt="kebab" title="Options menu"></span> in the same row as the secret and select <strong>Edit Secret</strong>.</p>
</li>
<li>
<p>Record the contents of the <strong>Value</strong> field or fields. You can use this information to verify that the value is different after updating the credentials.</p>
</li>
<li>
<p>Update the text in the <strong>Value</strong> field or fields with the new authentication information for your cloud provider, and then click <strong>Save</strong>.</p>
</li>
<li>
<p>Delete each component secret that is referenced by the individual <code>CredentialsRequest</code> objects.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Log in to the OpenShift Container Platform CLI as a user with the <code>cluster-admin</code> role.</p>
</li>
<li>
<p>Get the names and namespaces of all referenced component secrets:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc -n openshift-cloud-credential-operator get CredentialsRequest \
  -o json | jq -r '.items[] | select (.spec.providerSpec.kind=="&lt;provider_spec&gt;") | .spec.secretRef'</code></pre>
</div>
</div>
<div class="paragraph">
<p>where <code>&lt;provider_spec&gt;</code> is the corresponding value for your cloud provider:</p>
</div>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p>AWS: <code>AWSProviderSpec</code></p>
</li>
<li>
<p>GCP: <code>GCPProviderSpec</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="listingblock">
<div class="title">Partial example output for AWS</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-json" data-lang="json">{
  "name": "ebs-cloud-credentials",
  "namespace": "openshift-cluster-csi-drivers"
}
{
  "name": "cloud-credential-operator-iam-ro-creds",
  "namespace": "openshift-cloud-credential-operator"
}</code></pre>
</div>
</div>
</li>
<li>
<p>Delete each of the referenced component secrets:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc delete secret &lt;secret_name&gt; \//<b class="conum">(1)</b>
  -n &lt;secret_namespace&gt; <b class="conum">(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Specify the name of a secret.</p>
</li>
<li>
<p>Specify the namespace that contains the secret.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="title">Example deletion of an AWS secret</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc delete secret ebs-cloud-credentials -n openshift-cluster-csi-drivers</code></pre>
</div>
</div>
<div class="paragraph">
<p>You do not need to manually delete the credentials from your provider console. Deleting the referenced component secrets will cause the CCO to delete the existing credentials from the platform and create new ones.</p>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">Verification</div>
<p>To verify that the credentials have changed:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the <strong>Administrator</strong> perspective of the web console, navigate to <strong>Workloads</strong> &#8594; <strong>Secrets</strong>.</p>
</li>
<li>
<p>Verify that the contents of the <strong>Value</strong> field or fields have changed.</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="manually-removing-cloud-creds_cco-mode-mint">Removing cloud provider credentials</h5>
<div class="paragraph">
<p>After installing an OpenShift Container Platform cluster with the Cloud Credential Operator (CCO) in mint mode, you can remove the administrator-level credential secret from the <code>kube-system</code> namespace in the cluster. The administrator-level credential is required only during changes that require its elevated permissions, such as upgrades.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Prior to a non z-stream upgrade, you must reinstate the credential secret with the administrator-level credential. If the credential is not present, the upgrade might be blocked.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Your cluster is installed on a platform that supports removing cloud credentials from the CCO. Supported platforms are AWS and GCP.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the <strong>Administrator</strong> perspective of the web console, navigate to <strong>Workloads</strong> &#8594; <strong>Secrets</strong>.</p>
</li>
<li>
<p>In the table on the <strong>Secrets</strong> page, find the root secret for your cloud provider.</p>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Platform</th>
<th class="tableblock halign-left valign-top">Secret name</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">AWS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>aws-creds</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">GCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>gcp-credentials</code></p></td>
</tr>
</tbody>
</table>
</li>
<li>
<p>Click the <strong>Options</strong> menu <span class="image"><img src="images/kebab.png" alt="kebab" title="Options menu"></span> in the same row as the secret and select <strong>Delete Secret</strong>.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3 _additional-resources">
<h4 id="_additional-resources-2">Additional resources</h4>
<div class="ulist">
<ul>
<li>
<p><a href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.13/html-single/installing/#alternatives-to-storing-admin-secrets-in-kube-system_manually-creating-iam-aws">Alternatives to storing administrator-level secrets in the kube-system project</a> for AWS</p>
</li>
<li>
<p><a href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.13/html-single/installing/#alternatives-to-storing-admin-secrets-in-kube-system_manually-creating-iam-gcp">Alternatives to storing administrator-level secrets in the kube-system project</a> for GCP</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="cco-mode-passthrough">Using passthrough mode</h3>
<div class="paragraph">
<p>Passthrough mode is supported for Amazon Web Services (AWS), Microsoft Azure, Google Cloud Platform (GCP), Red Hat OpenStack Platform (RHOSP), Red Hat Virtualization (RHV), and VMware vSphere.</p>
</div>
<div class="paragraph">
<p>In passthrough mode, the Cloud Credential Operator (CCO) passes the provided cloud credential to the components that request cloud credentials. The credential must have permissions to perform the installation and complete the operations that are required by components in the cluster, but does not need to be able to create new credentials. The CCO does not attempt to create additional limited-scoped credentials in passthrough mode.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p><a href="_managing-cloud-provider-credentials.html#cco-mode-manual">Manual mode</a> is the only supported CCO configuration for Microsoft Azure Stack Hub.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="passthrough-mode-permissions">Passthrough mode permissions requirements</h4>
<div class="paragraph">
<p>When using the CCO in passthrough mode, ensure that the credential you provide meets the requirements of the cloud on which you are running or installing OpenShift Container Platform. If the provided credentials the CCO passes to a component that creates a <code>CredentialsRequest</code> CR are not sufficient, that component will report an error when it tries to call an API that it does not have permissions for.</p>
</div>
<div class="sect4">
<h5 id="passthrough-mode-permissions-aws">Amazon Web Services (AWS) permissions</h5>
<div class="paragraph">
<p>The credential you provide for passthrough mode in AWS must have all the requested permissions for all <code>CredentialsRequest</code> CRs that are required by the version of OpenShift Container Platform you are running or installing.</p>
</div>
<div class="paragraph">
<p>To locate the <code>CredentialsRequest</code> CRs that are required, see <a href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.13/html-single/installing/#manually-creating-iam-aws">Manually creating IAM for AWS</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="passthrough-mode-permissions-azure">Microsoft Azure permissions</h5>
<div class="paragraph">
<p>The credential you provide for passthrough mode in Azure must have all the requested permissions for all <code>CredentialsRequest</code> CRs that are required by the version of OpenShift Container Platform you are running or installing.</p>
</div>
<div class="paragraph">
<p>To locate the <code>CredentialsRequest</code> CRs that are required, see <a href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.13/html-single/installing/#manually-creating-iam-azure">Manually creating IAM for Azure</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="passthrough-mode-permissions-gcp">Google Cloud Platform (GCP) permissions</h5>
<div class="paragraph">
<p>The credential you provide for passthrough mode in GCP must have all the requested permissions for all <code>CredentialsRequest</code> CRs that are required by the version of OpenShift Container Platform you are running or installing.</p>
</div>
<div class="paragraph">
<p>To locate the <code>CredentialsRequest</code> CRs that are required, see <a href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.13/html-single/installing/#manually-creating-iam-gcp">Manually creating IAM for GCP</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="passthrough-mode-permissions-rhosp">Red Hat OpenStack Platform (RHOSP) permissions</h5>
<div class="paragraph">
<p>To install an OpenShift Container Platform cluster on RHOSP, the CCO requires a credential with the permissions of a <code>member</code> user role.</p>
</div>
</div>
<div class="sect4">
<h5 id="passthrough-mode-permissions-rhv">Red Hat Virtualization (RHV) permissions</h5>
<div class="paragraph">
<p>To install an OpenShift Container Platform cluster on RHV, the CCO requires a credential with the following privileges:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>DiskOperator</code></p>
</li>
<li>
<p><code>DiskCreator</code></p>
</li>
<li>
<p><code>UserTemplateBasedVm</code></p>
</li>
<li>
<p><code>TemplateOwner</code></p>
</li>
<li>
<p><code>TemplateCreator</code></p>
</li>
<li>
<p><code>ClusterAdmin</code> on the specific cluster that is targeted for OpenShift Container Platform deployment</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="passthrough-mode-permissions-vsware">VMware vSphere permissions</h5>
<div class="paragraph">
<p>To install an OpenShift Container Platform cluster on VMware vSphere, the CCO requires a credential with the following vSphere privileges:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 7. Required vSphere privileges</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 66.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Category</th>
<th class="tableblock halign-left valign-top">Privileges</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Datastore</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Allocate space</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Folder</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Create folder</em>, <em>Delete folder</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">vSphere Tagging</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">All privileges</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Network</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Assign network</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Resource</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Assign virtual machine to resource pool</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Profile-driven storage</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">All privileges</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">vApp</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">All privileges</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Virtual machine</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">All privileges</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="admin-credentials-root-secret-formats_cco-mode-passthrough">Admin credentials root secret format</h4>
<div class="paragraph">
<p>Each cloud provider uses a credentials root secret in the <code>kube-system</code>
namespace by convention, which is then used to satisfy all credentials requests
and create their respective secrets.
This is done either by minting new credentials with <em>mint mode</em>, or by copying the credentials root secret with <em>passthrough mode</em>.</p>
</div>
<div class="paragraph">
<p>The format for the secret varies by cloud, and is also used for each
<code>CredentialsRequest</code> secret.</p>
</div>
<div class="listingblock">
<div class="title">Amazon Web Services (AWS) secret format</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: v1
kind: Secret
metadata:
  namespace: kube-system
  name: aws-creds
stringData:
  aws_access_key_id: &lt;base64-encoded_access_key_id&gt;
  aws_secret_access_key: &lt;base64-encoded_secret_access_key&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Microsoft Azure secret format</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: v1
kind: Secret
metadata:
  namespace: kube-system
  name: azure-credentials
stringData:
  azure_subscription_id: &lt;base64-encoded_subscription_id&gt;
  azure_client_id: &lt;base64-encoded_client_id&gt;
  azure_client_secret: &lt;base64-encoded_client_secret&gt;
  azure_tenant_id: &lt;base64-encoded_tenant_id&gt;
  azure_resource_prefix: &lt;base64-encoded_resource_prefix&gt;
  azure_resourcegroup: &lt;base64-encoded_resource_group&gt;
  azure_region: &lt;base64-encoded_region&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>On Microsoft Azure, the credentials secret format includes two properties that must contain the cluster&#8217;s infrastructure ID, generated randomly for each cluster installation. This value can be found after running create manifests:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ cat .openshift_install_state.json | jq '."*installconfig.ClusterID".InfraID' -r</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">mycluster-2mpcn</code></pre>
</div>
</div>
<div class="paragraph">
<p>This value would be used in the secret data as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">azure_resource_prefix: mycluster-2mpcn
azure_resourcegroup: mycluster-2mpcn-rg</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Google Cloud Platform (GCP) secret format</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: v1
kind: Secret
metadata:
  namespace: kube-system
  name: gcp-credentials
stringData:
  service_account.json: &lt;base64-encoded_service_account&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Red Hat OpenStack Platform (RHOSP) secret format</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: v1
kind: Secret
metadata:
  namespace: kube-system
  name: openstack-credentials
data:
  clouds.yaml: &lt;base64-encoded_cloud_creds&gt;
  clouds.conf: &lt;base64-encoded_cloud_creds_init&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Red Hat Virtualization (RHV) secret format</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: v1
kind: Secret
metadata:
  namespace: kube-system
  name: ovirt-credentials
data:
  ovirt_url: &lt;base64-encoded_url&gt;
  ovirt_username: &lt;base64-encoded_username&gt;
  ovirt_password: &lt;base64-encoded_password&gt;
  ovirt_insecure: &lt;base64-encoded_insecure&gt;
  ovirt_ca_bundle: &lt;base64-encoded_ca_bundle&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">VMware vSphere secret format</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: v1
kind: Secret
metadata:
  namespace: kube-system
  name: vsphere-creds
data:
 vsphere.openshift.example.com.username: &lt;base64-encoded_username&gt;
 vsphere.openshift.example.com.password: &lt;base64-encoded_password&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="passthrough-mode-maintenance">Passthrough mode credential maintenance</h4>
<div class="paragraph">
<p>If <code>CredentialsRequest</code> CRs change over time as the cluster is upgraded, you must manually update the passthrough mode credential to meet the requirements. To avoid credentials issues during an upgrade, check the <code>CredentialsRequest</code> CRs in the release image for the new version of OpenShift Container Platform before upgrading. To locate the <code>CredentialsRequest</code> CRs that are required for your cloud provider, see <em>Manually creating IAM</em> for <a href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.13/html-single/installing/#manually-creating-iam-aws">AWS</a>, <a href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.13/html-single/installing/#manually-creating-iam-azure">Azure</a>, or <a href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.13/html-single/installing/#manually-creating-iam-gcp">GCP</a>.</p>
</div>
<div class="sect4">
<h5 id="manually-rotating-cloud-creds_cco-mode-passthrough">Rotating cloud provider credentials manually</h5>
<div class="paragraph">
<p>If your cloud provider credentials are changed for any reason, you must manually update the secret that the Cloud Credential Operator (CCO) uses to manage cloud provider credentials.</p>
</div>
<div class="paragraph">
<p>The process for rotating cloud credentials depends on the mode that the CCO is configured to use. After you rotate credentials for a cluster that is using mint mode, you must manually remove the component credentials that were created by the removed credential.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Your cluster is installed on a platform that supports rotating cloud credentials manually with the CCO mode that you are using:</p>
<div class="ulist">
<ul>
<li>
<p>For passthrough mode, Amazon Web Services (AWS), Microsoft Azure, Google Cloud Platform (GCP), Red Hat OpenStack Platform (RHOSP), Red Hat Virtualization (RHV), and VMware vSphere are supported.</p>
</li>
</ul>
</div>
</li>
<li>
<p>You have changed the credentials that are used to interface with your cloud provider.</p>
</li>
<li>
<p>The new credentials have sufficient permissions for the mode CCO is configured to use in your cluster.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the <strong>Administrator</strong> perspective of the web console, navigate to <strong>Workloads</strong> &#8594; <strong>Secrets</strong>.</p>
</li>
<li>
<p>In the table on the <strong>Secrets</strong> page, find the root secret for your cloud provider.</p>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Platform</th>
<th class="tableblock halign-left valign-top">Secret name</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">AWS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>aws-creds</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Azure</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>azure-credentials</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">GCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>gcp-credentials</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">RHOSP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>openstack-credentials</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">RHV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ovirt-credentials</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">VMware vSphere</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>vsphere-creds</code></p></td>
</tr>
</tbody>
</table>
</li>
<li>
<p>Click the <strong>Options</strong> menu <span class="image"><img src="images/kebab.png" alt="kebab" title="Options menu"></span> in the same row as the secret and select <strong>Edit Secret</strong>.</p>
</li>
<li>
<p>Record the contents of the <strong>Value</strong> field or fields. You can use this information to verify that the value is different after updating the credentials.</p>
</li>
<li>
<p>Update the text in the <strong>Value</strong> field or fields with the new authentication information for your cloud provider, and then click <strong>Save</strong>.</p>
</li>
<li>
<p>If you are updating the credentials for a vSphere cluster that does not have the vSphere CSI Driver Operator enabled, you must force a rollout of the Kubernetes controller manager to apply the updated credentials.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>If the vSphere CSI Driver Operator is enabled, this step is not required.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To apply the updated vSphere credentials, log in to the OpenShift Container Platform CLI as a user with the <code>cluster-admin</code> role and run the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc patch kubecontrollermanager cluster \
  -p='{"spec": {"forceRedeploymentReason": "recovery-'"$( date )"'"}}' \
  --type=merge</code></pre>
</div>
</div>
<div class="paragraph">
<p>While the credentials are rolling out, the status of the Kubernetes Controller Manager Operator reports <code>Progressing=true</code>. To view the status, run the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc get co kube-controller-manager</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">Verification</div>
<p>To verify that the credentials have changed:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the <strong>Administrator</strong> perspective of the web console, navigate to <strong>Workloads</strong> &#8594; <strong>Secrets</strong>.</p>
</li>
<li>
<p>Verify that the contents of the <strong>Value</strong> field or fields have changed.</p>
</li>
</ol>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.13/html-single/storage/#vmware-vsphere-csi-driver-operator">vSphere CSI Driver Operator</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="passthrough-mode-reduce-permissions">Reducing permissions after installation</h4>
<div class="paragraph">
<p>When using passthrough mode, each component has the same permissions used by all other components. If you do not reduce the permissions after installing, all components have the broad permissions that are required to run the installer.</p>
</div>
<div class="paragraph">
<p>After installation, you can reduce the permissions on your credential to only those that are required to run the cluster, as defined by the <code>CredentialsRequest</code> CRs in the release image for the version of OpenShift Container Platform that you are using.</p>
</div>
<div class="paragraph">
<p>To locate the <code>CredentialsRequest</code> CRs that are required for AWS, Azure, or GCP and learn how to change the permissions the CCO uses, see <em>Manually creating IAM</em> for <a href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.13/html-single/installing/#manually-creating-iam-aws">AWS</a>, <a href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.13/html-single/installing/#manually-creating-iam-azure">Azure</a>, or <a href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.13/html-single/installing/#manually-creating-iam-gcp">GCP</a>.</p>
</div>
</div>
<div class="sect3 _additional-resources">
<h4 id="_additional-resources-3">Additional resources</h4>
<div class="ulist">
<ul>
<li>
<p><a href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.13/html-single/installing/#manually-creating-iam-aws">Manually creating IAM for AWS</a></p>
</li>
<li>
<p><a href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.13/html-single/installing/#manually-creating-iam-azure">Manually creating IAM for Azure</a></p>
</li>
<li>
<p><a href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.13/html-single/installing/#manually-creating-iam-gcp">Manually creating IAM for GCP</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="cco-mode-manual">Using manual mode</h3>
<div class="paragraph">
<p>Manual mode is supported for Alibaba Cloud, Amazon Web Services (AWS), Microsoft Azure, IBM Cloud, and Google Cloud Platform (GCP).</p>
</div>
<div class="paragraph">
<p>In manual mode, a user manages cloud credentials instead of the Cloud Credential Operator (CCO). To use this mode, you must examine the <code>CredentialsRequest</code> CRs in the release image for the version of OpenShift Container Platform that you are running or installing, create corresponding credentials in the underlying cloud provider, and create Kubernetes Secrets in the correct namespaces to satisfy all <code>CredentialsRequest</code> CRs for the cluster&#8217;s cloud provider.</p>
</div>
<div class="paragraph">
<p>Using manual mode allows each cluster component to have only the permissions it requires, without storing an administrator-level credential in the cluster. This mode also does not require connectivity to the AWS public IAM endpoint. However, you must manually reconcile permissions with new release images for every upgrade.</p>
</div>
<div class="paragraph">
<p>For information about configuring your cloud provider to use manual mode, see the manual credentials management options for your cloud provider:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.13/html-single/installing/#manually-creating-alibaba-ram">Manually creating RAM resources for Alibaba Cloud</a></p>
</li>
<li>
<p><a href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.13/html-single/installing/#manually-creating-iam-aws">Manually creating IAM for AWS</a></p>
</li>
<li>
<p><a href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.13/html-single/installing/#manually-creating-iam-azure">Manually creating IAM for Azure</a></p>
</li>
<li>
<p><a href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.13/html-single/installing/#manually-creating-iam-gcp">Manually creating IAM for GCP</a></p>
</li>
<li>
<p><a href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.13/html-single/installing/#configuring-iam-ibm-cloud">Configuring IAM for IBM Cloud</a></p>
</li>
<li>
<p><a href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.13/html-single/installing/#manually-create-iam-nutanix_installing-nutanix-installer-provisioned">Configuring IAM for Nutanix</a></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="manual-mode-sts-blurb">Manual mode with cloud credentials created and managed outside of the cluster</h4>
<div class="paragraph">
<p>An AWS or GCP cluster that uses manual mode might be configured to create and manage cloud credentials from outside of the cluster using the AWS Security Token Service (STS) or GCP Workload Identity. With this configuration, the CCO uses temporary credentials for different components.</p>
</div>
<div class="paragraph">
<p>For more information, see <a href="_managing-cloud-provider-credentials.html#cco-mode-sts">Using manual mode with Amazon Web Services Security Token Service</a> or <a href="_managing-cloud-provider-credentials.html#cco-mode-gcp-workload-identity">Using manual mode with GCP Workload Identity</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="manually-maintained-credentials-upgrade_cco-mode-manual">Updating cloud provider resources with manually maintained credentials</h4>
<div class="paragraph">
<p>Before upgrading a cluster with manually maintained credentials, you must create any new credentials for the release image that you are upgrading to. You must also review the required permissions for existing credentials and accommodate any new permissions requirements in the new release for those components.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Extract and examine the <code>CredentialsRequest</code> custom resource for the new release.</p>
<div class="paragraph">
<p>The "Manually creating IAM" section of the installation content for your cloud provider explains how to obtain and use the credentials required for your cloud.</p>
</div>
</li>
<li>
<p>Update the manually maintained credentials on your cluster:</p>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p>Create new secrets for any <code>CredentialsRequest</code> custom resources that are added by the new release image.</p>
</li>
<li>
<p>If the <code>CredentialsRequest</code> custom resources for any existing credentials that are stored in secrets have changed permissions requirements, update the permissions as required.</p>
</li>
</ul>
</div>
</div>
</div>
</li>
<li>
<p>If your cluster uses cluster capabilities to disable one or more optional components, delete the <code>CredentialsRequest</code> custom resources for any disabled components.</p>
<div class="listingblock">
<div class="title">Example <code>credrequests</code> directory contents for OpenShift Container Platform 4.12 on AWS</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">0000_30_machine-api-operator_00_credentials-request.yaml <b class="conum">(1)</b>
0000_50_cloud-credential-operator_05-iam-ro-credentialsrequest.yaml <b class="conum">(2)</b>
0000_50_cluster-image-registry-operator_01-registry-credentials-request.yaml <b class="conum">(3)</b>
0000_50_cluster-ingress-operator_00-ingress-credentials-request.yaml <b class="conum">(4)</b>
0000_50_cluster-network-operator_02-cncc-credentials.yaml <b class="conum">(5)</b>
0000_50_cluster-storage-operator_03_credentials_request_aws.yaml <b class="conum">(6)</b></code></pre>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="colist arabic">
<ol>
<li>
<p>The Machine API Operator CR is required.</p>
</li>
<li>
<p>The Cloud Credential Operator CR is required.</p>
</li>
<li>
<p>The Image Registry Operator CR is required.</p>
</li>
<li>
<p>The Ingress Operator CR is required.</p>
</li>
<li>
<p>The Network Operator CR is required.</p>
</li>
<li>
<p>The Storage Operator CR is an optional component and might be disabled in your cluster.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="listingblock">
<div class="title">Example <code>credrequests</code> directory contents for OpenShift Container Platform 4.12 on GCP</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">0000_26_cloud-controller-manager-operator_16_credentialsrequest-gcp.yaml <b class="conum">(1)</b>
0000_30_machine-api-operator_00_credentials-request.yaml <b class="conum">(2)</b>
0000_50_cloud-credential-operator_05-gcp-ro-credentialsrequest.yaml <b class="conum">(3)</b>
0000_50_cluster-image-registry-operator_01-registry-credentials-request-gcs.yaml <b class="conum">(4)</b>
0000_50_cluster-ingress-operator_00-ingress-credentials-request.yaml <b class="conum">(5)</b>
0000_50_cluster-network-operator_02-cncc-credentials.yaml <b class="conum">(6)</b>
0000_50_cluster-storage-operator_03_credentials_request_gcp.yaml <b class="conum">(7)</b></code></pre>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="colist arabic">
<ol>
<li>
<p>The Cloud Controller Manager Operator CR is required.</p>
</li>
<li>
<p>The Machine API Operator CR is required.</p>
</li>
<li>
<p>The Cloud Credential Operator CR is required.</p>
</li>
<li>
<p>The Image Registry Operator CR is required.</p>
</li>
<li>
<p>The Ingress Operator CR is required.</p>
</li>
<li>
<p>The Network Operator CR is required.</p>
</li>
<li>
<p>The Storage Operator CR is an optional component and might be disabled in your cluster.</p>
</li>
</ol>
</div>
</div>
</div>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Next steps</div>
<ul>
<li>
<p>Update the <code>upgradeable-to</code> annotation to indicate that the cluster is ready to upgrade.</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="cco-manual-upgrade-annotation_cco-mode-manual">Indicating that the cluster is ready to upgrade</h5>
<div class="paragraph">
<p>The Cloud Credential Operator (CCO) <code>Upgradable</code> status for a cluster with manually maintained credentials is <code>False</code> by default.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>For the release image that you are upgrading to, you have processed any new credentials manually or by using the Cloud Credential Operator utility (<code>ccoctl</code>).</p>
</li>
<li>
<p>You have installed the OpenShift CLI (<code>oc</code>).</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Log in to <code>oc</code> on the cluster as a user with the <code>cluster-admin</code> role.</p>
</li>
<li>
<p>Edit the <code>CloudCredential</code> resource to add an <code>upgradeable-to</code> annotation within the <code>metadata</code> field by running the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc edit cloudcredential cluster</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Text to add</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">...
  metadata:
    annotations:
      cloudcredential.openshift.io/upgradeable-to: &lt;version_number&gt;
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>Where <code>&lt;version_number&gt;</code> is the version that you are upgrading to, in the format <code>x.y.z</code>. For example, use <code>4.12.2</code> for OpenShift Container Platform 4.12.2.</p>
</div>
<div class="paragraph">
<p>It may take several minutes after adding the annotation for the upgradeable status to change.</p>
</div>
</li>
</ol>
</div>
<div class="olist arabic">
<div class="title">Verification</div>
<ol class="arabic">
<li>
<p>In the <strong>Administrator</strong> perspective of the web console, navigate to <strong>Administration</strong> &#8594; <strong>Cluster Settings</strong>.</p>
</li>
<li>
<p>To view the CCO status details, click <strong>cloud-credential</strong> in the <strong>Cluster Operators</strong> list.</p>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p>If the <strong>Upgradeable</strong> status in the <strong>Conditions</strong> section is <strong>False</strong>, verify that the <code>upgradeable-to</code> annotation is free of typographical errors.</p>
</li>
</ul>
</div>
</div>
</div>
</li>
<li>
<p>When the <strong>Upgradeable</strong> status in the <strong>Conditions</strong> section is <strong>True</strong>, begin the OpenShift Container Platform upgrade.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3 _additional-resources">
<h4 id="additional-resources_cco-mode-manual">Additional resources</h4>
<div class="ulist">
<ul>
<li>
<p><a href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.13/html-single/installing/#manually-creating-alibaba-ram">Manually creating RAM resources for Alibaba Cloud</a></p>
</li>
<li>
<p><a href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.13/html-single/installing/#manually-creating-iam-aws">Manually creating IAM for AWS</a></p>
</li>
<li>
<p><a href="_managing-cloud-provider-credentials.html#cco-mode-sts">Using manual mode with Amazon Web Services Security Token Service</a></p>
</li>
<li>
<p><a href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.13/html-single/installing/#manually-creating-iam-azure">Manually creating IAM for Azure</a></p>
</li>
<li>
<p><a href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.13/html-single/installing/#manually-creating-iam-gcp">Manually creating IAM for GCP</a></p>
</li>
<li>
<p><a href="_managing-cloud-provider-credentials.html#cco-mode-gcp-workload-identity">Using manual mode with GCP Workload Identity</a></p>
</li>
<li>
<p><a href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.13/html-single/installing/#configuring-iam-ibm-cloud">Configuring IAM for IBM Cloud</a></p>
</li>
<li>
<p><a href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.13/html-single/installing/#manually-create-iam-nutanix_installing-nutanix-installer-provisioned">Configuring IAM for Nutanix</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="cco-mode-sts">Using manual mode with Amazon Web Services Security Token Service</h3>
<div class="paragraph">
<p>Manual mode with STS is supported for Amazon Web Services (AWS).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>This credentials strategy is supported for only new OpenShift Container Platform clusters and must be configured during installation. You cannot reconfigure an existing cluster that uses a different credentials strategy to use this feature.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="sts-mode-about_cco-mode-sts">About manual mode with AWS Security Token Service</h4>
<div class="paragraph">
<p>In manual mode with STS, the individual OpenShift Container Platform cluster components use AWS Security Token Service (STS) to assign components IAM roles that provide short-term, limited-privilege security credentials. These credentials are associated with IAM roles that are specific to each component that makes AWS API calls.</p>
</div>
<div class="paragraph">
<p>Requests for new and refreshed credentials are automated by using an appropriately configured AWS IAM OpenID Connect (OIDC) identity provider, combined with AWS IAM roles. OpenShift Container Platform signs service account tokens that are trusted by AWS IAM, and can be projected into a pod and used for authentication. Tokens are refreshed after one hour.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/142_OpenShift_credentials_STS_0221.png" alt="Detailed authentication flow between AWS and the cluster when using AWS STS">
</div>
<div class="title">Figure 2. STS authentication flow</div>
</div>
<div class="paragraph">
<p>Using manual mode with STS changes the content of the AWS credentials that are provided to individual OpenShift Container Platform components.</p>
</div>
<div class="listingblock">
<div class="title">AWS secret format using long-lived credentials</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: v1
kind: Secret
metadata:
  namespace: &lt;target-namespace&gt; <b class="conum">(1)</b>
  name: &lt;target-secret-name&gt; <b class="conum">(2)</b>
data:
  aws_access_key_id: &lt;base64-encoded-access-key-id&gt;
  aws_secret_access_key: &lt;base64-encoded-secret-access-key&gt;</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The namespace for the component.</p>
</li>
<li>
<p>The name of the component secret.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="title">AWS secret format with STS</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: v1
kind: Secret
metadata:
  namespace: &lt;target-namespace&gt; <b class="conum">(1)</b>
  name: &lt;target-secret-name&gt; <b class="conum">(2)</b>
stringData:
  credentials: |-
    [default]
    sts_regional_endpoints = regional
    role_name: &lt;operator-role-name&gt; <b class="conum">(3)</b>
    web_identity_token_file: &lt;path-to-token&gt; <b class="conum">(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The namespace for the component.</p>
</li>
<li>
<p>The name of the component secret.</p>
</li>
<li>
<p>The IAM role for the component.</p>
</li>
<li>
<p>The path to the service account token inside the pod. By convention, this is <code>/var/run/secrets/openshift/serviceaccount/token</code> for OpenShift Container Platform components.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="sts-mode-installing_cco-mode-sts">Installing an OpenShift Container Platform cluster configured for manual mode with STS</h4>
<div class="paragraph">
<p>To install a cluster that is configured to use the Cloud Credential Operator (CCO) in manual mode with STS:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="_managing-cloud-provider-credentials.html#cco-ccoctl-configuring_cco-mode-sts">Configure the Cloud Credential Operator utility</a>.</p>
</li>
<li>
<p>Create the required AWS resources <a href="_managing-cloud-provider-credentials.html#cco-ccoctl-creating-individually_cco-mode-sts">individually</a>, or <a href="_managing-cloud-provider-credentials.html#cco-ccoctl-creating-at-once_cco-mode-sts">with a single command</a>.</p>
</li>
<li>
<p><a href="_managing-cloud-provider-credentials.html#sts-mode-installing-manual-run-installer_cco-mode-sts">Run the OpenShift Container Platform installer</a>.</p>
</li>
<li>
<p><a href="_managing-cloud-provider-credentials.html#sts-mode-installing-verifying_cco-mode-sts">Verify that the cluster is using short-lived credentials</a>.</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Because the cluster is operating in manual mode when using STS, it is not able to create new credentials for components with the permissions that they require. When upgrading to a different minor version of OpenShift Container Platform, there are often new AWS permission requirements. Before upgrading a cluster that is using STS, the cluster administrator must manually ensure that the AWS permissions are sufficient for existing components and available to any new components.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.13/html-single/updating_clusters/#cco-ccoctl-configuring_preparing-manual-creds-update">Configuring the Cloud Credential Operator utility for a cluster update</a></p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="cco-ccoctl-configuring_cco-mode-sts">Configuring the Cloud Credential Operator utility</h5>
<div class="paragraph">
<p>To create and manage cloud credentials from outside of the cluster when the Cloud Credential Operator (CCO) is operating in manual mode, extract and prepare the CCO utility (<code>ccoctl</code>) binary.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>ccoctl</code> utility is a Linux binary that must run in a Linux environment.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You have access to an OpenShift Container Platform account with cluster administrator access.</p>
</li>
<li>
<p>You have installed the OpenShift CLI (<code>oc</code>).</p>
</li>
</ul>
</div>
<div class="ulist">
<ul>
<li>
<p>You have created an AWS account for the <code>ccoctl</code> utility to use with the following permissions:</p>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 8. Required AWS permissions</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Permission type</th>
<th class="tableblock halign-left valign-top">Required permissions</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>iam</code> permissions</p>
</div>
<div class="ulist">
<ul>
</ul>
</div>
<div class="paragraph nav-footer">
<p></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p><code>iam:CreateOpenIDConnectProvider</code></p>
</li>
<li>
<p><code>iam:CreateRole</code></p>
</li>
<li>
<p><code>iam:DeleteOpenIDConnectProvider</code></p>
</li>
<li>
<p><code>iam:DeleteRole</code></p>
</li>
<li>
<p><code>iam:DeleteRolePolicy</code></p>
</li>
<li>
<p><code>iam:GetOpenIDConnectProvider</code></p>
</li>
<li>
<p><code>iam:GetRole</code></p>
</li>
<li>
<p><code>iam:GetUser</code></p>
</li>
<li>
<p><code>iam:ListOpenIDConnectProviders</code></p>
</li>
<li>
<p><code>iam:ListRolePolicies</code></p>
</li>
<li>
<p><code>iam:ListRoles</code></p>
</li>
<li>
<p><code>iam:PutRolePolicy</code></p>
</li>
<li>
<p><code>iam:TagOpenIDConnectProvider</code></p>
</li>
<li>
<p><code>iam:TagRole</code></p>
</li>
</ul>
</div>
<div class="ulist">
<ul>
</ul>
</div>
<div class="paragraph nav-footer">
<p></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>s3</code> permissions</p>
</div>
<div class="ulist">
<ul>
</ul>
</div>
<div class="paragraph nav-footer">
<p></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p><code>s3:CreateBucket</code></p>
</li>
<li>
<p><code>s3:DeleteBucket</code></p>
</li>
<li>
<p><code>s3:DeleteObject</code></p>
</li>
<li>
<p><code>s3:GetBucketAcl</code></p>
</li>
<li>
<p><code>s3:GetBucketTagging</code></p>
</li>
<li>
<p><code>s3:GetObject</code></p>
</li>
<li>
<p><code>s3:GetObjectAcl</code></p>
</li>
<li>
<p><code>s3:GetObjectTagging</code></p>
</li>
<li>
<p><code>s3:ListBucket</code></p>
</li>
<li>
<p><code>s3:PutBucketAcl</code></p>
</li>
<li>
<p><code>s3:PutBucketPolicy</code></p>
</li>
<li>
<p><code>s3:PutBucketPublicAccessBlock</code></p>
</li>
<li>
<p><code>s3:PutBucketTagging</code></p>
</li>
<li>
<p><code>s3:PutObject</code></p>
</li>
<li>
<p><code>s3:PutObjectAcl</code></p>
</li>
<li>
<p><code>s3:PutObjectTagging</code></p>
</li>
</ul>
</div>
<div class="ulist">
<ul>
</ul>
</div>
<div class="paragraph nav-footer">
<p></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>cloudfront</code> permissions</p>
</div>
<div class="ulist">
<ul>
</ul>
</div>
<div class="paragraph nav-footer">
<p></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p><code>cloudfront:ListCloudFrontOriginAccessIdentities</code></p>
</li>
<li>
<p><code>cloudfront:ListDistributions</code></p>
</li>
<li>
<p><code>cloudfront:ListTagsForResource</code></p>
</li>
</ul>
</div>
<div class="ulist">
<ul>
</ul>
</div>
<div class="paragraph nav-footer">
<p></p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>If you plan to store the OIDC configuration in a private S3 bucket that is accessed by the IAM identity provider through a public CloudFront distribution URL, the AWS account that runs the <code>ccoctl</code> utility requires the following additional permissions:</p>
</div>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p><code>cloudfront:CreateCloudFrontOriginAccessIdentity</code></p>
</li>
<li>
<p><code>cloudfront:CreateDistribution</code></p>
</li>
<li>
<p><code>cloudfront:DeleteCloudFrontOriginAccessIdentity</code></p>
</li>
<li>
<p><code>cloudfront:DeleteDistribution</code></p>
</li>
<li>
<p><code>cloudfront:GetCloudFrontOriginAccessIdentity</code></p>
</li>
<li>
<p><code>cloudfront:GetCloudFrontOriginAccessIdentityConfig</code></p>
</li>
<li>
<p><code>cloudfront:GetDistribution</code></p>
</li>
<li>
<p><code>cloudfront:TagResource</code></p>
</li>
<li>
<p><code>cloudfront:UpdateDistribution</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>These additional permissions support the use of the <code>--create-private-s3-bucket</code> option when processing credentials requests with the <code>ccoctl aws create-all</code> command.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Obtain the OpenShift Container Platform release image by running the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ RELEASE_IMAGE=$(./openshift-install version | awk '/release image/ {print $3}')</code></pre>
</div>
</div>
</li>
<li>
<p>Obtain the CCO container image from the OpenShift Container Platform release image by running the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ CCO_IMAGE=$(oc adm release info --image-for='cloud-credential-operator' $RELEASE_IMAGE -a ~/.pull-secret)</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Ensure that the architecture of the <code>$RELEASE_IMAGE</code> matches the architecture of the environment in which you will use the <code>ccoctl</code> tool.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Extract the <code>ccoctl</code> binary from the CCO container image within the OpenShift Container Platform release image by running the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc image extract $CCO_IMAGE --file="/usr/bin/ccoctl" -a ~/.pull-secret</code></pre>
</div>
</div>
</li>
<li>
<p>Change the permissions to make <code>ccoctl</code> executable by running the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ chmod 775 ccoctl</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Verification</div>
<ul>
<li>
<p>To verify that <code>ccoctl</code> is ready to use, display the help file by running the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ ccoctl --help</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Output of <code>ccoctl --help</code></div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">OpenShift credentials provisioning tool

Usage:
  ccoctl [command]

Available Commands:
  alibabacloud Manage credentials objects for alibaba cloud
  aws          Manage credentials objects for AWS cloud
  gcp          Manage credentials objects for Google cloud
  help         Help about any command
  ibmcloud     Manage credentials objects for IBM Cloud
  nutanix      Manage credentials objects for Nutanix

Flags:
  -h, --help   help for ccoctl

Use "ccoctl [command] --help" for more information about a command.</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="sts-mode-create-aws-resources-ccoctl_cco-mode-sts">Creating AWS resources with the Cloud Credential Operator utility</h5>
<div class="paragraph">
<p>You can use the CCO utility (<code>ccoctl</code>) to create the required AWS resources <a href="_managing-cloud-provider-credentials.html#cco-ccoctl-creating-individually_cco-mode-sts">individually</a>, or <a href="_managing-cloud-provider-credentials.html#cco-ccoctl-creating-at-once_cco-mode-sts">with a single command</a>.</p>
</div>
<div class="sect5">
<h6 id="cco-ccoctl-creating-individually_cco-mode-sts">Creating AWS resources individually</h6>
<div class="paragraph">
<p>If you need to review the JSON files that the <code>ccoctl</code> tool creates before modifying AWS resources, or if the process the <code>ccoctl</code> tool uses to create AWS resources automatically does not meet the requirements of your organization, you can create the AWS resources individually. For example, this option might be useful for an organization that shares the responsibility for creating these resources among different users or departments.</p>
</div>
<div class="paragraph">
<p>Otherwise, you can use the <code>ccoctl aws create-all</code> command to create the AWS resources automatically.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>By default, <code>ccoctl</code> creates objects in the directory in which the commands are run. To create the objects in a different directory, use the <code>--output-dir</code> flag. This procedure uses <code>&lt;path_to_ccoctl_output_dir&gt;</code> to refer to this directory.</p>
</div>
<div class="paragraph">
<p>Some <code>ccoctl</code> commands make AWS API calls to create or modify AWS resources. You can use the <code>--dry-run</code> flag to avoid making API calls. Using this flag creates JSON files on the local file system instead. You can review and modify the JSON files and then apply them with the AWS CLI tool using the <code>--cli-input-json</code> parameters.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Extract and prepare the <code>ccoctl</code> binary.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Generate the public and private RSA key files that are used to set up the OpenID Connect provider for the cluster:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ ccoctl aws create-key-pair</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output:</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">2021/04/13 11:01:02 Generating RSA keypair
2021/04/13 11:01:03 Writing private key to /&lt;path_to_ccoctl_output_dir&gt;/serviceaccount-signer.private
2021/04/13 11:01:03 Writing public key to /&lt;path_to_ccoctl_output_dir&gt;/serviceaccount-signer.public
2021/04/13 11:01:03 Copying signing key for use by installer</code></pre>
</div>
</div>
<div class="paragraph">
<p>where <code>serviceaccount-signer.private</code> and <code>serviceaccount-signer.public</code> are the generated key files.</p>
</div>
<div class="paragraph">
<p>This command also creates a private key that the cluster requires during installation in <code>/&lt;path_to_ccoctl_output_dir&gt;/tls/bound-service-account-signing-key.key</code>.</p>
</div>
</li>
<li>
<p>Create an OpenID Connect identity provider and S3 bucket on AWS:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ ccoctl aws create-identity-provider \
--name=&lt;name&gt; \
--region=&lt;aws_region&gt; \
--public-key-file=&lt;path_to_ccoctl_output_dir&gt;/serviceaccount-signer.public</code></pre>
</div>
</div>
<div class="paragraph">
<p>where:</p>
</div>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p><code>&lt;name&gt;</code> is the name used to tag any cloud resources that are created for tracking.</p>
</li>
<li>
<p><code>&lt;aws-region&gt;</code> is the AWS region in which cloud resources will be created.</p>
</li>
<li>
<p><code>&lt;path_to_ccoctl_output_dir&gt;</code> is the path to the public key file that the <code>ccoctl aws create-key-pair</code> command generated.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="listingblock">
<div class="title">Example output:</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">2021/04/13 11:16:09 Bucket &lt;name&gt;-oidc created
2021/04/13 11:16:10 OpenID Connect discovery document in the S3 bucket &lt;name&gt;-oidc at .well-known/openid-configuration updated
2021/04/13 11:16:10 Reading public key
2021/04/13 11:16:10 JSON web key set (JWKS) in the S3 bucket &lt;name&gt;-oidc at keys.json updated
2021/04/13 11:16:18 Identity Provider created with ARN: arn:aws:iam::&lt;aws_account_id&gt;:oidc-provider/&lt;name&gt;-oidc.s3.&lt;aws_region&gt;.amazonaws.com</code></pre>
</div>
</div>
<div class="paragraph">
<p>where <code>openid-configuration</code> is a discovery document and <code>keys.json</code> is a JSON web key set file.</p>
</div>
<div class="paragraph">
<p>This command also creates a YAML configuration file in <code>/&lt;path_to_ccoctl_output_dir&gt;/manifests/cluster-authentication-02-config.yaml</code>. This file sets the issuer URL field for the service account tokens that the cluster generates, so that the AWS IAM identity provider trusts the tokens.</p>
</div>
</li>
<li>
<p>Create IAM roles for each component in the cluster.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Extract the list of <code>CredentialsRequest</code> objects from the OpenShift Container Platform release image:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc adm release extract --credentials-requests \
--cloud=aws \
--to=&lt;path_to_directory_with_list_of_credentials_requests&gt;/credrequests <b class="conum">(1)</b>
--from=quay.io/&lt;path_to&gt;/ocp-release:&lt;version&gt;</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p><code>credrequests</code> is the directory where the list of <code>CredentialsRequest</code> objects is stored. This command creates the directory if it does not exist.</p>
</li>
</ol>
</div>
</li>
<li>
<p>If your cluster uses cluster capabilities to disable one or more optional components, delete the <code>CredentialsRequest</code> custom resources for any disabled components.</p>
<div class="listingblock">
<div class="title">Example <code>credrequests</code> directory contents for OpenShift Container Platform 4.12 on AWS</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">0000_30_machine-api-operator_00_credentials-request.yaml <b class="conum">(1)</b>
0000_50_cloud-credential-operator_05-iam-ro-credentialsrequest.yaml <b class="conum">(2)</b>
0000_50_cluster-image-registry-operator_01-registry-credentials-request.yaml <b class="conum">(3)</b>
0000_50_cluster-ingress-operator_00-ingress-credentials-request.yaml <b class="conum">(4)</b>
0000_50_cluster-network-operator_02-cncc-credentials.yaml <b class="conum">(5)</b>
0000_50_cluster-storage-operator_03_credentials_request_aws.yaml <b class="conum">(6)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The Machine API Operator CR is required.</p>
</li>
<li>
<p>The Cloud Credential Operator CR is required.</p>
</li>
<li>
<p>The Image Registry Operator CR is required.</p>
</li>
<li>
<p>The Ingress Operator CR is required.</p>
</li>
<li>
<p>The Network Operator CR is required.</p>
</li>
<li>
<p>The Storage Operator CR is an optional component and might be disabled in your cluster.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Use the <code>ccoctl</code> tool to process all <code>CredentialsRequest</code> objects in the <code>credrequests</code> directory:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ ccoctl aws create-iam-roles \
--name=&lt;name&gt; \
--region=&lt;aws_region&gt; \
--credentials-requests-dir=&lt;path_to_directory_with_list_of_credentials_requests&gt;/credrequests \
--identity-provider-arn=arn:aws:iam::&lt;aws_account_id&gt;:oidc-provider/&lt;name&gt;-oidc.s3.&lt;aws_region&gt;.amazonaws.com</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>For AWS environments that use alternative IAM API endpoints, such as GovCloud, you must also specify your region with the <code>--region</code> parameter.</p>
</div>
<div class="paragraph">
<p>If your cluster uses Technology Preview features that are enabled by the <code>TechPreviewNoUpgrade</code> feature set, you must include the <code>--enable-tech-preview</code> parameter.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For each <code>CredentialsRequest</code> object, <code>ccoctl</code> creates an IAM role with a trust policy that is tied to the specified OIDC identity provider, and a permissions policy as defined in each <code>CredentialsRequest</code> object from the OpenShift Container Platform release image.</p>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Verification</div>
<ul>
<li>
<p>To verify that the OpenShift Container Platform secrets are created, list the files in the <code>&lt;path_to_ccoctl_output_dir&gt;/manifests</code> directory:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ ll &lt;path_to_ccoctl_output_dir&gt;/manifests</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output:</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">total 24
-rw-------. 1 &lt;user&gt; &lt;user&gt; 161 Apr 13 11:42 cluster-authentication-02-config.yaml
-rw-------. 1 &lt;user&gt; &lt;user&gt; 379 Apr 13 11:59 openshift-cloud-credential-operator-cloud-credential-operator-iam-ro-creds-credentials.yaml
-rw-------. 1 &lt;user&gt; &lt;user&gt; 353 Apr 13 11:59 openshift-cluster-csi-drivers-ebs-cloud-credentials-credentials.yaml
-rw-------. 1 &lt;user&gt; &lt;user&gt; 355 Apr 13 11:59 openshift-image-registry-installer-cloud-credentials-credentials.yaml
-rw-------. 1 &lt;user&gt; &lt;user&gt; 339 Apr 13 11:59 openshift-ingress-operator-cloud-credentials-credentials.yaml
-rw-------. 1 &lt;user&gt; &lt;user&gt; 337 Apr 13 11:59 openshift-machine-api-aws-cloud-credentials-credentials.yaml</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can verify that the IAM roles are created by querying AWS. For more information, refer to AWS documentation on listing IAM roles.</p>
</div>
</div>
<div class="sect5">
<h6 id="cco-ccoctl-creating-at-once_cco-mode-sts">Creating AWS resources with a single command</h6>
<div class="paragraph">
<p>If you do not need to review the JSON files that the <code>ccoctl</code> tool creates before modifying AWS resources, and if the process the <code>ccoctl</code> tool uses to create AWS resources automatically meets the requirements of your organization, you can use the <code>ccoctl aws create-all</code> command to automate the creation of AWS resources.</p>
</div>
<div class="paragraph">
<p>Otherwise, you can create the AWS resources individually.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>By default, <code>ccoctl</code> creates objects in the directory in which the commands are run. To create the objects in a different directory, use the <code>--output-dir</code> flag. This procedure uses <code>&lt;path_to_ccoctl_output_dir&gt;</code> to refer to this directory.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<div class="title">Prerequisites</div>
<p>You must have:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Extracted and prepared the <code>ccoctl</code> binary.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Extract the list of <code>CredentialsRequest</code> objects from the OpenShift Container Platform release image by running the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc adm release extract \
--credentials-requests \
--cloud=aws \
--to=&lt;path_to_directory_with_list_of_credentials_requests&gt;/credrequests \ <b class="conum">(1)</b>
--from=quay.io/&lt;path_to&gt;/ocp-release:&lt;version&gt;</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p><code>credrequests</code> is the directory where the list of <code>CredentialsRequest</code> objects is stored. This command creates the directory if it does not exist.</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>This command can take a few moments to run.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>If your cluster uses cluster capabilities to disable one or more optional components, delete the <code>CredentialsRequest</code> custom resources for any disabled components.</p>
<div class="listingblock">
<div class="title">Example <code>credrequests</code> directory contents for OpenShift Container Platform 4.12 on AWS</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">0000_30_machine-api-operator_00_credentials-request.yaml <b class="conum">(1)</b>
0000_50_cloud-credential-operator_05-iam-ro-credentialsrequest.yaml <b class="conum">(2)</b>
0000_50_cluster-image-registry-operator_01-registry-credentials-request.yaml <b class="conum">(3)</b>
0000_50_cluster-ingress-operator_00-ingress-credentials-request.yaml <b class="conum">(4)</b>
0000_50_cluster-network-operator_02-cncc-credentials.yaml <b class="conum">(5)</b>
0000_50_cluster-storage-operator_03_credentials_request_aws.yaml <b class="conum">(6)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The Machine API Operator CR is required.</p>
</li>
<li>
<p>The Cloud Credential Operator CR is required.</p>
</li>
<li>
<p>The Image Registry Operator CR is required.</p>
</li>
<li>
<p>The Ingress Operator CR is required.</p>
</li>
<li>
<p>The Network Operator CR is required.</p>
</li>
<li>
<p>The Storage Operator CR is an optional component and might be disabled in your cluster.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Use the <code>ccoctl</code> tool to process all <code>CredentialsRequest</code> objects in the <code>credrequests</code> directory:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ ccoctl aws create-all \
  --name=&lt;name&gt; \// <b class="conum">(1)</b>
  --region=&lt;aws_region&gt; \// <b class="conum">(2)</b>
  --credentials-requests-dir=&lt;path_to_directory_with_list_of_credentials_requests&gt;/credrequests \// <b class="conum">(3)</b>
  --output-dir=&lt;path_to_ccoctl_output_dir&gt; \// <b class="conum">(4)</b>
  --create-private-s3-bucket <b class="conum">(5)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Specify the name used to tag any cloud resources that are created for tracking.</p>
</li>
<li>
<p>Specify the AWS region in which cloud resources will be created.</p>
</li>
<li>
<p>Specify the directory containing the files for the component <code>CredentialsRequest</code> objects.</p>
</li>
<li>
<p>Optional: Specify the directory in which you want the <code>ccoctl</code> utility to create objects. By default, the utility creates objects in the directory in which the commands are run.</p>
</li>
<li>
<p>Optional: By default, the <code>ccoctl</code> utility stores the OpenID Connect (OIDC) configuration files in a public S3 bucket and uses the S3 URL as the public OIDC endpoint. To store the OIDC configuration in a private S3 bucket that is accessed by the IAM identity provider through a public CloudFront distribution URL instead, use the <code>--create-private-s3-bucket</code> parameter.</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>If your cluster uses Technology Preview features that are enabled by the <code>TechPreviewNoUpgrade</code> feature set, you must include the <code>--enable-tech-preview</code> parameter.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Verification</div>
<ul>
<li>
<p>To verify that the OpenShift Container Platform secrets are created, list the files in the <code>&lt;path_to_ccoctl_output_dir&gt;/manifests</code> directory:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ ls &lt;path_to_ccoctl_output_dir&gt;/manifests</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output:</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">cluster-authentication-02-config.yaml
openshift-cloud-credential-operator-cloud-credential-operator-iam-ro-creds-credentials.yaml
openshift-cluster-csi-drivers-ebs-cloud-credentials-credentials.yaml
openshift-image-registry-installer-cloud-credentials-credentials.yaml
openshift-ingress-operator-cloud-credentials-credentials.yaml
openshift-machine-api-aws-cloud-credentials-credentials.yaml</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can verify that the IAM roles are created by querying AWS. For more information, refer to AWS documentation on listing IAM roles.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="sts-mode-installing-manual-run-installer_cco-mode-sts">Running the installer</h5>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Configure an account with the cloud platform that hosts your cluster.</p>
</li>
<li>
<p>Obtain the OpenShift Container Platform release image.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Change to the directory that contains the installation program and create the <code>install-config.yaml</code> file:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ openshift-install create install-config --dir &lt;installation_directory&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>where <code>&lt;installation_directory&gt;</code> is the directory in which the installation program creates files.</p>
</div>
</li>
<li>
<p>Edit the <code>install-config.yaml</code> configuration file so that it contains the <code>credentialsMode</code> parameter set to <code>Manual</code>.</p>
<div class="listingblock">
<div class="title">Example <code>install-config.yaml</code> configuration file</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: v1
baseDomain: cluster1.example.com
credentialsMode: Manual <b class="conum">(1)</b>
compute:
- architecture: amd64
  hyperthreading: Enabled</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>This line is added to set the <code>credentialsMode</code> parameter to <code>Manual</code>.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Create the required OpenShift Container Platform installation manifests:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ openshift-install create manifests</code></pre>
</div>
</div>
</li>
<li>
<p>Copy the manifests that <code>ccoctl</code> generated to the manifests directory that the installation program created:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ cp /&lt;path_to_ccoctl_output_dir&gt;/manifests/* ./manifests/</code></pre>
</div>
</div>
</li>
<li>
<p>Copy the private key that the <code>ccoctl</code> generated in the <code>tls</code> directory to the installation directory:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ cp -a /&lt;path_to_ccoctl_output_dir&gt;/tls .</code></pre>
</div>
</div>
</li>
<li>
<p>Run the OpenShift Container Platform installer:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ ./openshift-install create cluster</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="sts-mode-installing-verifying_cco-mode-sts">Verifying the installation</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Connect to the OpenShift Container Platform cluster.</p>
</li>
<li>
<p>Verify that the cluster does not have <code>root</code> credentials:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc get secrets -n kube-system aws-creds</code></pre>
</div>
</div>
<div class="paragraph">
<p>The output should look similar to:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">Error from server (NotFound): secrets "aws-creds" not found</code></pre>
</div>
</div>
</li>
<li>
<p>Verify that the components are assuming the
IAM roles
that are specified in the secret manifests, instead of using credentials that are created by the CCO:</p>
<div class="listingblock">
<div class="title">Example command with the Image Registry Operator</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc get secrets -n openshift-image-registry installer-cloud-credentials -o json | jq -r .data.credentials | base64 --decode</code></pre>
</div>
</div>
<div class="paragraph">
<p>The output should show the role and web identity token that are used by the component and look similar to:</p>
</div>
<div class="listingblock">
<div class="title">Example output with the Image Registry Operator</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">[default]
role_arn = arn:aws:iam::123456789:role/openshift-image-registry-installer-cloud-credentials
web_identity_token_file = /var/run/secrets/openshift/serviceaccount/token</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3 _additional-resources">
<h4 id="additional-resources_cco-mode-sts">Additional resources</h4>
<div class="ulist">
<ul>
<li>
<p><a href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.13/html-single/updating_clusters/#preparing-manual-creds-update">Preparing to update a cluster with manually maintained credentials</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="cco-mode-gcp-workload-identity">Using manual mode with GCP Workload Identity</h3>
<div class="paragraph">
<p>Manual mode with GCP Workload Identity is supported for Google Cloud Platform (GCP).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>This credentials strategy is supported for only new OpenShift Container Platform clusters and must be configured during installation. You cannot reconfigure an existing cluster that uses a different credentials strategy to use this feature.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In manual mode with GCP Workload Identity, the individual OpenShift Container Platform cluster components can impersonate IAM service accounts using short-term, limited-privilege credentials.</p>
</div>
<div class="paragraph">
<p>Requests for new and refreshed credentials are automated by using an appropriately configured OpenID Connect (OIDC) identity provider, combined with IAM service accounts. OpenShift Container Platform signs service account tokens that are trusted by GCP, and can be projected into a pod and used for authentication. Tokens are refreshed after one hour by default.</p>
</div>
<div class="paragraph">
<p>Using manual mode with GCP Workload Identity changes the content of the GCP credentials that are provided to individual OpenShift Container Platform components.</p>
</div>
<div class="listingblock">
<div class="title">GCP secret format</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: v1
kind: Secret
metadata:
  namespace: &lt;target_namespace&gt; <b class="conum">(1)</b>
  name: &lt;target_secret_name&gt; <b class="conum">(2)</b>
data:
  service_account.json: &lt;service_account&gt; <b class="conum">(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The namespace for the component.</p>
</li>
<li>
<p>The name of the component secret.</p>
</li>
<li>
<p>The Base64 encoded service account.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="title">Content of the Base64 encoded <code>service_account.json</code> file using long-lived credentials</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-json" data-lang="json">{
   "type": "service_account", <b class="conum">(1)</b>
   "project_id": "&lt;project_id&gt;",
   "private_key_id": "&lt;private_key_id&gt;",
   "private_key": "&lt;private_key&gt;", <b class="conum">(2)</b>
   "client_email": "&lt;client_email_address&gt;",
   "client_id": "&lt;client_id&gt;",
   "auth_uri": "https://accounts.google.com/o/oauth2/auth",
   "token_uri": "https://oauth2.googleapis.com/token",
   "auth_provider_x509_cert_url": "https://www.googleapis.com/oauth2/v1/certs",
   "client_x509_cert_url": "https://www.googleapis.com/robot/v1/metadata/x509/&lt;client_email_address&gt;"
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The credential type is <code>service_account</code>.</p>
</li>
<li>
<p>The private RSA key that is used to authenticate to GCP. This key must be kept secure and is not rotated.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="title">Content of the Base64 encoded <code>service_account.json</code> file using GCP Workload Identity</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-json" data-lang="json">{
   "type": "external_account", <b class="conum">(1)</b>
   "audience": "//iam.googleapis.com/projects/123456789/locations/global/workloadIdentityPools/test-pool/providers/test-provider", <b class="conum">(2)</b>
   "subject_token_type": "urn:ietf:params:oauth:token-type:jwt",
   "token_url": "https://sts.googleapis.com/v1/token",
   "service_account_impersonation_url": "https://iamcredentials.googleapis.com/v1/projects/-/serviceAccounts/&lt;client_email_address&gt;:generateAccessToken", <b class="conum">(3)</b>
   "credential_source": {
      "file": "&lt;path_to_token&gt;", <b class="conum">(4)</b>
      "format": {
         "type": "text"
      }
   }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The credential type is <code>external_account</code>.</p>
</li>
<li>
<p>The target audience is the GCP Workload Identity provider.</p>
</li>
<li>
<p>The resource URL of the service account that can be impersonated with these credentials.</p>
</li>
<li>
<p>The path to the service account token inside the pod. By convention, this is <code>/var/run/secrets/openshift/serviceaccount/token</code> for OpenShift Container Platform components.</p>
</li>
</ol>
</div>
<div class="sect3">
<h4 id="gcp-workload-identity-mode-installing">Installing an OpenShift Container Platform cluster configured for manual mode with GCP Workload Identity</h4>
<div class="paragraph">
<p>To install a cluster that is configured to use the Cloud Credential Operator (CCO) in manual mode with GCP Workload Identity:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="_managing-cloud-provider-credentials.html#cco-ccoctl-configuring_cco-mode-gcp-workload-identity">Configure the Cloud Credential Operator utility</a>.</p>
</li>
<li>
<p><a href="_managing-cloud-provider-credentials.html#cco-ccoctl-creating-at-once_cco-mode-gcp-workload-identity">Create the required GCP resources</a>.</p>
</li>
<li>
<p><a href="_managing-cloud-provider-credentials.html#sts-mode-installing-manual-run-installer_cco-mode-gcp-workload-identity">Run the OpenShift Container Platform installer</a>.</p>
</li>
<li>
<p><a href="_managing-cloud-provider-credentials.html#sts-mode-installing-verifying_cco-mode-gcp-workload-identity">Verify that the cluster is using short-lived credentials</a>.</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Because the cluster is operating in manual mode when using GCP Workload Identity, it is not able to create new credentials for components with the permissions that they require. When upgrading to a different minor version of OpenShift Container Platform, there are often new GCP permission requirements. Before upgrading a cluster that is using GCP Workload Identity, the cluster administrator must manually ensure that the GCP permissions are sufficient for existing components and available to any new components.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.13/html-single/updating_clusters/#cco-ccoctl-configuring_preparing-manual-creds-update">Configuring the Cloud Credential Operator utility for a cluster update</a></p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="cco-ccoctl-configuring_cco-mode-gcp-workload-identity">Configuring the Cloud Credential Operator utility</h5>
<div class="paragraph">
<p>To create and manage cloud credentials from outside of the cluster when the Cloud Credential Operator (CCO) is operating in manual mode, extract and prepare the CCO utility (<code>ccoctl</code>) binary.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>ccoctl</code> utility is a Linux binary that must run in a Linux environment.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You have access to an OpenShift Container Platform account with cluster administrator access.</p>
</li>
<li>
<p>You have installed the OpenShift CLI (<code>oc</code>).</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Obtain the OpenShift Container Platform release image by running the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ RELEASE_IMAGE=$(./openshift-install version | awk '/release image/ {print $3}')</code></pre>
</div>
</div>
</li>
<li>
<p>Obtain the CCO container image from the OpenShift Container Platform release image by running the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ CCO_IMAGE=$(oc adm release info --image-for='cloud-credential-operator' $RELEASE_IMAGE -a ~/.pull-secret)</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Ensure that the architecture of the <code>$RELEASE_IMAGE</code> matches the architecture of the environment in which you will use the <code>ccoctl</code> tool.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Extract the <code>ccoctl</code> binary from the CCO container image within the OpenShift Container Platform release image by running the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc image extract $CCO_IMAGE --file="/usr/bin/ccoctl" -a ~/.pull-secret</code></pre>
</div>
</div>
</li>
<li>
<p>Change the permissions to make <code>ccoctl</code> executable by running the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ chmod 775 ccoctl</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Verification</div>
<ul>
<li>
<p>To verify that <code>ccoctl</code> is ready to use, display the help file by running the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ ccoctl --help</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Output of <code>ccoctl --help</code></div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">OpenShift credentials provisioning tool

Usage:
  ccoctl [command]

Available Commands:
  alibabacloud Manage credentials objects for alibaba cloud
  aws          Manage credentials objects for AWS cloud
  gcp          Manage credentials objects for Google cloud
  help         Help about any command
  ibmcloud     Manage credentials objects for IBM Cloud
  nutanix      Manage credentials objects for Nutanix

Flags:
  -h, --help   help for ccoctl

Use "ccoctl [command] --help" for more information about a command.</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="cco-ccoctl-creating-at-once_cco-mode-gcp-workload-identity">Creating GCP resources with the Cloud Credential Operator utility</h5>
<div class="paragraph">
<p>You can use the <code>ccoctl gcp create-all</code> command to automate the creation of GCP resources.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>By default, <code>ccoctl</code> creates objects in the directory in which the commands are run. To create the objects in a different directory, use the <code>--output-dir</code> flag. This procedure uses <code>&lt;path_to_ccoctl_output_dir&gt;</code> to refer to this directory.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<div class="title">Prerequisites</div>
<p>You must have:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Extracted and prepared the <code>ccoctl</code> binary.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Extract the list of <code>CredentialsRequest</code> objects from the OpenShift Container Platform release image by running the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc adm release extract \
--credentials-requests \
--cloud=gcp \
--to=&lt;path_to_directory_with_list_of_credentials_requests&gt;/credrequests \ <b class="conum">(1)</b>
quay.io/&lt;path_to&gt;/ocp-release:&lt;version&gt;</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p><code>credrequests</code> is the directory where the list of <code>CredentialsRequest</code> objects is stored. This command creates the directory if it does not exist.</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>This command can take a few moments to run.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>If your cluster uses cluster capabilities to disable one or more optional components, delete the <code>CredentialsRequest</code> custom resources for any disabled components.</p>
<div class="listingblock">
<div class="title">Example <code>credrequests</code> directory contents for OpenShift Container Platform 4.12 on GCP</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">0000_26_cloud-controller-manager-operator_16_credentialsrequest-gcp.yaml <b class="conum">(1)</b>
0000_30_machine-api-operator_00_credentials-request.yaml <b class="conum">(2)</b>
0000_50_cloud-credential-operator_05-gcp-ro-credentialsrequest.yaml <b class="conum">(3)</b>
0000_50_cluster-image-registry-operator_01-registry-credentials-request-gcs.yaml <b class="conum">(4)</b>
0000_50_cluster-ingress-operator_00-ingress-credentials-request.yaml <b class="conum">(5)</b>
0000_50_cluster-network-operator_02-cncc-credentials.yaml <b class="conum">(6)</b>
0000_50_cluster-storage-operator_03_credentials_request_gcp.yaml <b class="conum">(7)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The Cloud Controller Manager Operator CR is required.</p>
</li>
<li>
<p>The Machine API Operator CR is required.</p>
</li>
<li>
<p>The Cloud Credential Operator CR is required.</p>
</li>
<li>
<p>The Image Registry Operator CR is required.</p>
</li>
<li>
<p>The Ingress Operator CR is required.</p>
</li>
<li>
<p>The Network Operator CR is required.</p>
</li>
<li>
<p>The Storage Operator CR is an optional component and might be disabled in your cluster.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Use the <code>ccoctl</code> tool to process all <code>CredentialsRequest</code> objects in the <code>credrequests</code> directory:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ ccoctl gcp create-all \
--name=&lt;name&gt; \
--region=&lt;gcp_region&gt; \
--project=&lt;gcp_project_id&gt; \
--credentials-requests-dir=&lt;path_to_directory_with_list_of_credentials_requests&gt;/credrequests</code></pre>
</div>
</div>
<div class="paragraph">
<p>where:</p>
</div>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p><code>&lt;name&gt;</code> is the user-defined name for all created GCP resources used for tracking.</p>
</li>
<li>
<p><code>&lt;gcp_region&gt;</code> is the GCP region in which cloud resources will be created.</p>
</li>
<li>
<p><code>&lt;gcp_project_id&gt;</code> is the GCP project ID in which cloud resources will be created.</p>
</li>
<li>
<p><code>&lt;path_to_directory_with_list_of_credentials_requests&gt;/credrequests</code> is the directory containing the files of <code>CredentialsRequest</code> manifests to create GCP service accounts.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>If your cluster uses Technology Preview features that are enabled by the <code>TechPreviewNoUpgrade</code> feature set, you must include the <code>--enable-tech-preview</code> parameter.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Verification</div>
<ul>
<li>
<p>To verify that the OpenShift Container Platform secrets are created, list the files in the <code>&lt;path_to_ccoctl_output_dir&gt;/manifests</code> directory:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ ls &lt;path_to_ccoctl_output_dir&gt;/manifests</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can verify that the IAM service accounts are created by querying GCP. For more information, refer to GCP documentation on listing IAM service accounts.</p>
</div>
</div>
<div class="sect4">
<h5 id="sts-mode-installing-manual-run-installer_cco-mode-gcp-workload-identity">Running the installer</h5>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Configure an account with the cloud platform that hosts your cluster.</p>
</li>
<li>
<p>Obtain the OpenShift Container Platform release image.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Change to the directory that contains the installation program and create the <code>install-config.yaml</code> file:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ openshift-install create install-config --dir &lt;installation_directory&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>where <code>&lt;installation_directory&gt;</code> is the directory in which the installation program creates files.</p>
</div>
</li>
<li>
<p>Edit the <code>install-config.yaml</code> configuration file so that it contains the <code>credentialsMode</code> parameter set to <code>Manual</code>.</p>
<div class="listingblock">
<div class="title">Example <code>install-config.yaml</code> configuration file</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: v1
baseDomain: cluster1.example.com
credentialsMode: Manual <b class="conum">(1)</b>
compute:
- architecture: amd64
  hyperthreading: Enabled</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>This line is added to set the <code>credentialsMode</code> parameter to <code>Manual</code>.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Create the required OpenShift Container Platform installation manifests:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ openshift-install create manifests</code></pre>
</div>
</div>
</li>
<li>
<p>Copy the manifests that <code>ccoctl</code> generated to the manifests directory that the installation program created:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ cp /&lt;path_to_ccoctl_output_dir&gt;/manifests/* ./manifests/</code></pre>
</div>
</div>
</li>
<li>
<p>Copy the private key that the <code>ccoctl</code> generated in the <code>tls</code> directory to the installation directory:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ cp -a /&lt;path_to_ccoctl_output_dir&gt;/tls .</code></pre>
</div>
</div>
</li>
<li>
<p>Run the OpenShift Container Platform installer:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ ./openshift-install create cluster</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="sts-mode-installing-verifying_cco-mode-gcp-workload-identity">Verifying the installation</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Connect to the OpenShift Container Platform cluster.</p>
</li>
<li>
<p>Verify that the cluster does not have <code>root</code> credentials:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc get secrets -n kube-system gcp-credentials</code></pre>
</div>
</div>
<div class="paragraph">
<p>The output should look similar to:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">Error from server (NotFound): secrets "gcp-credentials" not found</code></pre>
</div>
</div>
</li>
<li>
<p>Verify that the components are assuming the
service accounts
that are specified in the secret manifests, instead of using credentials that are created by the CCO:</p>
<div class="listingblock">
<div class="title">Example command with the Image Registry Operator</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc get secrets -n openshift-image-registry installer-cloud-credentials -o json | jq -r '.data."service_account.json"' | base64 -d</code></pre>
</div>
</div>
<div class="paragraph">
<p>The output should show the role and web identity token that are used by the component and look similar to:</p>
</div>
<div class="listingblock">
<div class="title">Example output with the Image Registry Operator</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-json" data-lang="json">{
   "type": "external_account", <b class="conum">(1)</b>
   "audience": "//iam.googleapis.com/projects/123456789/locations/global/workloadIdentityPools/test-pool/providers/test-provider",
   "subject_token_type": "urn:ietf:params:oauth:token-type:jwt",
   "token_url": "https://sts.googleapis.com/v1/token",
   "service_account_impersonation_url": "https://iamcredentials.googleapis.com/v1/projects/-/serviceAccounts/&lt;client-email-address&gt;:generateAccessToken", <b class="conum">(2)</b>
   "credential_source": {
      "file": "/var/run/secrets/openshift/serviceaccount/token",
      "format": {
         "type": "text"
      }
   }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The credential type is <code>external_account</code>.</p>
</li>
<li>
<p>The resource URL of the service account used by the Image Registry Operator.</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3 _additional-resources">
<h4 id="additional-resources_cco-mode-gcp-workload-identity">Additional resources</h4>
<div class="ulist">
<ul>
<li>
<p><a href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.13/html-single/updating_clusters/#preparing-manual-creds-update">Preparing to update a cluster with manually maintained credentials</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph nav-footer">
<p>← Previous: <a href="ldap-syncing.html">Syncing LDAP groups</a> | ↑ Up: <a href="master.html">Authentication and authorization</a></p>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2023-07-17 11:00:01 +0100
</div>
</div>
</body>
</html>