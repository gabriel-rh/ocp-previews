<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.16">
<title>Serving</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;-webkit-tap-highlight-color:transparent}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos{border-right:1px solid;opacity:.35;padding-right:.5em}
pre.pygments .lineno{border-right:1px solid;opacity:.35;display:inline-block;margin-right:.75em}
pre.pygments .lineno::before{content:"";margin-right:-.125em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd),table.stripes-even tr:nth-of-type(even),table.stripes-hover tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
</head>
<body class="article">
<div id="header">
<h1>Serving</h1>
</div>
<div id="content">
<div class="sect1">
<h2 id="_getting-started-with-knative-serving">Getting started with Knative Serving</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="serverless-applications">Serverless applications</h3>
<div class="paragraph">
<p>Serverless applications are created and deployed as Kubernetes services, defined by a route and a configuration, and contained in a YAML file. To deploy a serverless application using OpenShift Serverless, you must create a Knative <code>Service</code> object.</p>
</div>
<div class="listingblock">
<div class="title">Example Knative <code>Service</code> object YAML file</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: serving.knative.dev/v1
kind: Service
metadata:
  name: hello <b class="conum">(1)</b>
  namespace: default <b class="conum">(2)</b>
spec:
  template:
    spec:
      containers:
        - image: docker.io/openshift/hello-openshift <b class="conum">(3)</b>
          env:
            - name: RESPONSE <b class="conum">(4)</b>
              value: "Hello Serverless!"</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The name of the application.</p>
</li>
<li>
<p>The namespace the application uses.</p>
</li>
<li>
<p>The image of the application.</p>
</li>
<li>
<p>The environment variable printed out by the sample application.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>You can create a serverless application by using one of the following methods:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Create a Knative service from the OpenShift Container Platform web console.</p>
<div class="paragraph">
<p>For OpenShift Container Platform, see <a href="https://docs.openshift.com/container-platform/latest/applications/creating_applications/odc-creating-applications-using-developer-perspective.html#odc-creating-applications-using-developer-perspective">Creating applications using the Developer perspective</a> for more information.</p>
</div>
</li>
<li>
<p>Create a Knative service by using the Knative (<code>kn</code>) CLI.</p>
</li>
<li>
<p>Create and apply a Knative <code>Service</code> object as a YAML file, by using the <code>oc</code> CLI.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="creating-serverless-apps-kn_serverless-applications">Creating serverless applications by using the Knative CLI</h4>
<div class="paragraph">
<p>Using the Knative (<code>kn</code>) CLI to create serverless applications provides a more streamlined and intuitive user interface over modifying YAML files directly. You can use the <code>kn service create</code> command to create a basic serverless application.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>OpenShift Serverless Operator and Knative Serving are installed on your cluster.</p>
</li>
<li>
<p>You have installed the Knative (<code>kn</code>) CLI.</p>
</li>
<li>
<p>You have created a project or have access to a project with the appropriate roles and permissions to create applications and other workloads in OpenShift Container Platform.</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Create a Knative service:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ kn service create &lt;service-name&gt; --image &lt;image&gt; --tag &lt;tag-value&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Where:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>--image</code> is the URI of the image for the application.</p>
</li>
<li>
<p><code>--tag</code> is an optional flag that can be used to add a tag to the initial revision that is created with the service.</p>
<div class="listingblock">
<div class="title">Example command</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ kn service create event-display \
    --image quay.io/openshift-knative/knative-eventing-sources-event-display:latest</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">Creating service 'event-display' in namespace 'default':

  0.271s The Route is still working to reflect the latest desired specification.
  0.580s Configuration "event-display" is waiting for a Revision to become ready.
  3.857s ...
  3.861s Ingress has not yet been reconciled.
  4.270s Ready to serve.

Service 'event-display' created with latest revision 'event-display-bxshg-1' and URL:
http://event-display-default.apps-crc.testing</code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="creating-serverless-apps-yaml_serverless-applications">Creating serverless applications using YAML</h4>
<div class="paragraph">
<p>Creating Knative resources by using YAML files uses a declarative API, which enables you to describe applications declaratively and in a reproducible manner. To create a serverless application by using YAML, you must create a YAML file that defines a Knative <code>Service</code> object, then apply it by using <code>oc apply</code>.</p>
</div>
<div class="paragraph">
<p>After the service is created and the application is deployed, Knative creates an immutable revision for this version of the application. Knative also performs network programming to create a route, ingress, service, and load balancer for your application and automatically scales your pods up and down based on traffic.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>OpenShift Serverless Operator and Knative Serving are installed on your cluster.</p>
</li>
<li>
<p>You have created a project or have access to a project with the appropriate roles and permissions to create applications and other workloads in OpenShift Container Platform.</p>
</li>
<li>
<p>Install the OpenShift CLI (<code>oc</code>).</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create a YAML file containing the following sample code:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: serving.knative.dev/v1
kind: Service
metadata:
  name: event-delivery
  namespace: default
spec:
  template:
    spec:
      containers:
        - image: quay.io/openshift-knative/knative-eventing-sources-event-display:latest
          env:
            - name: RESPONSE
              value: "Hello Serverless!"</code></pre>
</div>
</div>
</li>
<li>
<p>Navigate to the directory where the YAML file is contained, and deploy the application by applying the YAML file:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc apply -f &lt;filename&gt;</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>If you do not want to switch to the <strong>Developer</strong> perspective in the OpenShift Container Platform web console or use the Knative (<code>kn</code>) CLI or YAML files, you can create Knative components by using the <strong>Administator</strong> perspective of the OpenShift Container Platform web console.</p>
</div>
</div>
<div class="sect3">
<h4 id="creating-serverless-apps-admin-console_serverless-applications">Creating serverless applications using the Administrator perspective</h4>
<div class="paragraph">
<p>Serverless applications are created and deployed as Kubernetes services, defined by a route and a configuration, and contained in a YAML file. To deploy a serverless application using OpenShift Serverless, you must create a Knative <code>Service</code> object.</p>
</div>
<div class="listingblock">
<div class="title">Example Knative <code>Service</code> object YAML file</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: serving.knative.dev/v1
kind: Service
metadata:
  name: hello <b class="conum">(1)</b>
  namespace: default <b class="conum">(2)</b>
spec:
  template:
    spec:
      containers:
        - image: docker.io/openshift/hello-openshift <b class="conum">(3)</b>
          env:
            - name: RESPONSE <b class="conum">(4)</b>
              value: "Hello Serverless!"</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The name of the application.</p>
</li>
<li>
<p>The namespace the application uses.</p>
</li>
<li>
<p>The image of the application.</p>
</li>
<li>
<p>The environment variable printed out by the sample application.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>After the service is created and the application is deployed, Knative creates an immutable revision for this version of the application. Knative also performs network programming to create a route, ingress, service, and load balancer for your application and automatically scales your pods up and down based on traffic.</p>
</div>
<div class="paragraph">
<div class="title">Prerequisites</div>
<p>To create serverless applications using the <strong>Administrator</strong> perspective, ensure that you have completed the following steps.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The OpenShift Serverless Operator and Knative Serving are installed.</p>
</li>
<li>
<p>You have logged in to the web console and are in the <strong>Administrator</strong> perspective.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Navigate to the <strong>Serverless</strong> &#8594; <strong>Serving</strong> page.</p>
</li>
<li>
<p>In the <strong>Create</strong> list, select <strong>Service</strong>.</p>
</li>
<li>
<p>Manually enter YAML or JSON definitions, or by dragging and dropping a file into the editor.</p>
</li>
<li>
<p>Click <strong>Create</strong>.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="creating-an-offline-service_serverless-applications">Creating a service using offline mode</h4>
<div class="paragraph">
<p>You can execute <code>kn service</code> commands in offline mode, so that no changes happen on the cluster, and instead the service descriptor file is created on your local machine. After the descriptor file is created, you can modify the file before propagating changes to the cluster.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>The offline mode of the Knative CLI is a Technology Preview feature only. Technology Preview features
are not supported with Red Hat production service level agreements (SLAs) and
might not be functionally complete. Red Hat does not recommend using them
in production. These features provide early access to upcoming product
features, enabling customers to test functionality and provide feedback during
the development process.</p>
</div>
<div class="paragraph">
<p>For more information about the support scope of Red Hat Technology Preview features, see <a href="https://access.redhat.com/support/offerings/techpreview/">Technology Preview Features Support Scope</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>OpenShift Serverless Operator and Knative Serving are installed on your cluster.</p>
</li>
<li>
<p>You have installed the Knative (<code>kn</code>) CLI.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In offline mode, create a local Knative service descriptor file:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ kn service create event-display \
    --image quay.io/openshift-knative/knative-eventing-sources-event-display:latest \
    --target ./ \
    --namespace test</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">Service 'event-display' created in namespace 'test'.</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>--target ./</code> flag enables offline mode and specifies <code>./</code> as the directory for storing the new directory tree.</p>
<div class="paragraph">
<p>If you do not specify an existing directory, but use a filename, such as <code>--target my-service.yaml</code>, then no directory tree is created. Instead, only the service descriptor file <code>my-service.yaml</code> is created in the current directory.</p>
</div>
<div class="paragraph">
<p>The filename can have the <code>.yaml</code>, <code>.yml</code>, or <code>.json</code> extension. Choosing <code>.json</code> creates the service descriptor file in the JSON format.</p>
</div>
</li>
<li>
<p>The <code>--namespace test</code> option places the new service in the <code>test</code> namespace.</p>
<div class="paragraph">
<p>If you do not use <code>--namespace</code>, and you are logged in to an OpenShift Container Platform cluster, the descriptor file is created in the current namespace. Otherwise, the descriptor file is created in the <code>default</code> namespace.</p>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Examine the created directory structure:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ tree ./</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">./
└── test
    └── ksvc
        └── event-display.yaml

2 directories, 1 file</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>The current <code>./</code> directory specified with <code>--target</code> contains the new <code>test/</code> directory that is named after the specified namespace.</p>
</li>
<li>
<p>The <code>test/</code> directory contains the <code>ksvc</code> directory, named after the resource type.</p>
</li>
<li>
<p>The <code>ksvc</code> directory contains the descriptor file <code>event-display.yaml</code>, named according to the specified service name.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Examine the generated service descriptor file:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ cat test/ksvc/event-display.yaml</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: serving.knative.dev/v1
kind: Service
metadata:
  creationTimestamp: null
  name: event-display
  namespace: test
spec:
  template:
    metadata:
      annotations:
        client.knative.dev/user-image: quay.io/openshift-knative/knative-eventing-sources-event-display:latest
      creationTimestamp: null
    spec:
      containers:
      - image: quay.io/openshift-knative/knative-eventing-sources-event-display:latest
        name: ""
        resources: {}
status: {}</code></pre>
</div>
</div>
</li>
<li>
<p>List information about the new service:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ kn service describe event-display --target ./ --namespace test</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">Name:       event-display
Namespace:  test
Age:
URL:

Revisions:

Conditions:
  OK TYPE    AGE REASON</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>--target ./</code> option specifies the root directory for the directory structure containing namespace subdirectories.</p>
<div class="paragraph">
<p>Alternatively, you can directly specify a YAML or JSON filename with the <code>--target</code> option. The accepted file extensions are <code>.yaml</code>, <code>.yml</code>, and <code>.json</code>.</p>
</div>
</li>
<li>
<p>The <code>--namespace</code> option specifies the namespace, which communicates to <code>kn</code> the subdirectory that contains the necessary service descriptor file.</p>
<div class="paragraph">
<p>If you do not use <code>--namespace</code>, and you are logged in to an OpenShift Container Platform cluster, <code>kn</code> searches for the service in the subdirectory that is named after the current namespace. Otherwise, <code>kn</code> searches in the <code>default/</code> subdirectory.</p>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Use the service descriptor file to create the service on the cluster:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ kn service create -f test/ksvc/event-display.yaml</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">Creating service 'event-display' in namespace 'test':

  0.058s The Route is still working to reflect the latest desired specification.
  0.098s ...
  0.168s Configuration "event-display" is waiting for a Revision to become ready.
 23.377s ...
 23.419s Ingress has not yet been reconciled.
 23.534s Waiting for load balancer to be ready
 23.723s Ready to serve.

Service 'event-display' created to latest revision 'event-display-00001' is available at URL:
http://event-display-test.apps.example.com</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3 _additional-resources">
<h4 id="additional-resources_serverless-applications">Additional resources</h4>
<div class="ulist">
<ul>
<li>
<p><a href="https://access.redhat.com/documentation/en-us/red_hat_openshift_serverless/1.29/html-single/knative_cli/#kn-service">Knative Serving CLI commands</a></p>
</li>
<li>
<p><a href="#serverless-ossm-with-kourier-jwt">Configuring JSON Web Token authentication for Knative services</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="verifying-application-deployment">Verifying your serverless application deployment</h3>
<div class="paragraph">
<p>To verify that your serverless application has been deployed successfully, you must get the application URL created by Knative, and then send a request to that URL and observe the output. OpenShift Serverless supports the use of both HTTP and HTTPS URLs, however the output from <code>oc get ksvc</code> always prints URLs using the <code>http://</code> format.</p>
</div>
<div class="sect3">
<h4 id="verifying-serverless-app-deployment_verifying-application-deployment">Verifying your serverless application deployment</h4>
<div class="paragraph">
<p>To verify that your serverless application has been deployed successfully, you must get the application URL created by Knative, and then send a request to that URL and observe the output. OpenShift Serverless supports the use of both HTTP and HTTPS URLs, however the output from <code>oc get ksvc</code> always prints URLs using the <code>http://</code> format.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>OpenShift Serverless Operator and Knative Serving are installed on your cluster.</p>
</li>
<li>
<p>You have installed the <code>oc</code> CLI.</p>
</li>
<li>
<p>You have created a Knative service.</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Install the OpenShift CLI (<code>oc</code>).</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Find the application URL:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc get ksvc &lt;service_name&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">NAME            URL                                        LATESTCREATED         LATESTREADY           READY   REASON
event-delivery   http://event-delivery-default.example.com   event-delivery-4wsd2   event-delivery-4wsd2   True</code></pre>
</div>
</div>
</li>
<li>
<p>Make a request to your cluster and observe the output.</p>
<div class="listingblock">
<div class="title">Example HTTP request</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ curl http://event-delivery-default.example.com</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example HTTPS request</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ curl https://event-delivery-default.example.com</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">Hello Serverless!</code></pre>
</div>
</div>
</li>
<li>
<p>Optional. If you receive an error relating to a self-signed certificate in the certificate chain, you can add the <code>--insecure</code> flag to the curl command to ignore the error:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ curl https://event-delivery-default.example.com --insecure</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">Hello Serverless!</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>Self-signed certificates must not be used in a production deployment. This method is only for testing purposes.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Optional. If your OpenShift Container Platform cluster is configured with a certificate that is signed by a certificate authority (CA) but not yet globally configured for your system, you can specify this with the <code>curl</code> command.
The path to the certificate can be passed to the curl command by using the <code>--cacert</code> flag:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ curl https://event-delivery-default.example.com --cacert &lt;file&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">Hello Serverless!</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_autoscaling">Autoscaling</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="serverless-autoscaling-developer">Autoscaling</h3>
<div class="paragraph">
<p>Knative Serving provides automatic scaling, or <em>autoscaling</em>, for applications to match incoming demand. For example, if an application is receiving no traffic, and scale-to-zero is enabled, Knative Serving scales the application down to zero replicas. If scale-to-zero is disabled, the application is scaled down to the minimum number of replicas configured for applications on the cluster. Replicas can also be scaled up to meet demand if traffic to the application increases.</p>
</div>
<div class="paragraph">
<p>Autoscaling settings for Knative services can be global settings that are configured by cluster administrators (or dedicated administrators for Red Hat OpenShift Service on AWS and OpenShift Dedicated), or per-revision settings that are configured for individual services.</p>
</div>
<div class="paragraph">
<p>You can modify per-revision settings for your services by using the OpenShift Container Platform web console, by modifying the YAML file for your service, or by using the Knative (<code>kn</code>) CLI.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Any limits or targets that you set for a service are measured against a single instance of your application. For example, setting the <code>target</code> annotation to <code>50</code> configures the autoscaler to scale the application so that each revision handles 50 requests at a time.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="serverless-autoscaling-developer-scale-bounds">Scale bounds</h3>
<div class="paragraph">
<p>Scale bounds determine the minimum and maximum numbers of replicas that can serve an application at any given time. You can set scale bounds for an application to help prevent cold starts or control computing costs.</p>
</div>
<div class="sect3">
<h4 id="serverless-autoscaling-developer-minscale_serverless-serving-scale-bounds">Minimum scale bounds</h4>
<div class="paragraph">
<p>The minimum number of replicas that can serve an application is determined by the <code>min-scale</code> annotation. If scale to zero is not enabled, the <code>min-scale</code> value defaults to <code>1</code>.</p>
</div>
<div class="paragraph">
<p>The <code>min-scale</code> value defaults to <code>0</code> replicas if the following conditions are met:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>min-scale</code> annotation is not set</p>
</li>
<li>
<p>Scaling to zero is enabled</p>
</li>
<li>
<p>The class <code>KPA</code> is used</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Example service spec with <code>min-scale</code> annotation</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: serving.knative.dev/v1
kind: Service
metadata:
  name: example-service
  namespace: default
spec:
  template:
    metadata:
      annotations:
        autoscaling.knative.dev/min-scale: "0"
...</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="serverless-autoscaling-minscale-kn_serverless-serving-scale-bounds">Setting the min-scale annotation by using the Knative CLI</h5>
<div class="paragraph">
<p>Using the Knative (<code>kn</code>) CLI to set the <code>min-scale</code> annotation provides a more streamlined and intuitive user interface over modifying YAML files directly. You can use the <code>kn service</code> command with the <code>--scale-min</code> flag to create or modify the <code>min-scale</code> value for a service.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Knative Serving is installed on the cluster.</p>
</li>
<li>
<p>You have installed the Knative (<code>kn</code>) CLI.</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Set the minimum number of replicas for the service by using the <code>--scale-min</code> flag:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ kn service create &lt;service_name&gt; --image &lt;image_uri&gt; --scale-min &lt;integer&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example command</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ kn service create example-service --image quay.io/openshift-knative/knative-eventing-sources-event-display:latest --scale-min 2</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="serverless-autoscaling-developer-maxscale_serverless-serving-scale-bounds">Maximum scale bounds</h4>
<div class="paragraph">
<p>The maximum number of replicas that can serve an application is determined by the <code>max-scale</code> annotation. If the <code>max-scale</code> annotation is not set, there is no upper limit for the number of replicas created.</p>
</div>
<div class="listingblock">
<div class="title">Example service spec with <code>max-scale</code> annotation</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: serving.knative.dev/v1
kind: Service
metadata:
  name: example-service
  namespace: default
spec:
  template:
    metadata:
      annotations:
        autoscaling.knative.dev/max-scale: "10"
...</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="serverless-autoscaling-maxscale-kn_serverless-serving-scale-bounds">Setting the max-scale annotation by using the Knative CLI</h5>
<div class="paragraph">
<p>Using the Knative (<code>kn</code>) CLI to set the <code>max-scale</code> annotation provides a more streamlined and intuitive user interface over modifying YAML files directly. You can use the <code>kn service</code> command with the <code>--scale-max</code> flag to create or modify the <code>max-scale</code> value for a service.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Knative Serving is installed on the cluster.</p>
</li>
<li>
<p>You have installed the Knative (<code>kn</code>) CLI.</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Set the maximum number of replicas for the service by using the <code>--scale-max</code> flag:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ kn service create &lt;service_name&gt; --image &lt;image_uri&gt; --scale-max &lt;integer&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example command</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ kn service create example-service --image quay.io/openshift-knative/knative-eventing-sources-event-display:latest --scale-max 10</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="serverless-concurrency">Concurrency</h3>
<div class="paragraph">
<p>Concurrency determines the number of simultaneous requests that can be processed by each replica of an application at any given time. Concurrency can be configured as a <em>soft limit</em> or a <em>hard limit</em>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A soft limit is a targeted requests limit, rather than a strictly enforced bound. For example, if there is a sudden burst of traffic, the soft limit target can be exceeded.</p>
</li>
<li>
<p>A hard limit is a strictly enforced upper bound requests limit. If concurrency reaches the hard limit, surplus requests are buffered and must wait until there is enough free capacity to execute the requests.</p>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>Using a hard limit configuration is only recommended if there is a clear use case for it with your application. Having a low, hard limit specified may have a negative impact on the throughput and latency of an application, and might cause cold starts.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Adding a soft target and a hard limit means that the autoscaler targets the soft target number of concurrent requests, but imposes a hard limit of the hard limit value for the maximum number of requests.</p>
</div>
<div class="paragraph">
<p>If the hard limit value is less than the soft limit value, the soft limit value is tuned down, because there is no need to target more requests than the number that can actually be handled.</p>
</div>
<div class="sect3">
<h4 id="serverless-concurrency-limits-configure-soft_serverless-concurrency">Configuring a soft concurrency target</h4>
<div class="paragraph">
<p>A soft limit is a targeted requests limit, rather than a strictly enforced bound. For example, if there is a sudden burst of traffic, the soft limit target can be exceeded. You can specify a soft concurrency target for your Knative service by setting the <code>autoscaling.knative.dev/target</code> annotation in the spec, or by using the <code>kn service</code> command with the correct flags.</p>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Optional: Set the <code>autoscaling.knative.dev/target</code> annotation for your Knative service in the spec of the <code>Service</code> custom resource:</p>
<div class="listingblock">
<div class="title">Example service spec</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: serving.knative.dev/v1
kind: Service
metadata:
  name: example-service
  namespace: default
spec:
  template:
    metadata:
      annotations:
        autoscaling.knative.dev/target: "200"</code></pre>
</div>
</div>
</li>
<li>
<p>Optional: Use the <code>kn service</code> command to specify the <code>--concurrency-target</code> flag:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ kn service create &lt;service_name&gt; --image &lt;image_uri&gt; --concurrency-target &lt;integer&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example command to create a service with a concurrency target of 50 requests</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ kn service create example-service --image quay.io/openshift-knative/knative-eventing-sources-event-display:latest --concurrency-target 50</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="serverless-concurrency-limits-configure-hard_serverless-concurrency">Configuring a hard concurrency limit</h4>
<div class="paragraph">
<p>A hard concurrency limit is a strictly enforced upper bound requests limit. If concurrency reaches the hard limit, surplus requests are buffered and must wait until there is enough free capacity to execute the requests. You can specify a hard concurrency limit for your Knative service by modifying the <code>containerConcurrency</code> spec, or by using the <code>kn service</code> command with the correct flags.</p>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Optional: Set the <code>containerConcurrency</code> spec for your Knative service in the spec of the <code>Service</code> custom resource:</p>
<div class="listingblock">
<div class="title">Example service spec</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: serving.knative.dev/v1
kind: Service
metadata:
  name: example-service
  namespace: default
spec:
  template:
    spec:
      containerConcurrency: 50</code></pre>
</div>
</div>
<div class="paragraph">
<p>The default value is <code>0</code>, which means that there is no limit on the number of simultaneous requests that are permitted to flow into one replica of the service at a time.</p>
</div>
<div class="paragraph">
<p>A value greater than <code>0</code> specifies the exact number of requests that are permitted to flow into one replica of the service at a time. This example would enable a hard concurrency limit of 50 requests.</p>
</div>
</li>
<li>
<p>Optional: Use the <code>kn service</code> command to specify the <code>--concurrency-limit</code> flag:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ kn service create &lt;service_name&gt; --image &lt;image_uri&gt; --concurrency-limit &lt;integer&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example command to create a service with a concurrency limit of 50 requests</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ kn service create example-service --image quay.io/openshift-knative/knative-eventing-sources-event-display:latest --concurrency-limit 50</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="serverless-target-utilization_serverless-concurrency">Concurrency target utilization</h4>
<div class="paragraph">
<p>This value specifies the percentage of the concurrency limit that is actually targeted by the autoscaler. This is also known as specifying the <em>hotness</em> at which a replica runs, which enables the autoscaler to scale up before the defined hard limit is reached.</p>
</div>
<div class="paragraph">
<p>For example, if the <code>containerConcurrency</code> value is set to 10, and the <code>target-utilization-percentage</code> value is set to 70 percent, the autoscaler creates a new replica when the average number of concurrent requests across all existing replicas reaches 7. Requests numbered 7 to 10 are still sent to the existing replicas, but additional replicas are started in anticipation of being required after the <code>containerConcurrency</code> value is reached.</p>
</div>
<div class="listingblock">
<div class="title">Example service configured using the target-utilization-percentage annotation</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: serving.knative.dev/v1
kind: Service
metadata:
  name: example-service
  namespace: default
spec:
  template:
    metadata:
      annotations:
        autoscaling.knative.dev/target-utilization-percentage: "70"
...</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="serverless-autoscaling-scale-to-zero">Scale-to-zero</h3>
<div class="paragraph">
<p>Knative Serving provides automatic scaling, or <em>autoscaling</em>, for applications to match incoming demand.</p>
</div>
<div class="sect3">
<h4 id="serverless-enable-scale-to-zero_serverless-autoscaling-scale-to-zero">Enabling scale-to-zero</h4>
<div class="paragraph">
<p>You can use the <code>enable-scale-to-zero</code> spec to enable or disable scale-to-zero globally for applications on the cluster.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You have installed OpenShift Serverless Operator and Knative Serving on your cluster.</p>
</li>
<li>
<p>You have cluster administrator permissions on OpenShift Container Platform, or you have cluster or dedicated administrator permissions on Red Hat OpenShift Service on AWS or OpenShift Dedicated.</p>
</li>
<li>
<p>You are using the default Knative Pod Autoscaler. The scale to zero feature is not available if you are using the Kubernetes Horizontal Pod Autoscaler.</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Modify the <code>enable-scale-to-zero</code> spec in the <code>KnativeServing</code> custom resource (CR):</p>
<div class="listingblock">
<div class="title">Example KnativeServing CR</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: operator.knative.dev/v1beta1
kind: KnativeServing
metadata:
  name: knative-serving
spec:
  config:
    autoscaler:
      enable-scale-to-zero: "false" <b class="conum">(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The <code>enable-scale-to-zero</code> spec can be either <code>"true"</code> or <code>"false"</code>. If set to true, scale-to-zero is enabled. If set to false, applications are scaled down to the configured <em>minimum scale bound</em>. The default value is <code>"true"</code>.</p>
</li>
</ol>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="serverless-scale-to-zero-grace-period_serverless-autoscaling-scale-to-zero">Configuring the scale-to-zero grace period</h4>
<div class="paragraph">
<p>Knative Serving provides automatic scaling down to zero pods for applications. You can use the <code>scale-to-zero-grace-period</code> spec to define an upper bound time limit that Knative waits for scale-to-zero machinery to be in place before the last replica of an application is removed.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You have installed OpenShift Serverless Operator and Knative Serving on your cluster.</p>
</li>
<li>
<p>You have cluster administrator permissions on OpenShift Container Platform, or you have cluster or dedicated administrator permissions on Red Hat OpenShift Service on AWS or OpenShift Dedicated.</p>
</li>
<li>
<p>You are using the default Knative Pod Autoscaler. The scale-to-zero feature is not available if you are using the Kubernetes Horizontal Pod Autoscaler.</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Modify the <code>scale-to-zero-grace-period</code> spec in the <code>KnativeServing</code> custom resource (CR):</p>
<div class="listingblock">
<div class="title">Example KnativeServing CR</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: operator.knative.dev/v1beta1
kind: KnativeServing
metadata:
  name: knative-serving
spec:
  config:
    autoscaler:
      scale-to-zero-grace-period: "30s" <b class="conum">(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The grace period time in seconds. The default value is 30 seconds.</p>
</li>
</ol>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_configuring-serverless-applications">Configuring Serverless applications</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="overriding-config-serving">Overriding Knative Serving system deployment configurations</h3>
<div class="paragraph">
<p>You can override the default configurations for some specific deployments by modifying the <code>deployments</code> spec in the <code>KnativeServing</code> custom resources (CRs).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>You can only override probes that are defined in the deployment by default.</p>
</div>
<div class="paragraph">
<p>All Knative Serving deployments define a readiness and a liveness probe by default, with these exceptions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>net-kourier-controller</code> and <code>3scale-kourier-gateway</code> only define a readiness probe.</p>
</li>
<li>
<p><code>net-istio-controller</code> and <code>net-istio-webhook</code> define no probes.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="knative-serving-CR-system-deployments_overriding-config-serving">Overriding system deployment configurations</h4>
<div class="paragraph">
<p>Currently, overriding default configuration settings is supported for the <code>resources</code>, <code>replicas</code>, <code>labels</code>, <code>annotations</code>, and <code>nodeSelector</code> fields, as well as for the <code>readiness</code> and <code>liveness</code> fields for probes.</p>
</div>
<div class="paragraph">
<p>In the following example, a <code>KnativeServing</code> CR overrides the <code>webhook</code> deployment so that:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>readiness</code> probe timeout for <code>net-kourier-controller</code> is set to be 10 seconds.</p>
</li>
<li>
<p>The deployment has specified CPU and memory resource limits.</p>
</li>
<li>
<p>The deployment has 3 replicas.</p>
</li>
<li>
<p>The <code>example-label: label</code> label is added.</p>
</li>
<li>
<p>The <code>example-annotation: annotation</code> annotation is added.</p>
</li>
<li>
<p>The <code>nodeSelector</code> field is set to select nodes with the <code>disktype: hdd</code> label.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>KnativeServing</code> CR label and annotation settings override the deployment&#8217;s labels and annotations for both the deployment itself and the resulting pods.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">KnativeServing CR example</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: operator.knative.dev/v1beta1
kind: KnativeServing
metadata:
  name: ks
  namespace: knative-serving
spec:
  high-availability:
    replicas: 2
  deployments:
  - name: net-kourier-controller
    readinessProbes: <b class="conum">(1)</b>
      - container: controller
        timeoutSeconds: 10
  - name: webhook
    resources:
    - container: webhook
      requests:
        cpu: 300m
        memory: 60Mi
      limits:
        cpu: 1000m
        memory: 1000Mi
    replicas: 3
    labels:
      example-label: label
    annotations:
      example-annotation: annotation
    nodeSelector:
      disktype: hdd</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>You can use the <code>readiness</code> and <code>liveness</code> probe overrides to override all fields of a probe in a container of a deployment as specified in the Kubernetes API except for the fields related to the probe handler: <code>exec</code>, <code>grpc</code>, <code>httpGet</code>, and <code>tcpSocket</code>.</p>
</li>
</ol>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.25/#probe-v1-core">Probe configuration section of the Kubernetes API documentation</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="multi-container-support-for-serving">Multi-container support for Serving</h3>
<div class="paragraph">
<p>You can deploy a multi-container pod by using a single Knative service. This method is useful for separating application responsibilities into smaller, specialized parts.</p>
</div>
<div class="sect3">
<h4 id="serverless-configuring-multi-container-service_multi-container-support-for-serving">Configuring a multi-container service</h4>
<div class="paragraph">
<p>Multi-container support is enabled by default. You can create a multi-container pod by specifiying multiple containers in the service.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Modify your service to include additional containers. Only one container can handle requests, so specify <code>ports</code> for exactly one container. Here is an example configuration with two containers:</p>
<div class="listingblock">
<div class="title">Multiple containers configuration</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: serving.knative.dev/v1
kind: Service
...
spec:
  template:
    spec:
      containers:
        - name: first-container <b class="conum">(1)</b>
          image: gcr.io/knative-samples/helloworld-go
          ports:
            - containerPort: 8080 <b class="conum">(2)</b>
        - name: second-container <b class="conum">(3)</b>
          image: gcr.io/knative-samples/helloworld-java</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>First container configuration.</p>
</li>
<li>
<p>Port specification for the first container.</p>
</li>
<li>
<p>Second container configuration.</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="empty-dir">EmptyDir volumes</h3>
<div class="paragraph">
<p><code>emptyDir</code> volumes are empty volumes that are created when a pod is created, and are used to provide temporary working disk space. <code>emptyDir</code> volumes are deleted when the pod they were created for is deleted.</p>
</div>
<div class="sect3">
<h4 id="serverless-config-emptydir_empty-dir">Configuring the EmptyDir extension</h4>
<div class="paragraph">
<p>The <code>kubernetes.podspec-volumes-emptydir</code> extension controls whether <code>emptyDir</code> volumes can be used with Knative Serving. To enable using <code>emptyDir</code> volumes, you must modify the <code>KnativeServing</code> custom resource (CR) to include the following YAML:</p>
</div>
<div class="listingblock">
<div class="title">Example KnativeServing CR</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: operator.knative.dev/v1beta1
kind: KnativeServing
metadata:
  name: knative-serving
spec:
  config:
    features:
      kubernetes.podspec-volumes-emptydir: enabled
...</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="pvcs-for-serving">Persistent Volume Claims for Serving</h3>
<div class="paragraph">
<p>Some serverless applications need permanent data storage.
To achieve this, you can configure persistent volume claims (PVCs) for your Knative services.</p>
</div>
<div class="sect3">
<h4 id="serverless-enabling-pvc-support_pvcs-for-serving">Enabling PVC support</h4>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>To enable Knative Serving to use PVCs and write to them, modify the <code>KnativeServing</code> custom resource (CR) to include the following YAML:</p>
<div class="listingblock">
<div class="title">Enabling PVCs with write access</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">...
spec:
  config:
    features:
      "kubernetes.podspec-persistent-volume-claim": enabled
      "kubernetes.podspec-persistent-volume-write": enabled
...</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>kubernetes.podspec-persistent-volume-claim</code> extension controls whether persistent volumes (PVs) can be used with Knative Serving.</p>
</li>
<li>
<p>The <code>kubernetes.podspec-persistent-volume-write</code> extension controls whether PVs are available to Knative Serving with the write access.</p>
</li>
</ul>
</div>
</li>
<li>
<p>To claim a PV, modify your service to include the PV configuration. For example, you might have a persistent volume claim with the following configuration:</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Use the storage class that supports the access mode that you are requesting. For example, you can use the <code>ocs-storagecluster-cephfs</code> class for the <code>ReadWriteMany</code> access mode.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">PersistentVolumeClaim configuration</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: example-pv-claim
  namespace: my-ns
spec:
  accessModes:
    - ReadWriteMany
  storageClassName: ocs-storagecluster-cephfs
  resources:
    requests:
      storage: 1Gi</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case, to claim a PV with write access, modify your service as follows:</p>
</div>
<div class="listingblock">
<div class="title">Knative service PVC configuration</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: serving.knative.dev/v1
kind: Service
metadata:
  namespace: my-ns
...
spec:
 template:
   spec:
     containers:
         ...
         volumeMounts: <b class="conum">(1)</b>
           - mountPath: /data
             name: mydata
             readOnly: false
     volumes:
       - name: mydata
         persistentVolumeClaim: <b class="conum">(2)</b>
           claimName: example-pv-claim
           readOnly: false <b class="conum">(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Volume mount specification.</p>
</li>
<li>
<p>Persistent volume claim specification.</p>
</li>
<li>
<p>Flag that enables read-only access.</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>To successfully use persistent storage in Knative services, you need additional configuration, such as the user permissions for the Knative container user.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3 _additional-resources">
<h4 id="additional-resources_pvcs-for-serving">Additional resources for OpenShift Container Platform</h4>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.openshift.com/container-platform/latest/storage/understanding-persistent-storage.html#understanding-persistent-storage">Understanding persistent storage</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="init-containers">Init containers</h3>
<div class="paragraph">
<p><a href="https://kubernetes.io/docs/concepts/workloads/pods/init-containers/">Init containers</a> are specialized containers that are run before application containers in a pod. They are generally used to implement initialization logic for an application, which may include running setup scripts or downloading required configurations. You can enable the use of init containers for Knative services by modifying the <code>KnativeServing</code> custom resource (CR).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Init containers may cause longer application start-up times and should be used with caution for serverless applications, which are expected to scale up and down frequently.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="serverless-admin-init-containers_init-containers">Enabling init containers</h4>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You have installed OpenShift Serverless Operator and Knative Serving on your cluster.</p>
</li>
<li>
<p>You have cluster administrator permissions on OpenShift Container Platform, or you have cluster or dedicated administrator permissions on Red Hat OpenShift Service on AWS or OpenShift Dedicated.</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Enable the use of init containers by adding the <code>kubernetes.podspec-init-containers</code> flag to the <code>KnativeServing</code> CR:</p>
<div class="listingblock">
<div class="title">Example KnativeServing CR</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: operator.knative.dev/v1beta1
kind: KnativeServing
metadata:
  name: knative-serving
spec:
  config:
    features:
      kubernetes.podspec-init-containers: enabled
...</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="resolving-image-tags-to-digests">Resolving image tags to digests</h3>
<div class="paragraph">
<p>If the Knative Serving controller has access to the container registry, Knative Serving resolves image tags to a digest when you create a revision of a service. This is known as <em>tag-to-digest resolution</em>, and helps to provide consistency for deployments.</p>
</div>
<div class="sect3">
<h4 id="serverless-tag-to-digest-resolution_resolving-image-tags-to-digests">Tag-to-digest resolution</h4>
<div class="paragraph">
<p>To give the controller access to the container registry on OpenShift Container Platform, you must create a secret and then configure controller custom certificates. You can configure controller custom certificates by modifying the <code>controller-custom-certs</code> spec in the <code>KnativeServing</code> custom resource (CR). The secret must reside in the same namespace as the <code>KnativeServing</code> CR.</p>
</div>
<div class="paragraph">
<p>If a secret is not included in the <code>KnativeServing</code> CR, this setting defaults to using public key infrastructure (PKI). When using PKI, the cluster-wide certificates are automatically injected into the Knative Serving controller by using the <code>config-service-sa</code> config map. The OpenShift Serverless Operator populates the <code>config-service-sa</code> config map with cluster-wide certificates and mounts the config map as a volume to the controller.</p>
</div>
<div class="sect4">
<h5 id="knative-serving-controller-custom-certs-secrets_resolving-image-tags-to-digests">Configuring tag-to-digest resolution by using a secret</h5>
<div class="paragraph">
<p>If the <code>controller-custom-certs</code> spec uses the <code>Secret</code> type, the secret is mounted as a secret volume. Knative components consume the secret directly, assuming that the secret has the required certificates.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You have cluster administrator permissions on OpenShift Container Platform, or you have cluster or dedicated administrator permissions on Red Hat OpenShift Service on AWS or OpenShift Dedicated.</p>
</li>
<li>
<p>You have installed the OpenShift Serverless Operator and Knative Serving on your cluster.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create a secret:</p>
<div class="listingblock">
<div class="title">Example command</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">$ oc -n knative-serving create secret generic custom-secret --from-file=&lt;secret_name&gt;.crt=&lt;path_to_certificate&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>Configure the <code>controller-custom-certs</code> spec in the <code>KnativeServing</code> custom resource (CR) to use the <code>Secret</code> type:</p>
<div class="listingblock">
<div class="title">Example KnativeServing CR</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: operator.knative.dev/v1beta1
kind: KnativeServing
metadata:
  name: knative-serving
  namespace: knative-serving
spec:
  controller-custom-certs:
    name: custom-secret
    type: Secret</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="serverless-config-tls">Configuring TLS authentication</h3>
<div class="paragraph">
<p>You can use <em>Transport Layer Security</em> (TLS) to encrypt Knative traffic and for authentication.</p>
</div>
<div class="paragraph">
<p>TLS is the only supported method of traffic encryption for Knative Kafka. Red Hat recommends using both SASL and TLS together for Knative broker for Apache Kafka resources.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>If you want to enable internal TLS with a Red Hat OpenShift Service Mesh integration, you must enable Service Mesh with mTLS instead of the internal encryption explained in the following procedure.</p>
</div>
<div class="paragraph">
<p>For OpenShift Container Platform and Red Hat OpenShift Service on AWS, see the documentation for <a href="https://access.redhat.com/documentation/en-us/red_hat_openshift_serverless/1.29/html-single/integrations/#serverless-ossm-enabling-serving-metrics_serverless-ossm-setup">Enabling Knative Serving metrics when using Service Mesh with mTLS</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="serverless-enabling-tls-internal-traffic_serverless-config-tls">Enabling TLS authentication for internal traffic</h4>
<div class="paragraph">
<p>OpenShift Serverless supports TLS edge termination by default, so that HTTPS traffic from end users is encrypted. However, internal traffic behind the OpenShift route is forwarded to applications by using plain data. By enabling TLS for internal traffic, the traffic sent between components is encrypted, which makes this traffic more secure.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>If you want to enable internal TLS with a Red Hat OpenShift Service Mesh integration, you must enable Service Mesh with mTLS instead of the internal encryption explained in the following procedure.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>Internal TLS encryption support is a Technology Preview feature only. Technology Preview features
are not supported with Red Hat production service level agreements (SLAs) and
might not be functionally complete. Red Hat does not recommend using them
in production. These features provide early access to upcoming product
features, enabling customers to test functionality and provide feedback during
the development process.</p>
</div>
<div class="paragraph">
<p>For more information about the support scope of Red Hat Technology Preview features, see <a href="https://access.redhat.com/support/offerings/techpreview/">Technology Preview Features Support Scope</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You have installed the OpenShift Serverless Operator and Knative Serving.</p>
</li>
<li>
<p>You have installed the OpenShift (<code>oc</code>) CLI.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create a Knative service that includes the <code>internal-encryption: "true"</code> field in the spec:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">...
spec:
  config:
    network:
      internal-encryption: "true"
...</code></pre>
</div>
</div>
</li>
<li>
<p>Restart the activator pods in the <code>knative-serving</code> namespace to load the certificates:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc delete pod -n knative-serving --selector app=activator</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://access.redhat.com/documentation/en-us/red_hat_openshift_serverless/1.29/html-single/eventing/#serverless-kafka-broker-tls-default-config_kafka-broker">Configuring TLS authentication for the Knative broker for Apache Kafka</a></p>
</li>
<li>
<p><a href="https://access.redhat.com/documentation/en-us/red_hat_openshift_serverless/1.29/html-single/eventing/#serverless-kafka-tls-channels_serverless-kafka-admin-security-channels">Configuring TLS authentication for channels for Apache Kafka</a></p>
</li>
<li>
<p><a href="https://access.redhat.com/documentation/en-us/red_hat_openshift_serverless/1.29/html-single/integrations/#serverless-ossm-enabling-serving-metrics_serverless-ossm-setup">Enabling Knative Serving metrics when using Service Mesh with mTLS</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="restrictive-network-policies">Restrictive network policies</h3>
<div class="sect3">
<h4 id="serverless-services-network-policies_restrictive-network-policies">Clusters with restrictive network policies</h4>
<div class="paragraph">
<p>If you are using a cluster that multiple users have access to, your cluster might use network policies to control which pods, services, and namespaces can communicate with each other over the network. If your cluster uses restrictive network policies, it is possible that Knative system pods are not able to access your Knative application. For example, if your namespace has the following network policy, which denies all requests, Knative system pods cannot access your Knative application:</p>
</div>
<div class="listingblock">
<div class="title">Example NetworkPolicy object that denies all requests to the namespace</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">kind: NetworkPolicy
apiVersion: networking.k8s.io/v1
metadata:
  name: deny-by-default
  namespace: example-namespace
spec:
  podSelector:
  ingress: []</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="serverless-services-network-policies-enabling-comms_restrictive-network-policies">Enabling communication with Knative applications on a cluster with restrictive network policies</h4>
<div class="paragraph">
<p>To allow access to your applications from Knative system pods, you must add a label to each of the Knative system namespaces, and then create a <code>NetworkPolicy</code> object in your application namespace that allows access to the namespace for other namespaces that have this label.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>A network policy that denies requests to non-Knative services on your cluster still prevents access to these services. However, by allowing access from Knative system namespaces to your Knative application, you are allowing access to your Knative application from all namespaces in the cluster.</p>
</div>
<div class="paragraph">
<p>If you do not want to allow access to your Knative application from all namespaces on the cluster, you might want to use <em>JSON Web Token authentication for Knative services</em> instead. JSON Web Token authentication for Knative services requires Service Mesh.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Install the OpenShift CLI (<code>oc</code>).</p>
</li>
<li>
<p>OpenShift Serverless Operator and Knative Serving are installed on your cluster.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Add the <code>knative.openshift.io/system-namespace=true</code> label to each Knative system namespace that requires access to your application:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Label the <code>knative-serving</code> namespace:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc label namespace knative-serving knative.openshift.io/system-namespace=true</code></pre>
</div>
</div>
</li>
<li>
<p>Label the <code>knative-serving-ingress</code> namespace:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc label namespace knative-serving-ingress knative.openshift.io/system-namespace=true</code></pre>
</div>
</div>
</li>
<li>
<p>Label the <code>knative-eventing</code> namespace:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc label namespace knative-eventing knative.openshift.io/system-namespace=true</code></pre>
</div>
</div>
</li>
<li>
<p>Label the <code>knative-kafka</code> namespace:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc label namespace knative-kafka knative.openshift.io/system-namespace=true</code></pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Create a <code>NetworkPolicy</code> object in your application namespace to allow access from namespaces with the <code>knative.openshift.io/system-namespace</code> label:</p>
<div class="listingblock">
<div class="title">Example <code>NetworkPolicy</code> object</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: &lt;network_policy_name&gt; <b class="conum">(1)</b>
  namespace: &lt;namespace&gt; <b class="conum">(2)</b>
spec:
  ingress:
  - from:
    - namespaceSelector:
        matchLabels:
          knative.openshift.io/system-namespace: "true"
  podSelector: {}
  policyTypes:
  - Ingress</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Provide a name for your network policy.</p>
</li>
<li>
<p>The namespace where your application exists.</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_traffic-splitting">Traffic splitting</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="traffic-splitting-overview">Traffic splitting overview</h3>
<div class="paragraph">
<p>In a Knative application, traffic can be managed by creating a traffic split. A traffic split is configured as part of a route, which is managed by a Knative service.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/knative-service-architecture.png" alt="Traffic management for a Knative application">
</div>
</div>
<div class="paragraph">
<p>Configuring a route allows requests to be sent to different revisions of a service. This routing is determined by the <code>traffic</code> spec of the <code>Service</code> object.</p>
</div>
<div class="paragraph">
<p>A <code>traffic</code> spec declaration consists of one or more revisions, each responsible for handling a portion of the overall traffic. The percentages of traffic routed to each revision must add up to 100%, which is ensured by a Knative validation.</p>
</div>
<div class="paragraph">
<p>The revisions specified in a <code>traffic</code> spec can either be a fixed, named revision, or can point to the “latest” revision, which tracks the head of the list of all revisions for the service. The "latest" revision is a type of floating reference that updates if a new revision is created. Each revision can have a tag attached that creates an additional access URL for that revision.</p>
</div>
<div class="paragraph">
<p>The <code>traffic</code> spec can be modified by:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Editing the YAML of a <code>Service</code> object directly.</p>
</li>
<li>
<p>Using the Knative (<code>kn</code>) CLI <code>--traffic</code> flag.</p>
</li>
<li>
<p>Using the OpenShift Container Platform web console.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When you create a Knative service, it does not have any default <code>traffic</code> spec settings.</p>
</div>
</div>
<div class="sect2">
<h3 id="traffic-spec-examples">Traffic spec examples</h3>
<div class="paragraph">
<p>The following example shows a <code>traffic</code> spec where 100% of traffic is routed to the latest revision of the service. Under <code>status</code>, you can see the name of the latest revision that <code>latestRevision</code> resolves to:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: serving.knative.dev/v1
kind: Service
metadata:
  name: example-service
  namespace: default
spec:
...
  traffic:
  - latestRevision: true
    percent: 100
status:
  ...
  traffic:
  - percent: 100
    revisionName: example-service</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following example shows a <code>traffic</code> spec where 100% of traffic is routed to the revision tagged as <code>current</code>, and the name of that revision is specified as <code>example-service</code>. The revision tagged as <code>latest</code> is kept available, even though no traffic is routed to it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: serving.knative.dev/v1
kind: Service
metadata:
  name: example-service
  namespace: default
spec:
...
  traffic:
  - tag: current
    revisionName: example-service
    percent: 100
  - tag: latest
    latestRevision: true
    percent: 0</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following example shows how the list of revisions in the <code>traffic</code> spec can be extended so that traffic is split between multiple revisions. This example sends 50% of traffic to the revision tagged as <code>current</code>, and 50% of traffic to the revision tagged as <code>candidate</code>. The revision tagged as <code>latest</code> is kept available, even though no traffic is routed to it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: serving.knative.dev/v1
kind: Service
metadata:
  name: example-service
  namespace: default
spec:
...
  traffic:
  - tag: current
    revisionName: example-service-1
    percent: 50
  - tag: candidate
    revisionName: example-service-2
    percent: 50
  - tag: latest
    latestRevision: true
    percent: 0</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="traffic-splitting-using-cli">Traffic splitting using the Knative CLI</h3>
<div class="paragraph">
<p>Using the Knative (<code>kn</code>) CLI to create traffic splits provides a more streamlined and intuitive user interface over modifying YAML files directly. You can use the <code>kn service update</code> command to split traffic between revisions of a service.</p>
</div>
<div class="sect3">
<h4 id="serverless-create-traffic-split-kn_traffic-splitting-using-cli">Creating a traffic split by using the Knative CLI</h4>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>The OpenShift Serverless Operator and Knative Serving are installed on your cluster.</p>
</li>
<li>
<p>You have installed the Knative (<code>kn</code>) CLI.</p>
</li>
<li>
<p>You have created a Knative service.</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Specify the revision of your service and what percentage of traffic you want to route to it by using the <code>--traffic</code> tag with a standard <code>kn service update</code> command:</p>
<div class="listingblock">
<div class="title">Example command</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ kn service update &lt;service_name&gt; --traffic &lt;revision&gt;=&lt;percentage&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Where:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>&lt;service_name&gt;</code> is the name of the Knative service that you are configuring traffic routing for.</p>
</li>
<li>
<p><code>&lt;revision&gt;</code> is the revision that you want to configure to receive a percentage of traffic. You can either specify the name of the revision, or a tag that you assigned to the revision by using the <code>--tag</code> flag.</p>
</li>
<li>
<p><code>&lt;percentage&gt;</code> is the percentage of traffic that you want to send to the specified revision.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Optional: The <code>--traffic</code> flag can be specified multiple times in one command. For example, if you have a revision tagged as <code>@latest</code> and a revision named <code>stable</code>, you can specify the percentage of traffic that you want to split to each revision as follows:</p>
<div class="listingblock">
<div class="title">Example command</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ kn service update example-service --traffic @latest=20,stable=80</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you have multiple revisions and do not specify the percentage of traffic that should be split to the last revision, the <code>--traffic</code> flag can calculate this automatically. For example, if you have a third revision named <code>example</code>, and you use the following command:</p>
</div>
<div class="listingblock">
<div class="title">Example command</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ kn service update example-service --traffic @latest=10,stable=60</code></pre>
</div>
</div>
<div class="paragraph">
<p>The remaining 30% of traffic is split to the <code>example</code> revision, even though it was not specified.</p>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="traffic-splitting-flags">CLI flags for traffic splitting</h3>
<div class="paragraph">
<p>The Knative (<code>kn</code>) CLI supports traffic operations on the traffic block of a service as part of the <code>kn service update</code> command.</p>
</div>
<div class="sect3">
<h4 id="serverless-traffic-splitting-flags-kn_traffic-splitting-flags">Knative CLI traffic splitting flags</h4>
<div class="paragraph">
<p>The following table displays a summary of traffic splitting flags, value formats, and the operation the flag performs. The <strong>Repetition</strong> column denotes whether repeating the particular value of flag is allowed in a <code>kn service update</code> command.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Flag</th>
<th class="tableblock halign-left valign-top">Value(s)</th>
<th class="tableblock halign-left valign-top">Operation</th>
<th class="tableblock halign-left valign-top">Repetition</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--traffic</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RevisionName=Percent</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Gives <code>Percent</code> traffic to <code>RevisionName</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--traffic</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Tag=Percent</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Gives <code>Percent</code> traffic to the revision having <code>Tag</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--traffic</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@latest=Percent</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Gives <code>Percent</code> traffic to the latest ready revision</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--tag</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RevisionName=Tag</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Gives <code>Tag</code> to <code>RevisionName</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--tag</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@latest=Tag</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Gives <code>Tag</code> to the latest ready revision</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--untag</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Tag</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Removes <code>Tag</code> from revision</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
</tbody>
</table>
<div class="sect4">
<h5 id="serverless-traffic-splitting-flags-kn-precedence_traffic-splitting-flags">Multiple flags and order precedence</h5>
<div class="paragraph">
<p>All traffic-related flags can be specified using a single <code>kn service update</code> command. <code>kn</code> defines the precedence of these flags. The order of the flags specified when using the command is not taken into account.</p>
</div>
<div class="paragraph">
<p>The precedence of the flags as they are evaluated by <code>kn</code> are:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>--untag</code>: All the referenced revisions with this flag are removed from the traffic block.</p>
</li>
<li>
<p><code>--tag</code>: Revisions are tagged as specified in the traffic block.</p>
</li>
<li>
<p><code>--traffic</code>: The referenced revisions are assigned a portion of the traffic split.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>You can add tags to revisions and then split traffic according to the tags you have set.</p>
</div>
</div>
<div class="sect4">
<h5 id="serverless-custom-revision-urls_traffic-splitting-flags">Custom URLs for revisions</h5>
<div class="paragraph">
<p>Assigning a <code>--tag</code> flag to a service by using the <code>kn service update</code> command creates a custom URL for the revision that is created when you update the service. The custom URL follows the pattern <code><a href="https://&lt;tag&gt;-&lt;service_name&gt;-&lt;namespace&gt;.&lt;domain&gt" class="bare">https://&lt;tag&gt;-&lt;service_name&gt;-&lt;namespace&gt;.&lt;domain&gt</a>;</code> or <code><a href="http://&lt;tag&gt;-&lt;service_name&gt;-&lt;namespace&gt;.&lt;domain&gt" class="bare">http://&lt;tag&gt;-&lt;service_name&gt;-&lt;namespace&gt;.&lt;domain&gt</a>;</code>.</p>
</div>
<div class="paragraph">
<p>The <code>--tag</code> and <code>--untag</code> flags use the following syntax:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Require one value.</p>
</li>
<li>
<p>Denote a unique tag in the traffic block of the service.</p>
</li>
<li>
<p>Can be specified multiple times in one command.</p>
</li>
</ul>
</div>
<div class="sect5">
<h6 id="serverless-custom-revision-urls-assign_traffic-splitting-flags">Example: Assign a tag to a revision</h6>
<div class="paragraph">
<p>The following example assigns the tag <code>latest</code> to a revision named <code>example-revision</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ kn service update &lt;service_name&gt; --tag @latest=example-tag</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="serverless-custom-revision-urls-remove_traffic-splitting-flags">Example: Remove a tag from a revision</h6>
<div class="paragraph">
<p>You can remove a tag to remove the custom URL, by using the <code>--untag</code> flag.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>If a revision has its tags removed, and it is assigned 0% of the traffic, the revision is removed from the traffic block entirely.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following command removes all tags from the revision named <code>example-revision</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ kn service update &lt;service_name&gt; --untag example-tag</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="traffic-splitting-revisions">Splitting traffic between revisions</h3>
<div class="paragraph">
<p>After you create a serverless application, the application is displayed in the <strong>Topology</strong> view of the <strong>Developer</strong> perspective in the OpenShift Container Platform web console. The application revision is represented by the node, and the Knative service is indicated by a quadrilateral around the node.</p>
</div>
<div class="paragraph">
<p>Any new change in the code or the service configuration creates a new revision, which is a snapshot of the code at a given time. For a service, you can manage the traffic between the revisions of the service by splitting and routing it to the different revisions as required.</p>
</div>
<div class="sect3">
<h4 id="odc-splitting-traffic-between-revisions-using-developer-perspective_traffic-splitting-revisions">Managing traffic between revisions by using the OpenShift Container Platform web console</h4>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>The OpenShift Serverless Operator and Knative Serving are installed on your cluster.</p>
</li>
<li>
<p>You have logged in to the OpenShift Container Platform web console.</p>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>To split traffic between multiple revisions of an application in the <strong>Topology</strong> view:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click the Knative service to see its overview in the side panel.</p>
</li>
<li>
<p>Click the <strong>Resources</strong> tab, to see a list of <strong>Revisions</strong> and <strong>Routes</strong> for the service.</p>
<div class="imageblock">
<div class="content">
<img src="images/odc-serverless-app.png" alt="odc serverless app">
</div>
<div class="title">Figure 1. Serverless application</div>
</div>
</li>
<li>
<p>Click the service, indicated by the <strong>S</strong> icon at the top of the side panel, to see an overview of the service details.</p>
</li>
<li>
<p>Click the <strong>YAML</strong> tab and modify the service configuration in the YAML editor, and click <strong>Save</strong>. For example, change the <code>timeoutseconds</code> from 300 to 301 . This change in the configuration triggers a new revision. In the <strong>Topology</strong> view, the latest revision is displayed and the <strong>Resources</strong> tab for the service now displays the two revisions.</p>
</li>
<li>
<p>In the <strong>Resources</strong> tab, click <b class="button">Set Traffic Distribution</b> to see the traffic distribution dialog box:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Add the split traffic percentage portion for the two revisions in the <strong>Splits</strong> field.</p>
</li>
<li>
<p>Add tags to create custom URLs for the two revisions.</p>
</li>
<li>
<p>Click <strong>Save</strong> to see two nodes representing the two revisions in the Topology view.</p>
<div class="imageblock">
<div class="content">
<img src="images/odc-serverless-revisions.png" alt="odc serverless revisions">
</div>
<div class="title">Figure 2. Serverless application revisions</div>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="traffic-splitting-blue-green">Rerouting traffic using blue-green strategy</h3>
<div class="paragraph">
<p>You can safely reroute traffic from a production version of an app to a new version, by using a <a href="https://en.wikipedia.org/wiki/Blue-green_deployment">blue-green deployment strategy</a>.</p>
</div>
<div class="sect3">
<h4 id="serverless-blue-green-deploy_traffic-splitting-blue-green">Routing and managing traffic by using a blue-green deployment strategy</h4>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>The OpenShift Serverless Operator and Knative Serving are installed on the cluster.</p>
</li>
<li>
<p>Install the OpenShift CLI (<code>oc</code>).</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create and deploy an app as a Knative service.</p>
</li>
<li>
<p>Find the name of the first revision that was created when you deployed the service, by viewing the output from the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc get ksvc &lt;service_name&gt; -o=jsonpath='{.status.latestCreatedRevisionName}'</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example command</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc get ksvc example-service -o=jsonpath='{.status.latestCreatedRevisionName}'</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ example-service-00001</code></pre>
</div>
</div>
</li>
<li>
<p>Add the following YAML to the service <code>spec</code> to send inbound traffic to the revision:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">...
spec:
  traffic:
    - revisionName: &lt;first_revision_name&gt;
      percent: 100 # All traffic goes to this revision
...</code></pre>
</div>
</div>
</li>
<li>
<p>Verify that you can view your app at the URL output you get from running the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc get ksvc &lt;service_name&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>Deploy a second revision of your app by modifying at least one field in the <code>template</code> spec of the service and redeploying it. For example, you can modify the <code>image</code> of the service, or an <code>env</code> environment variable. You can redeploy the service by applying the service YAML file, or by using the <code>kn service update</code> command if you have installed the Knative (<code>kn</code>) CLI.</p>
</li>
<li>
<p>Find the name of the second, latest revision that was created when you redeployed the service, by running the command:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc get ksvc &lt;service_name&gt; -o=jsonpath='{.status.latestCreatedRevisionName}'</code></pre>
</div>
</div>
<div class="paragraph">
<p>At this point, both the first and second revisions of the service are deployed and running.</p>
</div>
</li>
<li>
<p>Update your existing service to create a new, test endpoint for the second revision, while still sending all other traffic to the first revision:</p>
<div class="listingblock">
<div class="title">Example of updated service spec with test endpoint</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">...
spec:
  traffic:
    - revisionName: &lt;first_revision_name&gt;
      percent: 100 # All traffic is still being routed to the first revision
    - revisionName: &lt;second_revision_name&gt;
      percent: 0 # No traffic is routed to the second revision
      tag: v2 # A named route
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>After you redeploy this service by reapplying the YAML resource, the second revision of the app is now staged. No traffic is routed to the second revision at the main URL, and Knative creates a new service named <code>v2</code> for testing the newly deployed revision.</p>
</div>
</li>
<li>
<p>Get the URL of the new service for the second revision, by running the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc get ksvc &lt;service_name&gt; --output jsonpath="{.status.traffic[*].url}"</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can use this URL to validate that the new version of the app is behaving as expected before you route any traffic to it.</p>
</div>
</li>
<li>
<p>Update your existing service again, so that 50% of traffic is sent to the first revision, and 50% is sent to the second revision:</p>
<div class="listingblock">
<div class="title">Example of updated service spec splitting traffic 50/50 between revisions</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">...
spec:
  traffic:
    - revisionName: &lt;first_revision_name&gt;
      percent: 50
    - revisionName: &lt;second_revision_name&gt;
      percent: 50
      tag: v2
...</code></pre>
</div>
</div>
</li>
<li>
<p>When you are ready to route all traffic to the new version of the app, update the service again to send 100% of traffic to the second revision:</p>
<div class="listingblock">
<div class="title">Example of updated service spec sending all traffic to the second revision</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">...
spec:
  traffic:
    - revisionName: &lt;first_revision_name&gt;
      percent: 0
    - revisionName: &lt;second_revision_name&gt;
      percent: 100
      tag: v2
...</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph">
<p>You can remove the first revision instead of setting it to 0% of traffic if you do not plan to roll back the revision. Non-routeable revision objects are then garbage-collected.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Visit the URL of the first revision to verify that no more traffic is being sent to the old version of the app.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_external-and-ingress-routing">External and Ingress routing</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="routing-overview">Routing overview</h3>
<div class="paragraph">
<p>Knative leverages OpenShift Container Platform TLS termination to provide routing for Knative services. When a Knative service is created, an OpenShift Container Platform route is automatically created for the service. This route is managed by the OpenShift Serverless Operator. The OpenShift Container Platform route exposes the Knative service through the same domain as the OpenShift Container Platform cluster.</p>
</div>
<div class="paragraph">
<p>You can disable Operator control of OpenShift Container Platform routing so that you can configure a Knative route to directly use your TLS certificates instead.</p>
</div>
<div class="paragraph">
<p>Knative routes can also be used alongside the OpenShift Container Platform route to provide additional fine-grained routing capabilities, such as traffic splitting.</p>
</div>
<div class="sect3 _additional-resources">
<h4 id="additional-resources_serverless-configuring-routes">Additional resources for OpenShift Container Platform</h4>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.openshift.com/container-platform/latest/networking/routes/route-configuration.html#nw-route-specific-annotations_route-configuration">Route-specific annotations</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="customize-labels-annotations-routes">Customizing labels and annotations</h3>
<div class="paragraph">
<p>OpenShift Container Platform routes support the use of custom labels and annotations, which you can configure by modifying the <code>metadata</code> spec of a Knative service. Custom labels and annotations are propagated from the service to the Knative route, then to the Knative ingress, and finally to the OpenShift Container Platform route.</p>
</div>
<div class="sect3">
<h4 id="serverless-customize-labels-annotations-routes_customize-labels-annotations-routes">Customizing labels and annotations for OpenShift Container Platform routes</h4>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You must have the OpenShift Serverless Operator and Knative Serving installed on your OpenShift Container Platform cluster.</p>
</li>
<li>
<p>Install the OpenShift CLI (<code>oc</code>).</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create a Knative service that contains the label or annotation that you want to propagate to the OpenShift Container Platform route:</p>
<div class="ulist">
<ul>
<li>
<p>To create a service by using YAML:</p>
<div class="listingblock">
<div class="title">Example service created by using YAML</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: serving.knative.dev/v1
kind: Service
metadata:
  name: &lt;service_name&gt;
  labels:
    &lt;label_name&gt;: &lt;label_value&gt;
  annotations:
    &lt;annotation_name&gt;: &lt;annotation_value&gt;
...</code></pre>
</div>
</div>
</li>
<li>
<p>To create a service by using the Knative (<code>kn</code>) CLI, enter:</p>
<div class="listingblock">
<div class="title">Example service created by using a <code>kn</code> command</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ kn service create &lt;service_name&gt; \
  --image=&lt;image&gt; \
  --annotation &lt;annotation_name&gt;=&lt;annotation_value&gt; \
  --label &lt;label_value&gt;=&lt;label_value&gt;</code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Verify that the OpenShift Container Platform route has been created with the annotation or label that you added by inspecting the output from the following command:</p>
<div class="listingblock">
<div class="title">Example command for verification</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc get routes.route.openshift.io \
     -l serving.knative.openshift.io/ingressName=&lt;service_name&gt; \ <b class="conum">(1)</b>
     -l serving.knative.openshift.io/ingressNamespace=&lt;service_namespace&gt; \ <b class="conum">(2)</b>
     -n knative-serving-ingress -o yaml \
         | grep -e "&lt;label_name&gt;: \"&lt;label_value&gt;\""  -e "&lt;annotation_name&gt;: &lt;annotation_value&gt;" <b class="conum">(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Use the name of your service.</p>
</li>
<li>
<p>Use the namespace where your service was created.</p>
</li>
<li>
<p>Use your values for the label and annotation names and values.</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configuring-service-routes">Configuring routes for Knative services</h3>
<div class="paragraph">
<p>If you want to configure a Knative service to use your TLS certificate on OpenShift Container Platform, you must disable the automatic creation of a route for the service by the OpenShift Serverless Operator and instead manually create a route for the service.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>When you complete the following procedure, the default OpenShift Container Platform route in the <code>knative-serving-ingress</code> namespace is not created. However, the Knative route for the application is still created in this namespace.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="serverless-openshift-routes_configuring-service-routes">Configuring OpenShift Container Platform routes for Knative services</h4>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>The OpenShift Serverless Operator and Knative Serving component must be installed on your OpenShift Container Platform cluster.</p>
</li>
<li>
<p>Install the OpenShift CLI (<code>oc</code>).</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create a Knative service that includes the <code>serving.knative.openshift.io/disableRoute=true</code> annotation:</p>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>serving.knative.openshift.io/disableRoute=true</code> annotation instructs OpenShift Serverless to not automatically create a route for you. However, the service still shows a URL and reaches a status of <code>Ready</code>. This URL does not work externally until you create your own route with the same hostname as the hostname in the URL.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Create a Knative <code>Service</code> resource:</p>
<div class="listingblock">
<div class="title">Example resource</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: serving.knative.dev/v1
kind: Service
metadata:
  name: &lt;service_name&gt;
  annotations:
    serving.knative.openshift.io/disableRoute: "true"
spec:
  template:
    spec:
      containers:
      - image: &lt;image&gt;
...</code></pre>
</div>
</div>
</li>
<li>
<p>Apply the <code>Service</code> resource:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc apply -f &lt;filename&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>Optional. Create a Knative service by using the <code>kn service create</code> command:</p>
<div class="listingblock">
<div class="title">Example <code>kn</code> command</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ kn service create &lt;service_name&gt; \
  --image=gcr.io/knative-samples/helloworld-go \
  --annotation serving.knative.openshift.io/disableRoute=true</code></pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Verify that no OpenShift Container Platform route has been created for the service:</p>
<div class="listingblock">
<div class="title">Example command</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ $ oc get routes.route.openshift.io \
  -l serving.knative.openshift.io/ingressName=$KSERVICE_NAME \
  -l serving.knative.openshift.io/ingressNamespace=$KSERVICE_NAMESPACE \
  -n knative-serving-ingress</code></pre>
</div>
</div>
<div class="paragraph">
<p>You will see the following output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">No resources found in knative-serving-ingress namespace.</code></pre>
</div>
</div>
</li>
<li>
<p>Create a <code>Route</code> resource in the <code>knative-serving-ingress</code> namespace:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: route.openshift.io/v1
kind: Route
metadata:
  annotations:
    haproxy.router.openshift.io/timeout: 600s <b class="conum">(1)</b>
  name: &lt;route_name&gt; <b class="conum">(2)</b>
  namespace: knative-serving-ingress <b class="conum">(3)</b>
spec:
  host: &lt;service_host&gt; <b class="conum">(4)</b>
  port:
    targetPort: http2
  to:
    kind: Service
    name: kourier
    weight: 100
  tls:
    insecureEdgeTerminationPolicy: Allow
    termination: edge <b class="conum">(5)</b>
    key: |-
      -----BEGIN PRIVATE KEY-----
      [...]
      -----END PRIVATE KEY-----
    certificate: |-
      -----BEGIN CERTIFICATE-----
      [...]
      -----END CERTIFICATE-----
    caCertificate: |-
      -----BEGIN CERTIFICATE-----
      [...]
      -----END CERTIFICATE----
  wildcardPolicy: None</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The timeout value for the OpenShift Container Platform route. You must set the same value as the <code>max-revision-timeout-seconds</code> setting (<code>600s</code> by default).</p>
</li>
<li>
<p>The name of the OpenShift Container Platform route.</p>
</li>
<li>
<p>The namespace for the OpenShift Container Platform route. This must be <code>knative-serving-ingress</code>.</p>
</li>
<li>
<p>The hostname for external access. You can set this to <code>&lt;service_name&gt;-&lt;service_namespace&gt;.&lt;domain&gt;</code>.</p>
</li>
<li>
<p>The certificates you want to use. Currently, only <code>edge</code> termination is supported.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Apply the <code>Route</code> resource:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc apply -f &lt;filename&gt;</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="https-redirect-global">Global HTTPS redirection</h3>
<div class="paragraph">
<p>HTTPS redirection provides redirection for incoming HTTP requests. These redirected HTTP requests are encrypted. You can enable HTTPS redirection for all services on the cluster by configuring the <code>httpProtocol</code> spec for the <code>KnativeServing</code> custom resource (CR).</p>
</div>
<div class="sect3">
<h4 id="serverless-https-redirect-global_https-redirect-global">HTTPS redirection global settings</h4>
<div class="listingblock">
<div class="title">Example <code>KnativeServing</code> CR that enables HTTPS redirection</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: operator.knative.dev/v1beta1
kind: KnativeServing
metadata:
  name: knative-serving
spec:
  config:
    network:
      httpProtocol: "redirected"
...</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="url-scheme-external-routes">URL scheme for external routes</h3>
<div class="paragraph">
<p>The URL scheme of external routes defaults to HTTPS for enhanced security. This scheme is determined by the <code>default-external-scheme</code> key in the <code>KnativeServing</code> custom resource (CR) spec.</p>
</div>
<div class="sect3">
<h4 id="serverless-url-scheme-external-routes_url-scheme-external-routes">Setting the URL scheme for external routes</h4>
<div class="listingblock">
<div class="title">Default spec</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">...
spec:
  config:
    network:
      default-external-scheme: "https"
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can override the default spec to use HTTP by modifying the <code>default-external-scheme</code> key:</p>
</div>
<div class="listingblock">
<div class="title">HTTP override spec</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">...
spec:
  config:
    network:
      default-external-scheme: "http"
...</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="https-redirect-per-service">HTTPS redirection per service</h3>
<div class="paragraph">
<p>You can enable or disable HTTPS redirection for a service by configuring the <code>networking.knative.dev/http-option</code> annotation.</p>
</div>
<div class="sect3">
<h4 id="serverless-https-redirect-service_https-redirect-per-service">Redirecting HTTPS for a service</h4>
<div class="paragraph">
<p>The following example shows how you can use this annotation in a Knative <code>Service</code> YAML object:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: serving.knative.dev/v1
kind: Service
metadata:
  name: example
  namespace: default
  annotations:
    networking.knative.dev/http-option: "redirected"
spec:
  ...</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="cluster-local-availability">Cluster local availability</h3>
<div class="paragraph">
<p>By default, Knative services are published to a public IP address.
Being published to a public IP address means that Knative services are public applications, and have a publicly accessible URL.</p>
</div>
<div class="paragraph">
<p>Publicly accessible URLs are accessible from outside of the cluster.
However, developers may need to build back-end services that are only be accessible from inside the cluster, known as <em>private services</em>.
Developers can label individual services in the cluster with the <code>networking.knative.dev/visibility=cluster-local</code> label to make them private.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>For OpenShift Serverless 1.15.0 and newer versions, the <code>serving.knative.dev/visibility</code> label is no longer available. You must update existing services to use the <code>networking.knative.dev/visibility</code> label instead.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="knative-service-cluster-local_cluster-local-availability">Setting cluster availability to cluster local</h4>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>The OpenShift Serverless Operator and Knative Serving are installed on the cluster.</p>
</li>
<li>
<p>You have created a Knative service.</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Set the visibility for your service by adding the <code>networking.knative.dev/visibility=cluster-local</code> label:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc label ksvc &lt;service_name&gt; networking.knative.dev/visibility=cluster-local</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Verification</div>
<ul>
<li>
<p>Check that the URL for your service is now in the format <code>http://&lt;service_name&gt;.&lt;namespace&gt;.svc.cluster.local</code>, by entering the following command and reviewing the output:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-termina" data-lang="termina">$ oc get ksvc</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">NAME            URL                                                                         LATESTCREATED     LATESTREADY       READY   REASON
hello           http://hello.default.svc.cluster.local                                      hello-tx2g7       hello-tx2g7       True</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="serverless-enabling-tls-local-services_cluster-local-availability">Enabling TLS authentication for cluster local services</h4>
<div class="paragraph">
<p>For cluster local services, the Kourier local gateway <code>kourier-internal</code> is used. If you want to use TLS traffic against the Kourier local gateway, you must configure your own server certificates in the local gateway.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You have installed the OpenShift Serverless Operator and Knative Serving.</p>
</li>
<li>
<p>You have administrator permissions.</p>
</li>
<li>
<p>You have installed the OpenShift (<code>oc</code>) CLI.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Deploy server certificates in the <code>knative-serving-ingress</code> namespace:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ export san="knative"</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Subject Alternative Name (SAN) validation is required so that these certificates can serve the request to <code>&lt;app_name&gt;.&lt;namespace&gt;.svc.cluster.local</code>.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Generate a root key and certificate:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ openssl req -x509 -sha256 -nodes -days 365 -newkey rsa:2048 \
    -subj '/O=Example/CN=Example' \
    -keyout ca.key \
    -out ca.crt</code></pre>
</div>
</div>
</li>
<li>
<p>Generate a server key that uses SAN validation:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ openssl req -out tls.csr -newkey rsa:2048 -nodes -keyout tls.key \
  -subj "/CN=Example/O=Example" \
  -addext "subjectAltName = DNS:$san"</code></pre>
</div>
</div>
</li>
<li>
<p>Create server certificates:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ openssl x509 -req -extfile &lt;(printf "subjectAltName=DNS:$san") \
  -days 365 -in tls.csr \
  -CA ca.crt -CAkey ca.key -CAcreateserial -out tls.crt</code></pre>
</div>
</div>
</li>
<li>
<p>Configure a secret for the Kourier local gateway:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Deploy a secret in <code>knative-serving-ingress</code> namespace from the certificates created by the previous steps:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc create -n knative-serving-ingress secret tls server-certs \
    --key=tls.key \
    --cert=tls.crt --dry-run=client -o yaml | oc apply -f -</code></pre>
</div>
</div>
</li>
<li>
<p>Update the <code>KnativeServing</code> custom resource (CR) spec to use the secret that was created by the Kourier gateway:</p>
<div class="listingblock">
<div class="title">Example KnativeServing CR</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">...
spec:
  config:
    kourier:
      cluster-cert-secret: server-certs
...</code></pre>
</div>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>The Kourier controller sets the certificate without restarting the service, so that you do not need to restart the pod.</p>
</div>
<div class="paragraph">
<p>You can access the Kourier internal service with TLS through port <code>443</code> by mounting and using the <code>ca.crt</code> from the client.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="kourier-gateway-service-type">Kourier Gateway service type</h3>
<div class="paragraph">
<p>The Kourier Gateway is exposed by default as the <code>ClusterIP</code> service type. This service type is determined by the <code>service-type</code> ingress spec in the <code>KnativeServing</code> custom resource (CR).</p>
</div>
<div class="listingblock">
<div class="title">Default spec</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">...
spec:
  ingress:
    kourier:
      service-type: ClusterIP
...</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="serverless-kourier-gateway-service-type_kourier-gateway-service-type">Setting the Kourier Gateway service type</h4>
<div class="paragraph">
<p>You can override the default service type to use a load balancer service type instead by modifying the <code>service-type</code> spec:</p>
</div>
<div class="listingblock">
<div class="title">LoadBalancer override spec</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">...
spec:
  ingress:
    kourier:
      service-type: LoadBalancer
...</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="using-http2-gRPC_kourier-gateway-service-type">Using HTTP2 and gRPC</h3>
<div class="paragraph">
<p>OpenShift Serverless supports only insecure or edge-terminated routes. Insecure or edge-terminated routes do not support HTTP2 on OpenShift Container Platform. These routes also do not support gRPC because gRPC is transported by HTTP2. If you use these protocols in your application, you must call the application using the ingress gateway directly. To do this you must find the ingress gateway&#8217;s public address and the application&#8217;s specific host.</p>
</div>
<div class="sect3">
<h4 id="interacting-serverless-apps-http2-grpc_using-http2-gRPC">Interacting with a serverless application using HTTP2 and gRPC</h4>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>This method applies to OpenShift Container Platform 4.10 and later. For older versions, see the following section.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Install OpenShift Serverless Operator and Knative Serving on your cluster.</p>
</li>
<li>
<p>Install the OpenShift CLI (<code>oc</code>).</p>
</li>
<li>
<p>Create a Knative service.</p>
</li>
<li>
<p>Upgrade OpenShift Container Platform 4.10 or later.</p>
</li>
<li>
<p>Enable HTTP/2 on OpenShift Ingress controller.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Add the <code>serverless.openshift.io/default-enable-http2=true</code> annotation to the <code>KnativeServing</code> Custom Resource:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc annotate knativeserving &lt;your_knative_CR&gt; -n knative-serving serverless.openshift.io/default-enable-http2=true</code></pre>
</div>
</div>
</li>
<li>
<p>After the annotation is added, you can verify that the <code>appProtocol</code> value of the Kourier service is <code>h2c</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc get svc -n knative-serving-ingress kourier -o jsonpath="{.spec.ports[0].appProtocol}"</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">h2c</code></pre>
</div>
</div>
</li>
<li>
<p>Now you can use the gRPC framework over the HTTP/2 protocol for external traffic, for example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-golang" data-lang="golang">import "google.golang.org/grpc"

grpc.Dial(
   YOUR_URL, <b class="conum">(1)</b>
   grpc.WithTransportCredentials(insecure.NewCredentials())), <b class="conum">(2)</b>
)</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Your <code>ksvc</code> URL.</p>
</li>
<li>
<p>Your certificate.</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://docs.openshift.com/container-platform/latest/networking/ingress-operator.html#nw-http2-haproxy_configuring-ingress">Enabling HTTP/2 Ingress connectivity</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="interacting-serverless-apps-http2-grpc-up-to-4-9_using-http2-gRPC">Interacting with a serverless application using HTTP2 and gRPC in OpenShift Container Platform 4.9 and older</h4>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>This method needs to expose Kourier Gateway using the <code>LoadBalancer</code> service type. You can configure this by adding the following YAML to your <code>KnativeServing</code> custom resource definition (CRD):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">...
spec:
  ingress:
    kourier:
      service-type: LoadBalancer
...</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Install OpenShift Serverless Operator and Knative Serving on your cluster.</p>
</li>
<li>
<p>Install the OpenShift CLI (<code>oc</code>).</p>
</li>
<li>
<p>Create a Knative service.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Find the application host. See the instructions in <em>Verifying your serverless application deployment</em>.</p>
</li>
<li>
<p>Find the ingress gateway&#8217;s public address:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc -n knative-serving-ingress get svc kourier</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">NAME                   TYPE           CLUSTER-IP      EXTERNAL-IP                                                             PORT(S)                                                                                                                                      AGE
kourier   LoadBalancer   172.30.51.103   a83e86291bcdd11e993af02b7a65e514-33544245.us-east-1.elb.amazonaws.com   80:31380/TCP,443:31390/TCP   67m</code></pre>
</div>
</div>
<div class="paragraph">
<p>The public address is surfaced in the <code>EXTERNAL-IP</code> field, and in this case is <code>a83e86291bcdd11e993af02b7a65e514-33544245.us-east-1.elb.amazonaws.com</code>.</p>
</div>
</li>
<li>
<p>Manually set the host header of your HTTP request to the application&#8217;s host, but direct the request itself against the public address of the ingress gateway.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ curl -H "Host: hello-default.example.com" a83e86291bcdd11e993af02b7a65e514-33544245.us-east-1.elb.amazonaws.com</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">Hello Serverless!</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also make a direct gRPC request against the ingress gateway:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-golang" data-lang="golang">import "google.golang.org/grpc"

grpc.Dial(
    "a83e86291bcdd11e993af02b7a65e514-33544245.us-east-1.elb.amazonaws.com:80",
    grpc.WithAuthority("hello-default.example.com:80"),
    grpc.WithInsecure(),
)</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Ensure that you append the respective port, 80 by default, to both hosts as shown in the previous example.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_configuring-access-to-knative-services">Configuring access to Knative services</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="serverless-ossm-with-kourier-jwt">Configuring JSON Web Token authentication for Knative services</h3>
<div class="paragraph">
<p>OpenShift Serverless does not currently have user-defined authorization features. To add user-defined authorization to your deployment, you must integrate OpenShift Serverless with Red Hat OpenShift Service Mesh, and then configure JSON Web Token (JWT) authentication and sidecar injection for Knative services.</p>
</div>
</div>
<div class="sect2">
<h3 id="serverless-ossm-v2x-jwt">Using JSON Web Token authentication with Service Mesh 2.x</h3>
<div class="paragraph">
<p>You can use JSON Web Token (JWT) authentication with Knative services by using Service Mesh 2.x and OpenShift Serverless. To do this, you must create authentication requests and policies in the application namespace that is a member of the <code>ServiceMeshMemberRoll</code> object. You must also enable sidecar injection for the service.</p>
</div>
<div class="sect3">
<h4 id="serverless-ossm-v2x-jwt_serverless-ossm-v2x-jwt">Configuring JSON Web Token authentication for Service Mesh 2.x and OpenShift Serverless</h4>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>Adding sidecar injection to pods in system namespaces, such as <code>knative-serving</code> and <code>knative-serving-ingress</code>, is not supported when Kourier is enabled.</p>
</div>
<div class="paragraph">
<p>For OpenShift Container Platform, if you require sidecar injection for pods in these namespaces, see the OpenShift Serverless documentation on <em>Integrating Service Mesh with OpenShift Serverless natively</em>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You have installed the OpenShift Serverless Operator, Knative Serving, and Red Hat OpenShift Service Mesh on your cluster.</p>
</li>
<li>
<p>Install the OpenShift CLI (<code>oc</code>).</p>
</li>
<li>
<p>You have created a project or have access to a project with the appropriate roles and permissions to create applications and other workloads in OpenShift Container Platform.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Add the <code>sidecar.istio.io/inject="true"</code> annotation to your service:</p>
<div class="listingblock">
<div class="title">Example service</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: serving.knative.dev/v1
kind: Service
metadata:
  name: &lt;service_name&gt;
spec:
  template:
    metadata:
      annotations:
        sidecar.istio.io/inject: "true" <b class="conum">(1)</b>
        sidecar.istio.io/rewriteAppHTTPProbers: "true" <b class="conum">(2)</b>
...</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Add the <code>sidecar.istio.io/inject="true"</code> annotation.</p>
</li>
<li>
<p>You must set the annotation <code>sidecar.istio.io/rewriteAppHTTPProbers: "true"</code> in your Knative service, because OpenShift Serverless versions 1.14.0 and higher use an HTTP probe as the readiness probe for Knative services by default.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Apply the <code>Service</code> resource:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc apply -f &lt;filename&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>Create a <code>RequestAuthentication</code> resource in each serverless application namespace that is a member in the <code>ServiceMeshMemberRoll</code> object:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: security.istio.io/v1beta1
kind: RequestAuthentication
metadata:
  name: jwt-example
  namespace: &lt;namespace&gt;
spec:
  jwtRules:
  - issuer: testing@secure.istio.io
    jwksUri: https://raw.githubusercontent.com/istio/istio/release-1.8/security/tools/jwt/samples/jwks.json</code></pre>
</div>
</div>
</li>
<li>
<p>Apply the <code>RequestAuthentication</code> resource:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc apply -f &lt;filename&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>Allow access to the <code>RequestAuthenticaton</code> resource from system pods for each serverless application namespace that is a member in the <code>ServiceMeshMemberRoll</code> object, by creating the following <code>AuthorizationPolicy</code> resource:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: security.istio.io/v1beta1
kind: AuthorizationPolicy
metadata:
  name: allowlist-by-paths
  namespace: &lt;namespace&gt;
spec:
  action: ALLOW
  rules:
  - to:
    - operation:
        paths:
        - /metrics <b class="conum">(1)</b>
        - /healthz <b class="conum">(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The path on your application to collect metrics by system pod.</p>
</li>
<li>
<p>The path on your application to probe by system pod.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Apply the <code>AuthorizationPolicy</code> resource:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc apply -f &lt;filename&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>For each serverless application namespace that is a member in the <code>ServiceMeshMemberRoll</code> object, create the following <code>AuthorizationPolicy</code> resource:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: security.istio.io/v1beta1
kind: AuthorizationPolicy
metadata:
  name: require-jwt
  namespace: &lt;namespace&gt;
spec:
  action: ALLOW
  rules:
  - from:
    - source:
       requestPrincipals: ["testing@secure.istio.io/testing@secure.istio.io"]</code></pre>
</div>
</div>
</li>
<li>
<p>Apply the <code>AuthorizationPolicy</code> resource:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc apply -f &lt;filename&gt;</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="olist arabic">
<div class="title">Verification</div>
<ol class="arabic">
<li>
<p>If you try to use a <code>curl</code> request to get the Knative service URL, it is denied:</p>
<div class="listingblock">
<div class="title">Example command</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ curl http://hello-example-1-default.apps.mycluster.example.com/</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">RBAC: access denied</code></pre>
</div>
</div>
</li>
<li>
<p>Verify the request with a valid JWT.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Get the valid JWT token:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ TOKEN=$(curl https://raw.githubusercontent.com/istio/istio/release-1.8/security/tools/jwt/samples/demo.jwt -s) &amp;&amp; echo "$TOKEN" | cut -d '.' -f2 - | base64 --decode -</code></pre>
</div>
</div>
</li>
<li>
<p>Access the service by using the valid token in the <code>curl</code> request header:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ curl -H "Authorization: Bearer $TOKEN"  http://hello-example-1-default.apps.example.com</code></pre>
</div>
</div>
<div class="paragraph">
<p>The request is now allowed:</p>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">Hello OpenShift!</code></pre>
</div>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="serverless-ossm-v1x-jwt">Using JSON Web Token authentication with Service Mesh 1.x</h3>
<div class="paragraph">
<p>You can use JSON Web Token (JWT) authentication with Knative services by using Service Mesh 1.x and OpenShift Serverless. To do this, you must create a policy in the application namespace that is a member of the <code>ServiceMeshMemberRoll</code> object. You must also enable sidecar injection for the service.</p>
</div>
<div class="sect3">
<h4 id="serverless-ossm-v1x-jwt_serverless-ossm-v1x-jwt">Configuring JSON Web Token authentication for Service Mesh 1.x and OpenShift Serverless</h4>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>Adding sidecar injection to pods in system namespaces, such as <code>knative-serving</code> and <code>knative-serving-ingress</code>, is not supported when Kourier is enabled.</p>
</div>
<div class="paragraph">
<p>For OpenShift Container Platform, if you require sidecar injection for pods in these namespaces, see the OpenShift Serverless documentation on <em>Integrating Service Mesh with OpenShift Serverless natively</em>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You have installed the OpenShift Serverless Operator, Knative Serving, and Red Hat OpenShift Service Mesh on your cluster.</p>
</li>
<li>
<p>Install the OpenShift CLI (<code>oc</code>).</p>
</li>
<li>
<p>You have created a project or have access to a project with the appropriate roles and permissions to create applications and other workloads in OpenShift Container Platform.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Add the <code>sidecar.istio.io/inject="true"</code> annotation to your service:</p>
<div class="listingblock">
<div class="title">Example service</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: serving.knative.dev/v1
kind: Service
metadata:
  name: &lt;service_name&gt;
spec:
  template:
    metadata:
      annotations:
        sidecar.istio.io/inject: "true" <b class="conum">(1)</b>
        sidecar.istio.io/rewriteAppHTTPProbers: "true" <b class="conum">(2)</b>
...</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Add the <code>sidecar.istio.io/inject="true"</code> annotation.</p>
</li>
<li>
<p>You must set the annotation <code>sidecar.istio.io/rewriteAppHTTPProbers: "true"</code> in your Knative service, because OpenShift Serverless versions 1.14.0 and higher use an HTTP probe as the readiness probe for Knative services by default.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Apply the <code>Service</code> resource:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc apply -f &lt;filename&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>Create a policy in a serverless application namespace which is a member in the <code>ServiceMeshMemberRoll</code> object, that only allows requests with valid JSON Web Tokens (JWT):</p>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>The paths <code>/metrics</code> and <code>/healthz</code> must be included in <code>excludedPaths</code> because they are accessed from system pods in the <code>knative-serving</code> namespace.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: authentication.istio.io/v1alpha1
kind: Policy
metadata:
  name: default
  namespace: &lt;namespace&gt;
spec:
  origins:
  - jwt:
      issuer: testing@secure.istio.io
      jwksUri: "https://raw.githubusercontent.com/istio/istio/release-1.6/security/tools/jwt/samples/jwks.json"
      triggerRules:
      - excludedPaths:
        - prefix: /metrics <b class="conum">(1)</b>
        - prefix: /healthz <b class="conum">(2)</b>
  principalBinding: USE_ORIGIN</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The path on your application to collect metrics by system pod.</p>
</li>
<li>
<p>The path on your application to probe by system pod.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Apply the <code>Policy</code> resource:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc apply -f &lt;filename&gt;</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="olist arabic">
<div class="title">Verification</div>
<ol class="arabic">
<li>
<p>If you try to use a <code>curl</code> request to get the Knative service URL, it is denied:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ curl http://hello-example-default.apps.mycluster.example.com/</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">Origin authentication failed.</code></pre>
</div>
</div>
</li>
<li>
<p>Verify the request with a valid JWT.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Get the valid JWT token:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ TOKEN=$(curl https://raw.githubusercontent.com/istio/istio/release-1.6/security/tools/jwt/samples/demo.jwt -s) &amp;&amp; echo "$TOKEN" | cut -d '.' -f2 - | base64 --decode -</code></pre>
</div>
</div>
</li>
<li>
<p>Access the service by using the valid token in the <code>curl</code> request header:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ curl http://hello-example-default.apps.mycluster.example.com/ -H "Authorization: Bearer $TOKEN"</code></pre>
</div>
</div>
<div class="paragraph">
<p>The request is now allowed:</p>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">Hello OpenShift!</code></pre>
</div>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="kube-rbac-proxy-serving">Configuring kube-rbac-proxy for Serving</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <code>kube-rbac-proxy</code> component provides internal authentication and authorization capabilities for Knative Serving.</p>
</div>
<div class="sect2">
<h3 id="serverless-configuring-kube-rbac-proxy-resources-for-serving_kube-rbac-proxy-serving">Configuring kube-rbac-proxy resources for Serving</h3>
<div class="paragraph">
<p>You can globally override resource allocation for the <code>kube-rbac-proxy</code> container by using the OpenShift Serverless Operator CR.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">You can also override resource allocation for a specific deployment.</pre>
</div>
</div>
<div class="paragraph">
<p>The following configuration sets Knative Serving <code>kube-rbac-proxy</code> minimum and maximum CPU and memory allocation:</p>
</div>
<div class="listingblock">
<div class="title">KnativeServing CR example</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: operator.knative.dev/v1beta1
kind: KnativeServing
metadata:
  name: knative-serving
  namespace: knative-serving
spec:
  config:
    deployment:
      "kube-rbac-proxy-cpu-request": "10m" <b class="conum">(1)</b>
      "kube-rbac-proxy-memory-request": "20Mi" <b class="conum">(2)</b>
      "kube-rbac-proxy-cpu-limit": "100m" <b class="conum">(3)</b>
      "kube-rbac-proxy-memory-limit": "100Mi" <b class="conum">(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Sets minimum CPU allocation.</p>
</li>
<li>
<p>Sets minimum RAM allocation.</p>
</li>
<li>
<p>Sets maximum CPU allocation.</p>
</li>
<li>
<p>Sets maximum RAM allocation.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_configuring-custom-domains-for-knative-services">Configuring custom domains for Knative services</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="serverless-custom-domains">Configuring a custom domain for a Knative service</h3>
<div class="paragraph">
<p>Knative services are automatically assigned a default domain name based on your cluster configuration. For example, <code>&lt;service_name&gt;-&lt;namespace&gt;.example.com</code>. You can customize the domain for your Knative service by mapping a custom domain name that you own to a Knative service.</p>
</div>
<div class="paragraph">
<p>You can do this by creating a <code>DomainMapping</code> resource for the service. You can also create multiple <code>DomainMapping</code> resources to map multiple domains and subdomains to a single service.</p>
</div>
</div>
<div class="sect2">
<h3 id="create-domain-mapping">Custom domain mapping</h3>
<div class="paragraph">
<p>You can customize the domain for your Knative service by mapping a custom domain name that you own to a Knative service. To map a custom domain name to a custom resource (CR), you must create a <code>DomainMapping</code> CR that maps to an Addressable target CR, such as a Knative service or a Knative route.</p>
</div>
<div class="sect3">
<h4 id="serverless-create-domain-mapping_create-domain-mapping">Creating a custom domain mapping</h4>
<div class="paragraph">
<p>You can customize the domain for your Knative service by mapping a custom domain name that you own to a Knative service. To map a custom domain name to a custom resource (CR), you must create a <code>DomainMapping</code> CR that maps to an Addressable target CR, such as a Knative service or a Knative route.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>The OpenShift Serverless Operator and Knative Serving are installed on your cluster.</p>
</li>
<li>
<p>Install the OpenShift CLI (<code>oc</code>).</p>
</li>
<li>
<p>You have created a project or have access to a project with the appropriate roles and permissions to create applications and other workloads in OpenShift Container Platform.</p>
</li>
<li>
<p>You have created a Knative service and control a custom domain that you want to map to that service.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Your custom domain must point to the IP address of the OpenShift Container Platform cluster.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create a YAML file containing the <code>DomainMapping</code> CR in the same namespace as the target CR you want to map to:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: serving.knative.dev/v1alpha1
kind: DomainMapping
metadata:
 name: &lt;domain_name&gt; <b class="conum">(1)</b>
 namespace: &lt;namespace&gt; <b class="conum">(2)</b>
spec:
 ref:
   name: &lt;target_name&gt; <b class="conum">(3)</b>
   kind: &lt;target_type&gt; <b class="conum">(4)</b>
   apiVersion: serving.knative.dev/v1</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The custom domain name that you want to map to the target CR.</p>
</li>
<li>
<p>The namespace of both the <code>DomainMapping</code> CR and the target CR.</p>
</li>
<li>
<p>The name of the target CR to map to the custom domain.</p>
</li>
<li>
<p>The type of CR being mapped to the custom domain.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="title">Example service domain mapping</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: serving.knative.dev/v1alpha1
kind: DomainMapping
metadata:
 name: example.com
 namespace: default
spec:
 ref:
   name: example-service
   kind: Service
   apiVersion: serving.knative.dev/v1</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example route domain mapping</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: serving.knative.dev/v1alpha1
kind: DomainMapping
metadata:
 name: example.com
 namespace: default
spec:
 ref:
   name: example-route
   kind: Route
   apiVersion: serving.knative.dev/v1</code></pre>
</div>
</div>
</li>
<li>
<p>Apply the <code>DomainMapping</code> CR as a YAML file:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc apply -f &lt;filename&gt;</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="create-domain-mapping-kn">Custom domains for Knative services using the Knative CLI</h3>
<div class="paragraph">
<p>You can customize the domain for your Knative service by mapping a custom domain name that you own to a Knative service. You can use the Knative (<code>kn</code>) CLI to create a <code>DomainMapping</code> custom resource (CR) that maps to an Addressable target CR, such as a Knative service or a Knative route.</p>
</div>
<div class="sect3">
<h4 id="serverless-create-domain-mapping-kn_create-domain-mapping-kn">Creating a custom domain mapping by using the Knative CLI</h4>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>The OpenShift Serverless Operator and Knative Serving are installed on your cluster.</p>
</li>
<li>
<p>You have created a Knative service or route, and control a custom domain that you want to map to that CR.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Your custom domain must point to the DNS of the OpenShift Container Platform cluster.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>You have installed the Knative (<code>kn</code>) CLI.</p>
</li>
<li>
<p>You have created a project or have access to a project with the appropriate roles and permissions to create applications and other workloads in OpenShift Container Platform.</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Map a domain to a CR in the current namespace:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ kn domain create &lt;domain_mapping_name&gt; --ref &lt;target_name&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example command</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ kn domain create example.com --ref example-service</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>--ref</code> flag specifies an Addressable target CR for domain mapping.</p>
</div>
<div class="paragraph">
<p>If a prefix is not provided when using the <code>--ref</code> flag, it is assumed that the target is a Knative service in the current namespace.</p>
</div>
</li>
<li>
<p>Map a domain to a Knative service in a specified namespace:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ kn domain create &lt;domain_mapping_name&gt; --ref &lt;ksvc:service_name:service_namespace&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example command</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ kn domain create example.com --ref ksvc:example-service:example-namespace</code></pre>
</div>
</div>
</li>
<li>
<p>Map a domain to a Knative route:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ kn domain create &lt;domain_mapping_name&gt; --ref &lt;kroute:route_name&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example command</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ kn domain create example.com --ref kroute:example-route</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="domain-mapping-odc-developer">Domain mapping using the Developer perspective</h3>
<div class="paragraph">
<p>You can customize the domain for your Knative service by mapping a custom domain name that you own to a Knative service. You can use the <strong>Developer</strong> perspective of the OpenShift Container Platform web console to map a <code>DomainMapping</code> custom resource (CR) to a Knative service.</p>
</div>
<div class="sect3">
<h4 id="serverless-domain-mapping-odc-developer_domain-mapping-odc-developer">Mapping a custom domain to a service by using the Developer perspective</h4>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You have logged in to the web console.</p>
</li>
<li>
<p>You are in the <strong>Developer</strong> perspective.</p>
</li>
<li>
<p>The OpenShift Serverless Operator and Knative Serving are installed on your cluster. This must be completed by a cluster administrator.</p>
</li>
<li>
<p>You have created a project or have access to a project with the appropriate roles and permissions to create applications and other workloads in OpenShift Container Platform.</p>
</li>
<li>
<p>You have created a Knative service and control a custom domain that you want to map to that service.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Your custom domain must point to the IP address of the OpenShift Container Platform cluster.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Navigate to the <strong>Topology</strong> page.</p>
</li>
<li>
<p>Right-click on the service that you want to map to a domain, and select the <strong>Edit</strong> option that contains the service name. For example, if the service is named <code>example-service</code>, select the <strong>Edit example-service</strong> option.</p>
</li>
<li>
<p>In the <strong>Advanced options</strong> section, click <strong>Show advanced Routing options</strong>.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>If the domain mapping CR that you want to map to the service already exists, you can select it in the <strong>Domain mapping</strong> list.</p>
</li>
<li>
<p>If you want to create a new domain mapping CR, type the domain name into the box, and select the <strong>Create</strong> option. For example, if you type in <code>example.com</code>, the <strong>Create</strong> option is <strong>Create "example.com"</strong>.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Click <strong>Save</strong> to save the changes to your service.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<div class="title">Verification</div>
<ol class="arabic">
<li>
<p>Navigate to the <strong>Topology</strong> page.</p>
</li>
<li>
<p>Click on the service that you have created.</p>
</li>
<li>
<p>In the <strong>Resources</strong> tab of the service information window, you can see the domain you have mapped to the service listed under <strong>Domain mappings</strong>.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="domain-mapping-odc-admin">Domain mapping using the Administrator perspective</h3>
<div class="paragraph">
<p>If you do not want to switch to the <strong>Developer</strong> perspective in the OpenShift Container Platform web console or use the Knative (<code>kn</code>) CLI or YAML files, you can use the <strong>Administator</strong> perspective of the OpenShift Container Platform web console.</p>
</div>
<div class="sect3">
<h4 id="serverless-domain-mapping-odc-admin_domain-mapping-odc-admin">Mapping a custom domain to a service by using the Administrator perspective</h4>
<div class="paragraph">
<p>Knative services are automatically assigned a default domain name based on your cluster configuration. For example, <code>&lt;service_name&gt;-&lt;namespace&gt;.example.com</code>. You can customize the domain for your Knative service by mapping a custom domain name that you own to a Knative service.</p>
</div>
<div class="paragraph">
<p>You can do this by creating a <code>DomainMapping</code> resource for the service. You can also create multiple <code>DomainMapping</code> resources to map multiple domains and subdomains to a single service.</p>
</div>
<div class="paragraph">
<p>If you have cluster administrator permissions on OpenShift Container Platform (or cluster or dedicated administrator permissions on OpenShift Dedicated or Red Hat OpenShift Service on AWS), you can create a <code>DomainMapping</code> custom resource (CR) by using the <strong>Administrator</strong> perspective in the web console.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You have logged in to the web console.</p>
</li>
<li>
<p>You are in the <strong>Administrator</strong> perspective.</p>
</li>
<li>
<p>You have installed the OpenShift Serverless Operator.</p>
</li>
<li>
<p>You have installed Knative Serving.</p>
</li>
<li>
<p>You have created a project or have access to a project with the appropriate roles and permissions to create applications and other workloads.</p>
</li>
<li>
<p>You have created a Knative service and control a custom domain that you want to map to that service.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Your custom domain must point to the IP address of the cluster.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Navigate to <strong>CustomResourceDefinitions</strong> and use the search box to find the <strong>DomainMapping</strong> custom resource definition (CRD).</p>
</li>
<li>
<p>Click the <strong>DomainMapping</strong> CRD, then navigate to the <strong>Instances</strong> tab.</p>
</li>
<li>
<p>Click <strong>Create DomainMapping</strong>.</p>
</li>
<li>
<p>Modify the YAML for the <code>DomainMapping</code> CR so that it includes the following information for your instance:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: serving.knative.dev/v1alpha1
kind: DomainMapping
metadata:
 name: &lt;domain_name&gt; <b class="conum">(1)</b>
 namespace: &lt;namespace&gt; <b class="conum">(2)</b>
spec:
 ref:
   name: &lt;target_name&gt; <b class="conum">(3)</b>
   kind: &lt;target_type&gt; <b class="conum">(4)</b>
   apiVersion: serving.knative.dev/v1</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The custom domain name that you want to map to the target CR.</p>
</li>
<li>
<p>The namespace of both the <code>DomainMapping</code> CR and the target CR.</p>
</li>
<li>
<p>The name of the target CR to map to the custom domain.</p>
</li>
<li>
<p>The type of CR being mapped to the custom domain.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="title">Example domain mapping to a Knative service</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: serving.knative.dev/v1alpha1
kind: DomainMapping
metadata:
 name: custom-ksvc-domain.example.com
 namespace: default
spec:
 ref:
   name: example-service
   kind: Service
   apiVersion: serving.knative.dev/v1</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Verification</div>
<ul>
<li>
<p>Access the custom domain by using a <code>curl</code> request. For example:</p>
<div class="listingblock">
<div class="title">Example command</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ curl custom-ksvc-domain.example.com</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">Hello OpenShift!</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="domain-mapping-custom-tls-cert">Securing a mapped service using a TLS certificate</h3>
<div class="sect3">
<h4 id="serverless-domain-mapping-custom-tls-cert_domain-mapping-custom-tls-cert">Securing a service with a custom domain by using a TLS certificate</h4>
<div class="paragraph">
<p>After you have configured a custom domain for a Knative service, you can use a TLS certificate to secure the mapped service. To do this, you must create a Kubernetes TLS secret, and then update the <code>DomainMapping</code> CR to use the TLS secret that you
have created.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>If you use <code>net-istio</code> for Ingress and enable mTLS via SMCP using <code>security.dataPlane.mtls: true</code>, Service Mesh deploys <code>DestinationRules</code> for the <code>*.local</code> host, which does not allow <code>DomainMapping</code> for OpenShift Serverless.</p>
</div>
<div class="paragraph">
<p>To work around this issue, enable mTLS by deploying <code>PeerAuthentication</code> instead of using <code>security.dataPlane.mtls: true</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You configured a custom domain for a Knative service and have a working <code>DomainMapping</code> CR.</p>
</li>
<li>
<p>You have a TLS certificate from your Certificate Authority provider or a self-signed certificate.</p>
</li>
<li>
<p>You have obtained the <code>cert</code> and <code>key</code> files from your Certificate Authority provider, or a self-signed certificate.</p>
</li>
<li>
<p>Install the OpenShift CLI (<code>oc</code>).</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create a Kubernetes TLS secret:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc create secret tls &lt;tls_secret_name&gt; --cert=&lt;path_to_certificate_file&gt; --key=&lt;path_to_key_file&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>Add the <code>networking.internal.knative.dev/certificate-uid: &lt;id&gt;`</code> label to the Kubernetes TLS secret:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc label secret &lt;tls_secret_name&gt; networking.internal.knative.dev/certificate-uid="&lt;id&gt;"</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you are using a third-party secret provider such as cert-manager, you can configure your secret manager to label the Kubernetes TLS secret automatically. Cert-manager users can use the secret template offered to automatically generate secrets with the correct label. In this case, secret filtering is done based on the key only, but this value can carry useful information such as the certificate ID that the secret contains.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>The cert-manager Operator for Red Hat OpenShift is a Technology Preview feature. For more information, see the <strong>Installing the cert-manager Operator for Red Hat OpenShift</strong> documentation.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Update the <code>DomainMapping</code> CR to use the TLS secret that you have created:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: serving.knative.dev/v1alpha1
kind: DomainMapping
metadata:
  name: &lt;domain_name&gt;
  namespace: &lt;namespace&gt;
spec:
  ref:
    name: &lt;service_name&gt;
    kind: Service
    apiVersion: serving.knative.dev/v1
# TLS block specifies the secret to be used
  tls:
    secretName: &lt;tls_secret_name&gt;</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="olist arabic">
<div class="title">Verification</div>
<ol class="arabic">
<li>
<p>Verify that the <code>DomainMapping</code> CR status is <code>True</code>, and that the <code>URL</code> column of the output shows the mapped domain with the scheme <code>https</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc get domainmapping &lt;domain_name&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">NAME                      URL                               READY   REASON
example.com               https://example.com               True</code></pre>
</div>
</div>
</li>
<li>
<p>Optional: If the service is exposed publicly, verify that it is available by running the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ curl https://&lt;domain_name&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the certificate is self-signed, skip verification by adding the <code>-k</code> flag to the <code>curl</code> command.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="serverless-ossm-secret-filtering-net-kourier_domain-mapping-custom-tls-cert">Improving net-kourier memory usage by using secret filtering</h4>
<div class="paragraph">
<p>By default, the <a href="https://aly.arriqaaq.com/kubernetes-informers/">informers</a> implementation for the Kubernetes <code>client-go</code> library fetches all resources of a particular type. This can lead to a substantial overhead when many resources are available, which can cause the Knative <code>net-kourier</code> ingress controller to fail on large clusters due to memory leaking. However, a filtering mechanism is available for the Knative <code>net-kourier</code> ingress controller, which enables the controller to only fetch Knative related secrets. You can enable this mechanism by setting an environment variable to the <code>KnativeServing</code> custom resource (CR).</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>If you enable secret filtering, all of your secrets need to be labeled with  <code>networking.internal.knative.dev/certificate-uid: "&lt;id&gt;"</code>. Otherwise, Knative Serving does not detect them, which leads to failures. You must label both new and existing secrets.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You have cluster administrator permissions on OpenShift Container Platform, or you have cluster or dedicated administrator permissions on Red Hat OpenShift Service on AWS or OpenShift Dedicated.</p>
</li>
<li>
<p>A project that you created or that you have roles and permissions for to create applications and other workloads.</p>
</li>
<li>
<p>Install the OpenShift Serverless Operator and Knative Serving.</p>
</li>
<li>
<p>Install the OpenShift CLI (<code>oc</code>).</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Set the <code>ENABLE_SECRET_INFORMER_FILTERING_BY_CERT_UID</code> variable to <code>true</code> for <code>net-kourier-controller</code> in the <code>KnativeServing</code> CR:</p>
<div class="listingblock">
<div class="title">Example KnativeServing CR</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: operator.knative.dev/v1beta1
kind: KnativeServing
metadata:
 name: knative-serving
 namespace: knative-serving
spec:
 deployments:
   - env:
     - container: controller
       envVars:
       - name: ENABLE_SECRET_INFORMER_FILTERING_BY_CERT_UID
         value: 'true'
     name: net-kourier-controller</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_configuring-high-availability-for-knative-services">Configuring high availability for Knative services</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="ha-services-overview">High availability for Knative services</h3>
<div class="paragraph">
<p>High availability (HA) is a standard feature of Kubernetes APIs that helps to ensure that APIs stay operational if a disruption occurs. In an HA deployment, if an active controller crashes or is deleted, another controller is readily available. This controller takes over processing of the APIs that were being serviced by the controller that is now unavailable.</p>
</div>
<div class="paragraph">
<p>HA in OpenShift Serverless is available through leader election, which is enabled by default after the Knative Serving or Eventing control plane is installed. When using a leader election HA pattern, instances of controllers are already scheduled and running inside the cluster before they are required.
These controller instances compete to use a shared resource, known as the leader election lock. The instance of the controller that has access to the leader election lock resource at any given time is called the leader.</p>
</div>
</div>
<div class="sect2">
<h3 id="ha-replicas-serving">High availability for Knative services</h3>
<div class="paragraph">
<p>High availability (HA) is available by default for the Knative Serving <code>activator</code>, <code>autoscaler</code>, <code>autoscaler-hpa</code>, <code>controller</code>, <code>webhook</code>, <code>kourier-control</code>, and <code>kourier-gateway</code> components, which are configured to have two replicas each by default. You can change the number of replicas for these components by modifying the <code>spec.high-availability.replicas</code> value in the <code>KnativeServing</code> custom resource (CR).</p>
</div>
<div class="sect3">
<h4 id="serverless-config-replicas-serving_ha-replicas-serving">Configuring high availability replicas for Knative Serving</h4>
<div class="paragraph">
<p>To specify three minimum replicas for the eligible deployment resources, set the value of the field <code>spec.high-availability.replicas</code> in the custom resource to <code>3</code>.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You have cluster administrator permissions on OpenShift Container Platform, or you have cluster or dedicated administrator permissions on Red Hat OpenShift Service on AWS or OpenShift Dedicated.</p>
</li>
<li>
<p>The OpenShift Serverless Operator and Knative Serving are installed on your cluster.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the OpenShift Container Platform web console <strong>Administrator</strong> perspective, navigate to <strong>OperatorHub</strong> &#8594; <strong>Installed Operators</strong>.</p>
</li>
<li>
<p>Select the <code>knative-serving</code> namespace.</p>
</li>
<li>
<p>Click <strong>Knative Serving</strong> in the list of <strong>Provided APIs</strong> for the OpenShift Serverless Operator to go to the <strong>Knative Serving</strong> tab.</p>
</li>
<li>
<p>Click <strong>knative-serving</strong>, then go to the <strong>YAML</strong> tab in the <strong>knative-serving</strong> page.</p>
<div class="imageblock">
<div class="content">
<img src="images/serving-YAML-HA.png" alt="Knative Serving YAML">
</div>
</div>
</li>
<li>
<p>Modify the number of replicas in the <code>KnativeServing</code> CR:</p>
<div class="listingblock">
<div class="title">Example YAML</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">apiVersion: operator.knative.dev/v1beta1
kind: KnativeServing
metadata:
  name: knative-serving
  namespace: knative-serving
spec:
  high-availability:
    replicas: 3</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2023-06-21 10:15:23 UTC
</div>
</div>
</body>
</html>