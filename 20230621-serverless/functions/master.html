<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.16">
<title>Functions</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;-webkit-tap-highlight-color:transparent}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos{border-right:1px solid;opacity:.35;padding-right:.5em}
pre.pygments .lineno{border-right:1px solid;opacity:.35;display:inline-block;margin-right:.75em}
pre.pygments .lineno::before{content:"";margin-right:-.125em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd),table.stripes-even tr:nth-of-type(even),table.stripes-hover tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
</head>
<body class="article">
<div id="header">
<h1>Functions</h1>
</div>
<div id="content">
<div class="sect1">
<h2 id="serverless-functions-setup">Setting up OpenShift Serverless Functions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To improve the process of deployment of your application code, you can use OpenShift Serverless to deploy stateless, event-driven functions as a Knative service on OpenShift Container Platform. If you want to develop functions, you must complete the set up steps.</p>
</div>
<div class="sect2">
<h3 id="prerequisites_serverless-functions-setup">Prerequisites</h3>
<div class="paragraph">
<p>To enable the use of OpenShift Serverless Functions on your cluster, you must complete the following steps:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The OpenShift Serverless Operator and Knative Serving are installed on your cluster.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Functions are deployed as a Knative service. If you want to use event-driven architecture with your functions, you must also install Knative Eventing.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>You have the <a href="https://docs.openshift.com/container-platform/latest/cli_reference/openshift_cli/getting-started-cli.html#cli-getting-started"><code>oc</code> CLI</a> installed.</p>
</li>
<li>
<p>You have the <a href="https://access.redhat.com/documentation/en-us/red_hat_openshift_serverless/1.29/html-single/installing_serverless/#installing-kn">Knative (<code>kn</code>) CLI</a> installed. Installing the Knative CLI enables the use of <code>kn func</code> commands which you can use to create and manage functions.</p>
</li>
<li>
<p>You have installed Docker Container Engine or Podman version 3.4.7 or higher.</p>
</li>
<li>
<p>You have access to an available image registry, such as the OpenShift Container Registry.</p>
</li>
<li>
<p>If you are using <a href="https://quay.io/">Quay.io</a> as the image registry, you must ensure that either the repository is not private, or that you have followed the OpenShift Container Platform documentation on <a href="https://docs.openshift.com/container-platform/latest/openshift_images/managing_images/using-image-pull-secrets.html#images-allow-pods-to-reference-images-from-secure-registries_using-image-pull-secrets">Allowing pods to reference images from other secured registries</a>.</p>
</li>
<li>
<p>If you are using the OpenShift Container Registry, a cluster administrator must <a href="https://docs.openshift.com/container-platform/latest/registry/securing-exposing-registry.html#securing-exposing-registry">expose the registry</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="serverless-functions-podman_serverless-functions-setup">Setting up Podman</h3>
<div class="paragraph">
<p>To use advanced container management features, you might want to use Podman with OpenShift Serverless Functions. To do so, you need to start the Podman service and configure the Knative (<code>kn</code>) CLI to connect to it.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Start the Podman service that serves the Docker API on a UNIX socket at <code>${XDG_RUNTIME_DIR}/podman/podman.sock</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ systemctl start --user podman.socket</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>On most systems, this socket is located at <code>/run/user/$(id -u)/podman/podman.sock</code>.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Establish the environment variable that is used to build a function:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ export DOCKER_HOST="unix://${XDG_RUNTIME_DIR}/podman/podman.sock"</code></pre>
</div>
</div>
</li>
<li>
<p>Run the build command inside your function project directory with the <code>-v</code> flag to see verbose output. You should see a connection to your local UNIX socket:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ kn func build -v</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="serverless-functions-podman-macos_serverless-functions-setup">Setting up Podman on macOS</h3>
<div class="paragraph">
<p>To use advanced container management features, you might want to use Podman with OpenShift Serverless Functions. To do so on macOS, you need to start the Podman machine and configure the Knative (<code>kn</code>) CLI to connect to it.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create the Podman machine:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ podman machine init --memory=8192 --cpus=2 --disk-size=20</code></pre>
</div>
</div>
</li>
<li>
<p>Start the Podman machine, which serves the Docker API on a UNIX socket:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ podman machine start
Starting machine "podman-machine-default"
Waiting for VM ...
Mounting volume... /Users/myuser:/Users/user

[...truncated output...]

You can still connect Docker API clients by setting DOCKER_HOST using the
following command in your terminal session:

	export DOCKER_HOST='unix:///Users/myuser/.local/share/containers/podman/machine/podman-machine-default/podman.sock'

Machine "podman-machine-default" started successfully</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>On most macOS systems, this socket is located at <code>/Users/myuser/.local/share/containers/podman/machine/podman-machine-default/podman.sock</code>.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Establish the environment variable that is used to build a function:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ export DOCKER_HOST='unix:///Users/myuser/.local/share/containers/podman/machine/podman-machine-default/podman.sock'</code></pre>
</div>
</div>
</li>
<li>
<p>Run the build command inside your function project directory with the <code>-v</code> flag to see verbose output. You should see a connection to your local UNIX socket:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ kn func build -v</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="next-steps_serverless-functions-setup">Next steps</h3>
<div class="ulist">
<ul>
<li>
<p>For more information about Docker Container Engine or Podman, see <a href="https://docs.openshift.com/container-platform/latest/architecture/understanding-development.html#container-build-tool-options">Container build tool options</a>.</p>
</li>
<li>
<p>See <a href="#serverless-functions-getting-started">Getting started with functions</a>.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="serverless-functions-getting-started">Getting started with functions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Function lifecycle management includes creating, building, and deploying a function. Optionally, you can also test a deployed function by invoking it. You can do all of these operations on OpenShift Serverless using the <code>kn func</code> tool.</p>
</div>
<div class="sect2">
<h3 id="prerequisites_serverless-functions-getting-started">Prerequisites</h3>
<div class="paragraph">
<p>Before you can complete the following procedures, you must ensure that you have completed all of the prerequisite tasks in <a href="#serverless-functions-setup">Setting up OpenShift Serverless Functions</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="serverless-create-func-kn_serverless-functions-getting-started">Creating functions</h3>
<div class="paragraph">
<p>Before you can build and deploy a function, you must create it by using the Knative (<code>kn</code>) CLI. You can specify the path, runtime, template, and image registry as flags on the command line, or use the <code>-c</code> flag to start the interactive experience in the terminal.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>The OpenShift Serverless Operator and Knative Serving are installed on the cluster.</p>
</li>
<li>
<p>You have installed the Knative (<code>kn</code>) CLI.</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Create a function project:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ kn func create -r &lt;repository&gt; -l &lt;runtime&gt; -t &lt;template&gt; &lt;path&gt;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Accepted runtime values include <code>quarkus</code>, <code>node</code>, <code>typescript</code>, <code>go</code>, <code>python</code>, <code>springboot</code>, and <code>rust</code>.</p>
</li>
<li>
<p>Accepted template values include <code>http</code> and <code>cloudevents</code>.</p>
<div class="listingblock">
<div class="title">Example command</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ kn func create -l typescript -t cloudevents examplefunc</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">Created typescript function in /home/user/demo/examplefunc</code></pre>
</div>
</div>
</li>
<li>
<p>Alternatively, you can specify a repository that contains a custom template.</p>
<div class="listingblock">
<div class="title">Example command</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ kn func create -r https://github.com/boson-project/templates/ -l node -t hello-world examplefunc</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">Created node function in /home/user/demo/examplefunc</code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="serverless-kn-func-run_serverless-functions-getting-started">Running a function locally</h3>
<div class="paragraph">
<p>You can use the <code>kn func run</code> command to run a function locally in the current directory or in the directory specified by the <code>--path</code> flag. If the function that you are running has never previously been built, or if the project files have been modified since the last time it was built, the <code>kn func run</code> command builds the function before running it by default.</p>
</div>
<div class="listingblock">
<div class="title">Example command to run a function in the current directory</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ kn func run</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example command to run a function in a directory specified as a path</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ kn func run --path=&lt;directory_path&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also force a rebuild of an existing image before running the function, even if there have been no changes to the project files, by using the <code>--build</code> flag:</p>
</div>
<div class="listingblock">
<div class="title">Example run command using the build flag</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ kn func run --build</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you set the <code>build</code> flag as false, this disables building of the image, and runs the function using the previously built image:</p>
</div>
<div class="listingblock">
<div class="title">Example run command using the build flag</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ kn func run --build=false</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can use the help command to learn more about <code>kn func run</code> command options:</p>
</div>
<div class="listingblock">
<div class="title">Build help command</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ kn func help run</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="serverless-build-func-kn_serverless-functions-getting-started">Building functions</h3>
<div class="paragraph">
<p>Before you can run a function, you must build the function project. If you are using the <code>kn func run</code> command, the function is built automatically. However, you can use the <code>kn func build</code> command to build a function without running it, which can be useful for advanced users or debugging scenarios.</p>
</div>
<div class="paragraph">
<p>The <code>kn func build</code> command creates an OCI container image that can be run locally on your computer or on an OpenShift Container Platform cluster. This command uses the function project name and the image registry name to construct a fully qualified image name for your function.</p>
</div>
<div class="sect3">
<h4 id="serverless-build-func-kn-image-containers_serverless-functions-getting-started">Image container types</h4>
<div class="paragraph">
<p>By default, <code>kn func build</code> creates a container image by using Red Hat Source-to-Image (S2I) technology.</p>
</div>
<div class="listingblock">
<div class="title">Example build command using Red Hat Source-to-Image (S2I)</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ kn func build</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="serverless-build-func-kn-image-registries_serverless-functions-getting-started">Image registry types</h4>
<div class="paragraph">
<p>The OpenShift Container Registry is used by default as the image registry for storing function images.</p>
</div>
<div class="listingblock">
<div class="title">Example build command using OpenShift Container Registry</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ kn func build</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">Building function image
Function image has been built, image: registry.redhat.io/example/example-function:latest</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can override using OpenShift Container Registry as the default image registry by using the <code>--registry</code> flag:</p>
</div>
<div class="listingblock">
<div class="title">Example build command overriding OpenShift Container Registry to use quay.io</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ kn func build --registry quay.io/username</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">Building function image
Function image has been built, image: quay.io/username/example-function:latest</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="serverless-build-func-kn-push_serverless-functions-getting-started">Push flag</h4>
<div class="paragraph">
<p>You can add the <code>--push</code> flag to a <code>kn func build</code> command to automatically push the function image after it is successfully built:</p>
</div>
<div class="listingblock">
<div class="title">Example build command using OpenShift Container Registry</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ kn func build --push</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="serverless-build-func-kn-help_serverless-functions-getting-started">Help command</h4>
<div class="paragraph">
<p>You can use the help command to learn more about <code>kn func build</code> command options:</p>
</div>
<div class="listingblock">
<div class="title">Build help command</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ kn func help build</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="serverless-deploy-func-kn_serverless-functions-getting-started">Deploying functions</h3>
<div class="paragraph">
<p>You can deploy a function to your cluster as a Knative service by using the <code>kn func deploy</code> command. If the targeted function is already deployed, it is updated with a new container image that is pushed to a container image registry, and the Knative service is updated.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>The OpenShift Serverless Operator and Knative Serving are installed on the cluster.</p>
</li>
<li>
<p>You have installed the Knative (<code>kn</code>) CLI.</p>
</li>
<li>
<p>You have created a project or have access to a project with the appropriate roles and permissions to create applications and other workloads in OpenShift Container Platform.</p>
</li>
<li>
<p>You must have already created and initialized the function that you want to deploy.</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Deploy a function:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ kn func deploy [-n &lt;namespace&gt; -p &lt;path&gt; -i &lt;image&gt;]</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">Function deployed at: http://func.example.com</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>If no <code>namespace</code> is specified, the function is deployed in the current namespace.</p>
</li>
<li>
<p>The function is deployed from the current directory, unless a <code>path</code> is specified.</p>
</li>
<li>
<p>The Knative service name is derived from the project name, and cannot be changed using this command.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>You can create a serverless function with a Git repository URL by using <strong>Import from Git</strong> or <strong>Create Serverless Function</strong> in the <strong>+Add</strong> view of the <strong>Developer</strong> perspective.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="serverless-kn-func-invoke_serverless-functions-getting-started">Invoking a deployed function with a test event</h3>
<div class="paragraph">
<p>You can use the <code>kn func invoke</code> CLI command to send a test request to invoke a function either locally or on your OpenShift Container Platform cluster. You can use this command to test that a function is working and able to receive events correctly. Invoking a function locally is useful for a quick test during function development. Invoking a function on the cluster is useful for testing that is closer to the production environment.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>The OpenShift Serverless Operator and Knative Serving are installed on the cluster.</p>
</li>
<li>
<p>You have installed the Knative (<code>kn</code>) CLI.</p>
</li>
<li>
<p>You have created a project or have access to a project with the appropriate roles and permissions to create applications and other workloads in OpenShift Container Platform.</p>
</li>
<li>
<p>You must have already deployed the function that you want to invoke.</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Invoke a function:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ kn func invoke</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>kn func invoke</code> command only works when there is either a local container image currently running, or when there is a function deployed in the cluster.</p>
</li>
<li>
<p>The <code>kn func invoke</code> command executes on the local directory by default, and assumes that this directory is a function project.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="serverless-kn-func-delete_serverless-functions-getting-started">Deleting a function</h3>
<div class="paragraph">
<p>You can delete a function by using the <code>kn func delete</code> command. This is useful when a function is no longer required, and can help to save resources on your cluster.</p>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Delete a function:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ kn func delete [&lt;function_name&gt; -n &lt;namespace&gt; -p &lt;path&gt;]</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>If the name or path of the function to delete is not specified, the current directory is searched for a <code>func.yaml</code> file that is used to determine the function to delete.</p>
</li>
<li>
<p>If the namespace is not specified, it defaults to the <code>namespace</code> value in the <code>func.yaml</code> file.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2 _additional-resources">
<h3 id="additional-resources_serverless-functions-getting-started">Additional resources for OpenShift Container Platform</h3>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.openshift.com/container-platform/latest/registry/securing-exposing-registry.html#securing-exposing-registry">Exposing a default registry manually</a></p>
</li>
<li>
<p><a href="https://plugins.jetbrains.com/plugin/16476-knative--serverless-functions-by-red-hat">Marketplace page for the Intellij Knative plugin</a></p>
</li>
<li>
<p><a href="https://marketplace.visualstudio.com/items?itemName=redhat.vscode-knative&amp;utm_source=VSCode.pro&amp;utm_campaign=AhmadAwais">Marketplace page for the Visual Studio Code Knative plugin</a></p>
</li>
<li>
<p><a href="https://docs.openshift.com/container-platform/latest/applications/creating_applications/odc-creating-applications-using-developer-perspective.html#odc-creating-applications-using-the-developer-perspective">Creating applications using the Developer perspective</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="next-steps_serverless-functions-getting-started">Next steps</h3>
<div class="ulist">
<ul>
<li>
<p>See <a href="#serverless-functions-eventing">Using functions with Knative Eventing</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="serverless-functions-on-cluster-builds">On-cluster function building and deploying</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Instead of building a function locally, you can build a function directly on the cluster. When using this workflow on a local development machine, you only need to work with the function source code. This is useful, for example, when you cannot install on-cluster function building tools, such as docker or podman.</p>
</div>
<div class="sect2">
<h3 id="serverless-functions-creating-on-cluster-builds_serverless-functions-on-cluster-builds">Building and deploying functions on the cluster</h3>
<div class="paragraph">
<p>You can use the Knative (<code>kn</code>) CLI to initiate a function project build and then deploy the function directly on the cluster. To build a function project in this way, the source code for your function project must exist in a Git repository branch that is accessible to your cluster.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Red Hat OpenShift Pipelines must be installed on your cluster.</p>
</li>
<li>
<p>You have installed the OpenShift CLI (<code>oc</code>).</p>
</li>
<li>
<p>You have installed the Knative (<code>kn</code>) CLI.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In each namespace where you want to run OpenShift Pipelines and deploy a function, you must create the following resources:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Create the <code>s2i</code> Tekton task to be able to use Source-to-Image in the pipeline:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc apply -f https://raw.githubusercontent.com/openshift-knative/kn-plugin-func/serverless-1.29.0/pkg/pipelines/resources/tekton/task/func-s2i/0.1/func-s2i.yaml</code></pre>
</div>
</div>
</li>
<li>
<p>Create the <code>kn func</code> deploy Tekton task to be able to deploy the function in the pipeline:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ oc apply -f https://raw.githubusercontent.com/openshift-knative/kn-plugin-func/serverless-1.29.0/pkg/pipelines/resources/tekton/task/func-deploy/0.1/func-deploy.yaml</code></pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Create a function:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ kn func create &lt;function_name&gt; -l &lt;runtime&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>After you have created a new function project, you must add the project to a Git repository and ensure that the repository is available to the cluster. Information about this Git repository is used to update the <code>func.yaml</code> file in the next step.</p>
</li>
<li>
<p>Update the configuration in the <code>func.yaml</code> file for your function project to enable on-cluster builds for the Git repository:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">...
git:
  url: &lt;git_repository_url&gt; <b class="conum">(1)</b>
  revision: main <b class="conum">(2)</b>
  contextDir: &lt;directory_path&gt; <b class="conum">(3)</b>
...</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Required. Specify the Git repository that contains your function&#8217;s source code.</p>
</li>
<li>
<p>Optional. Specify the Git repository revision to be used. This can be a branch, tag, or commit.</p>
</li>
<li>
<p>Optional. Specify the function&#8217;s directory path if the function is not located in the Git repository root folder.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Implement the business logic of your function. Then, use Git to commit and push the changes.</p>
</li>
<li>
<p>Deploy your function:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ kn func deploy --remote</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you are not logged into the container registry referenced in your function configuration, you are prompted to provide credentials for the remote container registry that hosts the function image:</p>
</div>
<div class="listingblock">
<div class="title">Example output and prompts</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">🕕 Creating Pipeline resources
Please provide credentials for image registry used by Pipeline.
? Server: https://index.docker.io/v1/
? Username: my-repo
? Password: ********
   Function deployed at URL: http://test-function.default.svc.cluster.local</code></pre>
</div>
</div>
</li>
<li>
<p>To update your function, commit and push new changes by using Git, then run the <code>kn func deploy --remote</code> command again.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="serverless-functions-specifying-function-revision_serverless-functions-on-cluster-builds">Specifying function revision</h3>
<div class="paragraph">
<p>When building and deploying a function on the cluster, you must specify the location of the function code by specifying the Git repository, branch, and subdirectory within the repository. You do not need to specify the branch if you use the <code>main</code> branch. Similarly, you do not need to specify the subdirectory if your function is at the root of the repository. You can specify these parameters in the <code>func.yaml</code> configuration file, or by using flags with the <code>kn func deploy</code> command.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Red Hat OpenShift Pipelines must be installed on your cluster.</p>
</li>
<li>
<p>You have installed the OpenShift (<code>oc</code>) CLI.</p>
</li>
<li>
<p>You have installed the Knative (<code>kn</code>) CLI.</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Deploy your function:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ kn func deploy --remote \ <b class="conum">(1)</b>
                 --git-url &lt;repo-url&gt; \ <b class="conum">(2)</b>
                 [--git-branch &lt;branch&gt;] \ <b class="conum">(3)</b>
                 [--git-dir &lt;function-dir&gt;] <b class="conum">(4)</b></code></pre>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="colist arabic">
<ol>
<li>
<p>With the <code>--remote</code> flag, the build runs remotely.</p>
</li>
<li>
<p>Substitute <code>&lt;repo-url&gt;</code> with the URL of the Git repository.</p>
</li>
<li>
<p>Substitute <code>&lt;branch&gt;</code> with the Git branch, tag, or commit. If using the latest commit on the <code>main</code> branch, you can skip this flag.</p>
</li>
<li>
<p>Substitute <code>&lt;function-dir&gt;</code> with the directory containing the function if it is different than the repository root directory.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ kn func deploy --remote \
                 --git-url https://example.com/alice/myfunc.git \
                 --git-branch my-feature \
                 --git-dir functions/example-func/</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="serverless-developing-quarkus-functions">Developing Quarkus functions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>After you have <a href="#serverless-create-func-kn_serverless-functions-getting-started">created a Quarkus function project</a>, you can modify the template files provided to add business logic to your function. This includes configuring function invocation and the returned headers and status codes.</p>
</div>
<div class="sect2">
<h3 id="prerequisites_serverless-developing-quarkus-functions">Prerequisites</h3>
<div class="ulist">
<ul>
<li>
<p>Before you can develop functions, you must complete the setup steps in <a href="#serverless-functions-setup">Setting up OpenShift Serverless Functions</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="serverless-quarkus-template_serverless-developing-quarkus-functions">Quarkus function template structure</h3>
<div class="paragraph">
<p>When you create a Quarkus function by using the Knative (<code>kn</code>) CLI, the project directory looks similar to a typical Maven project. Additionally, the project contains the <code>func.yaml</code> file, which is used for configuring the function.</p>
</div>
<div class="paragraph">
<p>Both <code>http</code> and <code>event</code> trigger functions have the same template structure:</p>
</div>
<div class="listingblock">
<div class="title">Template structure</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">.
├── func.yaml <b class="conum">(1)</b>
├── mvnw
├── mvnw.cmd
├── pom.xml <b class="conum">(2)</b>
├── README.md
└── src
    ├── main
    │   ├── java
    │   │   └── functions
    │   │       ├── Function.java <b class="conum">(3)</b>
    │   │       ├── Input.java
    │   │       └── Output.java
    │   └── resources
    │       └── application.properties
    └── test
        └── java
            └── functions <b class="conum">(4)</b>
                ├── FunctionTest.java
                └── NativeFunctionIT.java</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Used to determine the image name and registry.</p>
</li>
<li>
<p>The Project Object Model (POM) file contains project configuration, such as information about dependencies. You can add additional dependencies by modifying this file.</p>
<div class="listingblock">
<div class="title">Example of additional dependencies</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">...
  &lt;dependencies&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;junit&lt;/groupId&gt;
      &lt;artifactId&gt;junit&lt;/artifactId&gt;
      &lt;version&gt;4.13&lt;/version&gt;
      &lt;scope&gt;test&lt;/scope&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;org.assertj&lt;/groupId&gt;
      &lt;artifactId&gt;assertj-core&lt;/artifactId&gt;
      &lt;version&gt;3.8.0&lt;/version&gt;
      &lt;scope&gt;test&lt;/scope&gt;
    &lt;/dependency&gt;
  &lt;/dependencies&gt;
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>Dependencies are downloaded during the first compilation.</p>
</div>
</li>
<li>
<p>The function project must contain a Java method annotated with <code>@Funq</code>. You can place this method in the <code>Function.java</code> class.</p>
</li>
<li>
<p>Contains simple test cases that can be used to test your function locally.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="serverless-invoking-quarkus-functions_serverless-developing-quarkus-functions">About invoking Quarkus functions</h3>
<div class="paragraph">
<p>You can create a Quarkus project that responds to cloud events, or one that responds to simple HTTP requests. Cloud events in Knative are transported over HTTP as a POST request, so either function type can listen and respond to incoming HTTP requests.</p>
</div>
<div class="paragraph">
<p>When an incoming request is received, Quarkus functions are invoked with an instance of a permitted type.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Function invocation options</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Invocation method</th>
<th class="tableblock halign-left valign-top">Data type contained in the instance</th>
<th class="tableblock halign-left valign-top">Example of data</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTP POST request</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">JSON object in the body of the request</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><code>{ "customerId": "0123456", "productId": "6543210" }</code></code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTP GET request</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Data in the query string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><code>?customerId=0123456&amp;productId=6543210</code></code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CloudEvent</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">JSON object in the <code>data</code> property</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><code>{ "customerId": "0123456", "productId": "6543210" }</code></code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The following example shows a function that receives and processes the <code>customerId</code> and <code>productId</code> purchase data that is listed in the previous table:</p>
</div>
<div class="listingblock">
<div class="title">Example Quarkus function</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">public class Functions {
    @Funq
    public void processPurchase(Purchase purchase) {
        // process the purchase
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The corresponding <code>Purchase</code> JavaBean class that contains the purchase data looks as follows:</p>
</div>
<div class="listingblock">
<div class="title">Example class</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">public class Purchase {
    private long customerId;
    private long productId;
    // getters and setters
}</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="serverless-invoking-quarkus-functions-examples_serverless-developing-quarkus-functions">Invocation examples</h4>
<div class="paragraph">
<p>The following example code defines three functions named <code>withBeans</code>, <code>withCloudEvent</code>, and <code>withBinary</code>;</p>
</div>
<div class="listingblock">
<div class="title">Example</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">import io.quarkus.funqy.Funq;
import io.quarkus.funqy.knative.events.CloudEvent;

public class Input {
    private String message;

    // getters and setters
}

public class Output {
    private String message;

    // getters and setters
}

public class Functions {
    @Funq
    public Output withBeans(Input in) {
        // function body
    }

    @Funq
    public CloudEvent&lt;Output&gt; withCloudEvent(CloudEvent&lt;Input&gt; in) {
        // function body
    }

    @Funq
    public void withBinary(byte[] in) {
        // function body
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>withBeans</code> function of the <code>Functions</code> class can be invoked by:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>An HTTP POST request with a JSON body:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ curl "http://localhost:8080/withBeans" -X POST \
    -H "Content-Type: application/json" \
    -d '{"message": "Hello there."}'</code></pre>
</div>
</div>
</li>
<li>
<p>An HTTP GET request with query parameters:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ curl "http://localhost:8080/withBeans?message=Hello%20there." -X GET</code></pre>
</div>
</div>
</li>
<li>
<p>A <code>CloudEvent</code> object in binary encoding:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ curl "http://localhost:8080/" -X POST \
  -H "Content-Type: application/json" \
  -H "Ce-SpecVersion: 1.0" \
  -H "Ce-Type: withBeans" \
  -H "Ce-Source: cURL" \
  -H "Ce-Id: 42" \
  -d '{"message": "Hello there."}'</code></pre>
</div>
</div>
</li>
<li>
<p>A <code>CloudEvent</code> object in structured encoding:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ curl http://localhost:8080/ \
    -H "Content-Type: application/cloudevents+json" \
    -d '{ "data": {"message":"Hello there."},
          "datacontenttype": "application/json",
          "id": "42",
          "source": "curl",
          "type": "withBeans",
          "specversion": "1.0"}'</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>withCloudEvent</code> function of the <code>Functions</code> class can be invoked by using a <code>CloudEvent</code> object, similarly to the <code>withBeans</code> function. However, unlike <code>withBeans</code>, <code>withCloudEvent</code> cannot be invoked with a plain HTTP request.</p>
</div>
<div class="paragraph">
<p>The <code>withBinary</code> function of the <code>Functions</code> class can be invoked by:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A <code>CloudEvent</code> object in binary encoding:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>$ curl "http://localhost:8080/" -X POST \
  -H "Content-Type: application/octet-stream" \
  -H "Ce-SpecVersion: 1.0"\
  -H "Ce-Type: withBinary" \
  -H "Ce-Source: cURL" \
  -H "Ce-Id: 42" \
  --data-binary '@img.jpg'</code></pre>
</div>
</div>
</li>
<li>
<p>A <code>CloudEvent</code> object in structured encoding:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>$ curl http://localhost:8080/ \
  -H "Content-Type: application/cloudevents+json" \
  -d "{ \"data_base64\": \"$(base64 --wrap=0 img.jpg)\",
        \"datacontenttype\": \"application/octet-stream\",
        \"id\": \"42\",
        \"source\": \"curl\",
        \"type\": \"withBinary\",
        \"specversion\": \"1.0\"}"</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="serverless-quarkus-cloudevent-attributes_serverless-developing-quarkus-functions">CloudEvent attributes</h3>
<div class="paragraph">
<p>If you need to read or write the attributes of a CloudEvent, such as <code>type</code> or <code>subject</code>, you can use the <code>CloudEvent&lt;T&gt;</code> generic interface and the <code>CloudEventBuilder</code> builder. The <code>&lt;T&gt;</code> type parameter must be one of the permitted types.</p>
</div>
<div class="paragraph">
<p>In the following example, <code>CloudEventBuilder</code> is used to return success or failure of processing the purchase:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">public class Functions {

    private boolean _processPurchase(Purchase purchase) {
        // do stuff
    }

    public CloudEvent&lt;Void&gt; processPurchase(CloudEvent&lt;Purchase&gt; purchaseEvent) {
        System.out.println("subject is: " + purchaseEvent.subject());

        if (!_processPurchase(purchaseEvent.data())) {
            return CloudEventBuilder.create()
                    .type("purchase.error")
                    .build();
        }
        return CloudEventBuilder.create()
                .type("purchase.success")
                .build();
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="serverless-quarkus-function-return-values_serverless-developing-quarkus-functions">Quarkus function return values</h3>
<div class="paragraph">
<p>Functions can return an instance of any type from the list of permitted types. Alternatively, they can return the <code>Uni&lt;T&gt;</code> type, where the <code>&lt;T&gt;</code> type parameter can be of any type from the permitted types.</p>
</div>
<div class="paragraph">
<p>The <code>Uni&lt;T&gt;</code> type is useful if a function calls asynchronous APIs, because the returned object is serialized in the same format as the received object. For example:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If a function receives an HTTP request, then the returned object is sent in the body of an HTTP response.</p>
</li>
<li>
<p>If a function receives a <code>CloudEvent</code> object in binary encoding, then the returned object is sent in the data property of a binary-encoded <code>CloudEvent</code> object.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following example shows a function that fetches a list of purchases:</p>
</div>
<div class="listingblock">
<div class="title">Example command</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">public class Functions {
    @Funq
    public List&lt;Purchase&gt; getPurchasesByName(String name) {
      // logic to retrieve purchases
    }
}</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Invoking this function through an HTTP request produces an HTTP response that contains a list of purchases in the body of the response.</p>
</li>
<li>
<p>Invoking this function through an incoming <code>CloudEvent</code> object produces a <code>CloudEvent</code> response with a list of purchases in the <code>data</code> property.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="serverless-functions-quarkus-return-value-types_serverless-developing-quarkus-functions">Permitted types</h4>
<div class="paragraph">
<p>The input and output of a function can be any of the <code>void</code>, <code>String</code>, or <code>byte[]</code> types. Additionally, they can be primitive types and their wrappers, for example, <code>int</code> and <code>Integer</code>. They can also be the following complex objects: Javabeans, maps, lists, arrays, and the special <code>CloudEvents&lt;T&gt;</code> type.</p>
</div>
<div class="paragraph">
<p>Maps, lists, arrays, the <code>&lt;T&gt;</code> type parameter of the <code>CloudEvents&lt;T&gt;</code> type, and attributes of Javabeans can only be of types listed here.</p>
</div>
<div class="listingblock">
<div class="title">Example</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">public class Functions {
    public List&lt;Integer&gt; getIds();
    public Purchase[] getPurchasesByName(String name);
    public String getNameById(int id);
    public Map&lt;String,Integer&gt; getNameIdMapping();
    public void processImage(byte[] img);
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="serverless-testing-quarkus-functions_serverless-developing-quarkus-functions">Testing Quarkus functions</h3>
<div class="paragraph">
<p>Quarkus functions can be tested locally on your computer. In the default project that is created when you create a function using <code>kn func create</code>, there is the  <code>src/test/</code> directory, which contains basic Maven tests. These tests can be extended as needed.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You have created a Quarkus function.</p>
</li>
<li>
<p>You have installed the Knative (<code>kn</code>) CLI.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Navigate to the project folder for your function.</p>
</li>
<li>
<p>Run the Maven tests:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ ./mvnw test</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="next-steps_serverless-developing-quarkus-functions">Next steps</h3>
<div class="ulist">
<ul>
<li>
<p><a href="#serverless-build-func-kn_serverless-functions-getting-started">Build</a> and <a href="#serverless-deploy-func-kn_serverless-functions-getting-started">deploy</a> a function.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="serverless-developing-nodejs-functions">Developing Node.js functions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>After you have <a href="#serverless-create-func-kn_serverless-functions-getting-started">created a Node.js function project</a>, you can modify the template files provided to add business logic to your function. This includes configuring function invocation and the returned headers and status codes.</p>
</div>
<div class="sect2">
<h3 id="prerequisites_serverless-developing-nodejs-functions">Prerequisites</h3>
<div class="ulist">
<ul>
<li>
<p>Before you can develop functions, you must complete the steps in <a href="#serverless-functions-setup">Setting up OpenShift Serverless Functions</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="serverless-nodejs-template_serverless-developing-nodejs-functions">Node.js function template structure</h3>
<div class="paragraph">
<p>When you create a Node.js function using the Knative (<code>kn</code>) CLI, the project directory looks like a typical Node.js project. The only exception is the additional <code>func.yaml</code> file, which is used to configure the function.</p>
</div>
<div class="paragraph">
<p>Both <code>http</code> and <code>event</code> trigger functions have the same template structure:</p>
</div>
<div class="listingblock">
<div class="title">Template structure</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">.
├── func.yaml <b class="conum">(1)</b>
├── index.js <b class="conum">(2)</b>
├── package.json <b class="conum">(3)</b>
├── README.md
└── test <b class="conum">(4)</b>
    ├── integration.js
    └── unit.js</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The <code>func.yaml</code> configuration file is used to determine the image name and registry.</p>
</li>
<li>
<p>Your project must contain an <code>index.js</code> file which exports a single function.</p>
</li>
<li>
<p>You are not restricted to the dependencies provided in the template <code>package.json</code> file. You can add additional dependencies as you would in any other Node.js project.</p>
<div class="listingblock">
<div class="title">Example of adding npm dependencies</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">npm install --save opossum</code></pre>
</div>
</div>
<div class="paragraph">
<p>When the project is built for deployment, these dependencies are included in the created runtime container image.</p>
</div>
</li>
<li>
<p>Integration and unit test scripts are provided as part of the function template.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="serverless-developing-nodejs-functions-about-invoking">About invoking Node.js functions</h3>
<div class="paragraph">
<p>When using the Knative (<code>kn</code>) CLI to create a function project, you can generate a project that responds to CloudEvents, or one that responds to simple HTTP requests. CloudEvents in Knative are transported over HTTP as a POST request, so both function types listen for and respond to incoming HTTP events.</p>
</div>
<div class="paragraph">
<p>Node.js functions can be invoked with a simple HTTP request. When an incoming request is received, functions are invoked with a <code>context</code> object as the first parameter.</p>
</div>
<div class="sect3">
<h4 id="serverless-nodejs-functions-context-objects_serverless-developing-nodejs-functions">Node.js context objects</h4>
<div class="paragraph">
<p>Functions are invoked by providing a <code>context</code> object as the first parameter. This object provides access to the incoming HTTP request information.</p>
</div>
<div class="listingblock">
<div class="title">Example context object</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-javascript" data-lang="javascript">function handle(context, data)</code></pre>
</div>
</div>
<div class="paragraph">
<p>This information includes the HTTP request method, any query strings or headers sent with the request, the HTTP version, and the request body. Incoming requests that contain a <code>CloudEvent</code> attach the incoming instance of the CloudEvent to the context object so that it can be accessed by using <code>context.cloudevent</code>.</p>
</div>
<div class="sect4">
<h5 id="serverless-nodejs-functions-context-objects-methods_serverless-developing-nodejs-functions">Context object methods</h5>
<div class="paragraph">
<p>The <code>context</code> object has a single method, <code>cloudEventResponse()</code>, that accepts a data value and returns a CloudEvent.</p>
</div>
<div class="paragraph">
<p>In a Knative system, if a function deployed as a service is invoked by an event broker sending a CloudEvent, the broker examines the response. If the response is a CloudEvent, this event is handled by the broker.</p>
</div>
<div class="listingblock">
<div class="title">Example context object method</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-javascript" data-lang="javascript">// Expects to receive a CloudEvent with customer data
function handle(context, customer) {
  // process the customer
  const processed = handle(customer);
  return context.cloudEventResponse(customer)
    .source('/handle')
    .type('fn.process.customer')
    .response();
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="serverless-nodejs-functions-context-objects-cloudevent-data_serverless-developing-nodejs-functions">CloudEvent data</h5>
<div class="paragraph">
<p>If the incoming request is a CloudEvent, any data associated with the CloudEvent is extracted from the event and provided as a second parameter. For example, if a CloudEvent is received that contains a JSON string in its data property that is similar to the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-json" data-lang="json">{
  "customerId": "0123456",
  "productId": "6543210"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>When invoked, the second parameter to the function, after the <code>context</code> object, will be a JavaScript object that has <code>customerId</code> and <code>productId</code> properties.</p>
</div>
<div class="listingblock">
<div class="title">Example signature</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-javascript" data-lang="javascript">function handle(context, data)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>data</code> parameter in this example is a JavaScript object that contains the <code>customerId</code> and <code>productId</code> properties.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="serverless-nodejs-function-return-values_serverless-developing-nodejs-functions">Node.js function return values</h3>
<div class="paragraph">
<p>Functions can return any valid JavaScript type or can have no return value. When a function has no return value specified, and no failure is indicated, the caller receives a <code>204 No Content</code> response.</p>
</div>
<div class="paragraph">
<p>Functions can also return a CloudEvent or a <code>Message</code> object in order to push events into the Knative Eventing system. In this case, the developer is not required to understand or implement the CloudEvent messaging specification. Headers and other relevant information from the returned values are extracted and sent with the response.</p>
</div>
<div class="listingblock">
<div class="title">Example</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-javascript" data-lang="javascript">function handle(context, customer) {
  // process customer and return a new CloudEvent
  return new CloudEvent({
    source: 'customer.processor',
    type: 'customer.processed'
  })
}</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="serverless-nodejs-function-return-values-headers_serverless-developing-nodejs-functions">Returning headers</h4>
<div class="paragraph">
<p>You can set a response header by adding a <code>headers</code> property to the <code>return</code> object. These headers are extracted and sent with the response to the caller.</p>
</div>
<div class="listingblock">
<div class="title">Example response header</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-javascript" data-lang="javascript">function handle(context, customer) {
  // process customer and return custom headers
  // the response will be '204 No content'
  return { headers: { customerid: customer.id } };
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="serverless-nodejs-function-return-values-status-codes_serverless-developing-nodejs-functions">Returning status codes</h4>
<div class="paragraph">
<p>You can set a status code that is returned to the caller by adding a <code>statusCode</code> property to the <code>return</code> object:</p>
</div>
<div class="listingblock">
<div class="title">Example status code</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-javascript" data-lang="javascript">function handle(context, customer) {
  // process customer
  if (customer.restricted) {
    return { statusCode: 451 }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Status codes can also be set for errors that are created and thrown by the function:</p>
</div>
<div class="listingblock">
<div class="title">Example error status code</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-javascript" data-lang="javascript">function handle(context, customer) {
  // process customer
  if (customer.restricted) {
    const err = new Error(‘Unavailable for legal reasons’);
    err.statusCode = 451;
    throw err;
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="serverless-testing-nodejs-functions_serverless-developing-nodejs-functions">Testing Node.js functions</h3>
<div class="paragraph">
<p>Node.js functions can be tested locally on your computer. In the default project that is created when you create a function by using <code>kn func create</code>, there is a <strong>test</strong> folder that contains some simple unit and integration tests.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>The OpenShift Serverless Operator and Knative Serving are installed on the cluster.</p>
</li>
<li>
<p>You have installed the Knative (<code>kn</code>) CLI.</p>
</li>
<li>
<p>You have created a function by using <code>kn func create</code>.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Navigate to the <strong>test</strong> folder for your function.</p>
</li>
<li>
<p>Run the tests:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ npm test</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="next-steps_serverless-developing-nodejs-functions">Next steps</h3>
<div class="ulist">
<ul>
<li>
<p>See the <a href="#serverless-nodejs-context-object-reference_serverless-functions-reference-guide">Node.js context object reference</a> documentation.</p>
</li>
<li>
<p><a href="#serverless-build-func-kn_serverless-functions-getting-started">Build</a> and <a href="#serverless-deploy-func-kn_serverless-functions-getting-started">deploy</a> a function.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="serverless-developing-typescript-functions">Developing TypeScript functions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>After you have <a href="#serverless-create-func-kn_serverless-functions-getting-started">created a TypeScript function project</a>, you can modify the template files provided to add business logic to your function. This includes configuring function invocation and the returned headers and status codes.</p>
</div>
<div class="sect2">
<h3 id="prerequisites_serverless-developing-typescript-functions">Prerequisites</h3>
<div class="ulist">
<ul>
<li>
<p>Before you can develop functions, you must complete the steps in <a href="#serverless-functions-setup">Setting up OpenShift Serverless Functions</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="serverless-typescript-template_serverless-developing-typescript-functions">TypeScript function template structure</h3>
<div class="paragraph">
<p>When you create a TypeScript function using the Knative (<code>kn</code>) CLI, the project directory looks like a typical TypeScript project. The only exception is the additional <code>func.yaml</code> file, which is used for configuring the function.</p>
</div>
<div class="paragraph">
<p>Both <code>http</code> and <code>event</code> trigger functions have the same template structure:</p>
</div>
<div class="listingblock">
<div class="title">Template structure</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">.
├── func.yaml <b class="conum">(1)</b>
├── package.json <b class="conum">(2)</b>
├── package-lock.json
├── README.md
├── src
│   └── index.ts <b class="conum">(3)</b>
├── test <b class="conum">(4)</b>
│   ├── integration.ts
│   └── unit.ts
└── tsconfig.json</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The <code>func.yaml</code> configuration file is used to determine the image name and registry.</p>
</li>
<li>
<p>You are not restricted to the dependencies provided in the template <code>package.json</code> file. You can add additional dependencies as you would in any other TypeScript project.</p>
<div class="listingblock">
<div class="title">Example of adding npm dependencies</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">npm install --save opossum</code></pre>
</div>
</div>
<div class="paragraph">
<p>When the project is built for deployment, these dependencies are included in the created runtime container image.</p>
</div>
</li>
<li>
<p>Your project must contain an <code>src/index.js</code> file which exports a function named <code>handle</code>.</p>
</li>
<li>
<p>Integration and unit test scripts are provided as part of the function template.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="serverless-developing-typescript-functions-about-invoking">About invoking TypeScript functions</h3>
<div class="paragraph">
<p>When using the Knative (<code>kn</code>) CLI to create a function project, you can generate a project that responds to CloudEvents or one that responds to simple HTTP requests. CloudEvents in Knative are transported over HTTP as a POST request, so both function types listen for and respond to incoming HTTP events.</p>
</div>
<div class="paragraph">
<p>TypeScript functions can be invoked with a simple HTTP request. When an incoming request is received, functions are invoked with a <code>context</code> object as the first parameter.</p>
</div>
<div class="sect3">
<h4 id="serverless-typescript-functions-context-objects_serverless-developing-typescript-functions">TypeScript context objects</h4>
<div class="paragraph">
<p>To invoke a function, you provide a <code>context</code> object as the first parameter. Accessing properties of the <code>context</code> object can provide information about the incoming HTTP request.</p>
</div>
<div class="listingblock">
<div class="title">Example context object</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-javascript" data-lang="javascript">function handle(context:Context): string</code></pre>
</div>
</div>
<div class="paragraph">
<p>This information includes the HTTP request method, any query strings or headers sent with the request, the HTTP version, and the request body. Incoming requests that contain a <code>CloudEvent</code> attach the incoming instance of the CloudEvent to the context object so that it can be accessed by using <code>context.cloudevent</code>.</p>
</div>
<div class="sect4">
<h5 id="serverless-typescript-functions-context-objects-methods_serverless-developing-typescript-functions">Context object methods</h5>
<div class="paragraph">
<p>The <code>context</code> object has a single method, <code>cloudEventResponse()</code>, that accepts a data value and returns a CloudEvent.</p>
</div>
<div class="paragraph">
<p>In a Knative system, if a function deployed as a service is invoked by an event broker sending a CloudEvent, the broker examines the response. If the response is a CloudEvent, this event is handled by the broker.</p>
</div>
<div class="listingblock">
<div class="title">Example context object method</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-javascript" data-lang="javascript">// Expects to receive a CloudEvent with customer data
export function handle(context: Context, cloudevent?: CloudEvent): CloudEvent {
  // process the customer
  const customer = cloudevent.data;
  const processed = processCustomer(customer);
  return context.cloudEventResponse(customer)
    .source('/customer/process')
    .type('customer.processed')
    .response();
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="serverless-typescript-functions-context-types_serverless-developing-typescript-functions">Context types</h5>
<div class="paragraph">
<p>The TypeScript type definition files export the following types for use in your functions.</p>
</div>
<div class="listingblock">
<div class="title">Exported type definitions</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-javascript" data-lang="javascript">// Invokable is the expeted Function signature for user functions
export interface Invokable {
    (context: Context, cloudevent?: CloudEvent): any
}

// Logger can be used for structural logging to the console
export interface Logger {
  debug: (msg: any) =&gt; void,
  info:  (msg: any) =&gt; void,
  warn:  (msg: any) =&gt; void,
  error: (msg: any) =&gt; void,
  fatal: (msg: any) =&gt; void,
  trace: (msg: any) =&gt; void,
}

// Context represents the function invocation context, and provides
// access to the event itself as well as raw HTTP objects.
export interface Context {
    log: Logger;
    req: IncomingMessage;
    query?: Record&lt;string, any&gt;;
    body?: Record&lt;string, any&gt;|string;
    method: string;
    headers: IncomingHttpHeaders;
    httpVersion: string;
    httpVersionMajor: number;
    httpVersionMinor: number;
    cloudevent: CloudEvent;
    cloudEventResponse(data: string|object): CloudEventResponse;
}

// CloudEventResponse is a convenience class used to create
// CloudEvents on function returns
export interface CloudEventResponse {
    id(id: string): CloudEventResponse;
    source(source: string): CloudEventResponse;
    type(type: string): CloudEventResponse;
    version(version: string): CloudEventResponse;
    response(): CloudEvent;
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="serverless-typescript-functions-context-objects-cloudevent-data_serverless-developing-typescript-functions">CloudEvent data</h5>
<div class="paragraph">
<p>If the incoming request is a CloudEvent, any data associated with the CloudEvent is extracted from the event and provided as a second parameter. For example, if a CloudEvent is received that contains a JSON string in its data property that is similar to the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-json" data-lang="json">{
  "customerId": "0123456",
  "productId": "6543210"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>When invoked, the second parameter to the function, after the <code>context</code> object, will be a JavaScript object that has <code>customerId</code> and <code>productId</code> properties.</p>
</div>
<div class="listingblock">
<div class="title">Example signature</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-javascript" data-lang="javascript">function handle(context: Context, cloudevent?: CloudEvent): CloudEvent</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>cloudevent</code> parameter in this example is a JavaScript object that contains the <code>customerId</code> and <code>productId</code> properties.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="serverless-typescript-function-return-values_serverless-developing-typescript-functions">TypeScript function return values</h3>
<div class="paragraph">
<p>Functions can return any valid JavaScript type or can have no return value. When a function has no return value specified, and no failure is indicated, the caller receives a <code>204 No Content</code> response.</p>
</div>
<div class="paragraph">
<p>Functions can also return a CloudEvent or a <code>Message</code> object in order to push events into the Knative Eventing system. In this case, the developer is not required to understand or implement the CloudEvent messaging specification. Headers and other relevant information from the returned values are extracted and sent with the response.</p>
</div>
<div class="listingblock">
<div class="title">Example</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-javascript" data-lang="javascript">export const handle: Invokable = function (
  context: Context,
  cloudevent?: CloudEvent
): Message {
  // process customer and return a new CloudEvent
  const customer = cloudevent.data;
  return HTTP.binary(
    new CloudEvent({
      source: 'customer.processor',
      type: 'customer.processed'
    })
  );
};</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="serverless-typescript-function-return-values-headers_serverless-developing-typescript-functions">Returning headers</h4>
<div class="paragraph">
<p>You can set a response header by adding a <code>headers</code> property to the <code>return</code> object. These headers are extracted and sent with the response to the caller.</p>
</div>
<div class="listingblock">
<div class="title">Example response header</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-javascript" data-lang="javascript">export function handle(context: Context, cloudevent?: CloudEvent): Record&lt;string, any&gt; {
  // process customer and return custom headers
  const customer = cloudevent.data as Record&lt;string, any&gt;;
  return { headers: { 'customer-id': customer.id } };
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="serverless-typescript-function-return-values-status-codes_serverless-developing-typescript-functions">Returning status codes</h4>
<div class="paragraph">
<p>You can set a status code that is returned to the caller by adding a <code>statusCode</code> property to the <code>return</code> object:</p>
</div>
<div class="listingblock">
<div class="title">Example status code</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-javascript" data-lang="javascript">export function handle(context: Context, cloudevent?: CloudEvent): Record&lt;string, any&gt; {
  // process customer
  const customer = cloudevent.data as Record&lt;string, any&gt;;
  if (customer.restricted) {
    return {
      statusCode: 451
    }
  }
  // business logic, then
  return {
    statusCode: 240
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Status codes can also be set for errors that are created and thrown by the function:</p>
</div>
<div class="listingblock">
<div class="title">Example error status code</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-javascript" data-lang="javascript">export function handle(context: Context, cloudevent?: CloudEvent): Record&lt;string, string&gt; {
  // process customer
  const customer = cloudevent.data as Record&lt;string, any&gt;;
  if (customer.restricted) {
    const err = new Error(‘Unavailable for legal reasons’);
    err.statusCode = 451;
    throw err;
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="serverless-testing-typescript-functions_serverless-developing-typescript-functions">Testing TypeScript functions</h3>
<div class="paragraph">
<p>TypeScript functions can be tested locally on your computer. In the default project that is created when you create a function using <code>kn func create</code>, there is a <strong>test</strong> folder that contains some simple unit and integration tests.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>The OpenShift Serverless Operator and Knative Serving are installed on the cluster.</p>
</li>
<li>
<p>You have installed the Knative (<code>kn</code>) CLI.</p>
</li>
<li>
<p>You have created a function by using <code>kn func create</code>.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>If you have not previously run tests, install the dependencies first:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ npm install</code></pre>
</div>
</div>
</li>
<li>
<p>Navigate to the <strong>test</strong> folder for your function.</p>
</li>
<li>
<p>Run the tests:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ npm test</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="next-steps_serverless-developing-typescript-functions">Next steps</h3>
<div class="ulist">
<ul>
<li>
<p>See the <a href="#serverless-typescript-context-object-reference_serverless-functions-reference-guide">TypeScript context object reference</a> documentation.</p>
</li>
<li>
<p><a href="#serverless-build-func-kn_serverless-functions-getting-started">Build</a> and <a href="#serverless-deploy-func-kn_serverless-functions-getting-started">deploy</a> a function.</p>
</li>
<li>
<p>See <a href="https://getpino.io/#/docs/api">the Pino API documentation</a> for more information about logging with functions.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="serverless-developing-python-functions">Developing Python functions</h2>
<div class="sectionbody">
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>OpenShift Serverless Functions with Python is a Technology Preview feature only. Technology Preview features
are not supported with Red Hat production service level agreements (SLAs) and
might not be functionally complete. Red Hat does not recommend using them
in production. These features provide early access to upcoming product
features, enabling customers to test functionality and provide feedback during
the development process.</p>
</div>
<div class="paragraph">
<p>For more information about the support scope of Red Hat Technology Preview features, see <a href="https://access.redhat.com/support/offerings/techpreview/">Technology Preview Features Support Scope</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>After you have <a href="#serverless-create-func-kn_serverless-functions-getting-started">created a Python function project</a>, you can modify the template files provided to add business logic to your function. This includes configuring function invocation and the returned headers and status codes.</p>
</div>
<div class="sect2">
<h3 id="prerequisites_serverless-developing-python-functions">Prerequisites</h3>
<div class="ulist">
<ul>
<li>
<p>Before you can develop functions, you must complete the steps in <a href="#serverless-functions-setup">Setting up OpenShift Serverless Functions</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="serverless-python-template_serverless-developing-python-functions">Python function template structure</h3>
<div class="paragraph">
<p>When you create a Python function by using the Knative (<code>kn</code>) CLI, the project directory looks similar to a typical Python project. Python functions have very few restrictions. The only requirements are that your project contains a <code>func.py</code> file that contains a <code>main()</code> function, and a <code>func.yaml</code> configuration file.</p>
</div>
<div class="paragraph">
<p>Developers are not restricted to the dependencies provided in the template <code>requirements.txt</code> file. Additional dependencies can be added as they would be in any other Python project. When the project is built for deployment, these dependencies will be included in the created runtime container image.</p>
</div>
<div class="paragraph">
<p>Both <code>http</code> and <code>event</code> trigger functions have the same template structure:</p>
</div>
<div class="listingblock">
<div class="title">Template structure</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">fn
├── func.py <b class="conum">(1)</b>
├── func.yaml <b class="conum">(2)</b>
├── requirements.txt <b class="conum">(3)</b>
└── test_func.py <b class="conum">(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Contains a <code>main()</code> function.</p>
</li>
<li>
<p>Used to determine the image name and registry.</p>
</li>
<li>
<p>Additional dependencies can be added to the <code>requirements.txt</code> file as they are in any other Python project.</p>
</li>
<li>
<p>Contains a simple unit test that can be used to test your function locally.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="serverless-invoking-python-functions_serverless-developing-python-functions">About invoking Python functions</h3>
<div class="paragraph">
<p>Python functions can be invoked with a simple HTTP request. When an incoming request is received, functions are invoked with a <code>context</code> object as the first parameter.</p>
</div>
<div class="paragraph">
<p>The <code>context</code> object is a Python class with two attributes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>request</code> attribute is always present, and contains the Flask <code>request</code> object.</p>
</li>
<li>
<p>The second attribute, <code>cloud_event</code>, is populated if the incoming request is a <code>CloudEvent</code> object.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Developers can access any <code>CloudEvent</code> data from the context object.</p>
</div>
<div class="listingblock">
<div class="title">Example context object</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-python" data-lang="python">def main(context: Context):
    """
    The context parameter contains the Flask request object and any
    CloudEvent received with the request.
    """
    print(f"Method: {context.request.method}")
    print(f"Event data {context.cloud_event.data}")
    # ... business logic here</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="serverless-python-function-return-values_serverless-developing-python-functions">Python function return values</h3>
<div class="paragraph">
<p>Functions can return any value supported by <a href="https://flask.palletsprojects.com/en/1.1.x/quickstart/#about-responses">Flask</a>. This is because the invocation framework proxies these values directly to the Flask server.</p>
</div>
<div class="listingblock">
<div class="title">Example</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-python" data-lang="python">def main(context: Context):
    body = { "message": "Howdy!" }
    headers = { "content-type": "application/json" }
    return body, 200, headers</code></pre>
</div>
</div>
<div class="paragraph">
<p>Functions can set both headers and response codes as secondary and tertiary response values from function invocation.</p>
</div>
<div class="sect3">
<h4 id="serverless-python-function-return-values-returning-events_serverless-developing-python-functions">Returning CloudEvents</h4>
<div class="paragraph">
<p>Developers can use the <code>@event</code> decorator to tell the invoker that the function return value must be converted to a CloudEvent before sending the response.</p>
</div>
<div class="listingblock">
<div class="title">Example</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-python" data-lang="python">@event("event_source"="/my/function", "event_type"="my.type")
def main(context):
    # business logic here
    data = do_something()
    # more data processing
    return data</code></pre>
</div>
</div>
<div class="paragraph">
<p>This example sends a CloudEvent as the response value, with a type of <code>"my.type"</code> and a source of <code>"/my/function"</code>. The CloudEvent <a href="https://github.com/cloudevents/spec/blob/v1.0.1/spec.md#event-data"><code>data</code> property</a> is set to the returned <code>data</code> variable. The <code>event_source</code> and <code>event_type</code> decorator attributes are both optional.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="serverless-testing-python-functions_serverless-developing-python-functions">Testing Python functions</h3>
<div class="paragraph">
<p>You can test Python functions locally on your computer. The default project contains a <code>test_func.py</code> file, which provides a simple unit test for functions.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>The default test framework for Python functions is <code>unittest</code>. You can use a different test framework if you prefer.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>To run Python functions tests locally, you must install the required dependencies:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ pip install -r requirements.txt</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Navigate to the folder for your function that contains the <code>test_func.py</code> file.</p>
</li>
<li>
<p>Run the tests:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ python3 test_func.py</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="next-steps_serverless-developing-python-functions">Next steps</h3>
<div class="ulist">
<ul>
<li>
<p><a href="#serverless-build-func-kn_serverless-functions-getting-started">Build</a> and <a href="#serverless-deploy-func-kn_serverless-functions-getting-started">deploy</a> a function.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="serverless-functions-eventing">Using functions with Knative Eventing</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Functions are deployed as Knative services on an OpenShift Container Platform cluster. You can connect functions to Knative Eventing components so that they can receive incoming events.</p>
</div>
<div class="sect2">
<h3 id="serverless-connect-func-source-odc_serverless-functions-eventing">Connect an event source to a function using the Developer perspective</h3>
<div class="paragraph">
<p>Functions are deployed as Knative services on an OpenShift Container Platform cluster. When you create an event source by using the OpenShift Container Platform web console, you can specify a deployed function that events are sent to from that source.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>The OpenShift Serverless Operator, Knative Serving, and Knative Eventing are installed on your OpenShift Container Platform cluster.</p>
</li>
<li>
<p>You have logged in to the web console and are in the <strong>Developer</strong> perspective.</p>
</li>
<li>
<p>You have created a project or have access to a project with the appropriate roles and permissions to create applications and other workloads in OpenShift Container Platform.</p>
</li>
<li>
<p>You have created and deployed a function.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create an event source of any type, by navigating to <strong>+Add</strong> &#8594; <strong>Event Source</strong> and selecting the event source type that you want to create.</p>
</li>
<li>
<p>In the <strong>Sink</strong> section of the <strong>Create Event Source</strong> form view, select your function in the <strong>Resource</strong> list.</p>
</li>
<li>
<p>Click <strong>Create</strong>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">Verification</div>
<p>You can verify that the event source was created and is connected to the function by viewing the <strong>Topology</strong> page.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the <strong>Developer</strong> perspective, navigate to <strong>Topology</strong>.</p>
</li>
<li>
<p>View the event source and click the connected function to see the function details in the right panel.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="serverless-functions-project-configuration">Function project configuration in func.yaml</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <code>func.yaml</code> file contains the configuration for your function project. Values specified in <code>func.yaml</code> are used when you execute a <code>kn func</code> command. For example, when you run the <code>kn func build</code> command, the value in the <code>build</code> field is used. In some cases, you can override these values with command line flags or environment variables.</p>
</div>
<div class="sect2">
<h3 id="serverless-functions-func-yaml_serverless-functions-yaml">Configurable fields in func.yaml</h3>
<div class="paragraph">
<p>Many of the fields in <code>func.yaml</code> are generated automatically when you create, build, and deploy your function. However, there are also fields that you modify manually to change things, such as the function name or the image name.</p>
</div>
<div class="sect3">
<h4 id="serverless-functions-func-yaml-buildenvs_serverless-functions-yaml">buildEnvs</h4>
<div class="paragraph">
<p>The <code>buildEnvs</code> field enables you to set environment variables to be available to the environment that builds your function. Unlike variables set using <code>envs</code>, a variable set using <code>buildEnv</code> is not available during function runtime.</p>
</div>
<div class="paragraph">
<p>You can set a <code>buildEnv</code> variable directly from a value. In the following example, the <code>buildEnv</code> variable named <code>EXAMPLE1</code> is directly assigned the <code>one</code> value:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">buildEnvs:
- name: EXAMPLE1
  value: one</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also set a <code>buildEnv</code> variable from a local environment variable. In the following example, the <code>buildEnv</code> variable named <code>EXAMPLE2</code> is assigned the value of the <code>LOCAL_ENV_VAR</code> local environment variable:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">buildEnvs:
- name: EXAMPLE1
  value: '{{ env:LOCAL_ENV_VAR }}'</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="serverless-functions-func-yaml-envs_serverless-functions-yaml">envs</h4>
<div class="paragraph">
<p>The <code>envs</code> field enables you to set environment variables to be available to your function at runtime. You can set an environment variable in several different ways:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Directly from a value.</p>
</li>
<li>
<p>From a value assigned to a local environment variable. See the section "Referencing local environment variables from func.yaml fields" for more information.</p>
</li>
<li>
<p>From a key-value pair stored in a secret or config map.</p>
</li>
<li>
<p>You can also import all key-value pairs stored in a secret or config map, with keys used as names of the created environment variables.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>This examples demonstrates the different ways to set an environment variable:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">name: test
namespace: ""
runtime: go
...
envs:
- name: EXAMPLE1 <b class="conum">(1)</b>
  value: value
- name: EXAMPLE2 <b class="conum">(2)</b>
  value: '{{ env:LOCAL_ENV_VALUE }}'
- name: EXAMPLE3 <b class="conum">(3)</b>
  value: '{{ secret:mysecret:key }}'
- name: EXAMPLE4 <b class="conum">(4)</b>
  value: '{{ configMap:myconfigmap:key }}'
- value: '{{ secret:mysecret2 }}' <b class="conum">(5)</b>
- value: '{{ configMap:myconfigmap2 }}' <b class="conum">(6)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>An environment variable set directly from a value.</p>
</li>
<li>
<p>An environment variable set from a value assigned to a local environment variable.</p>
</li>
<li>
<p>An environment variable assigned from a key-value pair stored in a secret.</p>
</li>
<li>
<p>An environment variable assigned from a key-value pair stored in a config map.</p>
</li>
<li>
<p>A set of environment variables imported from key-value pairs of a secret.</p>
</li>
<li>
<p>A set of environment variables imported from key-value pairs of a config map.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="serverless-functions-func-yaml-builder_serverless-functions-yaml">builder</h4>
<div class="paragraph">
<p>The <code>builder</code> field specifies the strategy used by the function to build the image. It accepts values of <code>pack</code> or <code>s2i</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="serverless-functions-func-yaml-build_serverless-functions-yaml">build</h4>
<div class="paragraph">
<p>The <code>build</code> field indicates how the function should be built. The value <code>local</code> indicates that the function is built locally on your machine. The value <code>git</code> indicates that the function is built on a cluster by using the values specified in the <code>git</code> field.</p>
</div>
</div>
<div class="sect3">
<h4 id="serverless-functions-func-yaml-volumes_serverless-functions-yaml">volumes</h4>
<div class="paragraph">
<p>The <code>volumes</code> field enables you to mount secrets and config maps as a volume accessible to the function at the specified path, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">name: test
namespace: ""
runtime: go
...
volumes:
- secret: mysecret <b class="conum">(1)</b>
  path: /workspace/secret
- configMap: myconfigmap <b class="conum">(2)</b>
  path: /workspace/configmap</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The <code>mysecret</code> secret is mounted as a volume residing at <code>/workspace/secret</code>.</p>
</li>
<li>
<p>The <code>myconfigmap</code> config map is mounted as a volume residing at <code>/workspace/configmap</code>.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="serverless-functions-func-yaml-options_serverless-functions-yaml">options</h4>
<div class="paragraph">
<p>The <code>options</code> field enables you to modify Knative Service properties for the deployed function, such as autoscaling. If these options are not set, the default ones are used.</p>
</div>
<div class="paragraph">
<p>These options are available:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>scale</code></p>
<div class="ulist">
<ul>
<li>
<p><code>min</code>: The minimum number of replicas. Must be a non-negative integer. The default is 0.</p>
</li>
<li>
<p><code>max</code>: The maximum number of replicas. Must be a non-negative integer. The default is 0, which means no limit.</p>
</li>
<li>
<p><code>metric</code>: Defines which metric type is watched by the Autoscaler. It can be set to <code>concurrency</code>, which is the default, or <code>rps</code>.</p>
</li>
<li>
<p><code>target</code>: Recommendation for when to scale up based on the number of concurrently incoming requests. The <code>target</code> option can be a float value greater than 0.01. The default is 100, unless the <code>options.resources.limits.concurrency</code> is set, in which case <code>target</code> defaults to its value.</p>
</li>
<li>
<p><code>utilization</code>: Percentage of concurrent requests utilization allowed before scaling up. It can be a float value between 1 and 100. The default is 70.</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>resources</code></p>
<div class="ulist">
<ul>
<li>
<p><code>requests</code></p>
<div class="ulist">
<ul>
<li>
<p><code>cpu</code>: A CPU resource request for the container with deployed function.</p>
</li>
<li>
<p><code>memory</code>: A memory resource request for the container with deployed function.</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>limits</code></p>
<div class="ulist">
<ul>
<li>
<p><code>cpu</code>: A CPU resource limit for the container with deployed function.</p>
</li>
<li>
<p><code>memory</code>: A memory resource limit for the container with deployed function.</p>
</li>
<li>
<p><code>concurrency</code>: Hard Limit of concurrent requests to be processed by a single replica. It can be integer value greater than or equal to 0, default is 0 - meaning no limit.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>This is an example configuration of the <code>scale</code> options:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">name: test
namespace: ""
runtime: go
...
options:
  scale:
    min: 0
    max: 10
    metric: concurrency
    target: 75
    utilization: 75
  resources:
    requests:
      cpu: 100m
      memory: 128Mi
    limits:
      cpu: 1000m
      memory: 256Mi
      concurrency: 100</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="serverless-functions-func-yaml-image_serverless-functions-yaml">image</h4>
<div class="paragraph">
<p>The <code>image</code> field sets the image name for your function after it has been built. You can modify this field. If you do, the next time you run <code>kn func build</code> or <code>kn func deploy</code>, the function image will be created with the new name.</p>
</div>
</div>
<div class="sect3">
<h4 id="serverless-functions-func-yaml-imagedigest_serverless-functions-yaml">imageDigest</h4>
<div class="paragraph">
<p>The <code>imageDigest</code> field contains the SHA256 hash of the image manifest when the function is deployed. Do not modify this value.</p>
</div>
</div>
<div class="sect3">
<h4 id="serverless-functions-func-yaml-labels_serverless-functions-yaml">labels</h4>
<div class="paragraph">
<p>The <code>labels</code> field enables you to set labels on a deployed function.</p>
</div>
<div class="paragraph">
<p>You can set a label directly from a value. In the following example, the label with the <code>role</code> key is directly assigned the value of <code>backend</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">labels:
- key: role
  value: backend</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also set a label from a local environment variable. In the following example, the label with the <code>author</code> key is assigned the value of the <code>USER</code> local environment variable:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">labels:
- key: author
  value: '{{ env:USER }}'</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="serverless-functions-func-yaml-name_serverless-functions-yaml">name</h4>
<div class="paragraph">
<p>The <code>name</code> field defines the name of your function. This value is used as the name of your Knative service when it is deployed. You can change this field to rename the function on subsequent deployments.</p>
</div>
</div>
<div class="sect3">
<h4 id="serverless-functions-func-yaml-namespace_serverless-functions-yaml">namespace</h4>
<div class="paragraph">
<p>The <code>namespace</code> field specifies the namespace in which your function is deployed.</p>
</div>
</div>
<div class="sect3">
<h4 id="serverless-functions-func-yaml-runtime_serverless-functions-yaml">runtime</h4>
<div class="paragraph">
<p>The <code>runtime</code> field specifies the language runtime for your function, for example, <code>python</code>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="serverless-functions-func-yaml-environment-variables_serverless-functions-yaml">Referencing local environment variables from func.yaml fields</h3>
<div class="paragraph">
<p>If you want to avoid storing sensitive information such as an API key in the function configuration, you can add a reference to an environment variable available in the local environment. You can do this by modifying the <code>envs</code> field in the <code>func.yaml</code> file.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You need to have the function project created.</p>
</li>
<li>
<p>The local environment needs to contain the variable that you want to reference.</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>To refer to a local environment variable, use the following syntax:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>{{ env:ENV_VAR }}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Substitute <code>ENV_VAR</code> with the name of the variable in the local environment that you want to use.</p>
</div>
<div class="paragraph">
<p>For example, you might have the <code>API_KEY</code> variable available in the local environment. You can assign its value to the <code>MY_API_KEY</code> variable, which you can then directly use within your function:</p>
</div>
<div class="listingblock">
<div class="title">Example function</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">name: test
namespace: ""
runtime: go
...
envs:
- name: MY_API_KEY
  value: '{{ env:API_KEY }}'
...</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2 _additional-resources">
<h3 id="additional-resources_serverless-functions-project-configuration">Additional resources</h3>
<div class="ulist">
<ul>
<li>
<p><a href="#serverless-functions-getting-started">Getting started with functions</a></p>
</li>
<li>
<p><a href="#serverless-functions-accessing-secrets-configmaps">Accessing secrets and config maps from Serverless functions</a></p>
</li>
<li>
<p><a href="https://knative.dev/docs/serving/autoscaling/">Knative documentation on Autoscaling</a></p>
</li>
<li>
<p><a href="https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/">Kubernetes documentation on managing resources for containers</a></p>
</li>
<li>
<p><a href="https://knative.dev/docs/serving/autoscaling/concurrency/">Knative documentation on configuring concurrency</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="serverless-functions-accessing-secrets-configmaps">Accessing secrets and config maps from functions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>After your functions have been deployed to the cluster, they can access data stored in secrets and config maps. This data can be mounted as volumes, or assigned to environment variables. You can configure this access interactively by using the Knative CLI, or by manually by editing the function configuration YAML file.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>To access secrets and config maps, the function must be deployed on the cluster. This functionality is not available to a function running locally.</p>
</div>
<div class="paragraph">
<p>If a secret or config map value cannot be accessed, the deployment fails with an error message specifying the inaccessible values.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="serverless-functions-secrets-configmaps-interactively_serverless-functions-secrets">Modifying function access to secrets and config maps interactively</h3>
<div class="paragraph">
<p>You can manage the secrets and config maps accessed by your function by using the <code>kn func config</code> interactive utility. The available operations include listing, adding, and removing values stored in config maps and secrets as environment variables, as well as listing, adding, and removing volumes. This functionality enables you to manage what data stored on the cluster is accessible by your function.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>The OpenShift Serverless Operator and Knative Serving are installed on the cluster.</p>
</li>
<li>
<p>You have installed the Knative (<code>kn</code>) CLI.</p>
</li>
<li>
<p>You have created a function.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Run the following command in the function project directory:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ kn func config</code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively, you can specify the function project directory using the <code>--path</code> or <code>-p</code> option.</p>
</div>
</li>
<li>
<p>Use the interactive interface to perform the necessary operation. For example, using the utility to list configured volumes produces an output similar to this:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ kn func config
? What do you want to configure? Volumes
? What operation do you want to perform? List
Configured Volumes mounts:
- Secret "mysecret" mounted at path: "/workspace/secret"
- Secret "mysecret2" mounted at path: "/workspace/secret2"</code></pre>
</div>
</div>
<div class="paragraph">
<p>This scheme shows all operations available in the interactive utility and how to navigate to them:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>kn func config
   ├─&gt; Environment variables
   │               ├─&gt; Add
   │               │    ├─&gt; ConfigMap: Add all key-value pairs from a config map
   │               │    ├─&gt; ConfigMap: Add value from a key in a config map
   │               │    ├─&gt; Secret: Add all key-value pairs from a secret
   │               │    └─&gt; Secret: Add value from a key in a secret
   │               ├─&gt; List: List all configured environment variables
   │               └─&gt; Remove: Remove a configured environment variable
   └─&gt; Volumes
           ├─&gt; Add
           │    ├─&gt; ConfigMap: Mount a config map as a volume
           │    └─&gt; Secret: Mount a secret as a volume
           ├─&gt; List: List all configured volumes
           └─&gt; Remove: Remove a configured volume</code></pre>
</div>
</div>
</li>
<li>
<p>Optional. Deploy the function to make the changes take effect:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ kn func deploy -p test</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="serverless-functions-secrets-configmaps-interactively-specialized_serverless-functions-secrets">Modifying function access to secrets and config maps interactively by using specialized commands</h3>
<div class="paragraph">
<p>Every time you run the <code>kn func config</code> utility, you need to navigate the entire dialogue to select the operation you need, as shown in the previous section. To save steps, you can directly execute a specific operation by running a more specific form of the <code>kn func config</code> command:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>To list configured environment variables:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ kn func config envs [-p &lt;function-project-path&gt;]</code></pre>
</div>
</div>
</li>
<li>
<p>To add environment variables to the function configuration:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ kn func config envs add [-p &lt;function-project-path&gt;]</code></pre>
</div>
</div>
</li>
<li>
<p>To remove environment variables from the function configuration:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ kn func config envs remove [-p &lt;function-project-path&gt;]</code></pre>
</div>
</div>
</li>
<li>
<p>To list configured volumes:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ kn func config volumes [-p &lt;function-project-path&gt;]</code></pre>
</div>
</div>
</li>
<li>
<p>To add a volume to the function configuration:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ kn func config volumes add [-p &lt;function-project-path&gt;]</code></pre>
</div>
</div>
</li>
<li>
<p>To remove a volume from the function configuration:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ kn func config volumes remove [-p &lt;function-project-path&gt;]</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="serverless-functions-secrets-configmaps-manually_serverless-functions-secrets">Adding function access to secrets and config maps manually</h3>
<div class="paragraph">
<p>You can manually add configuration for accessing secrets and config maps to your function. This might be preferable to using the <code>kn func config</code> interactive utility and commands, for example when you have an existing configuration snippet.</p>
</div>
<div class="sect3">
<h4 id="serverless-functions-mounting-secret-as-volume_serverless-functions-secrets">Mounting a secret as a volume</h4>
<div class="paragraph">
<p>You can mount a secret as a volume. Once a secret is mounted, you can access it from the function as a regular file. This enables you to store on the cluster data needed by the function, for example, a list of URIs that need to be accessed by the function.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>The OpenShift Serverless Operator and Knative Serving are installed on the cluster.</p>
</li>
<li>
<p>You have installed the Knative (<code>kn</code>) CLI.</p>
</li>
<li>
<p>You have created a function.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Open the <code>func.yaml</code> file for your function.</p>
</li>
<li>
<p>For each secret you want to mount as a volume, add the following YAML to the <code>volumes</code> section:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">name: test
namespace: ""
runtime: go
...
volumes:
- secret: mysecret
  path: /workspace/secret</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Substitute <code>mysecret</code> with the name of the target secret.</p>
</li>
<li>
<p>Substitute <code>/workspace/secret</code> with the path where you want to mount the secret.</p>
<div class="paragraph">
<p>For example, to mount the <code>addresses</code> secret, use the following YAML:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">name: test
namespace: ""
runtime: go
...
volumes:
- configMap: addresses
  path: /workspace/secret-addresses</code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Save the configuration.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="serverless-functions-mounting-configmap-as-volume_serverless-functions-secrets">Mounting a config map as a volume</h4>
<div class="paragraph">
<p>You can mount a config map as a volume. Once a config map is mounted, you can access it from the function as a regular file. This enables you to store on the cluster data needed by the function, for example, a list of URIs that need to be accessed by the function.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>The OpenShift Serverless Operator and Knative Serving are installed on the cluster.</p>
</li>
<li>
<p>You have installed the Knative (<code>kn</code>) CLI.</p>
</li>
<li>
<p>You have created a function.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Open the <code>func.yaml</code> file for your function.</p>
</li>
<li>
<p>For each config map you want to mount as a volume, add the following YAML to the <code>volumes</code> section:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">name: test
namespace: ""
runtime: go
...
volumes:
- configMap: myconfigmap
  path: /workspace/configmap</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Substitute <code>myconfigmap</code> with the name of the target config map.</p>
</li>
<li>
<p>Substitute <code>/workspace/configmap</code> with the path where you want to mount the config map.</p>
<div class="paragraph">
<p>For example, to mount the <code>addresses</code> config map, use the following YAML:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">name: test
namespace: ""
runtime: go
...
volumes:
- configMap: addresses
  path: /workspace/configmap-addresses</code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Save the configuration.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="serverless-functions-key-value-in-secret-to-env-variable_serverless-functions-secrets">Setting environment variable from a key value defined in a secret</h4>
<div class="paragraph">
<p>You can set an environment variable from a key value defined as a secret. A value previously stored in a secret can then be accessed as an environment variable by the function at runtime. This can be useful for getting access to a value stored in a secret, such as the ID of a user.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>The OpenShift Serverless Operator and Knative Serving are installed on the cluster.</p>
</li>
<li>
<p>You have installed the Knative (<code>kn</code>) CLI.</p>
</li>
<li>
<p>You have created a function.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Open the <code>func.yaml</code> file for your function.</p>
</li>
<li>
<p>For each value from a secret key-value pair that you want to assign to an environment variable, add the following YAML to the <code>envs</code> section:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">name: test
namespace: ""
runtime: go
...
envs:
- name: EXAMPLE
  value: '{{ secret:mysecret:key }}'</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Substitute <code>EXAMPLE</code> with the name of the environment variable.</p>
</li>
<li>
<p>Substitute <code>mysecret</code> with the name of the target secret.</p>
</li>
<li>
<p>Substitute <code>key</code> with the key mapped to the target value.</p>
<div class="paragraph">
<p>For example, to access the user ID that is stored in <code>userdetailssecret</code>, use the following YAML:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">name: test
namespace: ""
runtime: go
...
envs:
- value: '{{ configMap:userdetailssecret:userid }}'</code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Save the configuration.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="serverless-functions-key-value-in-configmap-to-env-variable_serverless-functions-secrets">Setting environment variable from a key value defined in a config map</h4>
<div class="paragraph">
<p>You can set an environment variable from a key value defined as a config map. A value previously stored in a config map can then be accessed as an environment variable by the function at runtime. This can be useful for getting access to a value stored in a config map, such as the ID of a user.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>The OpenShift Serverless Operator and Knative Serving are installed on the cluster.</p>
</li>
<li>
<p>You have installed the Knative (<code>kn</code>) CLI.</p>
</li>
<li>
<p>You have created a function.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Open the <code>func.yaml</code> file for your function.</p>
</li>
<li>
<p>For each value from a config map key-value pair that you want to assign to an environment variable, add the following YAML to the <code>envs</code> section:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">name: test
namespace: ""
runtime: go
...
envs:
- name: EXAMPLE
  value: '{{ configMap:myconfigmap:key }}'</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Substitute <code>EXAMPLE</code> with the name of the environment variable.</p>
</li>
<li>
<p>Substitute <code>myconfigmap</code> with the name of the target config map.</p>
</li>
<li>
<p>Substitute <code>key</code> with the key mapped to the target value.</p>
<div class="paragraph">
<p>For example, to access the user ID that is stored in <code>userdetailsmap</code>, use the following YAML:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">name: test
namespace: ""
runtime: go
...
envs:
- value: '{{ configMap:userdetailsmap:userid }}'</code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Save the configuration.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="serverless-functions-all-values-in-secret-to-env-variables_serverless-functions-secrets">Setting environment variables from all values defined in a secret</h4>
<div class="paragraph">
<p>You can set an environment variable from all values defined in a secret. Values previously stored in a secret can then be accessed as environment variables by the function at runtime. This can be useful for simultaneously getting access to a collection of values stored in a secret, for example, a set of data pertaining to a user.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>The OpenShift Serverless Operator and Knative Serving are installed on the cluster.</p>
</li>
<li>
<p>You have installed the Knative (<code>kn</code>) CLI.</p>
</li>
<li>
<p>You have created a function.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Open the <code>func.yaml</code> file for your function.</p>
</li>
<li>
<p>For every secret for which you want to import all key-value pairs as environment variables, add the following YAML to the <code>envs</code> section:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">name: test
namespace: ""
runtime: go
...
envs:
- value: '{{ secret:mysecret }}' <b class="conum">(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Substitute <code>mysecret</code> with the name of the target secret.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>For example, to access all user data that is stored in <code>userdetailssecret</code>, use the following YAML:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">name: test
namespace: ""
runtime: go
...
envs:
- value: '{{ configMap:userdetailssecret }}'</code></pre>
</div>
</div>
</li>
<li>
<p>Save the configuration.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="serverless-functions-all-values-in-configmap-to-env-variables_serverless-functions-secrets">Setting environment variables from all values defined in a config map</h4>
<div class="paragraph">
<p>You can set an environment variable from all values defined in a config map. Values previously stored in a config map can then be accessed as environment variables by the function at runtime. This can be useful for simultaneously getting access to a collection of values stored in a config map, for example, a set of data pertaining to a user.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>The OpenShift Serverless Operator and Knative Serving are installed on the cluster.</p>
</li>
<li>
<p>You have installed the Knative (<code>kn</code>) CLI.</p>
</li>
<li>
<p>You have created a function.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Open the <code>func.yaml</code> file for your function.</p>
</li>
<li>
<p>For every config map for which you want to import all key-value pairs as environment variables, add the following YAML to the <code>envs</code> section:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">name: test
namespace: ""
runtime: go
...
envs:
- value: '{{ configMap:myconfigmap }}' <b class="conum">(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Substitute <code>myconfigmap</code> with the name of the target config map.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>For example, to access all user data that is stored in <code>userdetailsmap</code>, use the following YAML:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">name: test
namespace: ""
runtime: go
...
envs:
- value: '{{ configMap:userdetailsmap }}'</code></pre>
</div>
</div>
</li>
<li>
<p>Save the file.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="serverless-functions-attributes">Adding annotations to functions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can add Kubernetes annotations to a deployed Serverless function. Annotations enable you to attach arbitrary metadata to a function, for example, a note about the function&#8217;s purpose. Annotations are added to the <code>annotations</code> section of the <code>func.yaml</code> configuration file.</p>
</div>
<div class="paragraph">
<p>There are two limitations of the function annotation feature:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>After a function annotation propagates to the corresponding Knative service on the cluster, it cannot be removed from the service by deleting it from the <code>func.yaml</code> file. You must remove the annotation from the Knative service by modifying the YAML file of the service directly, or by using the OpenShift Container Platform web console.</p>
</li>
<li>
<p>You cannot set annotations that are set by Knative, for example, the <code>autoscaling</code> annotations.</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="serverless-functions-adding-annotations_serverless-functions-annotations">Adding annotations to a function</h3>
<div class="paragraph">
<p>You can add annotations to a function. Similar to a label, an annotation is defined as a key-value map. Annotations are useful, for example, for providing metadata about a function, such as the function&#8217;s author.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>The OpenShift Serverless Operator and Knative Serving are installed on the cluster.</p>
</li>
<li>
<p>You have installed the Knative (<code>kn</code>) CLI.</p>
</li>
<li>
<p>You have created a function.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Open the <code>func.yaml</code> file for your function.</p>
</li>
<li>
<p>For every annotation that you want to add, add the following YAML to the <code>annotations</code> section:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">name: test
namespace: ""
runtime: go
...
annotations:
  &lt;annotation_name&gt;: "&lt;annotation_value&gt;" <b class="conum">(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Substitute <code>&lt;annotation_name&gt;: "&lt;annotation_value&gt;"</code> with your annotation.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>For example, to indicate that a function was authored by Alice, you might include the following annotation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">name: test
namespace: ""
runtime: go
...
annotations:
  author: "alice@example.com"</code></pre>
</div>
</div>
</li>
<li>
<p>Save the configuration.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The next time you deploy your function to the cluster, the annotations are added to the corresponding Knative service.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="serverless-functions-reference-guide">Functions development reference guide</h2>
<div class="sectionbody">
<div class="paragraph">
<p>OpenShift Serverless Functions provides templates that can be used to create basic functions. A template initiates the function project boilerplate and prepares it for use with the <code>kn func</code> tool. Each function template is tailored for a specific runtime and follows its conventions. With a template, you can initiate your function project automatically.</p>
</div>
<div class="paragraph">
<p>Templates for the following runtimes are available:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#serverless-developing-nodejs-functions">Node.js</a></p>
</li>
<li>
<p><a href="#serverless-developing-quarkus-functions">Quarkus</a></p>
</li>
<li>
<p><a href="#serverless-developing-typescript-functions">TypeScript</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="serverless-nodejs-context-object-reference_serverless-functions-reference-guide">Node.js context object reference</h3>
<div class="paragraph">
<p>The <code>context</code> object has several properties that can be accessed by the function developer. Accessing these properties can provide information about HTTP requests and write output to the cluster logs.</p>
</div>
<div class="sect3">
<h4 id="serverless-nodejs-context-object-reference-log_serverless-functions-reference-guide">log</h4>
<div class="paragraph">
<p>Provides a logging object that can be used to write output to the cluster logs. The log adheres to the <a href="https://getpino.io/#/docs/api">Pino logging API</a>.</p>
</div>
<div class="listingblock">
<div class="title">Example log</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-javascript" data-lang="javascript">function handle(context) {
  context.log.info(“Processing customer”);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can access the function by using the <code>kn func invoke</code> command:</p>
</div>
<div class="listingblock">
<div class="title">Example command</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ kn func invoke --target 'http://example.function.com'</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">{"level":30,"time":1604511655265,"pid":3430203,"hostname":"localhost.localdomain","reqId":1,"msg":"Processing customer"}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can change the log level to one of <code>fatal</code>, <code>error</code>, <code>warn</code>, <code>info</code>, <code>debug</code>, <code>trace</code>, or <code>silent</code>. To do that, change the value of <code>logLevel</code> by assigning one of these values to the environment variable <code>FUNC_LOG_LEVEL</code> using the <code>config</code> command.</p>
</div>
</div>
<div class="sect3">
<h4 id="serverless-nodejs-context-object-reference-query_serverless-functions-reference-guide">query</h4>
<div class="paragraph">
<p>Returns the query string for the request, if any, as key-value pairs. These attributes are also found on the context object itself.</p>
</div>
<div class="listingblock">
<div class="title">Example query</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-javascript" data-lang="javascript">function handle(context) {
  // Log the 'name' query parameter
  context.log.info(context.query.name);
  // Query parameters are also attached to the context
  context.log.info(context.name);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can access the function by using the <code>kn func invoke</code> command:</p>
</div>
<div class="listingblock">
<div class="title">Example command</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ kn func invoke --target 'http://example.com?name=tiger'</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">{"level":30,"time":1604511655265,"pid":3430203,"hostname":"localhost.localdomain","reqId":1,"msg":"tiger"}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="serverless-nodejs-context-object-reference-body_serverless-functions-reference-guide">body</h4>
<div class="paragraph">
<p>Returns the request body if any. If the request body contains JSON code, this will be parsed so that the attributes are directly available.</p>
</div>
<div class="listingblock">
<div class="title">Example body</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-javascript" data-lang="javascript">function handle(context) {
  // log the incoming request body's 'hello' parameter
  context.log.info(context.body.hello);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can access the function by using the <code>curl</code> command to invoke it:</p>
</div>
<div class="listingblock">
<div class="title">Example command</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ kn func invoke -d '{"Hello": "world"}'</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">{"level":30,"time":1604511655265,"pid":3430203,"hostname":"localhost.localdomain","reqId":1,"msg":"world"}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="serverless-nodejs-context-object-reference-headers_serverless-functions-reference-guide">headers</h4>
<div class="paragraph">
<p>Returns the HTTP request headers as an object.</p>
</div>
<div class="listingblock">
<div class="title">Example header</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-javascript" data-lang="javascript">function handle(context) {
  context.log.info(context.headers["custom-header"]);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can access the function by using the <code>kn func invoke</code> command:</p>
</div>
<div class="listingblock">
<div class="title">Example command</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ kn func invoke --target 'http://example.function.com'</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">{"level":30,"time":1604511655265,"pid":3430203,"hostname":"localhost.localdomain","reqId":1,"msg":"some-value"}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="serverless-nodejs-context-object-reference-http-requests_serverless-functions-reference-guide">HTTP requests</h4>
<div class="dlist">
<dl>
<dt class="hdlist1">method</dt>
<dd>
<p>Returns the HTTP request method as a string.</p>
</dd>
<dt class="hdlist1">httpVersion</dt>
<dd>
<p>Returns the HTTP version as a string.</p>
</dd>
<dt class="hdlist1">httpVersionMajor</dt>
<dd>
<p>Returns the HTTP major version number as a string.</p>
</dd>
<dt class="hdlist1">httpVersionMinor</dt>
<dd>
<p>Returns the HTTP minor version number as a string.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect2">
<h3 id="serverless-typescript-context-object-reference_serverless-functions-reference-guide">TypeScript context object reference</h3>
<div class="paragraph">
<p>The <code>context</code> object has several properties that can be accessed by the function developer. Accessing these properties can provide information about incoming HTTP requests and write output to the cluster logs.</p>
</div>
<div class="sect3">
<h4 id="serverless-typescript-context-object-reference-log_serverless-functions-reference-guide">log</h4>
<div class="paragraph">
<p>Provides a logging object that can be used to write output to the cluster logs. The log adheres to the <a href="https://getpino.io/#/docs/api">Pino logging API</a>.</p>
</div>
<div class="listingblock">
<div class="title">Example log</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-javascript" data-lang="javascript">export function handle(context: Context): string {
    // log the incoming request body's 'hello' parameter
    if (context.body) {
      context.log.info((context.body as Record&lt;string, string&gt;).hello);
    } else {
      context.log.info('No data received');
    }
    return 'OK';
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can access the function by using the <code>kn func invoke</code> command:</p>
</div>
<div class="listingblock">
<div class="title">Example command</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ kn func invoke --target 'http://example.function.com'</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">{"level":30,"time":1604511655265,"pid":3430203,"hostname":"localhost.localdomain","reqId":1,"msg":"Processing customer"}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can change the log level to one of <code>fatal</code>, <code>error</code>, <code>warn</code>, <code>info</code>, <code>debug</code>, <code>trace</code>, or <code>silent</code>. To do that, change the value of <code>logLevel</code> by assigning one of these values to the environment variable <code>FUNC_LOG_LEVEL</code> using the <code>config</code> command.</p>
</div>
</div>
<div class="sect3">
<h4 id="serverless-typescript-context-object-reference-query_serverless-functions-reference-guide">query</h4>
<div class="paragraph">
<p>Returns the query string for the request, if any, as key-value pairs. These attributes are also found on the context object itself.</p>
</div>
<div class="listingblock">
<div class="title">Example query</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-javascript" data-lang="javascript">export function handle(context: Context): string {
      // log the 'name' query parameter
    if (context.query) {
      context.log.info((context.query as Record&lt;string, string&gt;).name);
    } else {
      context.log.info('No data received');
    }
    return 'OK';
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can access the function by using the <code>kn func invoke</code> command:</p>
</div>
<div class="listingblock">
<div class="title">Example command</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ kn func invoke --target 'http://example.function.com' --data '{"name": "tiger"}'</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">{"level":30,"time":1604511655265,"pid":3430203,"hostname":"localhost.localdomain","reqId":1,"msg":"tiger"}
{"level":30,"time":1604511655265,"pid":3430203,"hostname":"localhost.localdomain","reqId":1,"msg":"tiger"}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="serverless-typescript-context-object-reference-body_serverless-functions-reference-guide">body</h4>
<div class="paragraph">
<p>Returns the request body, if any. If the request body contains JSON code, this will be parsed so that the attributes are directly available.</p>
</div>
<div class="listingblock">
<div class="title">Example body</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-javascript" data-lang="javascript">export function handle(context: Context): string {
    // log the incoming request body's 'hello' parameter
    if (context.body) {
      context.log.info((context.body as Record&lt;string, string&gt;).hello);
    } else {
      context.log.info('No data received');
    }
    return 'OK';
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can access the function by using the <code>kn func invoke</code> command:</p>
</div>
<div class="listingblock">
<div class="title">Example command</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ kn func invoke --target 'http://example.function.com' --data '{"hello": "world"}'</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">{"level":30,"time":1604511655265,"pid":3430203,"hostname":"localhost.localdomain","reqId":1,"msg":"world"}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="serverless-typescript-context-object-reference-headers_serverless-functions-reference-guide">headers</h4>
<div class="paragraph">
<p>Returns the HTTP request headers as an object.</p>
</div>
<div class="listingblock">
<div class="title">Example header</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-javascript" data-lang="javascript">export function handle(context: Context): string {
    // log the incoming request body's 'hello' parameter
    if (context.body) {
      context.log.info((context.headers as Record&lt;string, string&gt;)['custom-header']);
    } else {
      context.log.info('No data received');
    }
    return 'OK';
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can access the function by using the <code>curl</code> command to invoke it:</p>
</div>
<div class="listingblock">
<div class="title">Example command</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">$ curl -H'x-custom-header: some-value’' http://example.function.com</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-terminal" data-lang="terminal">{"level":30,"time":1604511655265,"pid":3430203,"hostname":"localhost.localdomain","reqId":1,"msg":"some-value"}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="serverless-typescript-context-object-reference-http-requests_serverless-functions-reference-guide">HTTP requests</h4>
<div class="dlist">
<dl>
<dt class="hdlist1">method</dt>
<dd>
<p>Returns the HTTP request method as a string.</p>
</dd>
<dt class="hdlist1">httpVersion</dt>
<dd>
<p>Returns the HTTP version as a string.</p>
</dd>
<dt class="hdlist1">httpVersionMajor</dt>
<dd>
<p>Returns the HTTP major version number as a string.</p>
</dd>
<dt class="hdlist1">httpVersionMinor</dt>
<dd>
<p>Returns the HTTP minor version number as a string.</p>
</dd>
</dl>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2023-06-21 10:15:23 UTC
</div>
</div>
</body>
</html>